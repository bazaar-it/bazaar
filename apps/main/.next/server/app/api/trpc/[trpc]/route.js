/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/trpc/[trpc]/route";
exports.ids = ["app/api/trpc/[trpc]/route"];
exports.modules = {

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&page=%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute.ts&appDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&page=%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute.ts&appDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/../../node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_markushogne_Documents_APPS_bazaar_vid_bazaar_vid_apps_main_src_app_api_trpc_trpc_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/trpc/[trpc]/route.ts */ \"(rsc)/./src/app/api/trpc/[trpc]/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_markushogne_Documents_APPS_bazaar_vid_bazaar_vid_apps_main_src_app_api_trpc_trpc_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_Users_markushogne_Documents_APPS_bazaar_vid_bazaar_vid_apps_main_src_app_api_trpc_trpc_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/trpc/[trpc]/route\",\n        pathname: \"/api/trpc/[trpc]\",\n        filename: \"route\",\n        bundlePath: \"app/api/trpc/[trpc]/route\"\n    },\n    resolvedPagePath: \"/Users/markushogne/Documents/APPS/bazaar-vid/bazaar-vid/apps/main/src/app/api/trpc/[trpc]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_markushogne_Documents_APPS_bazaar_vid_bazaar_vid_apps_main_src_app_api_trpc_trpc_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyL2luZGV4LmpzP25hbWU9YXBwJTJGYXBpJTJGdHJwYyUyRiU1QnRycGMlNUQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnRycGMlMkYlNUJ0cnBjJTVEJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGdHJwYyUyRiU1QnRycGMlNUQlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZtYXJrdXNob2duZSUyRkRvY3VtZW50cyUyRkFQUFMlMkZiYXphYXItdmlkJTJGYmF6YWFyLXZpZCUyRmFwcHMlMkZtYWluJTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRm1hcmt1c2hvZ25lJTJGRG9jdW1lbnRzJTJGQVBQUyUyRmJhemFhci12aWQlMkZiYXphYXItdmlkJTJGYXBwcyUyRm1haW4maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNrRDtBQUMvSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2FwcC9hcGkvdHJwYy9bdHJwY10vcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwic3RhbmRhbG9uZVwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90cnBjL1t0cnBjXS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3RycGMvW3RycGNdXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS90cnBjL1t0cnBjXS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9hcHAvYXBpL3RycGMvW3RycGNdL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&page=%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute.ts&appDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!**********************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \**********************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/../../packages/auth/config.ts":
/*!*************************************!*\
  !*** ../../packages/auth/config.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authConfig: () => (/* binding */ authConfig)\n/* harmony export */ });\n/* harmony import */ var _auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @auth/drizzle-adapter */ \"(rsc)/../../node_modules/@auth/drizzle-adapter/index.js\");\n/* harmony import */ var next_auth_providers_github__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/github */ \"(rsc)/../../node_modules/next-auth/providers/github.js\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/google */ \"(rsc)/../../node_modules/next-auth/providers/google.js\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_3__]);\n([_auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/auth/config.ts\n\n\n\n// Use validated env import if you set it up in env.js/mjs\n// import { env } from \"~/env\";\n\n/**\n * Options for NextAuth.js used to configure adapters, providers, callbacks, etc.\n *\n * @see https://next-auth.js.org/configuration/options\n */ const authConfig = {\n    debug: \"development\" === \"development\",\n    adapter: (0,_auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_0__.DrizzleAdapter)(_bazaar_database__WEBPACK_IMPORTED_MODULE_3__.db, {\n        usersTable: _bazaar_database__WEBPACK_IMPORTED_MODULE_3__.users,\n        accountsTable: _bazaar_database__WEBPACK_IMPORTED_MODULE_3__.accounts,\n        verificationTokensTable: _bazaar_database__WEBPACK_IMPORTED_MODULE_3__.verificationTokens\n    }),\n    providers: [\n        (0,next_auth_providers_github__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            clientId: process.env.AUTH_GITHUB_ID || \"\",\n            clientSecret: process.env.AUTH_GITHUB_SECRET || \"\",\n            allowDangerousEmailAccountLinking: true\n        }),\n        (0,next_auth_providers_google__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n            clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\n            allowDangerousEmailAccountLinking: true\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    callbacks: {\n        // Add the JWT callback needed for JWT strategy\n        jwt ({ token, user }) {\n            if (user) {\n                token.id = user.id;\n            }\n            return token;\n        },\n        // Session callback reads from the token\n        session: ({ session, token })=>({\n                ...session,\n                user: {\n                    ...session.user,\n                    id: token.id\n                }\n            }),\n        // Handle account linking for OAuth providers\n        async signIn ({ user, account, profile, email, credentials }) {\n            // Allow all OAuth sign-ins\n            if (account?.provider === \"google\" || account?.provider === \"github\") {\n                return true;\n            }\n            return true;\n        },\n        // Your authorized callback can likely stay here too\n        authorized ({ auth, request: { nextUrl } }) {\n            const isLoggedIn = !!auth?.user;\n            const isProtectedRoute = nextUrl.pathname.startsWith('/projects');\n            // Consider if API should be protected differently (e.g., allow unauthed access to specific tRPC routes?)\n            const isApiRoute = nextUrl.pathname.startsWith('/api/');\n            if (isProtectedRoute || isApiRoute && !nextUrl.pathname.startsWith('/api/auth')) {\n                if (isLoggedIn) return true;\n                return false; // Redirect for protected routes\n            }\n            return true; // Allow public routes\n        }\n    },\n    // secret: env.AUTH_SECRET, // Implicitly uses AUTH_SECRET env var in v5\n    pages: {\n        signIn: \"/login\"\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvYXV0aC9jb25maWcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSw0QkFBNEI7QUFDMkI7QUFFQztBQUNBO0FBQ3hELDBEQUEwRDtBQUMxRCwrQkFBK0I7QUFDNEM7QUF1QjNFOzs7O0NBSUMsR0FDTSxNQUFNTyxhQUFhO0lBQ3hCQyxPQUFPQyxrQkFBeUI7SUFDaENDLFNBQVNWLHFFQUFjQSxDQUFDRyxnREFBRUEsRUFBRTtRQUMxQlEsWUFBWU4sbURBQUtBO1FBQ2pCTyxlQUFlUixzREFBUUE7UUFDdkJTLHlCQUF5QlAsZ0VBQWtCQTtJQUU3QztJQUNBUSxXQUFXO1FBQ1RiLHNFQUFjQSxDQUFDO1lBQ2JjLFVBQVVOLFFBQVFPLEdBQUcsQ0FBQ0MsY0FBYyxJQUFJO1lBQ3hDQyxjQUFjVCxRQUFRTyxHQUFHLENBQUNHLGtCQUFrQixJQUFJO1lBQ2hEQyxtQ0FBbUM7UUFDckM7UUFDQWxCLHNFQUFjQSxDQUFDO1lBQ2JhLFVBQVVOLFFBQVFPLEdBQUcsQ0FBQ0ssZ0JBQWdCLElBQUk7WUFDMUNILGNBQWNULFFBQVFPLEdBQUcsQ0FBQ00sb0JBQW9CLElBQUk7WUFDbERGLG1DQUFtQztRQUNyQztLQUNEO0lBQ0RHLFNBQVM7UUFDUEMsVUFBVTtJQUNaO0lBQ0FDLFdBQVc7UUFDVCwrQ0FBK0M7UUFDL0NDLEtBQUksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUU7WUFDakIsSUFBSUEsTUFBTTtnQkFDUkQsTUFBTUUsRUFBRSxHQUFHRCxLQUFLQyxFQUFFO1lBQ3BCO1lBQ0EsT0FBT0Y7UUFDVDtRQUNBLHdDQUF3QztRQUN4Q0osU0FBUyxDQUFDLEVBQUVBLE9BQU8sRUFBRUksS0FBSyxFQUFFLEdBQU07Z0JBQ2hDLEdBQUdKLE9BQU87Z0JBQ1ZLLE1BQU07b0JBQ0osR0FBR0wsUUFBUUssSUFBSTtvQkFDZkMsSUFBSUYsTUFBTUUsRUFBRTtnQkFDZDtZQUNGO1FBQ0EsNkNBQTZDO1FBQzdDLE1BQU1DLFFBQU8sRUFBRUYsSUFBSSxFQUFFRyxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsS0FBSyxFQUFFQyxXQUFXLEVBQUU7WUFDekQsMkJBQTJCO1lBQzNCLElBQUlILFNBQVNJLGFBQWEsWUFBWUosU0FBU0ksYUFBYSxVQUFVO2dCQUNwRSxPQUFPO1lBQ1Q7WUFDQSxPQUFPO1FBQ1Q7UUFDQSxvREFBb0Q7UUFDcERDLFlBQVcsRUFBRUMsSUFBSSxFQUFFQyxTQUFTLEVBQUVDLE9BQU8sRUFBRSxFQUFFO1lBQ3ZDLE1BQU1DLGFBQWEsQ0FBQyxDQUFDSCxNQUFNVDtZQUMzQixNQUFNYSxtQkFBbUJGLFFBQVFHLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDO1lBQ3JELHlHQUF5RztZQUN6RyxNQUFNQyxhQUFhTCxRQUFRRyxRQUFRLENBQUNDLFVBQVUsQ0FBQztZQUMvQyxJQUFJRixvQkFBcUJHLGNBQWMsQ0FBQ0wsUUFBUUcsUUFBUSxDQUFDQyxVQUFVLENBQUMsY0FBZTtnQkFDakYsSUFBSUgsWUFBWSxPQUFPO2dCQUN2QixPQUFPLE9BQU8sZ0NBQWdDO1lBQ2hEO1lBQ0EsT0FBTyxNQUFNLHNCQUFzQjtRQUNyQztJQUNGO0lBQ0Esd0VBQXdFO0lBQ3hFSyxPQUFPO1FBQUVmLFFBQVE7SUFBUztBQUM1QixFQUEyQiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9wYWNrYWdlcy9hdXRoL2NvbmZpZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2F1dGgvY29uZmlnLnRzXG5pbXBvcnQgeyBEcml6emxlQWRhcHRlciB9IGZyb20gXCJAYXV0aC9kcml6emxlLWFkYXB0ZXJcIjtcbmltcG9ydCB7IHR5cGUgRGVmYXVsdFNlc3Npb24sIHR5cGUgTmV4dEF1dGhDb25maWcgfSBmcm9tIFwibmV4dC1hdXRoXCI7XG5pbXBvcnQgR2l0SHViUHJvdmlkZXIgZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnMvZ2l0aHViXCI7XG5pbXBvcnQgR29vZ2xlUHJvdmlkZXIgZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnMvZ29vZ2xlXCI7XG4vLyBVc2UgdmFsaWRhdGVkIGVudiBpbXBvcnQgaWYgeW91IHNldCBpdCB1cCBpbiBlbnYuanMvbWpzXG4vLyBpbXBvcnQgeyBlbnYgfSBmcm9tIFwifi9lbnZcIjtcbmltcG9ydCB7IGRiLCBhY2NvdW50cywgdXNlcnMsIHZlcmlmaWNhdGlvblRva2VucyB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5cbi8qKlxuICogTW9kdWxlIGF1Z21lbnRhdGlvbiBmb3IgYG5leHQtYXV0aGAgdHlwZXMuIEFsbG93cyB1cyB0byBhZGQgY3VzdG9tIHByb3BlcnRpZXMgdG8gdGhlIGBzZXNzaW9uYFxuICogb2JqZWN0IGFuZCBrZWVwIHR5cGUgc2FmZXR5LlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9uZXh0LWF1dGguanMub3JnL2dldHRpbmctc3RhcnRlZC90eXBlc2NyaXB0I21vZHVsZS1hdWdtZW50YXRpb25cbiAqL1xuZGVjbGFyZSBtb2R1bGUgXCJuZXh0LWF1dGhcIiB7XG4gIGludGVyZmFjZSBTZXNzaW9uIGV4dGVuZHMgRGVmYXVsdFNlc3Npb24ge1xuICAgIHVzZXI6IHtcbiAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAvLyAuLi5vdGhlciBwcm9wZXJ0aWVzXG4gICAgICAvLyByb2xlOiBVc2VyUm9sZTtcbiAgICB9ICYgRGVmYXVsdFNlc3Npb25bXCJ1c2VyXCJdO1xuICB9XG5cbiAgLy8gaW50ZXJmYWNlIFVzZXIge1xuICAvLyAgIC8vIC4uLm90aGVyIHByb3BlcnRpZXNcbiAgLy8gICAvLyByb2xlOiBVc2VyUm9sZTtcbiAgLy8gfVxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIE5leHRBdXRoLmpzIHVzZWQgdG8gY29uZmlndXJlIGFkYXB0ZXJzLCBwcm92aWRlcnMsIGNhbGxiYWNrcywgZXRjLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9uZXh0LWF1dGguanMub3JnL2NvbmZpZ3VyYXRpb24vb3B0aW9uc1xuICovXG5leHBvcnQgY29uc3QgYXV0aENvbmZpZyA9IHtcbiAgZGVidWc6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIsXG4gIGFkYXB0ZXI6IERyaXp6bGVBZGFwdGVyKGRiLCB7XG4gICAgdXNlcnNUYWJsZTogdXNlcnMsXG4gICAgYWNjb3VudHNUYWJsZTogYWNjb3VudHMsXG4gICAgdmVyaWZpY2F0aW9uVG9rZW5zVGFibGU6IHZlcmlmaWNhdGlvblRva2VucyxcbiAgICAvLyBETyBOT1QgYWRkIHNlc3Npb25zVGFibGUgaGVyZVxuICB9KSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgR2l0SHViUHJvdmlkZXIoe1xuICAgICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LkFVVEhfR0lUSFVCX0lEIHx8IFwiXCIsXG4gICAgICBjbGllbnRTZWNyZXQ6IHByb2Nlc3MuZW52LkFVVEhfR0lUSFVCX1NFQ1JFVCB8fCBcIlwiLFxuICAgICAgYWxsb3dEYW5nZXJvdXNFbWFpbEFjY291bnRMaW5raW5nOiB0cnVlLFxuICAgIH0pLFxuICAgIEdvb2dsZVByb3ZpZGVyKHtcbiAgICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEIHx8IFwiXCIsXG4gICAgICBjbGllbnRTZWNyZXQ6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUIHx8IFwiXCIsXG4gICAgICBhbGxvd0Rhbmdlcm91c0VtYWlsQWNjb3VudExpbmtpbmc6IHRydWUsXG4gICAgfSksXG4gIF0sXG4gIHNlc3Npb246IHtcbiAgICBzdHJhdGVneTogXCJqd3RcIixcbiAgfSxcbiAgY2FsbGJhY2tzOiB7XG4gICAgLy8gQWRkIHRoZSBKV1QgY2FsbGJhY2sgbmVlZGVkIGZvciBKV1Qgc3RyYXRlZ3lcbiAgICBqd3QoeyB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5pZCA9IHVzZXIuaWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW47XG4gICAgfSxcbiAgICAvLyBTZXNzaW9uIGNhbGxiYWNrIHJlYWRzIGZyb20gdGhlIHRva2VuXG4gICAgc2Vzc2lvbjogKHsgc2Vzc2lvbiwgdG9rZW4gfSkgPT4gKHtcbiAgICAgIC4uLnNlc3Npb24sXG4gICAgICB1c2VyOiB7XG4gICAgICAgIC4uLnNlc3Npb24udXNlcixcbiAgICAgICAgaWQ6IHRva2VuLmlkIGFzIHN0cmluZywgLy8gRW5zdXJlIElEIGZyb20gdG9rZW4gaXMgcHV0IGludG8gc2Vzc2lvbiB1c2VyXG4gICAgICB9LFxuICAgIH0pLFxuICAgIC8vIEhhbmRsZSBhY2NvdW50IGxpbmtpbmcgZm9yIE9BdXRoIHByb3ZpZGVyc1xuICAgIGFzeW5jIHNpZ25Jbih7IHVzZXIsIGFjY291bnQsIHByb2ZpbGUsIGVtYWlsLCBjcmVkZW50aWFscyB9KSB7XG4gICAgICAvLyBBbGxvdyBhbGwgT0F1dGggc2lnbi1pbnNcbiAgICAgIGlmIChhY2NvdW50Py5wcm92aWRlciA9PT0gXCJnb29nbGVcIiB8fCBhY2NvdW50Py5wcm92aWRlciA9PT0gXCJnaXRodWJcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgLy8gWW91ciBhdXRob3JpemVkIGNhbGxiYWNrIGNhbiBsaWtlbHkgc3RheSBoZXJlIHRvb1xuICAgIGF1dGhvcml6ZWQoeyBhdXRoLCByZXF1ZXN0OiB7IG5leHRVcmwgfSB9KSB7XG4gICAgICBjb25zdCBpc0xvZ2dlZEluID0gISFhdXRoPy51c2VyO1xuICAgICAgY29uc3QgaXNQcm90ZWN0ZWRSb3V0ZSA9IG5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL3Byb2plY3RzJyk7XG4gICAgICAvLyBDb25zaWRlciBpZiBBUEkgc2hvdWxkIGJlIHByb3RlY3RlZCBkaWZmZXJlbnRseSAoZS5nLiwgYWxsb3cgdW5hdXRoZWQgYWNjZXNzIHRvIHNwZWNpZmljIHRSUEMgcm91dGVzPylcbiAgICAgIGNvbnN0IGlzQXBpUm91dGUgPSBuZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvJyk7XG4gICAgICBpZiAoaXNQcm90ZWN0ZWRSb3V0ZSB8fCAoaXNBcGlSb3V0ZSAmJiAhbmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpL2F1dGgnKSkpIHsgLy8gRXhhbXBsZTogUHJvdGVjdCBBUEkgZXhjZXB0IGF1dGggcm91dGVzXG4gICAgICAgIGlmIChpc0xvZ2dlZEluKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBSZWRpcmVjdCBmb3IgcHJvdGVjdGVkIHJvdXRlc1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7IC8vIEFsbG93IHB1YmxpYyByb3V0ZXNcbiAgICB9LFxuICB9LFxuICAvLyBzZWNyZXQ6IGVudi5BVVRIX1NFQ1JFVCwgLy8gSW1wbGljaXRseSB1c2VzIEFVVEhfU0VDUkVUIGVudiB2YXIgaW4gdjVcbiAgcGFnZXM6IHsgc2lnbkluOiBcIi9sb2dpblwiIH0sIC8vIEN1c3RvbSBsb2dpbiBwYWdlXG59IHNhdGlzZmllcyBOZXh0QXV0aENvbmZpZztcbiJdLCJuYW1lcyI6WyJEcml6emxlQWRhcHRlciIsIkdpdEh1YlByb3ZpZGVyIiwiR29vZ2xlUHJvdmlkZXIiLCJkYiIsImFjY291bnRzIiwidXNlcnMiLCJ2ZXJpZmljYXRpb25Ub2tlbnMiLCJhdXRoQ29uZmlnIiwiZGVidWciLCJwcm9jZXNzIiwiYWRhcHRlciIsInVzZXJzVGFibGUiLCJhY2NvdW50c1RhYmxlIiwidmVyaWZpY2F0aW9uVG9rZW5zVGFibGUiLCJwcm92aWRlcnMiLCJjbGllbnRJZCIsImVudiIsIkFVVEhfR0lUSFVCX0lEIiwiY2xpZW50U2VjcmV0IiwiQVVUSF9HSVRIVUJfU0VDUkVUIiwiYWxsb3dEYW5nZXJvdXNFbWFpbEFjY291bnRMaW5raW5nIiwiR09PR0xFX0NMSUVOVF9JRCIsIkdPT0dMRV9DTElFTlRfU0VDUkVUIiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJ1c2VyIiwiaWQiLCJzaWduSW4iLCJhY2NvdW50IiwicHJvZmlsZSIsImVtYWlsIiwiY3JlZGVudGlhbHMiLCJwcm92aWRlciIsImF1dGhvcml6ZWQiLCJhdXRoIiwicmVxdWVzdCIsIm5leHRVcmwiLCJpc0xvZ2dlZEluIiwiaXNQcm90ZWN0ZWRSb3V0ZSIsInBhdGhuYW1lIiwic3RhcnRzV2l0aCIsImlzQXBpUm91dGUiLCJwYWdlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/auth/config.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/auth/index.ts":
/*!************************************!*\
  !*** ../../packages/auth/index.ts ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signOut: () => (/* binding */ signOut)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/../../node_modules/next-auth/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(rsc)/../../node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ \"(rsc)/../../packages/auth/config.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_config__WEBPACK_IMPORTED_MODULE_2__]);\n_config__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// src/server/auth/index.ts\n\n\n\nconst { auth: uncachedAuth, handlers, signIn, signOut } = (0,next_auth__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(_config__WEBPACK_IMPORTED_MODULE_2__.authConfig);\nconst auth = (0,react__WEBPACK_IMPORTED_MODULE_1__.cache)(uncachedAuth);\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvYXV0aC9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLDJCQUEyQjtBQUNNO0FBQ0g7QUFFUTtBQUV0QyxNQUFNLEVBQUVHLE1BQU1DLFlBQVksRUFBRUMsUUFBUSxFQUFFQyxNQUFNLEVBQUVDLE9BQU8sRUFBRSxHQUFHUCxxREFBUUEsQ0FBQ0UsK0NBQVVBO0FBRTdFLE1BQU1DLE9BQU9GLDRDQUFLQSxDQUFDRztBQUV3QiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9wYWNrYWdlcy9hdXRoL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvYXV0aC9pbmRleC50c1xuaW1wb3J0IE5leHRBdXRoIGZyb20gXCJuZXh0LWF1dGhcIjtcbmltcG9ydCB7IGNhY2hlIH0gZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB7IGF1dGhDb25maWcgfSBmcm9tIFwiLi9jb25maWdcIjtcblxuY29uc3QgeyBhdXRoOiB1bmNhY2hlZEF1dGgsIGhhbmRsZXJzLCBzaWduSW4sIHNpZ25PdXQgfSA9IE5leHRBdXRoKGF1dGhDb25maWcpO1xuXG5jb25zdCBhdXRoID0gY2FjaGUodW5jYWNoZWRBdXRoKTtcblxuZXhwb3J0IHsgYXV0aCwgaGFuZGxlcnMsIHNpZ25Jbiwgc2lnbk91dCB9O1xuIl0sIm5hbWVzIjpbIk5leHRBdXRoIiwiY2FjaGUiLCJhdXRoQ29uZmlnIiwiYXV0aCIsInVuY2FjaGVkQXV0aCIsImhhbmRsZXJzIiwic2lnbkluIiwic2lnbk91dCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/auth/index.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/database/index.ts":
/*!****************************************!*\
  !*** ../../packages/database/index.ts ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MEMORY_TYPES: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.MEMORY_TYPES),\n/* harmony export */   accounts: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.accounts),\n/* harmony export */   accountsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.accountsRelations),\n/* harmony export */   agentMessages: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.agentMessages),\n/* harmony export */   agentMessagesIndexes: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.agentMessagesIndexes),\n/* harmony export */   animationDesignBriefs: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.animationDesignBriefs),\n/* harmony export */   animationDesignBriefsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.animationDesignBriefsRelations),\n/* harmony export */   componentErrors: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.componentErrors),\n/* harmony export */   componentErrorsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.componentErrorsRelations),\n/* harmony export */   componentEvaluationMetrics: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.componentEvaluationMetrics),\n/* harmony export */   componentEvaluationMetricsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.componentEvaluationMetricsRelations),\n/* harmony export */   componentTestCases: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.componentTestCases),\n/* harmony export */   createTable: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.createTable),\n/* harmony export */   customComponentJobs: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.customComponentJobs),\n/* harmony export */   customComponentJobsRecoveryUpdate: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.customComponentJobsRecoveryUpdate),\n/* harmony export */   customComponentJobsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.customComponentJobsRelations),\n/* harmony export */   customComponentJobsUpdate: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.customComponentJobsUpdate),\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   emailSubscribers: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.emailSubscribers),\n/* harmony export */   emailSubscribersRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.emailSubscribersRelations),\n/* harmony export */   executeWithRetry: () => (/* binding */ executeWithRetry),\n/* harmony export */   feedback: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.feedback),\n/* harmony export */   feedbackRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.feedbackRelations),\n/* harmony export */   imageAnalysis: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.imageAnalysis),\n/* harmony export */   imageAnalysisRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.imageAnalysisRelations),\n/* harmony export */   messages: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.messages),\n/* harmony export */   messagesRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.messagesRelations),\n/* harmony export */   metrics: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.metrics),\n/* harmony export */   patches: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.patches),\n/* harmony export */   patchesRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.patchesRelations),\n/* harmony export */   projectMemory: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.projectMemory),\n/* harmony export */   projectMemoryRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.projectMemoryRelations),\n/* harmony export */   projects: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.projects),\n/* harmony export */   projectsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.projectsRelations),\n/* harmony export */   sceneIterations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.sceneIterations),\n/* harmony export */   sceneIterationsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.sceneIterationsRelations),\n/* harmony export */   scenePlans: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.scenePlans),\n/* harmony export */   scenePlansRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.scenePlansRelations),\n/* harmony export */   sceneSpecs: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.sceneSpecs),\n/* harmony export */   sceneSpecsRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.sceneSpecsRelations),\n/* harmony export */   scenes: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.scenes),\n/* harmony export */   scenesRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.scenesRelations),\n/* harmony export */   sharedVideos: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.sharedVideos),\n/* harmony export */   sharedVideosRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.sharedVideosRelations),\n/* harmony export */   users: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.users),\n/* harmony export */   usersRelations: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.usersRelations),\n/* harmony export */   verificationTokens: () => (/* reexport safe */ _schema__WEBPACK_IMPORTED_MODULE_2__.verificationTokens)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm_neon_http__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! drizzle-orm/neon-http */ \"drizzle-orm/neon-http\");\n/* harmony import */ var _neondatabase_serverless__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @neondatabase/serverless */ \"(rsc)/../../node_modules/@neondatabase/serverless/index.mjs\");\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./schema */ \"(rsc)/../../packages/database/schema.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([drizzle_orm_neon_http__WEBPACK_IMPORTED_MODULE_0__, _schema__WEBPACK_IMPORTED_MODULE_2__]);\n([drizzle_orm_neon_http__WEBPACK_IMPORTED_MODULE_0__, _schema__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/db/index.ts\n\n\n\n// Recommended by Neon for Drizzle to cache connection details.\n_neondatabase_serverless__WEBPACK_IMPORTED_MODULE_1__.neonConfig.fetchConnectionCache = true;\nconst createDbConnection = ()=>{\n    // console.log(\"Creating new Neon database connection instance\"); \n    const sql = (0,_neondatabase_serverless__WEBPACK_IMPORTED_MODULE_1__.neon)(process.env.DATABASE_URL, {\n        fetchOptions: {\n            keepalive: true,\n            timeout: 30000\n        }\n    });\n    return (0,drizzle_orm_neon_http__WEBPACK_IMPORTED_MODULE_0__.drizzle)(sql, {\n        schema: _schema__WEBPACK_IMPORTED_MODULE_2__\n    });\n};\nconst createDummyDbConnection = ()=>{\n    // console.warn(\"Falling back to dummy Neon database connection instance\"); \n    const dummySql = (0,_neondatabase_serverless__WEBPACK_IMPORTED_MODULE_1__.neon)(\"postgresql://user:password@localhost:5432/dummy\");\n    return (0,drizzle_orm_neon_http__WEBPACK_IMPORTED_MODULE_0__.drizzle)(dummySql, {\n        schema: _schema__WEBPACK_IMPORTED_MODULE_2__\n    });\n};\nlet dbConnectionInstance;\nif (false) {} else {\n    // Development: cache the connection on the global object to reuse across HMR reloads.\n    if (!global.__drizzleNeonClient__) {\n        console.log(\"Initializing Neon database connection for DEVELOPMENT (new global instance)\");\n        try {\n            global.__drizzleNeonClient__ = createDbConnection();\n        } catch (error) {\n            console.error(\"Failed to initialize globally cached database connection for DEVELOPMENT:\", error);\n            global.__drizzleNeonClient__ = createDummyDbConnection();\n        }\n    } else {\n        console.log(\"Reusing existing Neon database connection for DEVELOPMENT from global cache\");\n    }\n    dbConnectionInstance = global.__drizzleNeonClient__;\n}\nconst db = dbConnectionInstance;\n/**\n * Execute a database operation with retry logic for transient connection issues\n * @param operation Function that performs the database operation\n * @param maxRetries Maximum number of retry attempts\n * @param initialDelay Initial delay between retries in ms\n * @returns Result of the database operation\n */ async function executeWithRetry(operation, maxRetries = 3, initialDelay = 200) {\n    let lastError;\n    let delay = initialDelay;\n    for(let attempt = 0; attempt <= maxRetries; attempt++){\n        try {\n            return await operation();\n        } catch (error) {\n            lastError = error;\n            // Check if this is a connection-related error that might be transient\n            const isTransientError = error instanceof Error && // Common network errors\n            (error.message.includes('ECONNRESET') || error.message.includes('socket hang up') || error.message.includes('connection timeout') || error.message.includes('network error') || error.message.includes('fetch failed') || error.message.includes('Connect Timeout Error') || error.message.includes('UND_ERR_CONNECT_TIMEOUT') || // Neon specific errors\n            error.message.includes('Error connecting to database') || error.message.includes('Connection terminated unexpectedly') || error.message.includes('NeonDbError') || error.message.includes('ConnectTimeoutError'));\n            if (!isTransientError || attempt === maxRetries) {\n                // Not a transient error or we've exhausted our retries\n                throw error;\n            }\n            console.warn(`Database operation failed (attempt ${attempt + 1}/${maxRetries + 1}), retrying in ${delay}ms:`, error instanceof Error ? error.message : String(error));\n            // Exponential backoff with jitter\n            await new Promise((resolve)=>setTimeout(resolve, delay + Math.random() * 100));\n            delay = Math.min(delay * 2, 5000); // Exponential backoff with max 5s delay\n        }\n    }\n    // This should never be reached due to the throw in the loop, but TypeScript needs it\n    throw lastError;\n}\n// Export schema for use in other files\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGF0YWJhc2UvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBeUI7QUFDc0M7QUFDSDtBQUV6QjtBQUVuQywrREFBK0Q7QUFDL0RHLGdFQUFVQSxDQUFDRSxvQkFBb0IsR0FBRztBQVFsQyxNQUFNQyxxQkFBcUI7SUFDekIsa0VBQWtFO0lBQ2xFLE1BQU1DLE1BQU1MLDhEQUFJQSxDQUFDTSxRQUFRQyxHQUFHLENBQUNDLFlBQVksRUFBRztRQUMxQ0MsY0FBYztZQUNaQyxXQUFXO1lBQ1hDLFNBQVM7UUFDWDtJQUNGO0lBQ0EsT0FBT1osOERBQVdBLENBQUNNLEtBQUs7UUFBRUgsTUFBTUEsc0NBQUFBO0lBQUM7QUFDbkM7QUFFQSxNQUFNVSwwQkFBMEI7SUFDOUIsNEVBQTRFO0lBQzVFLE1BQU1DLFdBQVdiLDhEQUFJQSxDQUFDO0lBQ3RCLE9BQU9ELDhEQUFXQSxDQUFDYyxVQUFVO1FBQUVYLE1BQU1BLHNDQUFBQTtJQUFDO0FBQ3hDO0FBRUEsSUFBSVk7QUFFSixJQUFJUixLQUFxQyxFQUFFLEVBUTFDLE1BQU07SUFDTCxzRkFBc0Y7SUFDdEYsSUFBSSxDQUFDWSxPQUFPQyxxQkFBcUIsRUFBRTtRQUNqQ0osUUFBUUMsR0FBRyxDQUFDO1FBQ1osSUFBSTtZQUNGRSxPQUFPQyxxQkFBcUIsR0FBR2Y7UUFDakMsRUFBRSxPQUFPYSxPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyw2RUFBNkVBO1lBQzNGQyxPQUFPQyxxQkFBcUIsR0FBR1A7UUFDakM7SUFDRixPQUFPO1FBQ0xHLFFBQVFDLEdBQUcsQ0FBQztJQUNkO0lBQ0FGLHVCQUF1QkksT0FBT0MscUJBQXFCO0FBQ3JEO0FBRU8sTUFBTUMsS0FBS04scUJBQXFCO0FBRXZDOzs7Ozs7Q0FNQyxHQUNNLGVBQWVPLGlCQUNwQkMsU0FBMkIsRUFDM0JDLGFBQWEsQ0FBQyxFQUNkQyxlQUFlLEdBQUc7SUFFbEIsSUFBSUM7SUFDSixJQUFJQyxRQUFRRjtJQUVaLElBQUssSUFBSUcsVUFBVSxHQUFHQSxXQUFXSixZQUFZSSxVQUFXO1FBQ3RELElBQUk7WUFDRixPQUFPLE1BQU1MO1FBQ2YsRUFBRSxPQUFPTCxPQUFPO1lBQ2RRLFlBQVlSO1lBRVosc0VBQXNFO1lBQ3RFLE1BQU1XLG1CQUNKWCxpQkFBaUJZLFNBRWYsd0JBQXdCO1lBQ3hCWixDQUFBQSxNQUFNYSxPQUFPLENBQUNDLFFBQVEsQ0FBQyxpQkFDdkJkLE1BQU1hLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLHFCQUN2QmQsTUFBTWEsT0FBTyxDQUFDQyxRQUFRLENBQUMseUJBQ3ZCZCxNQUFNYSxPQUFPLENBQUNDLFFBQVEsQ0FBQyxvQkFDdkJkLE1BQU1hLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLG1CQUN2QmQsTUFBTWEsT0FBTyxDQUFDQyxRQUFRLENBQUMsNEJBQ3ZCZCxNQUFNYSxPQUFPLENBQUNDLFFBQVEsQ0FBQyw4QkFDdkIsdUJBQXVCO1lBQ3ZCZCxNQUFNYSxPQUFPLENBQUNDLFFBQVEsQ0FBQyxtQ0FDdkJkLE1BQU1hLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLHlDQUN2QmQsTUFBTWEsT0FBTyxDQUFDQyxRQUFRLENBQUMsa0JBQ3ZCZCxNQUFNYSxPQUFPLENBQUNDLFFBQVEsQ0FBQyxzQkFBcUI7WUFHaEQsSUFBSSxDQUFDSCxvQkFBb0JELFlBQVlKLFlBQVk7Z0JBQy9DLHVEQUF1RDtnQkFDdkQsTUFBTU47WUFDUjtZQUVBRixRQUFRaUIsSUFBSSxDQUFDLENBQUMsbUNBQW1DLEVBQUVMLFVBQVUsRUFBRSxDQUFDLEVBQUVKLGFBQWEsRUFBRSxlQUFlLEVBQUVHLE1BQU0sR0FBRyxDQUFDLEVBQzFHVCxpQkFBaUJZLFFBQVFaLE1BQU1hLE9BQU8sR0FBR0csT0FBT2hCO1lBRWxELGtDQUFrQztZQUNsQyxNQUFNLElBQUlpQixRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTVCxRQUFRVyxLQUFLQyxNQUFNLEtBQUs7WUFDekVaLFFBQVFXLEtBQUtFLEdBQUcsQ0FBQ2IsUUFBUSxHQUFHLE9BQU8sd0NBQXdDO1FBQzdFO0lBQ0Y7SUFFQSxxRkFBcUY7SUFDckYsTUFBTUQ7QUFDUjtBQUVBLHVDQUF1QztBQUNkIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL3BhY2thZ2VzL2RhdGFiYXNlL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvZGIvaW5kZXgudHNcbmltcG9ydCB7IGRyaXp6bGUgYXMgZHJpenpsZU5lb24gfSBmcm9tIFwiZHJpenpsZS1vcm0vbmVvbi1odHRwXCI7XG5pbXBvcnQgeyBuZW9uLCBuZW9uQ29uZmlnIH0gZnJvbSBcIkBuZW9uZGF0YWJhc2Uvc2VydmVybGVzc1wiO1xuXG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSBcIi4vc2NoZW1hXCI7XG5cbi8vIFJlY29tbWVuZGVkIGJ5IE5lb24gZm9yIERyaXp6bGUgdG8gY2FjaGUgY29ubmVjdGlvbiBkZXRhaWxzLlxubmVvbkNvbmZpZy5mZXRjaENvbm5lY3Rpb25DYWNoZSA9IHRydWU7XG5cbi8vIEF1Z21lbnQgdGhlIE5vZGVKUyBnbG9iYWwgdHlwZSBmb3IgSE1SLXByb29maW5nIGluIGRldmVsb3BtZW50XG5kZWNsYXJlIGdsb2JhbCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXJcbiAgdmFyIF9fZHJpenpsZU5lb25DbGllbnRfXzogUmV0dXJuVHlwZTx0eXBlb2YgZHJpenpsZU5lb248dHlwZW9mIHNjaGVtYT4+IHwgdW5kZWZpbmVkO1xufVxuXG5jb25zdCBjcmVhdGVEYkNvbm5lY3Rpb24gPSAoKSA9PiB7XG4gIC8vIGNvbnNvbGUubG9nKFwiQ3JlYXRpbmcgbmV3IE5lb24gZGF0YWJhc2UgY29ubmVjdGlvbiBpbnN0YW5jZVwiKTsgXG4gIGNvbnN0IHNxbCA9IG5lb24ocHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMISwge1xuICAgIGZldGNoT3B0aW9uczoge1xuICAgICAga2VlcGFsaXZlOiB0cnVlLFxuICAgICAgdGltZW91dDogMzAwMDAsIC8vIDMwIHNlY29uZHMgKGluY3JlYXNlZCBmcm9tIDEwKVxuICAgIH0sXG4gIH0pO1xuICByZXR1cm4gZHJpenpsZU5lb24oc3FsLCB7IHNjaGVtYSB9KTtcbn07XG5cbmNvbnN0IGNyZWF0ZUR1bW15RGJDb25uZWN0aW9uID0gKCkgPT4ge1xuICAvLyBjb25zb2xlLndhcm4oXCJGYWxsaW5nIGJhY2sgdG8gZHVtbXkgTmVvbiBkYXRhYmFzZSBjb25uZWN0aW9uIGluc3RhbmNlXCIpOyBcbiAgY29uc3QgZHVtbXlTcWwgPSBuZW9uKFwicG9zdGdyZXNxbDovL3VzZXI6cGFzc3dvcmRAbG9jYWxob3N0OjU0MzIvZHVtbXlcIik7XG4gIHJldHVybiBkcml6emxlTmVvbihkdW1teVNxbCwgeyBzY2hlbWEgfSk7XG59O1xuXG5sZXQgZGJDb25uZWN0aW9uSW5zdGFuY2U6IFJldHVyblR5cGU8dHlwZW9mIGRyaXp6bGVOZW9uPHR5cGVvZiBzY2hlbWE+PjtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIikge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIE5lb24gZGF0YWJhc2UgY29ubmVjdGlvbiBmb3IgUFJPRFVDVElPTlwiKTtcbiAgICBkYkNvbm5lY3Rpb25JbnN0YW5jZSA9IGNyZWF0ZURiQ29ubmVjdGlvbigpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBkYXRhYmFzZSBjb25uZWN0aW9uIGZvciBQUk9EVUNUSU9OOlwiLCBlcnJvcik7XG4gICAgZGJDb25uZWN0aW9uSW5zdGFuY2UgPSBjcmVhdGVEdW1teURiQ29ubmVjdGlvbigpO1xuICB9XG59IGVsc2Uge1xuICAvLyBEZXZlbG9wbWVudDogY2FjaGUgdGhlIGNvbm5lY3Rpb24gb24gdGhlIGdsb2JhbCBvYmplY3QgdG8gcmV1c2UgYWNyb3NzIEhNUiByZWxvYWRzLlxuICBpZiAoIWdsb2JhbC5fX2RyaXp6bGVOZW9uQ2xpZW50X18pIHtcbiAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyBOZW9uIGRhdGFiYXNlIGNvbm5lY3Rpb24gZm9yIERFVkVMT1BNRU5UIChuZXcgZ2xvYmFsIGluc3RhbmNlKVwiKTtcbiAgICB0cnkge1xuICAgICAgZ2xvYmFsLl9fZHJpenpsZU5lb25DbGllbnRfXyA9IGNyZWF0ZURiQ29ubmVjdGlvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgZ2xvYmFsbHkgY2FjaGVkIGRhdGFiYXNlIGNvbm5lY3Rpb24gZm9yIERFVkVMT1BNRU5UOlwiLCBlcnJvcik7XG4gICAgICBnbG9iYWwuX19kcml6emxlTmVvbkNsaWVudF9fID0gY3JlYXRlRHVtbXlEYkNvbm5lY3Rpb24oKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCJSZXVzaW5nIGV4aXN0aW5nIE5lb24gZGF0YWJhc2UgY29ubmVjdGlvbiBmb3IgREVWRUxPUE1FTlQgZnJvbSBnbG9iYWwgY2FjaGVcIik7XG4gIH1cbiAgZGJDb25uZWN0aW9uSW5zdGFuY2UgPSBnbG9iYWwuX19kcml6emxlTmVvbkNsaWVudF9fO1xufVxuXG5leHBvcnQgY29uc3QgZGIgPSBkYkNvbm5lY3Rpb25JbnN0YW5jZTtcblxuLyoqXG4gKiBFeGVjdXRlIGEgZGF0YWJhc2Ugb3BlcmF0aW9uIHdpdGggcmV0cnkgbG9naWMgZm9yIHRyYW5zaWVudCBjb25uZWN0aW9uIGlzc3Vlc1xuICogQHBhcmFtIG9wZXJhdGlvbiBGdW5jdGlvbiB0aGF0IHBlcmZvcm1zIHRoZSBkYXRhYmFzZSBvcGVyYXRpb25cbiAqIEBwYXJhbSBtYXhSZXRyaWVzIE1heGltdW0gbnVtYmVyIG9mIHJldHJ5IGF0dGVtcHRzXG4gKiBAcGFyYW0gaW5pdGlhbERlbGF5IEluaXRpYWwgZGVsYXkgYmV0d2VlbiByZXRyaWVzIGluIG1zXG4gKiBAcmV0dXJucyBSZXN1bHQgb2YgdGhlIGRhdGFiYXNlIG9wZXJhdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVdpdGhSZXRyeTxUPihcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+LFxuICBtYXhSZXRyaWVzID0gMyxcbiAgaW5pdGlhbERlbGF5ID0gMjAwXG4pOiBQcm9taXNlPFQ+IHtcbiAgbGV0IGxhc3RFcnJvcjogdW5rbm93bjtcbiAgbGV0IGRlbGF5ID0gaW5pdGlhbERlbGF5O1xuICBcbiAgZm9yIChsZXQgYXR0ZW1wdCA9IDA7IGF0dGVtcHQgPD0gbWF4UmV0cmllczsgYXR0ZW1wdCsrKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBvcGVyYXRpb24oKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbGFzdEVycm9yID0gZXJyb3I7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBjb25uZWN0aW9uLXJlbGF0ZWQgZXJyb3IgdGhhdCBtaWdodCBiZSB0cmFuc2llbnRcbiAgICAgIGNvbnN0IGlzVHJhbnNpZW50RXJyb3IgPSBcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBcbiAgICAgICAgKFxuICAgICAgICAgIC8vIENvbW1vbiBuZXR3b3JrIGVycm9yc1xuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0VDT05OUkVTRVQnKSB8fFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3NvY2tldCBoYW5nIHVwJykgfHxcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdjb25uZWN0aW9uIHRpbWVvdXQnKSB8fFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25ldHdvcmsgZXJyb3InKSB8fFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ2ZldGNoIGZhaWxlZCcpIHx8XG4gICAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnQ29ubmVjdCBUaW1lb3V0IEVycm9yJykgfHxcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdVTkRfRVJSX0NPTk5FQ1RfVElNRU9VVCcpIHx8XG4gICAgICAgICAgLy8gTmVvbiBzcGVjaWZpYyBlcnJvcnNcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdFcnJvciBjb25uZWN0aW5nIHRvIGRhdGFiYXNlJykgfHxcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdDb25uZWN0aW9uIHRlcm1pbmF0ZWQgdW5leHBlY3RlZGx5JykgfHxcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdOZW9uRGJFcnJvcicpIHx8XG4gICAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnQ29ubmVjdFRpbWVvdXRFcnJvcicpXG4gICAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghaXNUcmFuc2llbnRFcnJvciB8fCBhdHRlbXB0ID09PSBtYXhSZXRyaWVzKSB7XG4gICAgICAgIC8vIE5vdCBhIHRyYW5zaWVudCBlcnJvciBvciB3ZSd2ZSBleGhhdXN0ZWQgb3VyIHJldHJpZXNcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUud2FybihgRGF0YWJhc2Ugb3BlcmF0aW9uIGZhaWxlZCAoYXR0ZW1wdCAke2F0dGVtcHQgKyAxfS8ke21heFJldHJpZXMgKyAxfSksIHJldHJ5aW5nIGluICR7ZGVsYXl9bXM6YCwgXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSk7XG4gICAgICBcbiAgICAgIC8vIEV4cG9uZW50aWFsIGJhY2tvZmYgd2l0aCBqaXR0ZXJcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheSArIE1hdGgucmFuZG9tKCkgKiAxMDApKTtcbiAgICAgIGRlbGF5ID0gTWF0aC5taW4oZGVsYXkgKiAyLCA1MDAwKTsgLy8gRXhwb25lbnRpYWwgYmFja29mZiB3aXRoIG1heCA1cyBkZWxheVxuICAgIH1cbiAgfVxuICBcbiAgLy8gVGhpcyBzaG91bGQgbmV2ZXIgYmUgcmVhY2hlZCBkdWUgdG8gdGhlIHRocm93IGluIHRoZSBsb29wLCBidXQgVHlwZVNjcmlwdCBuZWVkcyBpdFxuICB0aHJvdyBsYXN0RXJyb3I7XG59XG5cbi8vIEV4cG9ydCBzY2hlbWEgZm9yIHVzZSBpbiBvdGhlciBmaWxlc1xuZXhwb3J0ICogZnJvbSAnLi9zY2hlbWEnO1xuIl0sIm5hbWVzIjpbImRyaXp6bGUiLCJkcml6emxlTmVvbiIsIm5lb24iLCJuZW9uQ29uZmlnIiwic2NoZW1hIiwiZmV0Y2hDb25uZWN0aW9uQ2FjaGUiLCJjcmVhdGVEYkNvbm5lY3Rpb24iLCJzcWwiLCJwcm9jZXNzIiwiZW52IiwiREFUQUJBU0VfVVJMIiwiZmV0Y2hPcHRpb25zIiwia2VlcGFsaXZlIiwidGltZW91dCIsImNyZWF0ZUR1bW15RGJDb25uZWN0aW9uIiwiZHVtbXlTcWwiLCJkYkNvbm5lY3Rpb25JbnN0YW5jZSIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImdsb2JhbCIsIl9fZHJpenpsZU5lb25DbGllbnRfXyIsImRiIiwiZXhlY3V0ZVdpdGhSZXRyeSIsIm9wZXJhdGlvbiIsIm1heFJldHJpZXMiLCJpbml0aWFsRGVsYXkiLCJsYXN0RXJyb3IiLCJkZWxheSIsImF0dGVtcHQiLCJpc1RyYW5zaWVudEVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJ3YXJuIiwiU3RyaW5nIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiTWF0aCIsInJhbmRvbSIsIm1pbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/database/index.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/database/schema.ts":
/*!*****************************************!*\
  !*** ../../packages/database/schema.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MEMORY_TYPES: () => (/* binding */ MEMORY_TYPES),\n/* harmony export */   accounts: () => (/* binding */ accounts),\n/* harmony export */   accountsRelations: () => (/* binding */ accountsRelations),\n/* harmony export */   agentMessages: () => (/* binding */ agentMessages),\n/* harmony export */   agentMessagesIndexes: () => (/* binding */ agentMessagesIndexes),\n/* harmony export */   animationDesignBriefs: () => (/* binding */ animationDesignBriefs),\n/* harmony export */   animationDesignBriefsRelations: () => (/* binding */ animationDesignBriefsRelations),\n/* harmony export */   componentErrors: () => (/* binding */ componentErrors),\n/* harmony export */   componentErrorsRelations: () => (/* binding */ componentErrorsRelations),\n/* harmony export */   componentEvaluationMetrics: () => (/* binding */ componentEvaluationMetrics),\n/* harmony export */   componentEvaluationMetricsRelations: () => (/* binding */ componentEvaluationMetricsRelations),\n/* harmony export */   componentTestCases: () => (/* binding */ componentTestCases),\n/* harmony export */   createTable: () => (/* binding */ createTable),\n/* harmony export */   customComponentJobs: () => (/* binding */ customComponentJobs),\n/* harmony export */   customComponentJobsRecoveryUpdate: () => (/* binding */ customComponentJobsRecoveryUpdate),\n/* harmony export */   customComponentJobsRelations: () => (/* binding */ customComponentJobsRelations),\n/* harmony export */   customComponentJobsUpdate: () => (/* binding */ customComponentJobsUpdate),\n/* harmony export */   emailSubscribers: () => (/* binding */ emailSubscribers),\n/* harmony export */   emailSubscribersRelations: () => (/* binding */ emailSubscribersRelations),\n/* harmony export */   feedback: () => (/* binding */ feedback),\n/* harmony export */   feedbackRelations: () => (/* binding */ feedbackRelations),\n/* harmony export */   imageAnalysis: () => (/* binding */ imageAnalysis),\n/* harmony export */   imageAnalysisRelations: () => (/* binding */ imageAnalysisRelations),\n/* harmony export */   messages: () => (/* binding */ messages),\n/* harmony export */   messagesRelations: () => (/* binding */ messagesRelations),\n/* harmony export */   metrics: () => (/* binding */ metrics),\n/* harmony export */   patches: () => (/* binding */ patches),\n/* harmony export */   patchesRelations: () => (/* binding */ patchesRelations),\n/* harmony export */   projectMemory: () => (/* binding */ projectMemory),\n/* harmony export */   projectMemoryRelations: () => (/* binding */ projectMemoryRelations),\n/* harmony export */   projects: () => (/* binding */ projects),\n/* harmony export */   projectsRelations: () => (/* binding */ projectsRelations),\n/* harmony export */   sceneIterations: () => (/* binding */ sceneIterations),\n/* harmony export */   sceneIterationsRelations: () => (/* binding */ sceneIterationsRelations),\n/* harmony export */   scenePlans: () => (/* binding */ scenePlans),\n/* harmony export */   scenePlansRelations: () => (/* binding */ scenePlansRelations),\n/* harmony export */   sceneSpecs: () => (/* binding */ sceneSpecs),\n/* harmony export */   sceneSpecsRelations: () => (/* binding */ sceneSpecsRelations),\n/* harmony export */   scenes: () => (/* binding */ scenes),\n/* harmony export */   scenesRelations: () => (/* binding */ scenesRelations),\n/* harmony export */   sharedVideos: () => (/* binding */ sharedVideos),\n/* harmony export */   sharedVideosRelations: () => (/* binding */ sharedVideosRelations),\n/* harmony export */   users: () => (/* binding */ users),\n/* harmony export */   usersRelations: () => (/* binding */ usersRelations),\n/* harmony export */   verificationTokens: () => (/* binding */ verificationTokens)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"drizzle-orm/pg-core\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([drizzle_orm__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__]);\n([drizzle_orm__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/db/schema.ts\n\n\n\n// Import the InputProps type for the projects table\n/**\n * This is an example of how to use the multi-project schema feature of Drizzle ORM. Use the same\n * database instance for multiple projects.\n *\n * @see https://orm.drizzle.team/docs/goodies#multi-project-schema\n */ const createTable = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgTableCreator)((name)=>`bazaar-vid_${name}`);\nconst users = createTable(\"user\", (d)=>({\n        id: d.varchar({\n            length: 255\n        }).notNull().primaryKey(),\n        name: d.varchar({\n            length: 255\n        }),\n        email: d.varchar({\n            length: 255\n        }).notNull(),\n        emailVerified: d.timestamp({\n            mode: \"date\",\n            withTimezone: true\n        }),\n        image: d.text(),\n        isAdmin: d.boolean().default(false).notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`)\n    }));\nconst usersRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(users, ({ many })=>({\n        accounts: many(accounts),\n        sharedVideos: many(sharedVideos)\n    }));\nconst accounts = createTable(\"account\", (d)=>({\n        userId: d.varchar({\n            length: 255\n        }).notNull().references(()=>users.id),\n        type: d.varchar({\n            length: 255\n        }).$type().notNull(),\n        provider: d.varchar({\n            length: 255\n        }).notNull(),\n        providerAccountId: d.varchar({\n            length: 255\n        }).notNull(),\n        refresh_token: d.text(),\n        access_token: d.text(),\n        expires_at: d.integer(),\n        token_type: d.varchar({\n            length: 255\n        }),\n        scope: d.varchar({\n            length: 255\n        }),\n        id_token: d.text(),\n        session_state: d.varchar({\n            length: 255\n        })\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.primaryKey)({\n            columns: [\n                t.provider,\n                t.providerAccountId\n            ]\n        }),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"account_user_id_idx\").on(t.userId)\n    ]);\nconst accountsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(accounts, ({ one })=>({\n        user: one(users, {\n            fields: [\n                accounts.userId\n            ],\n            references: [\n                users.id\n            ]\n        })\n    }));\nconst verificationTokens = createTable(\"verificationToken\", (d)=>({\n        identifier: d.varchar({\n            length: 255\n        }).notNull(),\n        token: d.varchar({\n            length: 255\n        }).notNull(),\n        expires: d.timestamp({\n            mode: \"date\",\n            withTimezone: true\n        }).notNull()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.primaryKey)({\n            columns: [\n                t.identifier,\n                t.token\n            ]\n        })\n    ]);\n// --- Projects table ---\n// Stores Remotion player state per user.\n// The `props` column stores the full canonical state as JSON.\nconst projects = createTable(\"project\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        userId: d.varchar({\n            length: 255\n        }).notNull().references(()=>users.id),\n        title: d.varchar({\n            length: 255\n        }).notNull(),\n        props: d.jsonb().$type().notNull(),\n        isWelcome: d.boolean().default(true).notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date())\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"project_user_idx\").on(t.userId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"project_title_idx\").on(t.title),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.uniqueIndex)(\"project_unique_name\").on(t.userId, t.title)\n    ]);\nconst projectsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(projects, ({ many })=>({\n        patches: many(patches),\n        messages: many(messages),\n        scenes: many(scenes),\n        sharedVideos: many(sharedVideos)\n    }));\n// --- Patches table ---\n// Stores JSON patches for projects, referencing the project by ID.\nconst patches = createTable(\"patch\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        patch: d.jsonb().$type().notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"patch_project_idx\").on(t.projectId)\n    ]);\nconst patchesRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(patches, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                patches.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        })\n    }));\n// --- Messages table ---\n// Stores chat messages for projects\nconst messages = createTable(\"message\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        content: d.text().notNull(),\n        role: d.varchar({\n            length: 50\n        }).notNull(),\n        kind: d.varchar({\n            length: 50\n        }).default(\"message\").notNull(),\n        status: d.varchar({\n            length: 50\n        }),\n        imageUrls: d.jsonb(\"image_urls\").$type(),\n        sequence: d.integer().notNull().default(0),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date()),\n        originalTsxCode: d.text(),\n        lastFixAttempt: d.timestamp({\n            withTimezone: true\n        }),\n        fixIssues: d.text()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"message_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"message_status_idx\").on(t.status),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"message_project_sequence_idx\").on(t.projectId, t.sequence)\n    ]);\nconst messagesRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(messages, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                messages.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        })\n    }));\n// --- Scenes table ---\n// Stores individual scene code and props for projects\nconst scenes = createTable(\"scene\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        order: d.integer().notNull().default(0),\n        name: d.varchar({\n            length: 255\n        }).default(\"Scene\").notNull(),\n        tsxCode: d.text().notNull(),\n        props: d.jsonb(),\n        duration: d.integer().default(150).notNull(),\n        // Publishing columns for BAZAAR-303\n        publishedUrl: d.text(),\n        publishedHash: d.text(),\n        publishedAt: d.timestamp({\n            withTimezone: true\n        }),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date()),\n        layoutJson: d.text(\"layout_json\"),\n        // Metadata for better scene targeting\n        slug: d.varchar({\n            length: 255\n        }),\n        dominantColors: d.jsonb(),\n        firstH1Text: d.text(),\n        lastFocused: d.boolean().default(false)\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_order_idx\").on(t.projectId, t.order),\n        // Index for published scenes lookup\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_publish_idx\").on(t.projectId, t.publishedHash)\n    ]);\nconst scenesRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(scenes, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                scenes.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        })\n    }));\n//  NEW: Scene Iterations Tracking Table - Track every LLM operation for continuous improvement\nconst sceneIterations = createTable(\"scene_iteration\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        sceneId: d.uuid(\"scene_id\").notNull().references(()=>scenes.id, {\n            onDelete: \"cascade\"\n        }),\n        projectId: d.uuid(\"project_id\").notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        // LLM Decision Data\n        operationType: d.varchar(\"operation_type\", {\n            length: 50\n        }).notNull(),\n        editComplexity: d.varchar(\"edit_complexity\", {\n            length: 20\n        }),\n        userPrompt: d.text(\"user_prompt\").notNull(),\n        brainReasoning: d.text(\"brain_reasoning\"),\n        toolReasoning: d.text(\"tool_reasoning\"),\n        // Code Changes\n        codeBefore: d.text(\"code_before\"),\n        codeAfter: d.text(\"code_after\"),\n        changesApplied: d.jsonb(\"changes_applied\"),\n        changesPreserved: d.jsonb(\"changes_preserved\"),\n        // Performance Metrics\n        generationTimeMs: d.integer(\"generation_time_ms\"),\n        modelUsed: d.varchar(\"model_used\", {\n            length: 50\n        }),\n        temperature: d.real(\"temperature\"),\n        tokensUsed: d.integer(\"tokens_used\"),\n        // User Satisfaction Indicators\n        userEditedAgain: d.boolean(\"user_edited_again\").default(false),\n        userSatisfactionScore: d.integer(\"user_satisfaction_score\"),\n        sessionId: d.varchar(\"session_id\", {\n            length: 255\n        }),\n        // Link to message that triggered this iteration\n        messageId: d.uuid(\"message_id\").references(()=>messages.id, {\n            onDelete: \"set null\"\n        }),\n        createdAt: d.timestamp(\"created_at\", {\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_iteration_scene_idx\").on(t.sceneId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_iteration_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_iteration_operation_idx\").on(t.operationType, t.editComplexity),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_iteration_satisfaction_idx\").on(t.userEditedAgain, t.createdAt),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_iteration_message_idx\").on(t.messageId)\n    ]);\nconst sceneIterationsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(sceneIterations, ({ one })=>({\n        scene: one(scenes, {\n            fields: [\n                sceneIterations.sceneId\n            ],\n            references: [\n                scenes.id\n            ]\n        }),\n        project: one(projects, {\n            fields: [\n                sceneIterations.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        }),\n        message: one(messages, {\n            fields: [\n                sceneIterations.messageId\n            ],\n            references: [\n                messages.id\n            ]\n        })\n    }));\n// --- Scene Specs table ---\n// Stores SceneSpec JSON for MCP architecture\nconst sceneSpecs = createTable(\"scene_specs\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        sceneId: d.varchar({\n            length: 255\n        }).notNull(),\n        name: d.varchar({\n            length: 255\n        }),\n        spec: d.jsonb().notNull(),\n        version: d.varchar({\n            length: 10\n        }).default(\"1.0\").notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date()),\n        createdBy: d.varchar({\n            length: 255\n        }).references(()=>users.id)\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_spec_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_spec_created_at_idx\").on(t.createdAt),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_spec_scene_id_idx\").on(t.sceneId),\n        // Ensure unique scene_id per project\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.uniqueIndex)(\"scene_spec_unique_scene_id\").on(t.projectId, t.sceneId),\n        // Added missing GIN index for JSONB spec column\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_spec_spec_gin_idx\").using(\"gin\", t.spec)\n    ]);\nconst sceneSpecsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(sceneSpecs, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                sceneSpecs.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        }),\n        createdByUser: one(users, {\n            fields: [\n                sceneSpecs.createdBy\n            ],\n            references: [\n                users.id\n            ]\n        })\n    }));\n// --- Custom Component Jobs table ---\n// Stores jobs for generating and compiling custom Remotion components\nconst customComponentJobs = createTable(\"custom_component_job\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        effect: d.text().notNull(),\n        tsxCode: d.text(),\n        metadata: d.jsonb(),\n        statusMessageId: d.uuid().references(()=>messages.id),\n        status: d.varchar({\n            length: 50\n        }).default(\"pending\").notNull(),\n        outputUrl: d.text(),\n        errorMessage: d.text(),\n        retryCount: d.integer().default(0).notNull(),\n        lastSuccessfulStep: d.varchar('last_successful_step', {\n            length: 50\n        }),\n        nextRetryAt: d.timestamp('next_retry_at', {\n            withTimezone: true\n        }),\n        errorContext: d.jsonb('error_context'),\n        checkpointData: d.jsonb('checkpoint_data'),\n        lastStep: d.varchar('last_step', {\n            length: 50\n        }),\n        // A2A protocol support fields\n        taskId: d.text('task_id'),\n        internalStatus: d.varchar('internal_status', {\n            length: 50\n        }),\n        requiresInput: d.boolean('requires_input').default(false),\n        inputType: d.text('input_type'),\n        taskState: d.jsonb('task_state'),\n        artifacts: d.jsonb('artifacts'),\n        history: d.jsonb('history'),\n        sseEnabled: d.boolean('sse_enabled').default(false),\n        // Timestamps\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date()),\n        // KEEP BOTH VERSIONS OF COLUMNS (camelCase and snake_case)\n        // CamelCase original columns - need to preserve these\n        originalTsxCode: d.text(),\n        lastFixAttempt: d.timestamp({\n            withTimezone: true\n        }),\n        fixIssues: d.text(),\n        // Snake_case new columns\n        original_tsx_code: d.text('original_tsx_code'),\n        last_fix_attempt: d.timestamp('last_fix_attempt', {\n            withTimezone: true\n        }),\n        fix_issues: d.text('fix_issues') // Snake case version\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"custom_component_job_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"custom_component_job_status_idx\").on(t.status),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"custom_component_job_task_id_idx\").on(t.taskId)\n    ]);\n// Add relations for custom component jobs\nconst customComponentJobsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(customComponentJobs, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                customComponentJobs.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        })\n    }));\n// --- Component Errors table ---\n// Stores errors for custom component jobs\nconst componentErrors = createTable(\"component_error\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        jobId: d.uuid().notNull().references(()=>customComponentJobs.id, {\n            onDelete: \"cascade\"\n        }),\n        errorType: d.varchar({\n            length: 100\n        }).notNull(),\n        details: d.text().notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"component_error_job_idx\").on(t.jobId)\n    ]);\nconst componentErrorsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(componentErrors, ({ one })=>({\n        job: one(customComponentJobs, {\n            fields: [\n                componentErrors.jobId\n            ],\n            references: [\n                customComponentJobs.id\n            ]\n        })\n    }));\n// --- Metrics table ---\nconst metrics = createTable(\"metric\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        name: d.varchar({\n            length: 100\n        }).notNull(),\n        value: d.real().notNull(),\n        tags: d.jsonb(),\n        timestamp: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull()\n    }));\n// --- Scene Plans table ---\n// Stores LLM reasoning about scene planning\nconst scenePlans = createTable(\"scene_plan\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        messageId: d.uuid().references(()=>messages.id, {\n            onDelete: \"cascade\"\n        }),\n        rawReasoning: d.text().notNull(),\n        planData: d.jsonb().notNull(),\n        userPrompt: d.text().notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"scene_plan_project_idx\").on(t.projectId)\n    ]);\nconst scenePlansRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(scenePlans, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                scenePlans.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        }),\n        message: one(messages, {\n            fields: [\n                scenePlans.messageId\n            ],\n            references: [\n                messages.id\n            ]\n        })\n    }));\n// --- Animation Design Briefs table ---\n// Stores detailed animation specifications that bridge scene plans and component generation\nconst animationDesignBriefs = createTable(\"animation_design_brief\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid().notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        sceneId: d.uuid().notNull(),\n        componentJobId: d.uuid().references(()=>customComponentJobs.id),\n        llmModel: d.varchar({\n            length: 100\n        }).notNull(),\n        status: d.varchar({\n            length: 50\n        }).default(\"pending\").notNull(),\n        errorMessage: d.text(),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date()),\n        originalTsxCode: d.text(),\n        lastFixAttempt: d.timestamp({\n            withTimezone: true\n        }),\n        fixIssues: d.text()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"animation_design_brief_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"animation_design_brief_scene_idx\").on(t.sceneId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"animation_design_brief_component_idx\").on(t.componentJobId)\n    ]);\nconst animationDesignBriefsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(animationDesignBriefs, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                animationDesignBriefs.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        }),\n        componentJob: one(customComponentJobs, {\n            fields: [\n                animationDesignBriefs.componentJobId\n            ],\n            references: [\n                customComponentJobs.id\n            ]\n        })\n    }));\n// --- Feedback table ---\n// Stores user feedback and feature prioritization\nconst feedback = createTable(\"feedback\", (d)=>({\n        id: d.text('id').primaryKey().$defaultFn(()=>crypto.randomUUID()),\n        content: d.text('content'),\n        name: d.text('name'),\n        email: d.text('email'),\n        userId: d.varchar('user_id', {\n            length: 255\n        }).references(()=>users.id, {\n            onDelete: 'set null'\n        }),\n        prioritizedFeatures: d.jsonb('prioritized_features').$type(),\n        createdAt: d.timestamp('created_at', {\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        status: d.text('status').default('new').notNull(),\n        adminNotes: d.text('admin_notes')\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"feedback_user_idx\").on(t.userId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"feedback_status_idx\").on(t.status),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"feedback_created_at_idx\").on(t.createdAt)\n    ]);\nconst feedbackRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(feedback, ({ one })=>({\n        user: one(users, {\n            fields: [\n                feedback.userId\n            ],\n            references: [\n                users.id\n            ]\n        })\n    }));\n// --- Email Subscribers table ---\n// Stores email addresses for newsletter/updates signup\nconst emailSubscribers = createTable(\"email_subscriber\", (d)=>({\n        id: d.text('id').primaryKey().$defaultFn(()=>crypto.randomUUID()),\n        email: d.text('email').notNull().unique(),\n        subscribedAt: d.timestamp('subscribed_at', {\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        status: d.text('status').default('active').notNull(),\n        source: d.text('source').default('homepage').notNull(),\n        userId: d.varchar('user_id', {\n            length: 255\n        }).references(()=>users.id, {\n            onDelete: 'set null'\n        })\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"email_subscriber_email_idx\").on(t.email),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"email_subscriber_status_idx\").on(t.status),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"email_subscriber_subscribed_at_idx\").on(t.subscribedAt)\n    ]);\nconst emailSubscribersRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(emailSubscribers, ({ one })=>({\n        user: one(users, {\n            fields: [\n                emailSubscribers.userId\n            ],\n            references: [\n                users.id\n            ]\n        })\n    }));\n// --- Agent Messages table ---\n// Stores messages exchanged between agents for A2A protocol support\nconst agentMessages = createTable(\"agent_message\", (d)=>({\n        id: d.text().primaryKey(),\n        sender: d.text(\"sender\").notNull(),\n        recipient: d.text(\"recipient\").notNull(),\n        type: d.text(\"type\").notNull(),\n        payload: d.jsonb(\"payload\").$type().notNull(),\n        correlationId: d.text(\"correlation_id\"),\n        status: d.text(\"status\").default('pending').notNull(),\n        createdAt: d.timestamp({\n            withTimezone: true,\n            mode: 'date'\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        processedAt: d.timestamp({\n            withTimezone: true,\n            mode: 'date'\n        })\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"agent_message_correlation_id_idx\").on(t.correlationId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"agent_message_type_idx\").on(t.type),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"agent_message_sender_idx\").on(t.sender),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"agent_message_recipient_idx\").on(t.recipient)\n    ]);\n// Add custom index for task ID in payload\nconst agentMessagesIndexes = {\n    byTaskId: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CREATE INDEX IF NOT EXISTS \"idx_agent_messages_task_id\" ON \"bazaar-vid_agent_message\" ((payload->>'taskId'))`\n};\n// Add history field to customComponentJobs to support A2A protocol task history\nconst customComponentJobsUpdate = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`\n  ALTER TABLE \"bazaar-vid_custom_component_job\"\n  ADD COLUMN IF NOT EXISTS \"history\" JSONB\n`;\nconst customComponentJobsRecoveryUpdate = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`\n  ALTER TABLE \"bazaar-vid_custom_component_job\"\n  ADD COLUMN IF NOT EXISTS \"last_successful_step\" varchar(50),\n  ADD COLUMN IF NOT EXISTS \"next_retry_at\" timestamp with time zone,\n  ADD COLUMN IF NOT EXISTS \"error_context\" jsonb\n`;\n// --- Component Test Cases table ---\n// Stores test cases for component generation evaluation\nconst componentTestCases = createTable(\"component_test_case\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        prompt: d.text().notNull(),\n        category: d.varchar({\n            length: 50\n        }).notNull(),\n        complexity: d.integer().notNull(),\n        edgeCases: d.jsonb().default([]),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull()\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"component_test_cases_category_idx\").on(t.category)\n    ]);\n// --- Component Evaluation Metrics table ---\n// Stores metrics from component generation evaluation\nconst componentEvaluationMetrics = createTable(\"component_evaluation_metric\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        testCaseId: d.uuid().notNull().references(()=>componentTestCases.id),\n        timestamp: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        // Test case metadata\n        category: d.varchar({\n            length: 50\n        }).notNull(),\n        complexity: d.integer().notNull(),\n        edgeCases: d.jsonb().default([]),\n        // Pipeline success metrics\n        success: d.boolean().notNull(),\n        errorStage: d.varchar({\n            length: 50\n        }),\n        errorType: d.varchar({\n            length: 100\n        }),\n        errorMessage: d.text(),\n        // Timing metrics\n        promptSubmissionTime: d.timestamp({\n            withTimezone: true\n        }).notNull(),\n        codeGenerationStartTime: d.timestamp({\n            withTimezone: true\n        }),\n        codeGenerationEndTime: d.timestamp({\n            withTimezone: true\n        }),\n        validationStartTime: d.timestamp({\n            withTimezone: true\n        }),\n        validationEndTime: d.timestamp({\n            withTimezone: true\n        }),\n        buildStartTime: d.timestamp({\n            withTimezone: true\n        }),\n        buildEndTime: d.timestamp({\n            withTimezone: true\n        }),\n        uploadStartTime: d.timestamp({\n            withTimezone: true\n        }),\n        uploadEndTime: d.timestamp({\n            withTimezone: true\n        }),\n        componentCompletionTime: d.timestamp({\n            withTimezone: true\n        }),\n        // Derived timing metrics\n        timeToFirstToken: d.integer(),\n        codeGenerationTime: d.integer(),\n        validationTime: d.integer(),\n        buildTime: d.integer(),\n        uploadTime: d.integer(),\n        totalTime: d.integer(),\n        // Code quality metrics\n        syntaxErrorCount: d.integer(),\n        eslintErrorCount: d.integer(),\n        eslintWarningCount: d.integer(),\n        codeLength: d.integer(),\n        // Rendering metrics\n        renderSuccess: d.boolean(),\n        renderErrorMessage: d.text(),\n        // References\n        componentId: d.varchar({\n            length: 100\n        }),\n        outputUrl: d.text(),\n        taskId: d.uuid(),\n        // A2A specific metrics\n        stateTransitions: d.jsonb().default([]),\n        artifacts: d.jsonb().default([]),\n        // Analysis fields\n        analysisNotes: d.text(),\n        tags: d.jsonb().default([])\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"component_evaluation_metrics_test_case_id_idx\").on(t.testCaseId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"component_evaluation_metrics_success_idx\").on(t.success),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"component_evaluation_metrics_timestamp_idx\").on(t.timestamp),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"component_evaluation_metrics_category_idx\").on(t.category)\n    ]);\nconst componentEvaluationMetricsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(componentEvaluationMetrics, ({ one })=>({\n        testCase: one(componentTestCases, {\n            fields: [\n                componentEvaluationMetrics.testCaseId\n            ],\n            references: [\n                componentTestCases.id\n            ]\n        })\n    }));\n// --- Shared Videos table ---\n// Stores shared videos for public video sharing\nconst sharedVideos = createTable(\"shared_video\", (d)=>({\n        id: d.varchar({\n            length: 255\n        }).notNull().primaryKey().$defaultFn(()=>crypto.randomUUID()),\n        projectId: d.uuid().notNull().references(()=>projects.id),\n        userId: d.varchar({\n            length: 255\n        }).notNull().references(()=>users.id),\n        title: d.varchar({\n            length: 255\n        }),\n        description: d.text(),\n        videoUrl: d.varchar({\n            length: 500\n        }),\n        thumbnailUrl: d.varchar({\n            length: 500\n        }),\n        isPublic: d.boolean().default(true),\n        viewCount: d.integer().default(0),\n        createdAt: d.timestamp({\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        expiresAt: d.timestamp({\n            withTimezone: true\n        })\n    }));\nconst sharedVideosRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(sharedVideos, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                sharedVideos.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        }),\n        user: one(users, {\n            fields: [\n                sharedVideos.userId\n            ],\n            references: [\n                users.id\n            ]\n        })\n    }));\n// --- Phase 2: Project Memory & Image Analysis Tables for Async Context Storage ---\n/**\n * Project Memory Table: Stores accumulated context across user sessions\n * Enables 30+ prompt workflows with persistent user preferences and scene relationships\n */ const projectMemory = createTable(\"project_memory\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid(\"project_id\").notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        memoryType: d.varchar(\"memory_type\", {\n            length: 50\n        }).notNull(),\n        memoryKey: d.varchar(\"memory_key\", {\n            length: 255\n        }).notNull(),\n        memoryValue: d.text(\"memory_value\").notNull(),\n        confidence: d.real(\"confidence\").default(0.8),\n        sourcePrompt: d.text(\"source_prompt\"),\n        createdAt: d.timestamp(\"created_at\", {\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        updatedAt: d.timestamp(\"updated_at\", {\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).$onUpdate(()=>new Date()),\n        expiresAt: d.timestamp(\"expires_at\", {\n            withTimezone: true\n        })\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"project_memory_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"project_memory_type_key_idx\").on(t.memoryType, t.memoryKey)\n    ]);\n/**\n * Image Analysis Table: Stores persistent image facts from vision analysis\n * Supports fire-and-forget async image processing with late-arriving facts integration\n */ const imageAnalysis = createTable(\"image_analysis\", (d)=>({\n        id: d.uuid().primaryKey().defaultRandom(),\n        projectId: d.uuid(\"project_id\").notNull().references(()=>projects.id, {\n            onDelete: \"cascade\"\n        }),\n        traceId: d.varchar(\"trace_id\", {\n            length: 100\n        }).notNull(),\n        imageUrls: d.jsonb(\"image_urls\").notNull(),\n        palette: d.jsonb(\"palette\").notNull(),\n        typography: d.text(\"typography\").notNull(),\n        mood: d.text(\"mood\").notNull(),\n        layoutJson: d.jsonb(\"layout_json\"),\n        processingTimeMs: d.integer(\"processing_time_ms\").notNull(),\n        createdAt: d.timestamp(\"created_at\", {\n            withTimezone: true\n        }).default((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`CURRENT_TIMESTAMP`).notNull(),\n        usedInScenes: d.jsonb(\"used_in_scenes\")\n    }), (t)=>[\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"image_analysis_project_idx\").on(t.projectId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"image_analysis_trace_idx\").on(t.traceId),\n        (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.index)(\"image_analysis_created_idx\").on(t.createdAt)\n    ]);\n// Relations for project memory\nconst projectMemoryRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(projectMemory, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                projectMemory.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        })\n    }));\n// Relations for image analysis\nconst imageAnalysisRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.relations)(imageAnalysis, ({ one })=>({\n        project: one(projects, {\n            fields: [\n                imageAnalysis.projectId\n            ],\n            references: [\n                projects.id\n            ]\n        })\n    }));\n// Memory type enum for better type safety\nconst MEMORY_TYPES = {\n    USER_PREFERENCE: 'user_preference',\n    SCENE_RELATIONSHIP: 'scene_relationship',\n    CONVERSATION_CONTEXT: 'conversation_context'\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGF0YWJhc2Uvc2NoZW1hLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMEJBQTBCO0FBQ21CO0FBQ0s7QUFFc0I7QUFNeEUsb0RBQW9EO0FBR3BEOzs7OztDQUtDLEdBQ00sTUFBTU0sY0FBY0YsbUVBQWNBLENBQUMsQ0FBQ0csT0FBUyxDQUFDLFdBQVcsRUFBRUEsTUFBTSxFQUFFO0FBR25FLE1BQU1DLFFBQVFGLFlBQVksUUFBUSxDQUFDRyxJQUFPO1FBQy9DQyxJQUFJRCxFQUNERSxPQUFPLENBQUM7WUFBRUMsUUFBUTtRQUFJLEdBQ3RCQyxPQUFPLEdBQ1BSLFVBQVU7UUFDYkUsTUFBTUUsRUFBRUUsT0FBTyxDQUFDO1lBQUVDLFFBQVE7UUFBSTtRQUM5QkUsT0FBT0wsRUFBRUUsT0FBTyxDQUFDO1lBQUVDLFFBQVE7UUFBSSxHQUFHQyxPQUFPO1FBQ3pDRSxlQUFlTixFQUFFTyxTQUFTLENBQUM7WUFDekJDLE1BQU07WUFDTkMsY0FBYztRQUNoQjtRQUNBQyxPQUFPVixFQUFFVyxJQUFJO1FBQ2JDLFNBQVNaLEVBQUVhLE9BQU8sR0FBR0MsT0FBTyxDQUFDLE9BQU9WLE9BQU87UUFDM0NXLFdBQVdmLEVBQUVPLFNBQVMsQ0FBQztZQUFFRSxjQUFjO1FBQUssR0FBR0ssT0FBTyxDQUFDdEIsZ0RBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFWSxPQUFPO1FBQ3RGWSxXQUFXaEIsRUFBRU8sU0FBUyxDQUFDO1lBQUVFLGNBQWM7UUFBSyxHQUFHSyxPQUFPLENBQUN0QixnREFBRyxDQUFDLGlCQUFpQixDQUFDO0lBQy9FLElBQUk7QUFFRyxNQUFNeUIsaUJBQWlCMUIsc0RBQVNBLENBQUNRLE9BQU8sQ0FBQyxFQUFFbUIsSUFBSSxFQUFFLEdBQU07UUFDNURDLFVBQVVELEtBQUtDO1FBQ2ZDLGNBQWNGLEtBQUtFO0lBQ3JCLElBQUk7QUFF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M0V3QixTQUFTeEIsSUFBSU8sVUFBVTtZQUNyQkwsUUFBUTtnQkFBQzRMLGNBQWMxSyxTQUFTO2FBQUM7WUFDakNyQyxZQUFZO2dCQUFDd0IsU0FBUzdDLEVBQUU7YUFBQztRQUMzQjtJQUNGLElBQUk7QUFFSiwwQ0FBMEM7QUFDbkMsTUFBTTZPLGVBQWU7SUFDMUJDLGlCQUFpQjtJQUNqQkMsb0JBQW9CO0lBQ3BCQyxzQkFBc0I7QUFDeEIsRUFBVyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9wYWNrYWdlcy9kYXRhYmFzZS9zY2hlbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9kYi9zY2hlbWEudHNcbmltcG9ydCB7IHJlbGF0aW9ucywgc3FsIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyB1bmlxdWVJbmRleCB9IGZyb20gXCJkcml6emxlLW9ybS9wZy1jb3JlXCI7XG5cbmltcG9ydCB7IGluZGV4LCBwZ1RhYmxlQ3JlYXRvciwgcHJpbWFyeUtleSB9IGZyb20gXCJkcml6emxlLW9ybS9wZy1jb3JlXCI7XG5pbXBvcnQgeyB0eXBlIEFkYXB0ZXJBY2NvdW50IH0gZnJvbSBcIkBhdXRoL2NvcmUvYWRhcHRlcnNcIjtcbmltcG9ydCB7IHR5cGUgSW5wdXRQcm9wcyB9IGZyb20gXCJ+L2xpYi90eXBlcy92aWRlby9pbnB1dC1wcm9wc1wiO1xuaW1wb3J0IHsgdHlwZSBKc29uUGF0Y2ggfSBmcm9tIFwifi9saWIvdHlwZXMvc2hhcmVkL2pzb24tcGF0Y2hcIjtcbmltcG9ydCB7IHR5cGUgSW5mZXJTZWxlY3RNb2RlbCB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuXG4vLyBJbXBvcnQgdGhlIElucHV0UHJvcHMgdHlwZSBmb3IgdGhlIHByb2plY3RzIHRhYmxlXG5cblxuLyoqXG4gKiBUaGlzIGlzIGFuIGV4YW1wbGUgb2YgaG93IHRvIHVzZSB0aGUgbXVsdGktcHJvamVjdCBzY2hlbWEgZmVhdHVyZSBvZiBEcml6emxlIE9STS4gVXNlIHRoZSBzYW1lXG4gKiBkYXRhYmFzZSBpbnN0YW5jZSBmb3IgbXVsdGlwbGUgcHJvamVjdHMuXG4gKlxuICogQHNlZSBodHRwczovL29ybS5kcml6emxlLnRlYW0vZG9jcy9nb29kaWVzI211bHRpLXByb2plY3Qtc2NoZW1hXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVUYWJsZSA9IHBnVGFibGVDcmVhdG9yKChuYW1lKSA9PiBgYmF6YWFyLXZpZF8ke25hbWV9YCk7XG5cblxuZXhwb3J0IGNvbnN0IHVzZXJzID0gY3JlYXRlVGFibGUoXCJ1c2VyXCIsIChkKSA9PiAoe1xuICBpZDogZFxuICAgIC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSlcbiAgICAubm90TnVsbCgpXG4gICAgLnByaW1hcnlLZXkoKSxcbiAgbmFtZTogZC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSksXG4gIGVtYWlsOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDI1NSB9KS5ub3ROdWxsKCksXG4gIGVtYWlsVmVyaWZpZWQ6IGQudGltZXN0YW1wKHtcbiAgICBtb2RlOiBcImRhdGVcIixcbiAgICB3aXRoVGltZXpvbmU6IHRydWUsXG4gIH0pLFxuICBpbWFnZTogZC50ZXh0KCksXG4gIGlzQWRtaW46IGQuYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLm5vdE51bGwoKSxcbiAgY3JlYXRlZEF0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLm5vdE51bGwoKSxcbiAgdXBkYXRlZEF0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLFxufSkpO1xuXG5leHBvcnQgY29uc3QgdXNlcnNSZWxhdGlvbnMgPSByZWxhdGlvbnModXNlcnMsICh7IG1hbnkgfSkgPT4gKHtcbiAgYWNjb3VudHM6IG1hbnkoYWNjb3VudHMpLFxuICBzaGFyZWRWaWRlb3M6IG1hbnkoc2hhcmVkVmlkZW9zKSxcbn0pKTtcblxuZXhwb3J0IGNvbnN0IGFjY291bnRzID0gY3JlYXRlVGFibGUoXG4gIFwiYWNjb3VudFwiLFxuICAoZCkgPT4gKHtcbiAgICB1c2VySWQ6IGRcbiAgICAgIC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSlcbiAgICAgIC5ub3ROdWxsKClcbiAgICAgIC5yZWZlcmVuY2VzKCgpID0+IHVzZXJzLmlkKSxcbiAgICB0eXBlOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDI1NSB9KS4kdHlwZTxBZGFwdGVyQWNjb3VudFtcInR5cGVcIl0+KCkubm90TnVsbCgpLFxuICAgIHByb3ZpZGVyOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDI1NSB9KS5ub3ROdWxsKCksXG4gICAgcHJvdmlkZXJBY2NvdW50SWQ6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLm5vdE51bGwoKSxcbiAgICByZWZyZXNoX3Rva2VuOiBkLnRleHQoKSxcbiAgICBhY2Nlc3NfdG9rZW46IGQudGV4dCgpLFxuICAgIGV4cGlyZXNfYXQ6IGQuaW50ZWdlcigpLFxuICAgIHRva2VuX3R5cGU6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLFxuICAgIHNjb3BlOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDI1NSB9KSxcbiAgICBpZF90b2tlbjogZC50ZXh0KCksXG4gICAgc2Vzc2lvbl9zdGF0ZTogZC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSksXG4gIH0pLFxuICAodCkgPT4gW1xuICAgIHByaW1hcnlLZXkoeyBjb2x1bW5zOiBbdC5wcm92aWRlciwgdC5wcm92aWRlckFjY291bnRJZF0gfSksXG4gICAgaW5kZXgoXCJhY2NvdW50X3VzZXJfaWRfaWR4XCIpLm9uKHQudXNlcklkKSxcbiAgXSxcbik7XG5cbmV4cG9ydCBjb25zdCBhY2NvdW50c1JlbGF0aW9ucyA9IHJlbGF0aW9ucyhhY2NvdW50cywgKHsgb25lIH0pID0+ICh7XG4gIHVzZXI6IG9uZSh1c2VycywgeyBmaWVsZHM6IFthY2NvdW50cy51c2VySWRdLCByZWZlcmVuY2VzOiBbdXNlcnMuaWRdIH0pLFxufSkpO1xuXG5leHBvcnQgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW5zID0gY3JlYXRlVGFibGUoXG4gIFwidmVyaWZpY2F0aW9uVG9rZW5cIiwgLy8gUmVuYW1lZCB0byBzaW5ndWxhciBjYW1lbC1jYXNlIGZvciBEcml6emxlLWFkYXB0ZXIgY29tcGF0aWJpbGl0eVxuICAoZCkgPT4gKHtcbiAgICBpZGVudGlmaWVyOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDI1NSB9KS5ub3ROdWxsKCksXG4gICAgdG9rZW46IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLm5vdE51bGwoKSxcbiAgICBleHBpcmVzOiBkLnRpbWVzdGFtcCh7IG1vZGU6IFwiZGF0ZVwiLCB3aXRoVGltZXpvbmU6IHRydWUgfSkubm90TnVsbCgpLFxuICB9KSxcbiAgKHQpID0+IFtwcmltYXJ5S2V5KHsgY29sdW1uczogW3QuaWRlbnRpZmllciwgdC50b2tlbl0gfSldLFxuKTtcblxuLy8gLS0tIFByb2plY3RzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIFJlbW90aW9uIHBsYXllciBzdGF0ZSBwZXIgdXNlci5cbi8vIFRoZSBgcHJvcHNgIGNvbHVtbiBzdG9yZXMgdGhlIGZ1bGwgY2Fub25pY2FsIHN0YXRlIGFzIEpTT04uXG5leHBvcnQgY29uc3QgcHJvamVjdHMgPSBjcmVhdGVUYWJsZShcbiAgXCJwcm9qZWN0XCIsXG4gIChkKSA9PiAoe1xuICAgIGlkOiBkLnV1aWQoKS5wcmltYXJ5S2V5KCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgIHVzZXJJZDogZC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSkubm90TnVsbCgpLnJlZmVyZW5jZXMoKCkgPT4gdXNlcnMuaWQpLFxuICAgIHRpdGxlOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDI1NSB9KS5ub3ROdWxsKCksXG4gICAgcHJvcHM6IGQuanNvbmIoKS4kdHlwZTxJbnB1dFByb3BzPigpLm5vdE51bGwoKSxcbiAgICBpc1dlbGNvbWU6IGQuYm9vbGVhbigpLmRlZmF1bHQodHJ1ZSkubm90TnVsbCgpLFxuICAgIGNyZWF0ZWRBdDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS5ub3ROdWxsKCksXG4gICAgdXBkYXRlZEF0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgfSksXG4gICh0KSA9PiBbXG4gICAgaW5kZXgoXCJwcm9qZWN0X3VzZXJfaWR4XCIpLm9uKHQudXNlcklkKSxcbiAgICBpbmRleChcInByb2plY3RfdGl0bGVfaWR4XCIpLm9uKHQudGl0bGUpLFxuICAgIHVuaXF1ZUluZGV4KFwicHJvamVjdF91bmlxdWVfbmFtZVwiKS5vbih0LnVzZXJJZCwgdC50aXRsZSksIC8vIEFkZGVkIHVuaXF1ZSBpbmRleCBvbiBwcm9qZWN0cy50aXRsZSBwZXIgdXNlclxuICBdLFxuKTtcblxuZXhwb3J0IGNvbnN0IHByb2plY3RzUmVsYXRpb25zID0gcmVsYXRpb25zKHByb2plY3RzLCAoeyBtYW55IH0pID0+ICh7IC8vIEFkZGVkIHByb2plY3RzUmVsYXRpb25zXG4gIHBhdGNoZXM6IG1hbnkocGF0Y2hlcyksXG4gIG1lc3NhZ2VzOiBtYW55KG1lc3NhZ2VzKSwgLy8gQWRkIHJlbGF0aW9uIHRvIG1lc3NhZ2VzXG4gIHNjZW5lczogbWFueShzY2VuZXMpLCAvLyBBZGQgcmVsYXRpb24gdG8gc2NlbmVzXG4gIHNoYXJlZFZpZGVvczogbWFueShzaGFyZWRWaWRlb3MpLCAvLyBBZGQgcmVsYXRpb24gdG8gc2hhcmVkVmlkZW9zXG59KSk7XG5cbi8vIC0tLSBQYXRjaGVzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIEpTT04gcGF0Y2hlcyBmb3IgcHJvamVjdHMsIHJlZmVyZW5jaW5nIHRoZSBwcm9qZWN0IGJ5IElELlxuZXhwb3J0IGNvbnN0IHBhdGNoZXMgPSBjcmVhdGVUYWJsZShcbiAgXCJwYXRjaFwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBwcm9qZWN0SWQ6IGQudXVpZCgpLm5vdE51bGwoKS5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgICBwYXRjaDogZC5qc29uYigpLiR0eXBlPEpzb25QYXRjaD4oKS5ub3ROdWxsKCksXG4gICAgY3JlYXRlZEF0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLm5vdE51bGwoKSxcbiAgfSksXG4gICh0KSA9PiBbaW5kZXgoXCJwYXRjaF9wcm9qZWN0X2lkeFwiKS5vbih0LnByb2plY3RJZCldLFxuKTtcblxuZXhwb3J0IGNvbnN0IHBhdGNoZXNSZWxhdGlvbnMgPSByZWxhdGlvbnMocGF0Y2hlcywgKHsgb25lIH0pID0+ICh7XG4gIHByb2plY3Q6IG9uZShwcm9qZWN0cywgeyBmaWVsZHM6IFtwYXRjaGVzLnByb2plY3RJZF0sIHJlZmVyZW5jZXM6IFtwcm9qZWN0cy5pZF0gfSksXG59KSk7XG5cbi8vIC0tLSBNZXNzYWdlcyB0YWJsZSAtLS1cbi8vIFN0b3JlcyBjaGF0IG1lc3NhZ2VzIGZvciBwcm9qZWN0c1xuZXhwb3J0IGNvbnN0IG1lc3NhZ2VzID0gY3JlYXRlVGFibGUoXG4gIFwibWVzc2FnZVwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBwcm9qZWN0SWQ6IGRcbiAgICAgIC51dWlkKClcbiAgICAgIC5ub3ROdWxsKClcbiAgICAgIC5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgICBjb250ZW50OiBkLnRleHQoKS5ub3ROdWxsKCksXG4gICAgcm9sZTogZC52YXJjaGFyKHsgbGVuZ3RoOiA1MCB9KS5ub3ROdWxsKCksIC8vICd1c2VyJyBvciAnYXNzaXN0YW50J1xuICAgIGtpbmQ6IGQudmFyY2hhcih7IGxlbmd0aDogNTAgfSkuZGVmYXVsdChcIm1lc3NhZ2VcIikubm90TnVsbCgpLCAvLyAnbWVzc2FnZScgfCAnc3RhdHVzJ1xuICAgIHN0YXR1czogZC52YXJjaGFyKHsgbGVuZ3RoOiA1MCB9KSwgLy8gJ3BlbmRpbmcnIHwgJ2J1aWxkaW5nJyB8ICdzdWNjZXNzJyB8ICdlcnJvcidcbiAgICBpbWFnZVVybHM6IGQuanNvbmIoXCJpbWFnZV91cmxzXCIpLiR0eXBlPHN0cmluZ1tdPigpLCAvLyDwn5qoIE5FVzogU3VwcG9ydCBmb3IgdXBsb2FkZWQgaW1hZ2VzXG4gICAgc2VxdWVuY2U6IGQuaW50ZWdlcigpLm5vdE51bGwoKS5kZWZhdWx0KDApLCAvLyBNZXNzYWdlIHNlcXVlbmNlIG51bWJlciBmb3Igb3JkZXJpbmdcbiAgICBjcmVhdGVkQXQ6IGRcbiAgICAgIC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSlcbiAgICAgIC5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApXG4gICAgICAubm90TnVsbCgpLFxuICAgIHVwZGF0ZWRBdDogZFxuICAgICAgLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KVxuICAgICAgLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYClcbiAgICAgIC4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgb3JpZ2luYWxUc3hDb2RlOiBkLnRleHQoKSwgLy8gU3RvcmUgdGhlIG9yaWdpbmFsIGNvZGUgYmVmb3JlIGZpeGluZ1xuICAgIGxhc3RGaXhBdHRlbXB0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KSwgLy8gV2hlbiB0aGUgbGFzdCBmaXggYXR0ZW1wdCB3YXMgbWFkZVxuICAgIGZpeElzc3VlczogZC50ZXh0KCksIC8vIElzc3VlcyBpZGVudGlmaWVkIGFuZCBmaXhlZCBieSB0aGUgcHJlcHJvY2Vzc29yXG4gIH0pLFxuICAodCkgPT4gW1xuICAgIGluZGV4KFwibWVzc2FnZV9wcm9qZWN0X2lkeFwiKS5vbih0LnByb2plY3RJZCksXG4gICAgaW5kZXgoXCJtZXNzYWdlX3N0YXR1c19pZHhcIikub24odC5zdGF0dXMpLFxuICAgIGluZGV4KFwibWVzc2FnZV9wcm9qZWN0X3NlcXVlbmNlX2lkeFwiKS5vbih0LnByb2plY3RJZCwgdC5zZXF1ZW5jZSksIC8vIEluZGV4IGZvciBlZmZpY2llbnQgc2VxdWVuY2UtYmFzZWQgcXVlcmllc1xuICBdLFxuKTtcblxuZXhwb3J0IGNvbnN0IG1lc3NhZ2VzUmVsYXRpb25zID0gcmVsYXRpb25zKG1lc3NhZ2VzLCAoeyBvbmUgfSkgPT4gKHtcbiAgcHJvamVjdDogb25lKHByb2plY3RzLCB7IGZpZWxkczogW21lc3NhZ2VzLnByb2plY3RJZF0sIHJlZmVyZW5jZXM6IFtwcm9qZWN0cy5pZF0gfSksXG59KSk7XG5cbi8vIC0tLSBTY2VuZXMgdGFibGUgLS0tXG4vLyBTdG9yZXMgaW5kaXZpZHVhbCBzY2VuZSBjb2RlIGFuZCBwcm9wcyBmb3IgcHJvamVjdHNcbmV4cG9ydCBjb25zdCBzY2VuZXMgPSBjcmVhdGVUYWJsZShcbiAgXCJzY2VuZVwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBwcm9qZWN0SWQ6IGQudXVpZCgpLm5vdE51bGwoKS5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgICBvcmRlcjogZC5pbnRlZ2VyKCkubm90TnVsbCgpLmRlZmF1bHQoMCksXG4gICAgbmFtZTogZC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSkuZGVmYXVsdChcIlNjZW5lXCIpLm5vdE51bGwoKSxcbiAgICB0c3hDb2RlOiBkLnRleHQoKS5ub3ROdWxsKCksXG4gICAgcHJvcHM6IGQuanNvbmIoKSwgLy8gU2NlbmUtc3BlY2lmaWMgcHJvcHMgZm9yIGFuaW1hdGlvbiBwYXJhbWV0ZXJzXG4gICAgZHVyYXRpb246IGQuaW50ZWdlcigpLmRlZmF1bHQoMTUwKS5ub3ROdWxsKCksIC8vIER1cmF0aW9uIGluIGZyYW1lcyAoZGVmYXVsdCA1IHNlY29uZHMgYXQgMzBmcHMpXG4gICAgLy8gUHVibGlzaGluZyBjb2x1bW5zIGZvciBCQVpBQVItMzAzXG4gICAgcHVibGlzaGVkVXJsOiBkLnRleHQoKSwgLy8gUHVibGljIFVSTCB0byB0aGUgcHVibGlzaGVkIGJ1bmRsZVxuICAgIHB1Ymxpc2hlZEhhc2g6IGQudGV4dCgpLCAvLyBTSEEtMjU2IGhhc2ggb2YgdGhlIHB1Ymxpc2hlZCBidW5kbGVcbiAgICBwdWJsaXNoZWRBdDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSksIC8vIFdoZW4gdGhlIHNjZW5lIHdhcyBwdWJsaXNoZWRcbiAgICBjcmVhdGVkQXQ6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYCkubm90TnVsbCgpLFxuICAgIHVwZGF0ZWRBdDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgbGF5b3V0SnNvbjogZC50ZXh0KFwibGF5b3V0X2pzb25cIiksIC8vIE5FVzogU3RvcmUgSlNPTiBzcGVjaWZpY2F0aW9uIGZvciB0d28tc3RlcCBwaXBlbGluZVxuICAgIC8vIE1ldGFkYXRhIGZvciBiZXR0ZXIgc2NlbmUgdGFyZ2V0aW5nXG4gICAgc2x1ZzogZC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSksIC8vIEF1dG8tZ2VuZXJhdGVkIHNsdWcgZm9yIGlkZW50aWZpY2F0aW9uXG4gICAgZG9taW5hbnRDb2xvcnM6IGQuanNvbmIoKSwgLy8gQXJyYXkgb2YgZG9taW5hbnQgY29sb3JzIFtcIiMwMDAwMDBcIiwgXCIjM0I4MkY2XCJdXG4gICAgZmlyc3RIMVRleHQ6IGQudGV4dCgpLCAvLyBGaXJzdCBIMSB0ZXh0IGNvbnRlbnQgZm9yIGVhc3kgaWRlbnRpZmljYXRpb25cbiAgICBsYXN0Rm9jdXNlZDogZC5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksIC8vIFRyYWNrIHdoaWNoIHNjZW5lIHVzZXIgaXMgd29ya2luZyBvblxuICB9KSxcbiAgKHQpID0+IFtcbiAgICBpbmRleChcInNjZW5lX3Byb2plY3RfaWR4XCIpLm9uKHQucHJvamVjdElkKSxcbiAgICBpbmRleChcInNjZW5lX29yZGVyX2lkeFwiKS5vbih0LnByb2plY3RJZCwgdC5vcmRlciksXG4gICAgLy8gSW5kZXggZm9yIHB1Ymxpc2hlZCBzY2VuZXMgbG9va3VwXG4gICAgaW5kZXgoXCJzY2VuZV9wdWJsaXNoX2lkeFwiKS5vbih0LnByb2plY3RJZCwgdC5wdWJsaXNoZWRIYXNoKSxcbiAgXSxcbik7XG5cbmV4cG9ydCBjb25zdCBzY2VuZXNSZWxhdGlvbnMgPSByZWxhdGlvbnMoc2NlbmVzLCAoeyBvbmUgfSkgPT4gKHtcbiAgcHJvamVjdDogb25lKHByb2plY3RzLCB7IGZpZWxkczogW3NjZW5lcy5wcm9qZWN0SWRdLCByZWZlcmVuY2VzOiBbcHJvamVjdHMuaWRdIH0pLFxufSkpO1xuXG4vLyDinIUgTkVXOiBTY2VuZSBJdGVyYXRpb25zIFRyYWNraW5nIFRhYmxlIC0gVHJhY2sgZXZlcnkgTExNIG9wZXJhdGlvbiBmb3IgY29udGludW91cyBpbXByb3ZlbWVudFxuZXhwb3J0IGNvbnN0IHNjZW5lSXRlcmF0aW9ucyA9IGNyZWF0ZVRhYmxlKFxuICBcInNjZW5lX2l0ZXJhdGlvblwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBzY2VuZUlkOiBkLnV1aWQoXCJzY2VuZV9pZFwiKS5ub3ROdWxsKCkucmVmZXJlbmNlcygoKSA9PiBzY2VuZXMuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLFxuICAgIHByb2plY3RJZDogZC51dWlkKFwicHJvamVjdF9pZFwiKS5ub3ROdWxsKCkucmVmZXJlbmNlcygoKSA9PiBwcm9qZWN0cy5pZCwgeyBvbkRlbGV0ZTogXCJjYXNjYWRlXCIgfSksXG4gICAgXG4gICAgLy8gTExNIERlY2lzaW9uIERhdGFcbiAgICBvcGVyYXRpb25UeXBlOiBkLnZhcmNoYXIoXCJvcGVyYXRpb25fdHlwZVwiLCB7IGxlbmd0aDogNTAgfSkubm90TnVsbCgpLCAvLyAnY3JlYXRlJywgJ2VkaXQnLCAnZGVsZXRlJ1xuICAgIGVkaXRDb21wbGV4aXR5OiBkLnZhcmNoYXIoXCJlZGl0X2NvbXBsZXhpdHlcIiwgeyBsZW5ndGg6IDIwIH0pLCAvLyAnc3VyZ2ljYWwnLCAnY3JlYXRpdmUnLCAnc3RydWN0dXJhbCdcbiAgICB1c2VyUHJvbXB0OiBkLnRleHQoXCJ1c2VyX3Byb21wdFwiKS5ub3ROdWxsKCksXG4gICAgYnJhaW5SZWFzb25pbmc6IGQudGV4dChcImJyYWluX3JlYXNvbmluZ1wiKSwgLy8gQnJhaW4gTExNJ3MgdG9vbCBzZWxlY3Rpb24gcmVhc29uaW5nXG4gICAgdG9vbFJlYXNvbmluZzogZC50ZXh0KFwidG9vbF9yZWFzb25pbmdcIiksIC8vIFRvb2wncyBleGVjdXRpb24gcmVhc29uaW5nXG4gICAgXG4gICAgLy8gQ29kZSBDaGFuZ2VzXG4gICAgY29kZUJlZm9yZTogZC50ZXh0KFwiY29kZV9iZWZvcmVcIiksIC8vIFByZXZpb3VzIFRTWCBjb2RlIChmb3IgZWRpdHMpXG4gICAgY29kZUFmdGVyOiBkLnRleHQoXCJjb2RlX2FmdGVyXCIpLCAvLyBOZXcgVFNYIGNvZGVcbiAgICBjaGFuZ2VzQXBwbGllZDogZC5qc29uYihcImNoYW5nZXNfYXBwbGllZFwiKSwgLy8gU3RydWN0dXJlZCBsaXN0IG9mIGNoYW5nZXNcbiAgICBjaGFuZ2VzUHJlc2VydmVkOiBkLmpzb25iKFwiY2hhbmdlc19wcmVzZXJ2ZWRcIiksIC8vIFdoYXQgd2FzIGtlcHQgdGhlIHNhbWVcbiAgICBcbiAgICAvLyBQZXJmb3JtYW5jZSBNZXRyaWNzXG4gICAgZ2VuZXJhdGlvblRpbWVNczogZC5pbnRlZ2VyKFwiZ2VuZXJhdGlvbl90aW1lX21zXCIpLFxuICAgIG1vZGVsVXNlZDogZC52YXJjaGFyKFwibW9kZWxfdXNlZFwiLCB7IGxlbmd0aDogNTAgfSksIC8vICdncHQtNC4xJywgJ2dwdC00LjEtbWluaScsIGV0Yy5cbiAgICB0ZW1wZXJhdHVyZTogZC5yZWFsKFwidGVtcGVyYXR1cmVcIiksXG4gICAgdG9rZW5zVXNlZDogZC5pbnRlZ2VyKFwidG9rZW5zX3VzZWRcIiksXG4gICAgXG4gICAgLy8gVXNlciBTYXRpc2ZhY3Rpb24gSW5kaWNhdG9yc1xuICAgIHVzZXJFZGl0ZWRBZ2FpbjogZC5ib29sZWFuKFwidXNlcl9lZGl0ZWRfYWdhaW5cIikuZGVmYXVsdChmYWxzZSksIC8vIERpZCB1c2VyIGVkaXQgdGhpcyBzY2VuZSBhZ2FpbiB3aXRoaW4gNSBtaW51dGVzP1xuICAgIHVzZXJTYXRpc2ZhY3Rpb25TY29yZTogZC5pbnRlZ2VyKFwidXNlcl9zYXRpc2ZhY3Rpb25fc2NvcmVcIiksIC8vIDEtNSByYXRpbmcgKGZ1dHVyZSBmZWF0dXJlKVxuICAgIHNlc3Npb25JZDogZC52YXJjaGFyKFwic2Vzc2lvbl9pZFwiLCB7IGxlbmd0aDogMjU1IH0pLCAvLyBUcmFjayB1c2VyIHNlc3Npb25zXG4gICAgXG4gICAgLy8gTGluayB0byBtZXNzYWdlIHRoYXQgdHJpZ2dlcmVkIHRoaXMgaXRlcmF0aW9uXG4gICAgbWVzc2FnZUlkOiBkLnV1aWQoXCJtZXNzYWdlX2lkXCIpLnJlZmVyZW5jZXMoKCkgPT4gbWVzc2FnZXMuaWQsIHsgb25EZWxldGU6IFwic2V0IG51bGxcIiB9KSxcbiAgICBcbiAgICBjcmVhdGVkQXQ6IGQudGltZXN0YW1wKFwiY3JlYXRlZF9hdFwiLCB7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLm5vdE51bGwoKSxcbiAgfSksXG4gICh0KSA9PiBbXG4gICAgaW5kZXgoXCJzY2VuZV9pdGVyYXRpb25fc2NlbmVfaWR4XCIpLm9uKHQuc2NlbmVJZCksXG4gICAgaW5kZXgoXCJzY2VuZV9pdGVyYXRpb25fcHJvamVjdF9pZHhcIikub24odC5wcm9qZWN0SWQpLFxuICAgIGluZGV4KFwic2NlbmVfaXRlcmF0aW9uX29wZXJhdGlvbl9pZHhcIikub24odC5vcGVyYXRpb25UeXBlLCB0LmVkaXRDb21wbGV4aXR5KSxcbiAgICBpbmRleChcInNjZW5lX2l0ZXJhdGlvbl9zYXRpc2ZhY3Rpb25faWR4XCIpLm9uKHQudXNlckVkaXRlZEFnYWluLCB0LmNyZWF0ZWRBdCksXG4gICAgaW5kZXgoXCJzY2VuZV9pdGVyYXRpb25fbWVzc2FnZV9pZHhcIikub24odC5tZXNzYWdlSWQpLFxuICBdLFxuKTtcblxuZXhwb3J0IGNvbnN0IHNjZW5lSXRlcmF0aW9uc1JlbGF0aW9ucyA9IHJlbGF0aW9ucyhzY2VuZUl0ZXJhdGlvbnMsICh7IG9uZSB9KSA9PiAoe1xuICBzY2VuZTogb25lKHNjZW5lcywgeyBmaWVsZHM6IFtzY2VuZUl0ZXJhdGlvbnMuc2NlbmVJZF0sIHJlZmVyZW5jZXM6IFtzY2VuZXMuaWRdIH0pLFxuICBwcm9qZWN0OiBvbmUocHJvamVjdHMsIHsgZmllbGRzOiBbc2NlbmVJdGVyYXRpb25zLnByb2plY3RJZF0sIHJlZmVyZW5jZXM6IFtwcm9qZWN0cy5pZF0gfSksXG4gIG1lc3NhZ2U6IG9uZShtZXNzYWdlcywgeyBmaWVsZHM6IFtzY2VuZUl0ZXJhdGlvbnMubWVzc2FnZUlkXSwgcmVmZXJlbmNlczogW21lc3NhZ2VzLmlkXSB9KSxcbn0pKTtcblxuLy8gLS0tIFNjZW5lIFNwZWNzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIFNjZW5lU3BlYyBKU09OIGZvciBNQ1AgYXJjaGl0ZWN0dXJlXG5leHBvcnQgY29uc3Qgc2NlbmVTcGVjcyA9IGNyZWF0ZVRhYmxlKFxuICBcInNjZW5lX3NwZWNzXCIsXG4gIChkKSA9PiAoe1xuICAgIGlkOiBkLnV1aWQoKS5wcmltYXJ5S2V5KCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgIHByb2plY3RJZDogZC51dWlkKCkubm90TnVsbCgpLnJlZmVyZW5jZXMoKCkgPT4gcHJvamVjdHMuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLFxuICAgIHNjZW5lSWQ6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLm5vdE51bGwoKSwgLy8gU2NlbmUgaWRlbnRpZmllciBmcm9tIFNjZW5lU3BlY1xuICAgIG5hbWU6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLCAvLyBIdW1hbi1yZWFkYWJsZSBzY2VuZSBuYW1lXG4gICAgc3BlYzogZC5qc29uYigpLm5vdE51bGwoKSwgLy8gQ29tcGxldGUgU2NlbmVTcGVjIEpTT05cbiAgICB2ZXJzaW9uOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDEwIH0pLmRlZmF1bHQoXCIxLjBcIikubm90TnVsbCgpLCAvLyBTY2hlbWEgdmVyc2lvblxuICAgIGNyZWF0ZWRBdDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS5ub3ROdWxsKCksXG4gICAgdXBkYXRlZEF0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgICBjcmVhdGVkQnk6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLnJlZmVyZW5jZXMoKCkgPT4gdXNlcnMuaWQpLFxuICB9KSxcbiAgKHQpID0+IFtcbiAgICBpbmRleChcInNjZW5lX3NwZWNfcHJvamVjdF9pZHhcIikub24odC5wcm9qZWN0SWQpLFxuICAgIGluZGV4KFwic2NlbmVfc3BlY19jcmVhdGVkX2F0X2lkeFwiKS5vbih0LmNyZWF0ZWRBdCksXG4gICAgaW5kZXgoXCJzY2VuZV9zcGVjX3NjZW5lX2lkX2lkeFwiKS5vbih0LnNjZW5lSWQpLFxuICAgIC8vIEVuc3VyZSB1bmlxdWUgc2NlbmVfaWQgcGVyIHByb2plY3RcbiAgICB1bmlxdWVJbmRleChcInNjZW5lX3NwZWNfdW5pcXVlX3NjZW5lX2lkXCIpLm9uKHQucHJvamVjdElkLCB0LnNjZW5lSWQpLFxuICAgIC8vIEFkZGVkIG1pc3NpbmcgR0lOIGluZGV4IGZvciBKU09OQiBzcGVjIGNvbHVtblxuICAgIGluZGV4KFwic2NlbmVfc3BlY19zcGVjX2dpbl9pZHhcIikudXNpbmcoXCJnaW5cIiwgdC5zcGVjKSxcbiAgXSxcbik7XG5cbmV4cG9ydCBjb25zdCBzY2VuZVNwZWNzUmVsYXRpb25zID0gcmVsYXRpb25zKHNjZW5lU3BlY3MsICh7IG9uZSB9KSA9PiAoe1xuICBwcm9qZWN0OiBvbmUocHJvamVjdHMsIHsgZmllbGRzOiBbc2NlbmVTcGVjcy5wcm9qZWN0SWRdLCByZWZlcmVuY2VzOiBbcHJvamVjdHMuaWRdIH0pLFxuICBjcmVhdGVkQnlVc2VyOiBvbmUodXNlcnMsIHsgZmllbGRzOiBbc2NlbmVTcGVjcy5jcmVhdGVkQnldLCByZWZlcmVuY2VzOiBbdXNlcnMuaWRdIH0pLFxufSkpO1xuXG4vLyAtLS0gQ3VzdG9tIENvbXBvbmVudCBKb2JzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIGpvYnMgZm9yIGdlbmVyYXRpbmcgYW5kIGNvbXBpbGluZyBjdXN0b20gUmVtb3Rpb24gY29tcG9uZW50c1xuZXhwb3J0IGNvbnN0IGN1c3RvbUNvbXBvbmVudEpvYnMgPSBjcmVhdGVUYWJsZShcbiAgXCJjdXN0b21fY29tcG9uZW50X2pvYlwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBwcm9qZWN0SWQ6IGRcbiAgICAgIC51dWlkKClcbiAgICAgIC5ub3ROdWxsKClcbiAgICAgIC5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgICBlZmZlY3Q6IGQudGV4dCgpLm5vdE51bGwoKSwgLy8gTmF0dXJhbCBsYW5ndWFnZSBkZXNjcmlwdGlvbiBvZiB0aGUgZWZmZWN0XG4gICAgdHN4Q29kZTogZC50ZXh0KCksIC8vIEdlbmVyYXRlZCBUU1ggY29kZSBmb3IgdGhlIGNvbXBvbmVudFxuICAgIG1ldGFkYXRhOiBkLmpzb25iKCksIC8vIE5FVyDigJMgaW50ZW50IG9yIG90aGVyIG1ldGFkYXRhXG4gICAgc3RhdHVzTWVzc2FnZUlkOiBkLnV1aWQoKS5yZWZlcmVuY2VzKCgpID0+IG1lc3NhZ2VzLmlkKSwgLy8gTGluayB0byBzdGF0dXMgbWVzc2FnZSBmb3Igc3RyZWFtaW5nIHVwZGF0ZXNcbiAgICBzdGF0dXM6IGQudmFyY2hhcih7IGxlbmd0aDogNTAgfSkuZGVmYXVsdChcInBlbmRpbmdcIikubm90TnVsbCgpLCAvLyBcInBlbmRpbmdcInxcImJ1aWxkaW5nXCJ8XCJzdWNjZXNzXCJ8XCJlcnJvclwiXG4gICAgb3V0cHV0VXJsOiBkLnRleHQoKSwgLy8gVVJMIHRvIHRoZSBjb21waWxlZCBKUyBob3N0ZWQgb24gUjJcbiAgICBlcnJvck1lc3NhZ2U6IGQudGV4dCgpLCAvLyBFcnJvciBtZXNzYWdlIGlmIGNvbXBpbGF0aW9uIGZhaWxlZFxuICAgIHJldHJ5Q291bnQ6IGQuaW50ZWdlcigpLmRlZmF1bHQoMCkubm90TnVsbCgpLCAvLyBOdW1iZXIgb2YgcmV0cnkgYXR0ZW1wdHNcbiAgICBsYXN0U3VjY2Vzc2Z1bFN0ZXA6IGQudmFyY2hhcignbGFzdF9zdWNjZXNzZnVsX3N0ZXAnLCB7IGxlbmd0aDogNTAgfSksXG4gICAgbmV4dFJldHJ5QXQ6IGQudGltZXN0YW1wKCduZXh0X3JldHJ5X2F0JywgeyB3aXRoVGltZXpvbmU6IHRydWUgfSksXG4gICAgZXJyb3JDb250ZXh0OiBkLmpzb25iKCdlcnJvcl9jb250ZXh0JyksXG4gICAgY2hlY2twb2ludERhdGE6IGQuanNvbmIoJ2NoZWNrcG9pbnRfZGF0YScpLFxuICAgIGxhc3RTdGVwOiBkLnZhcmNoYXIoJ2xhc3Rfc3RlcCcsIHsgbGVuZ3RoOiA1MCB9KSxcbiAgICAvLyBBMkEgcHJvdG9jb2wgc3VwcG9ydCBmaWVsZHNcbiAgICB0YXNrSWQ6IGQudGV4dCgndGFza19pZCcpLCAvLyBBMkEgdGFzayBJRFxuICAgIGludGVybmFsU3RhdHVzOiBkLnZhcmNoYXIoJ2ludGVybmFsX3N0YXR1cycsIHsgbGVuZ3RoOiA1MCB9KSwgLy8gRm9yIGludGVybmFsIHRyYWNraW5nXG4gICAgcmVxdWlyZXNJbnB1dDogZC5ib29sZWFuKCdyZXF1aXJlc19pbnB1dCcpLmRlZmF1bHQoZmFsc2UpLCAvLyBXaGV0aGVyIHVzZXIgaW5wdXQgaXMgbmVlZGVkXG4gICAgaW5wdXRUeXBlOiBkLnRleHQoJ2lucHV0X3R5cGUnKSwgLy8gV2hhdCBraW5kIG9mIGlucHV0IGlzIG5lZWRlZFxuICAgIHRhc2tTdGF0ZTogZC5qc29uYigndGFza19zdGF0ZScpLCAvLyBDdXJyZW50IEEyQSB0YXNrIHN0YXRlIGRldGFpbHNcbiAgICBhcnRpZmFjdHM6IGQuanNvbmIoJ2FydGlmYWN0cycpLCAvLyBBMkEgYXJ0aWZhY3RzIGNvbGxlY3Rpb25cbiAgICBoaXN0b3J5OiBkLmpzb25iKCdoaXN0b3J5JyksIC8vIEFkZGVkIGhpc3RvcnkgZmllbGQgZm9yIEEyQSB0YXNrIGhpc3RvcnlcbiAgICBzc2VFbmFibGVkOiBkLmJvb2xlYW4oJ3NzZV9lbmFibGVkJykuZGVmYXVsdChmYWxzZSksIC8vIFdoZXRoZXIgU1NFIGlzIGVuYWJsZWQgZm9yIHRoaXMgdGFza1xuICAgIC8vIFRpbWVzdGFtcHNcbiAgICBjcmVhdGVkQXQ6IGRcbiAgICAgIC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSlcbiAgICAgIC5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApXG4gICAgICAubm90TnVsbCgpLFxuICAgIHVwZGF0ZWRBdDogZFxuICAgICAgLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KVxuICAgICAgLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYClcbiAgICAgIC4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgXG4gICAgLy8gS0VFUCBCT1RIIFZFUlNJT05TIE9GIENPTFVNTlMgKGNhbWVsQ2FzZSBhbmQgc25ha2VfY2FzZSlcbiAgICAvLyBDYW1lbENhc2Ugb3JpZ2luYWwgY29sdW1ucyAtIG5lZWQgdG8gcHJlc2VydmUgdGhlc2VcbiAgICBvcmlnaW5hbFRzeENvZGU6IGQudGV4dCgpLCAvLyBDYW1lbCBjYXNlIHZlcnNpb25cbiAgICBsYXN0Rml4QXR0ZW1wdDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSksIC8vIENhbWVsIGNhc2UgdmVyc2lvblxuICAgIGZpeElzc3VlczogZC50ZXh0KCksIC8vIENhbWVsIGNhc2UgdmVyc2lvblxuICAgIFxuICAgIC8vIFNuYWtlX2Nhc2UgbmV3IGNvbHVtbnNcbiAgICBvcmlnaW5hbF90c3hfY29kZTogZC50ZXh0KCdvcmlnaW5hbF90c3hfY29kZScpLCAvLyBTbmFrZSBjYXNlIHZlcnNpb25cbiAgICBsYXN0X2ZpeF9hdHRlbXB0OiBkLnRpbWVzdGFtcCgnbGFzdF9maXhfYXR0ZW1wdCcsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLCAvLyBTbmFrZSBjYXNlIHZlcnNpb25cbiAgICBmaXhfaXNzdWVzOiBkLnRleHQoJ2ZpeF9pc3N1ZXMnKSAvLyBTbmFrZSBjYXNlIHZlcnNpb25cbiAgfSksXG4gICh0KSA9PiBbXG4gICAgaW5kZXgoXCJjdXN0b21fY29tcG9uZW50X2pvYl9wcm9qZWN0X2lkeFwiKS5vbih0LnByb2plY3RJZCksXG4gICAgaW5kZXgoXCJjdXN0b21fY29tcG9uZW50X2pvYl9zdGF0dXNfaWR4XCIpLm9uKHQuc3RhdHVzKSxcbiAgICBpbmRleChcImN1c3RvbV9jb21wb25lbnRfam9iX3Rhc2tfaWRfaWR4XCIpLm9uKHQudGFza0lkKSxcbiAgXSxcbik7XG5cbi8vIEFkZCByZWxhdGlvbnMgZm9yIGN1c3RvbSBjb21wb25lbnQgam9ic1xuZXhwb3J0IGNvbnN0IGN1c3RvbUNvbXBvbmVudEpvYnNSZWxhdGlvbnMgPSByZWxhdGlvbnMoY3VzdG9tQ29tcG9uZW50Sm9icywgKHsgb25lIH0pID0+ICh7XG4gIHByb2plY3Q6IG9uZShwcm9qZWN0cywgeyBmaWVsZHM6IFtjdXN0b21Db21wb25lbnRKb2JzLnByb2plY3RJZF0sIHJlZmVyZW5jZXM6IFtwcm9qZWN0cy5pZF0gfSksXG59KSk7XG5cbi8vIC0tLSBDb21wb25lbnQgRXJyb3JzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIGVycm9ycyBmb3IgY3VzdG9tIGNvbXBvbmVudCBqb2JzXG5leHBvcnQgY29uc3QgY29tcG9uZW50RXJyb3JzID0gY3JlYXRlVGFibGUoXG4gIFwiY29tcG9uZW50X2Vycm9yXCIsXG4gIChkKSA9PiAoe1xuICAgIGlkOiBkLnV1aWQoKS5wcmltYXJ5S2V5KCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgIGpvYklkOiBkXG4gICAgICAudXVpZCgpXG4gICAgICAubm90TnVsbCgpXG4gICAgICAucmVmZXJlbmNlcygoKSA9PiBjdXN0b21Db21wb25lbnRKb2JzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgICBlcnJvclR5cGU6IGQudmFyY2hhcih7IGxlbmd0aDogMTAwIH0pLm5vdE51bGwoKSxcbiAgICBkZXRhaWxzOiBkLnRleHQoKS5ub3ROdWxsKCksXG4gICAgY3JlYXRlZEF0OiBkXG4gICAgICAudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pXG4gICAgICAuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKVxuICAgICAgLm5vdE51bGwoKSxcbiAgfSksXG4gICh0KSA9PiBbaW5kZXgoXCJjb21wb25lbnRfZXJyb3Jfam9iX2lkeFwiKS5vbih0LmpvYklkKV0sXG4pO1xuXG5leHBvcnQgY29uc3QgY29tcG9uZW50RXJyb3JzUmVsYXRpb25zID0gcmVsYXRpb25zKGNvbXBvbmVudEVycm9ycywgKHsgb25lIH0pID0+ICh7XG4gIGpvYjogb25lKGN1c3RvbUNvbXBvbmVudEpvYnMsIHtcbiAgICBmaWVsZHM6IFtjb21wb25lbnRFcnJvcnMuam9iSWRdLFxuICAgIHJlZmVyZW5jZXM6IFtjdXN0b21Db21wb25lbnRKb2JzLmlkXSxcbiAgfSksXG59KSk7XG5cbi8vIC0tLSBNZXRyaWNzIHRhYmxlIC0tLVxuZXhwb3J0IGNvbnN0IG1ldHJpY3MgPSBjcmVhdGVUYWJsZShcbiAgXCJtZXRyaWNcIixcbiAgKGQpID0+ICh7XG4gICAgaWQ6IGQudXVpZCgpLnByaW1hcnlLZXkoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgbmFtZTogZC52YXJjaGFyKHsgbGVuZ3RoOiAxMDAgfSkubm90TnVsbCgpLFxuICAgIHZhbHVlOiBkLnJlYWwoKS5ub3ROdWxsKCksXG4gICAgdGFnczogZC5qc29uYigpLFxuICAgIHRpbWVzdGFtcDogZFxuICAgICAgLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KVxuICAgICAgLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYClcbiAgICAgIC5ub3ROdWxsKCksXG4gIH0pXG4pO1xuXG4vLyAtLS0gU2NlbmUgUGxhbnMgdGFibGUgLS0tXG4vLyBTdG9yZXMgTExNIHJlYXNvbmluZyBhYm91dCBzY2VuZSBwbGFubmluZ1xuZXhwb3J0IGNvbnN0IHNjZW5lUGxhbnMgPSBjcmVhdGVUYWJsZShcbiAgXCJzY2VuZV9wbGFuXCIsXG4gIChkKSA9PiAoe1xuICAgIGlkOiBkLnV1aWQoKS5wcmltYXJ5S2V5KCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgIHByb2plY3RJZDogZFxuICAgICAgLnV1aWQoKVxuICAgICAgLm5vdE51bGwoKVxuICAgICAgLnJlZmVyZW5jZXMoKCkgPT4gcHJvamVjdHMuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLFxuICAgIG1lc3NhZ2VJZDogZFxuICAgICAgLnV1aWQoKVxuICAgICAgLnJlZmVyZW5jZXMoKCkgPT4gbWVzc2FnZXMuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLFxuICAgIHJhd1JlYXNvbmluZzogZC50ZXh0KCkubm90TnVsbCgpLCAvLyBSYXcgTExNIHJlYXNvbmluZyBhYm91dCB0aGUgcGxhblxuICAgIHBsYW5EYXRhOiBkLmpzb25iKCkubm90TnVsbCgpLCAvLyBUaGUgc3RydWN0dXJlZCBzY2VuZSBwbGFuIGRhdGFcbiAgICB1c2VyUHJvbXB0OiBkLnRleHQoKS5ub3ROdWxsKCksIC8vIFByb21wdCB0aGF0IGdlbmVyYXRlZCB0aGlzIHBsYW5cbiAgICBjcmVhdGVkQXQ6IGRcbiAgICAgIC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSlcbiAgICAgIC5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApXG4gICAgICAubm90TnVsbCgpLFxuICB9KSxcbiAgKHQpID0+IFtcbiAgICBpbmRleChcInNjZW5lX3BsYW5fcHJvamVjdF9pZHhcIikub24odC5wcm9qZWN0SWQpLFxuICBdLFxuKTtcblxuZXhwb3J0IGNvbnN0IHNjZW5lUGxhbnNSZWxhdGlvbnMgPSByZWxhdGlvbnMoc2NlbmVQbGFucywgKHsgb25lIH0pID0+ICh7XG4gIHByb2plY3Q6IG9uZShwcm9qZWN0cywgeyBmaWVsZHM6IFtzY2VuZVBsYW5zLnByb2plY3RJZF0sIHJlZmVyZW5jZXM6IFtwcm9qZWN0cy5pZF0gfSksXG4gIG1lc3NhZ2U6IG9uZShtZXNzYWdlcywgeyBmaWVsZHM6IFtzY2VuZVBsYW5zLm1lc3NhZ2VJZF0sIHJlZmVyZW5jZXM6IFttZXNzYWdlcy5pZF0gfSksXG59KSk7XG5cbi8vIC0tLSBBbmltYXRpb24gRGVzaWduIEJyaWVmcyB0YWJsZSAtLS1cbi8vIFN0b3JlcyBkZXRhaWxlZCBhbmltYXRpb24gc3BlY2lmaWNhdGlvbnMgdGhhdCBicmlkZ2Ugc2NlbmUgcGxhbnMgYW5kIGNvbXBvbmVudCBnZW5lcmF0aW9uXG5leHBvcnQgY29uc3QgYW5pbWF0aW9uRGVzaWduQnJpZWZzID0gY3JlYXRlVGFibGUoXG4gIFwiYW5pbWF0aW9uX2Rlc2lnbl9icmllZlwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBwcm9qZWN0SWQ6IGRcbiAgICAgIC51dWlkKClcbiAgICAgIC5ub3ROdWxsKClcbiAgICAgIC5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgICBzY2VuZUlkOiBkLnV1aWQoKS5ub3ROdWxsKCksIC8vIFJlZmVyZW5jZXMgc2NlbmUgcGxhbiBJRCAob3Igc2NlbmUgSUQgd2l0aGluIHByb2plY3QpXG4gICAgY29tcG9uZW50Sm9iSWQ6IGRcbiAgICAgIC51dWlkKClcbiAgICAgIC5yZWZlcmVuY2VzKCgpID0+IGN1c3RvbUNvbXBvbmVudEpvYnMuaWQpLCAvLyBPcHRpb25hbCBsaW5rIHRvIGNvbXBvbmVudCBqb2JcbiAgICBsbG1Nb2RlbDogZC52YXJjaGFyKHsgbGVuZ3RoOiAxMDAgfSkubm90TnVsbCgpLCAvLyBNb2RlbCB1c2VkIHRvIGdlbmVyYXRlIHRoZSBicmllZlxuICAgIHN0YXR1czogZC52YXJjaGFyKHsgbGVuZ3RoOiA1MCB9KVxuICAgICAgLmRlZmF1bHQoXCJwZW5kaW5nXCIpXG4gICAgICAubm90TnVsbCgpLCAvLyBcInBlbmRpbmdcInxcImNvbXBsZXRlXCJ8XCJlcnJvclwiXG4gICAgZXJyb3JNZXNzYWdlOiBkLnRleHQoKSwgLy8gRXJyb3IgbWVzc2FnZSBpZiBnZW5lcmF0aW9uIGZhaWxlZFxuICAgIGNyZWF0ZWRBdDogZFxuICAgICAgLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KVxuICAgICAgLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYClcbiAgICAgIC5ub3ROdWxsKCksXG4gICAgdXBkYXRlZEF0OiBkXG4gICAgICAudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pXG4gICAgICAuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKVxuICAgICAgLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgICBvcmlnaW5hbFRzeENvZGU6IGQudGV4dCgpLCAvLyBTdG9yZSB0aGUgb3JpZ2luYWwgY29kZSBiZWZvcmUgZml4aW5nXG4gICAgbGFzdEZpeEF0dGVtcHQ6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLCAvLyBXaGVuIHRoZSBsYXN0IGZpeCBhdHRlbXB0IHdhcyBtYWRlXG4gICAgZml4SXNzdWVzOiBkLnRleHQoKSwgLy8gSXNzdWVzIGlkZW50aWZpZWQgYW5kIGZpeGVkIGJ5IHRoZSBwcmVwcm9jZXNzb3JcbiAgfSksXG4gICh0KSA9PiBbXG4gICAgaW5kZXgoXCJhbmltYXRpb25fZGVzaWduX2JyaWVmX3Byb2plY3RfaWR4XCIpLm9uKHQucHJvamVjdElkKSxcbiAgICBpbmRleChcImFuaW1hdGlvbl9kZXNpZ25fYnJpZWZfc2NlbmVfaWR4XCIpLm9uKHQuc2NlbmVJZCksXG4gICAgaW5kZXgoXCJhbmltYXRpb25fZGVzaWduX2JyaWVmX2NvbXBvbmVudF9pZHhcIikub24odC5jb21wb25lbnRKb2JJZCksXG4gIF0sXG4pO1xuXG5leHBvcnQgY29uc3QgYW5pbWF0aW9uRGVzaWduQnJpZWZzUmVsYXRpb25zID0gcmVsYXRpb25zKGFuaW1hdGlvbkRlc2lnbkJyaWVmcywgKHsgb25lIH0pID0+ICh7XG4gIHByb2plY3Q6IG9uZShwcm9qZWN0cywge1xuICAgIGZpZWxkczogW2FuaW1hdGlvbkRlc2lnbkJyaWVmcy5wcm9qZWN0SWRdLFxuICAgIHJlZmVyZW5jZXM6IFtwcm9qZWN0cy5pZF0sXG4gIH0pLFxuICBjb21wb25lbnRKb2I6IG9uZShjdXN0b21Db21wb25lbnRKb2JzLCB7XG4gICAgZmllbGRzOiBbYW5pbWF0aW9uRGVzaWduQnJpZWZzLmNvbXBvbmVudEpvYklkXSxcbiAgICByZWZlcmVuY2VzOiBbY3VzdG9tQ29tcG9uZW50Sm9icy5pZF0sXG4gIH0pLFxufSkpO1xuXG4vLyAtLS0gRmVlZGJhY2sgdGFibGUgLS0tXG4vLyBTdG9yZXMgdXNlciBmZWVkYmFjayBhbmQgZmVhdHVyZSBwcmlvcml0aXphdGlvblxuZXhwb3J0IGNvbnN0IGZlZWRiYWNrID0gY3JlYXRlVGFibGUoXG4gIFwiZmVlZGJhY2tcIixcbiAgKGQpID0+ICh7XG4gICAgaWQ6IGQudGV4dCgnaWQnKS5wcmltYXJ5S2V5KCkuJGRlZmF1bHRGbigoKSA9PiBjcnlwdG8ucmFuZG9tVVVJRCgpKSwgLy8gVXNpbmcgdGV4dCBmb3IgY3JlYXRlSWQgY29tcGF0aWJpbGl0eSBpZiBuZWVkZWQsIGVsc2UgdXNlIHV1aWQoKVxuICAgIGNvbnRlbnQ6IGQudGV4dCgnY29udGVudCcpLCAvLyBGcmVlLXRleHQgY29tbWVudHMsIGNhbiBiZSBudWxsYWJsZSBpZiBvbmx5IGZlYXR1cmVzIGFyZSBwcmlvcml0aXplZFxuICAgIG5hbWU6IGQudGV4dCgnbmFtZScpLCAvLyBPcHRpb25hbCBuYW1lIHByb3ZpZGVkIGJ5IHVzZXJcbiAgICBlbWFpbDogZC50ZXh0KCdlbWFpbCcpLCAvLyBPcHRpb25hbCBmb3IgYW5vbnltb3VzLCBwcmUtZmlsbGVkIGZvciBsb2dnZWQtaW5cbiAgICB1c2VySWQ6IGQudmFyY2hhcigndXNlcl9pZCcsIHsgbGVuZ3RoOiAyNTUgfSkucmVmZXJlbmNlcygoKSA9PiB1c2Vycy5pZCwgeyBvbkRlbGV0ZTogJ3NldCBudWxsJyB9KSxcbiAgICBwcmlvcml0aXplZEZlYXR1cmVzOiBkLmpzb25iKCdwcmlvcml0aXplZF9mZWF0dXJlcycpLiR0eXBlPHN0cmluZ1tdPigpLCAvLyBBcnJheSBvZiBzZWxlY3RlZCBmZWF0dXJlIElEcy9uYW1lc1xuICAgIGNyZWF0ZWRBdDogZC50aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnLCB7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLm5vdE51bGwoKSxcbiAgICBzdGF0dXM6IGQudGV4dCgnc3RhdHVzJykuZGVmYXVsdCgnbmV3Jykubm90TnVsbCgpLCAvLyBlLmcuLCAnbmV3JywgJ3Jldmlld2VkJywgJ3BsYW5uZWQnLCAnaW1wbGVtZW50ZWQnLCAnYXJjaGl2ZWQnXG4gICAgYWRtaW5Ob3RlczogZC50ZXh0KCdhZG1pbl9ub3RlcycpLCAvLyBGb3IgaW50ZXJuYWwgdGVhbSBub3Rlc1xuICB9KSxcbiAgKHQpID0+IFtcbiAgICBpbmRleChcImZlZWRiYWNrX3VzZXJfaWR4XCIpLm9uKHQudXNlcklkKSxcbiAgICBpbmRleChcImZlZWRiYWNrX3N0YXR1c19pZHhcIikub24odC5zdGF0dXMpLFxuICAgIGluZGV4KFwiZmVlZGJhY2tfY3JlYXRlZF9hdF9pZHhcIikub24odC5jcmVhdGVkQXQpLFxuICBdXG4pO1xuXG5leHBvcnQgY29uc3QgZmVlZGJhY2tSZWxhdGlvbnMgPSByZWxhdGlvbnMoZmVlZGJhY2ssICh7IG9uZSB9KSA9PiAoe1xuICB1c2VyOiBvbmUodXNlcnMsIHsgZmllbGRzOiBbZmVlZGJhY2sudXNlcklkXSwgcmVmZXJlbmNlczogW3VzZXJzLmlkXSB9KSxcbn0pKTtcblxuLy8gLS0tIEVtYWlsIFN1YnNjcmliZXJzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIGVtYWlsIGFkZHJlc3NlcyBmb3IgbmV3c2xldHRlci91cGRhdGVzIHNpZ251cFxuZXhwb3J0IGNvbnN0IGVtYWlsU3Vic2NyaWJlcnMgPSBjcmVhdGVUYWJsZShcbiAgXCJlbWFpbF9zdWJzY3JpYmVyXCIsXG4gIChkKSA9PiAoe1xuICAgIGlkOiBkLnRleHQoJ2lkJykucHJpbWFyeUtleSgpLiRkZWZhdWx0Rm4oKCkgPT4gY3J5cHRvLnJhbmRvbVVVSUQoKSksXG4gICAgZW1haWw6IGQudGV4dCgnZW1haWwnKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgc3Vic2NyaWJlZEF0OiBkLnRpbWVzdGFtcCgnc3Vic2NyaWJlZF9hdCcsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYCkubm90TnVsbCgpLFxuICAgIHN0YXR1czogZC50ZXh0KCdzdGF0dXMnKS5kZWZhdWx0KCdhY3RpdmUnKS5ub3ROdWxsKCksIC8vICdhY3RpdmUnLCAndW5zdWJzY3JpYmVkJ1xuICAgIHNvdXJjZTogZC50ZXh0KCdzb3VyY2UnKS5kZWZhdWx0KCdob21lcGFnZScpLm5vdE51bGwoKSwgLy8gJ2hvbWVwYWdlJywgJ2Zvb3RlcicsIGV0Yy5cbiAgICB1c2VySWQ6IGQudmFyY2hhcigndXNlcl9pZCcsIHsgbGVuZ3RoOiAyNTUgfSkucmVmZXJlbmNlcygoKSA9PiB1c2Vycy5pZCwgeyBvbkRlbGV0ZTogJ3NldCBudWxsJyB9KSwgLy8gT3B0aW9uYWwgbGluayB0byB1c2VyIGlmIGxvZ2dlZCBpblxuICB9KSxcbiAgKHQpID0+IFtcbiAgICBpbmRleChcImVtYWlsX3N1YnNjcmliZXJfZW1haWxfaWR4XCIpLm9uKHQuZW1haWwpLFxuICAgIGluZGV4KFwiZW1haWxfc3Vic2NyaWJlcl9zdGF0dXNfaWR4XCIpLm9uKHQuc3RhdHVzKSxcbiAgICBpbmRleChcImVtYWlsX3N1YnNjcmliZXJfc3Vic2NyaWJlZF9hdF9pZHhcIikub24odC5zdWJzY3JpYmVkQXQpLFxuICBdXG4pO1xuXG5leHBvcnQgY29uc3QgZW1haWxTdWJzY3JpYmVyc1JlbGF0aW9ucyA9IHJlbGF0aW9ucyhlbWFpbFN1YnNjcmliZXJzLCAoeyBvbmUgfSkgPT4gKHtcbiAgdXNlcjogb25lKHVzZXJzLCB7IGZpZWxkczogW2VtYWlsU3Vic2NyaWJlcnMudXNlcklkXSwgcmVmZXJlbmNlczogW3VzZXJzLmlkXSB9KSxcbn0pKTtcblxuLy8gLS0tIEFnZW50IE1lc3NhZ2VzIHRhYmxlIC0tLVxuLy8gU3RvcmVzIG1lc3NhZ2VzIGV4Y2hhbmdlZCBiZXR3ZWVuIGFnZW50cyBmb3IgQTJBIHByb3RvY29sIHN1cHBvcnRcbmV4cG9ydCBjb25zdCBhZ2VudE1lc3NhZ2VzID0gY3JlYXRlVGFibGUoXG4gIFwiYWdlbnRfbWVzc2FnZVwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC50ZXh0KCkucHJpbWFyeUtleSgpLCAvLyBVVUlEIGZvciB0aGUgbWVzc2FnZVxuICAgIHNlbmRlcjogZC50ZXh0KFwic2VuZGVyXCIpLm5vdE51bGwoKSwgLy8gTmFtZSBvZiB0aGUgc2VuZGluZyBhZ2VudFxuICAgIHJlY2lwaWVudDogZC50ZXh0KFwicmVjaXBpZW50XCIpLm5vdE51bGwoKSwgLy8gTmFtZSBvZiB0aGUgcmVjaXBpZW50IGFnZW50XG4gICAgdHlwZTogZC50ZXh0KFwidHlwZVwiKS5ub3ROdWxsKCksIC8vIFR5cGUgb2YgdGhlIG1lc3NhZ2UgKGUuZy4sIFRBU0tfU1RBUlQsIERBVEFfUkVRVUVTVClcbiAgICBwYXlsb2FkOiBkLmpzb25iKFwicGF5bG9hZFwiKS4kdHlwZTxSZWNvcmQ8c3RyaW5nLCBhbnk+PigpLm5vdE51bGwoKSwgLy8gQ29udGVudCBvZiB0aGUgbWVzc2FnZSwgdHlwZWRcbiAgICBjb3JyZWxhdGlvbklkOiBkLnRleHQoXCJjb3JyZWxhdGlvbl9pZFwiKSwgLy8gT3B0aW9uYWwgSUQgdG8gY29ycmVsYXRlIG1lc3NhZ2VzXG4gICAgc3RhdHVzOiBkLnRleHQoXCJzdGF0dXNcIikuZGVmYXVsdCgncGVuZGluZycpLm5vdE51bGwoKSwgLy8gZS5nLiwgcGVuZGluZywgcHJvY2Vzc2VkLCBmYWlsZWRcbiAgICBjcmVhdGVkQXQ6IGRcbiAgICAgIC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUsIG1vZGU6ICdkYXRlJyB9KVxuICAgICAgLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYClcbiAgICAgIC5ub3ROdWxsKCksXG4gICAgcHJvY2Vzc2VkQXQ6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlLCBtb2RlOiAnZGF0ZScgfSlcbiAgfSksXG4gICh0KSA9PiBbXG4gICAgaW5kZXgoXCJhZ2VudF9tZXNzYWdlX2NvcnJlbGF0aW9uX2lkX2lkeFwiKS5vbih0LmNvcnJlbGF0aW9uSWQpLFxuICAgIGluZGV4KFwiYWdlbnRfbWVzc2FnZV90eXBlX2lkeFwiKS5vbih0LnR5cGUpLFxuICAgIGluZGV4KFwiYWdlbnRfbWVzc2FnZV9zZW5kZXJfaWR4XCIpLm9uKHQuc2VuZGVyKSxcbiAgICBpbmRleChcImFnZW50X21lc3NhZ2VfcmVjaXBpZW50X2lkeFwiKS5vbih0LnJlY2lwaWVudCksXG4gIF0sXG4pO1xuXG4vLyBBZGQgY3VzdG9tIGluZGV4IGZvciB0YXNrIElEIGluIHBheWxvYWRcbmV4cG9ydCBjb25zdCBhZ2VudE1lc3NhZ2VzSW5kZXhlcyA9IHtcbiAgYnlUYXNrSWQ6IHNxbGBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBcImlkeF9hZ2VudF9tZXNzYWdlc190YXNrX2lkXCIgT04gXCJiYXphYXItdmlkX2FnZW50X21lc3NhZ2VcIiAoKHBheWxvYWQtPj4ndGFza0lkJykpYCxcbn07XG5cbi8vIEFkZCBoaXN0b3J5IGZpZWxkIHRvIGN1c3RvbUNvbXBvbmVudEpvYnMgdG8gc3VwcG9ydCBBMkEgcHJvdG9jb2wgdGFzayBoaXN0b3J5XG5leHBvcnQgY29uc3QgY3VzdG9tQ29tcG9uZW50Sm9ic1VwZGF0ZSA9IHNxbGBcbiAgQUxURVIgVEFCTEUgXCJiYXphYXItdmlkX2N1c3RvbV9jb21wb25lbnRfam9iXCJcbiAgQUREIENPTFVNTiBJRiBOT1QgRVhJU1RTIFwiaGlzdG9yeVwiIEpTT05CXG5gO1xuXG5leHBvcnQgY29uc3QgY3VzdG9tQ29tcG9uZW50Sm9ic1JlY292ZXJ5VXBkYXRlID0gc3FsYFxuICBBTFRFUiBUQUJMRSBcImJhemFhci12aWRfY3VzdG9tX2NvbXBvbmVudF9qb2JcIlxuICBBREQgQ09MVU1OIElGIE5PVCBFWElTVFMgXCJsYXN0X3N1Y2Nlc3NmdWxfc3RlcFwiIHZhcmNoYXIoNTApLFxuICBBREQgQ09MVU1OIElGIE5PVCBFWElTVFMgXCJuZXh0X3JldHJ5X2F0XCIgdGltZXN0YW1wIHdpdGggdGltZSB6b25lLFxuICBBREQgQ09MVU1OIElGIE5PVCBFWElTVFMgXCJlcnJvcl9jb250ZXh0XCIganNvbmJcbmA7XG5cbi8vIC0tLSBDb21wb25lbnQgVGVzdCBDYXNlcyB0YWJsZSAtLS1cbi8vIFN0b3JlcyB0ZXN0IGNhc2VzIGZvciBjb21wb25lbnQgZ2VuZXJhdGlvbiBldmFsdWF0aW9uXG5leHBvcnQgY29uc3QgY29tcG9uZW50VGVzdENhc2VzID0gY3JlYXRlVGFibGUoXG4gIFwiY29tcG9uZW50X3Rlc3RfY2FzZVwiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBwcm9tcHQ6IGQudGV4dCgpLm5vdE51bGwoKSxcbiAgICBjYXRlZ29yeTogZC52YXJjaGFyKHsgbGVuZ3RoOiA1MCB9KS5ub3ROdWxsKCksXG4gICAgY29tcGxleGl0eTogZC5pbnRlZ2VyKCkubm90TnVsbCgpLFxuICAgIGVkZ2VDYXNlczogZC5qc29uYigpLmRlZmF1bHQoW10pLFxuICAgIGNyZWF0ZWRBdDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS5ub3ROdWxsKCksXG4gIH0pLFxuICAodCkgPT4gW1xuICAgIGluZGV4KFwiY29tcG9uZW50X3Rlc3RfY2FzZXNfY2F0ZWdvcnlfaWR4XCIpLm9uKHQuY2F0ZWdvcnkpLFxuICBdLFxuKTtcblxuLy8gLS0tIENvbXBvbmVudCBFdmFsdWF0aW9uIE1ldHJpY3MgdGFibGUgLS0tXG4vLyBTdG9yZXMgbWV0cmljcyBmcm9tIGNvbXBvbmVudCBnZW5lcmF0aW9uIGV2YWx1YXRpb25cbmV4cG9ydCBjb25zdCBjb21wb25lbnRFdmFsdWF0aW9uTWV0cmljcyA9IGNyZWF0ZVRhYmxlKFxuICBcImNvbXBvbmVudF9ldmFsdWF0aW9uX21ldHJpY1wiLFxuICAoZCkgPT4gKHtcbiAgICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICB0ZXN0Q2FzZUlkOiBkLnV1aWQoKS5ub3ROdWxsKCkucmVmZXJlbmNlcygoKSA9PiBjb21wb25lbnRUZXN0Q2FzZXMuaWQpLFxuICAgIHRpbWVzdGFtcDogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS5ub3ROdWxsKCksXG4gICAgXG4gICAgLy8gVGVzdCBjYXNlIG1ldGFkYXRhXG4gICAgY2F0ZWdvcnk6IGQudmFyY2hhcih7IGxlbmd0aDogNTAgfSkubm90TnVsbCgpLFxuICAgIGNvbXBsZXhpdHk6IGQuaW50ZWdlcigpLm5vdE51bGwoKSxcbiAgICBlZGdlQ2FzZXM6IGQuanNvbmIoKS5kZWZhdWx0KFtdKSxcbiAgICBcbiAgICAvLyBQaXBlbGluZSBzdWNjZXNzIG1ldHJpY3NcbiAgICBzdWNjZXNzOiBkLmJvb2xlYW4oKS5ub3ROdWxsKCksXG4gICAgZXJyb3JTdGFnZTogZC52YXJjaGFyKHsgbGVuZ3RoOiA1MCB9KSxcbiAgICBlcnJvclR5cGU6IGQudmFyY2hhcih7IGxlbmd0aDogMTAwIH0pLFxuICAgIGVycm9yTWVzc2FnZTogZC50ZXh0KCksXG4gICAgXG4gICAgLy8gVGltaW5nIG1ldHJpY3NcbiAgICBwcm9tcHRTdWJtaXNzaW9uVGltZTogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSkubm90TnVsbCgpLFxuICAgIGNvZGVHZW5lcmF0aW9uU3RhcnRUaW1lOiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KSxcbiAgICBjb2RlR2VuZXJhdGlvbkVuZFRpbWU6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLFxuICAgIHZhbGlkYXRpb25TdGFydFRpbWU6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLFxuICAgIHZhbGlkYXRpb25FbmRUaW1lOiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KSxcbiAgICBidWlsZFN0YXJ0VGltZTogZC50aW1lc3RhbXAoeyB3aXRoVGltZXpvbmU6IHRydWUgfSksXG4gICAgYnVpbGRFbmRUaW1lOiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KSxcbiAgICB1cGxvYWRTdGFydFRpbWU6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLFxuICAgIHVwbG9hZEVuZFRpbWU6IGQudGltZXN0YW1wKHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLFxuICAgIGNvbXBvbmVudENvbXBsZXRpb25UaW1lOiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KSxcbiAgICBcbiAgICAvLyBEZXJpdmVkIHRpbWluZyBtZXRyaWNzXG4gICAgdGltZVRvRmlyc3RUb2tlbjogZC5pbnRlZ2VyKCksXG4gICAgY29kZUdlbmVyYXRpb25UaW1lOiBkLmludGVnZXIoKSxcbiAgICB2YWxpZGF0aW9uVGltZTogZC5pbnRlZ2VyKCksXG4gICAgYnVpbGRUaW1lOiBkLmludGVnZXIoKSxcbiAgICB1cGxvYWRUaW1lOiBkLmludGVnZXIoKSxcbiAgICB0b3RhbFRpbWU6IGQuaW50ZWdlcigpLFxuICAgIFxuICAgIC8vIENvZGUgcXVhbGl0eSBtZXRyaWNzXG4gICAgc3ludGF4RXJyb3JDb3VudDogZC5pbnRlZ2VyKCksXG4gICAgZXNsaW50RXJyb3JDb3VudDogZC5pbnRlZ2VyKCksXG4gICAgZXNsaW50V2FybmluZ0NvdW50OiBkLmludGVnZXIoKSxcbiAgICBjb2RlTGVuZ3RoOiBkLmludGVnZXIoKSxcbiAgICBcbiAgICAvLyBSZW5kZXJpbmcgbWV0cmljc1xuICAgIHJlbmRlclN1Y2Nlc3M6IGQuYm9vbGVhbigpLFxuICAgIHJlbmRlckVycm9yTWVzc2FnZTogZC50ZXh0KCksXG4gICAgXG4gICAgLy8gUmVmZXJlbmNlc1xuICAgIGNvbXBvbmVudElkOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDEwMCB9KSxcbiAgICBvdXRwdXRVcmw6IGQudGV4dCgpLFxuICAgIHRhc2tJZDogZC51dWlkKCksXG4gICAgXG4gICAgLy8gQTJBIHNwZWNpZmljIG1ldHJpY3NcbiAgICBzdGF0ZVRyYW5zaXRpb25zOiBkLmpzb25iKCkuZGVmYXVsdChbXSksXG4gICAgYXJ0aWZhY3RzOiBkLmpzb25iKCkuZGVmYXVsdChbXSksXG4gICAgXG4gICAgLy8gQW5hbHlzaXMgZmllbGRzXG4gICAgYW5hbHlzaXNOb3RlczogZC50ZXh0KCksXG4gICAgdGFnczogZC5qc29uYigpLmRlZmF1bHQoW10pLFxuICB9KSxcbiAgKHQpID0+IFtcbiAgICBpbmRleChcImNvbXBvbmVudF9ldmFsdWF0aW9uX21ldHJpY3NfdGVzdF9jYXNlX2lkX2lkeFwiKS5vbih0LnRlc3RDYXNlSWQpLFxuICAgIGluZGV4KFwiY29tcG9uZW50X2V2YWx1YXRpb25fbWV0cmljc19zdWNjZXNzX2lkeFwiKS5vbih0LnN1Y2Nlc3MpLFxuICAgIGluZGV4KFwiY29tcG9uZW50X2V2YWx1YXRpb25fbWV0cmljc190aW1lc3RhbXBfaWR4XCIpLm9uKHQudGltZXN0YW1wKSxcbiAgICBpbmRleChcImNvbXBvbmVudF9ldmFsdWF0aW9uX21ldHJpY3NfY2F0ZWdvcnlfaWR4XCIpLm9uKHQuY2F0ZWdvcnkpLFxuICBdLFxuKTtcblxuZXhwb3J0IGNvbnN0IGNvbXBvbmVudEV2YWx1YXRpb25NZXRyaWNzUmVsYXRpb25zID0gcmVsYXRpb25zKGNvbXBvbmVudEV2YWx1YXRpb25NZXRyaWNzLCAoeyBvbmUgfSkgPT4gKHtcbiAgdGVzdENhc2U6IG9uZShjb21wb25lbnRUZXN0Q2FzZXMsIHsgZmllbGRzOiBbY29tcG9uZW50RXZhbHVhdGlvbk1ldHJpY3MudGVzdENhc2VJZF0sIHJlZmVyZW5jZXM6IFtjb21wb25lbnRUZXN0Q2FzZXMuaWRdIH0pLFxufSkpO1xuXG4vLyBFeHBvcnQgaW5mZXJyZWQgdHlwZSBmb3IgY3VzdG9tQ29tcG9uZW50Sm9icyB0YWJsZVxuZXhwb3J0IHR5cGUgQ29tcG9uZW50Sm9iID0gSW5mZXJTZWxlY3RNb2RlbDx0eXBlb2YgY3VzdG9tQ29tcG9uZW50Sm9icz47XG5cbi8vIEV4cG9ydCBpbmZlcnJlZCB0eXBlIGZvciBzY2VuZXMgdGFibGVcbmV4cG9ydCB0eXBlIFNjZW5lID0gSW5mZXJTZWxlY3RNb2RlbDx0eXBlb2Ygc2NlbmVzPjtcblxuLy8gRGVmaW5lIGFuZCBleHBvcnQgVGFza1N0YXR1cyB0eXBlXG5leHBvcnQgdHlwZSBUYXNrU3RhdHVzID0gXCJwZW5kaW5nXCIgfCBcImJ1aWxkaW5nXCIgfCBcInN1Y2Nlc3NcIiB8IFwiZXJyb3JcIjtcblxuLy8gLS0tIFNoYXJlZCBWaWRlb3MgdGFibGUgLS0tXG4vLyBTdG9yZXMgc2hhcmVkIHZpZGVvcyBmb3IgcHVibGljIHZpZGVvIHNoYXJpbmdcbmV4cG9ydCBjb25zdCBzaGFyZWRWaWRlb3MgPSBjcmVhdGVUYWJsZShcbiAgXCJzaGFyZWRfdmlkZW9cIixcbiAgKGQpID0+ICh7XG4gICAgaWQ6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLm5vdE51bGwoKS5wcmltYXJ5S2V5KCkuJGRlZmF1bHRGbigoKSA9PiBjcnlwdG8ucmFuZG9tVVVJRCgpKSxcbiAgICBwcm9qZWN0SWQ6IGQudXVpZCgpLm5vdE51bGwoKS5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkKSxcbiAgICB1c2VySWQ6IGQudmFyY2hhcih7IGxlbmd0aDogMjU1IH0pLm5vdE51bGwoKS5yZWZlcmVuY2VzKCgpID0+IHVzZXJzLmlkKSxcbiAgICB0aXRsZTogZC52YXJjaGFyKHsgbGVuZ3RoOiAyNTUgfSksXG4gICAgZGVzY3JpcHRpb246IGQudGV4dCgpLFxuICAgIHZpZGVvVXJsOiBkLnZhcmNoYXIoeyBsZW5ndGg6IDUwMCB9KSwgLy8gUjIgcHVibGljIFVSTFxuICAgIHRodW1ibmFpbFVybDogZC52YXJjaGFyKHsgbGVuZ3RoOiA1MDAgfSksXG4gICAgaXNQdWJsaWM6IGQuYm9vbGVhbigpLmRlZmF1bHQodHJ1ZSksXG4gICAgdmlld0NvdW50OiBkLmludGVnZXIoKS5kZWZhdWx0KDApLFxuICAgIGNyZWF0ZWRBdDogZFxuICAgICAgLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KVxuICAgICAgLmRlZmF1bHQoc3FsYENVUlJFTlRfVElNRVNUQU1QYClcbiAgICAgIC5ub3ROdWxsKCksXG4gICAgZXhwaXJlc0F0OiBkLnRpbWVzdGFtcCh7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KSwgLy8gT3B0aW9uYWwgZXhwaXJhdGlvblxuICB9KSxcbik7XG5cbmV4cG9ydCBjb25zdCBzaGFyZWRWaWRlb3NSZWxhdGlvbnMgPSByZWxhdGlvbnMoc2hhcmVkVmlkZW9zLCAoeyBvbmUgfSkgPT4gKHtcbiAgcHJvamVjdDogb25lKHByb2plY3RzLCB7XG4gICAgZmllbGRzOiBbc2hhcmVkVmlkZW9zLnByb2plY3RJZF0sXG4gICAgcmVmZXJlbmNlczogW3Byb2plY3RzLmlkXSxcbiAgfSksXG4gIHVzZXI6IG9uZSh1c2Vycywge1xuICAgIGZpZWxkczogW3NoYXJlZFZpZGVvcy51c2VySWRdLFxuICAgIHJlZmVyZW5jZXM6IFt1c2Vycy5pZF0sXG4gIH0pLFxufSkpO1xuXG4vLyAtLS0gUGhhc2UgMjogUHJvamVjdCBNZW1vcnkgJiBJbWFnZSBBbmFseXNpcyBUYWJsZXMgZm9yIEFzeW5jIENvbnRleHQgU3RvcmFnZSAtLS1cblxuLyoqXG4gKiBQcm9qZWN0IE1lbW9yeSBUYWJsZTogU3RvcmVzIGFjY3VtdWxhdGVkIGNvbnRleHQgYWNyb3NzIHVzZXIgc2Vzc2lvbnNcbiAqIEVuYWJsZXMgMzArIHByb21wdCB3b3JrZmxvd3Mgd2l0aCBwZXJzaXN0ZW50IHVzZXIgcHJlZmVyZW5jZXMgYW5kIHNjZW5lIHJlbGF0aW9uc2hpcHNcbiAqL1xuZXhwb3J0IGNvbnN0IHByb2plY3RNZW1vcnkgPSBjcmVhdGVUYWJsZShcInByb2plY3RfbWVtb3J5XCIsIChkKSA9PiAoe1xuICBpZDogZC51dWlkKCkucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgcHJvamVjdElkOiBkLnV1aWQoXCJwcm9qZWN0X2lkXCIpLm5vdE51bGwoKS5yZWZlcmVuY2VzKCgpID0+IHByb2plY3RzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgbWVtb3J5VHlwZTogZC52YXJjaGFyKFwibWVtb3J5X3R5cGVcIiwgeyBsZW5ndGg6IDUwIH0pLm5vdE51bGwoKSwgLy8gJ3VzZXJfcHJlZmVyZW5jZScsICdzY2VuZV9yZWxhdGlvbnNoaXAnLCAnY29udmVyc2F0aW9uX2NvbnRleHQnXG4gIG1lbW9yeUtleTogZC52YXJjaGFyKFwibWVtb3J5X2tleVwiLCB7IGxlbmd0aDogMjU1IH0pLm5vdE51bGwoKSwgLy8gZS5nLiwgJ2R1cmF0aW9uX3ByZWZlcmVuY2UnLCAnc3R5bGVfcHJlZmVyZW5jZScsICdzY2VuZV9yZWZlcmVuY2UnXG4gIG1lbW9yeVZhbHVlOiBkLnRleHQoXCJtZW1vcnlfdmFsdWVcIikubm90TnVsbCgpLCAvLyBKU09OIG9yIHRleHQgdmFsdWVcbiAgY29uZmlkZW5jZTogZC5yZWFsKFwiY29uZmlkZW5jZVwiKS5kZWZhdWx0KDAuOCksIC8vIDAuMC0xLjAgY29uZmlkZW5jZSBzY29yZVxuICBzb3VyY2VQcm9tcHQ6IGQudGV4dChcInNvdXJjZV9wcm9tcHRcIiksIC8vIE9yaWdpbmFsIHVzZXIgcHJvbXB0IHRoYXQgY3JlYXRlZCB0aGlzIG1lbW9yeVxuICBjcmVhdGVkQXQ6IGQudGltZXN0YW1wKFwiY3JlYXRlZF9hdFwiLCB7IHdpdGhUaW1lem9uZTogdHJ1ZSB9KS5kZWZhdWx0KHNxbGBDVVJSRU5UX1RJTUVTVEFNUGApLm5vdE51bGwoKSxcbiAgdXBkYXRlZEF0OiBkLnRpbWVzdGFtcChcInVwZGF0ZWRfYXRcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gIGV4cGlyZXNBdDogZC50aW1lc3RhbXAoXCJleHBpcmVzX2F0XCIsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLCAvLyBPcHRpb25hbCBleHBpcmF0aW9uIGZvciB0ZW1wb3JhcnkgY29udGV4dFxufSksICh0KSA9PiBbXG4gIGluZGV4KFwicHJvamVjdF9tZW1vcnlfcHJvamVjdF9pZHhcIikub24odC5wcm9qZWN0SWQpLFxuICBpbmRleChcInByb2plY3RfbWVtb3J5X3R5cGVfa2V5X2lkeFwiKS5vbih0Lm1lbW9yeVR5cGUsIHQubWVtb3J5S2V5KSxcbl0pO1xuXG4vKipcbiAqIEltYWdlIEFuYWx5c2lzIFRhYmxlOiBTdG9yZXMgcGVyc2lzdGVudCBpbWFnZSBmYWN0cyBmcm9tIHZpc2lvbiBhbmFseXNpc1xuICogU3VwcG9ydHMgZmlyZS1hbmQtZm9yZ2V0IGFzeW5jIGltYWdlIHByb2Nlc3Npbmcgd2l0aCBsYXRlLWFycml2aW5nIGZhY3RzIGludGVncmF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBpbWFnZUFuYWx5c2lzID0gY3JlYXRlVGFibGUoXCJpbWFnZV9hbmFseXNpc1wiLCAoZCkgPT4gKHtcbiAgaWQ6IGQudXVpZCgpLnByaW1hcnlLZXkoKS5kZWZhdWx0UmFuZG9tKCksXG4gIHByb2plY3RJZDogZC51dWlkKFwicHJvamVjdF9pZFwiKS5ub3ROdWxsKCkucmVmZXJlbmNlcygoKSA9PiBwcm9qZWN0cy5pZCwgeyBvbkRlbGV0ZTogXCJjYXNjYWRlXCIgfSksXG4gIHRyYWNlSWQ6IGQudmFyY2hhcihcInRyYWNlX2lkXCIsIHsgbGVuZ3RoOiAxMDAgfSkubm90TnVsbCgpLCAvLyBGcm9tIHN0YXJ0QXN5bmNJbWFnZUFuYWx5c2lzKClcbiAgaW1hZ2VVcmxzOiBkLmpzb25iKFwiaW1hZ2VfdXJsc1wiKS5ub3ROdWxsKCksIC8vIEFycmF5IG9mIHVwbG9hZGVkIGltYWdlIFVSTHNcbiAgcGFsZXR0ZTogZC5qc29uYihcInBhbGV0dGVcIikubm90TnVsbCgpLCAvLyBFeHRyYWN0ZWQgY29sb3IgcGFsZXR0ZSAgXG4gIHR5cG9ncmFwaHk6IGQudGV4dChcInR5cG9ncmFwaHlcIikubm90TnVsbCgpLCAvLyBUeXBvZ3JhcGh5IGFuYWx5c2lzXG4gIG1vb2Q6IGQudGV4dChcIm1vb2RcIikubm90TnVsbCgpLCAvLyBTdHlsZSBtb29kIGFuYWx5c2lzXG4gIGxheW91dEpzb246IGQuanNvbmIoXCJsYXlvdXRfanNvblwiKSwgLy8gU3RydWN0dXJlZCBsYXlvdXQgYW5hbHlzaXNcbiAgcHJvY2Vzc2luZ1RpbWVNczogZC5pbnRlZ2VyKFwicHJvY2Vzc2luZ190aW1lX21zXCIpLm5vdE51bGwoKSxcbiAgY3JlYXRlZEF0OiBkLnRpbWVzdGFtcChcImNyZWF0ZWRfYXRcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdChzcWxgQ1VSUkVOVF9USU1FU1RBTVBgKS5ub3ROdWxsKCksXG4gIHVzZWRJblNjZW5lczogZC5qc29uYihcInVzZWRfaW5fc2NlbmVzXCIpLCAvLyBUcmFjayB3aGljaCBzY2VuZXMgdXNlZCB0aGlzIGFuYWx5c2lzXG59KSwgKHQpID0+IFtcbiAgaW5kZXgoXCJpbWFnZV9hbmFseXNpc19wcm9qZWN0X2lkeFwiKS5vbih0LnByb2plY3RJZCksXG4gIGluZGV4KFwiaW1hZ2VfYW5hbHlzaXNfdHJhY2VfaWR4XCIpLm9uKHQudHJhY2VJZCksXG4gIGluZGV4KFwiaW1hZ2VfYW5hbHlzaXNfY3JlYXRlZF9pZHhcIikub24odC5jcmVhdGVkQXQpLFxuXSk7XG5cbi8vIFJlbGF0aW9ucyBmb3IgcHJvamVjdCBtZW1vcnlcbmV4cG9ydCBjb25zdCBwcm9qZWN0TWVtb3J5UmVsYXRpb25zID0gcmVsYXRpb25zKHByb2plY3RNZW1vcnksICh7IG9uZSB9KSA9PiAoe1xuICBwcm9qZWN0OiBvbmUocHJvamVjdHMsIHtcbiAgICBmaWVsZHM6IFtwcm9qZWN0TWVtb3J5LnByb2plY3RJZF0sXG4gICAgcmVmZXJlbmNlczogW3Byb2plY3RzLmlkXSxcbiAgfSksXG59KSk7XG5cbi8vIFJlbGF0aW9ucyBmb3IgaW1hZ2UgYW5hbHlzaXNcbmV4cG9ydCBjb25zdCBpbWFnZUFuYWx5c2lzUmVsYXRpb25zID0gcmVsYXRpb25zKGltYWdlQW5hbHlzaXMsICh7IG9uZSB9KSA9PiAoe1xuICBwcm9qZWN0OiBvbmUocHJvamVjdHMsIHtcbiAgICBmaWVsZHM6IFtpbWFnZUFuYWx5c2lzLnByb2plY3RJZF0sXG4gICAgcmVmZXJlbmNlczogW3Byb2plY3RzLmlkXSxcbiAgfSksXG59KSk7XG5cbi8vIE1lbW9yeSB0eXBlIGVudW0gZm9yIGJldHRlciB0eXBlIHNhZmV0eVxuZXhwb3J0IGNvbnN0IE1FTU9SWV9UWVBFUyA9IHtcbiAgVVNFUl9QUkVGRVJFTkNFOiAndXNlcl9wcmVmZXJlbmNlJyxcbiAgU0NFTkVfUkVMQVRJT05TSElQOiAnc2NlbmVfcmVsYXRpb25zaGlwJywgXG4gIENPTlZFUlNBVElPTl9DT05URVhUOiAnY29udmVyc2F0aW9uX2NvbnRleHQnLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IHR5cGUgTWVtb3J5VHlwZSA9IHR5cGVvZiBNRU1PUllfVFlQRVNba2V5b2YgdHlwZW9mIE1FTU9SWV9UWVBFU107XG5cbi8vIFR5cGUgZXhwb3J0cyBmb3IgVHlwZVNjcmlwdFxuZXhwb3J0IHR5cGUgUHJvamVjdE1lbW9yeSA9IHR5cGVvZiBwcm9qZWN0TWVtb3J5LiRpbmZlclNlbGVjdDtcbmV4cG9ydCB0eXBlIEluc2VydFByb2plY3RNZW1vcnkgPSB0eXBlb2YgcHJvamVjdE1lbW9yeS4kaW5mZXJJbnNlcnQ7XG5cbmV4cG9ydCB0eXBlIEltYWdlQW5hbHlzaXMgPSB0eXBlb2YgaW1hZ2VBbmFseXNpcy4kaW5mZXJTZWxlY3Q7XG5leHBvcnQgdHlwZSBJbnNlcnRJbWFnZUFuYWx5c2lzID0gdHlwZW9mIGltYWdlQW5hbHlzaXMuJGluZmVySW5zZXJ0O1xuIl0sIm5hbWVzIjpbInJlbGF0aW9ucyIsInNxbCIsInVuaXF1ZUluZGV4IiwiaW5kZXgiLCJwZ1RhYmxlQ3JlYXRvciIsInByaW1hcnlLZXkiLCJjcmVhdGVUYWJsZSIsIm5hbWUiLCJ1c2VycyIsImQiLCJpZCIsInZhcmNoYXIiLCJsZW5ndGgiLCJub3ROdWxsIiwiZW1haWwiLCJlbWFpbFZlcmlmaWVkIiwidGltZXN0YW1wIiwibW9kZSIsIndpdGhUaW1lem9uZSIsImltYWdlIiwidGV4dCIsImlzQWRtaW4iLCJib29sZWFuIiwiZGVmYXVsdCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInVzZXJzUmVsYXRpb25zIiwibWFueSIsImFjY291bnRzIiwic2hhcmVkVmlkZW9zIiwidXNlcklkIiwicmVmZXJlbmNlcyIsInR5cGUiLCIkdHlwZSIsInByb3ZpZGVyIiwicHJvdmlkZXJBY2NvdW50SWQiLCJyZWZyZXNoX3Rva2VuIiwiYWNjZXNzX3Rva2VuIiwiZXhwaXJlc19hdCIsImludGVnZXIiLCJ0b2tlbl90eXBlIiwic2NvcGUiLCJpZF90b2tlbiIsInNlc3Npb25fc3RhdGUiLCJ0IiwiY29sdW1ucyIsIm9uIiwiYWNjb3VudHNSZWxhdGlvbnMiLCJvbmUiLCJ1c2VyIiwiZmllbGRzIiwidmVyaWZpY2F0aW9uVG9rZW5zIiwiaWRlbnRpZmllciIsInRva2VuIiwiZXhwaXJlcyIsInByb2plY3RzIiwidXVpZCIsImRlZmF1bHRSYW5kb20iLCJ0aXRsZSIsInByb3BzIiwianNvbmIiLCJpc1dlbGNvbWUiLCIkb25VcGRhdGUiLCJEYXRlIiwicHJvamVjdHNSZWxhdGlvbnMiLCJwYXRjaGVzIiwibWVzc2FnZXMiLCJzY2VuZXMiLCJwcm9qZWN0SWQiLCJvbkRlbGV0ZSIsInBhdGNoIiwicGF0Y2hlc1JlbGF0aW9ucyIsInByb2plY3QiLCJjb250ZW50Iiwicm9sZSIsImtpbmQiLCJzdGF0dXMiLCJpbWFnZVVybHMiLCJzZXF1ZW5jZSIsIm9yaWdpbmFsVHN4Q29kZSIsImxhc3RGaXhBdHRlbXB0IiwiZml4SXNzdWVzIiwibWVzc2FnZXNSZWxhdGlvbnMiLCJvcmRlciIsInRzeENvZGUiLCJkdXJhdGlvbiIsInB1Ymxpc2hlZFVybCIsInB1Ymxpc2hlZEhhc2giLCJwdWJsaXNoZWRBdCIsImxheW91dEpzb24iLCJzbHVnIiwiZG9taW5hbnRDb2xvcnMiLCJmaXJzdEgxVGV4dCIsImxhc3RGb2N1c2VkIiwic2NlbmVzUmVsYXRpb25zIiwic2NlbmVJdGVyYXRpb25zIiwic2NlbmVJZCIsIm9wZXJhdGlvblR5cGUiLCJlZGl0Q29tcGxleGl0eSIsInVzZXJQcm9tcHQiLCJicmFpblJlYXNvbmluZyIsInRvb2xSZWFzb25pbmciLCJjb2RlQmVmb3JlIiwiY29kZUFmdGVyIiwiY2hhbmdlc0FwcGxpZWQiLCJjaGFuZ2VzUHJlc2VydmVkIiwiZ2VuZXJhdGlvblRpbWVNcyIsIm1vZGVsVXNlZCIsInRlbXBlcmF0dXJlIiwicmVhbCIsInRva2Vuc1VzZWQiLCJ1c2VyRWRpdGVkQWdhaW4iLCJ1c2VyU2F0aXNmYWN0aW9uU2NvcmUiLCJzZXNzaW9uSWQiLCJtZXNzYWdlSWQiLCJzY2VuZUl0ZXJhdGlvbnNSZWxhdGlvbnMiLCJzY2VuZSIsIm1lc3NhZ2UiLCJzY2VuZVNwZWNzIiwic3BlYyIsInZlcnNpb24iLCJjcmVhdGVkQnkiLCJ1c2luZyIsInNjZW5lU3BlY3NSZWxhdGlvbnMiLCJjcmVhdGVkQnlVc2VyIiwiY3VzdG9tQ29tcG9uZW50Sm9icyIsImVmZmVjdCIsIm1ldGFkYXRhIiwic3RhdHVzTWVzc2FnZUlkIiwib3V0cHV0VXJsIiwiZXJyb3JNZXNzYWdlIiwicmV0cnlDb3VudCIsImxhc3RTdWNjZXNzZnVsU3RlcCIsIm5leHRSZXRyeUF0IiwiZXJyb3JDb250ZXh0IiwiY2hlY2twb2ludERhdGEiLCJsYXN0U3RlcCIsInRhc2tJZCIsImludGVybmFsU3RhdHVzIiwicmVxdWlyZXNJbnB1dCIsImlucHV0VHlwZSIsInRhc2tTdGF0ZSIsImFydGlmYWN0cyIsImhpc3RvcnkiLCJzc2VFbmFibGVkIiwib3JpZ2luYWxfdHN4X2NvZGUiLCJsYXN0X2ZpeF9hdHRlbXB0IiwiZml4X2lzc3VlcyIsImN1c3RvbUNvbXBvbmVudEpvYnNSZWxhdGlvbnMiLCJjb21wb25lbnRFcnJvcnMiLCJqb2JJZCIsImVycm9yVHlwZSIsImRldGFpbHMiLCJjb21wb25lbnRFcnJvcnNSZWxhdGlvbnMiLCJqb2IiLCJtZXRyaWNzIiwidmFsdWUiLCJ0YWdzIiwic2NlbmVQbGFucyIsInJhd1JlYXNvbmluZyIsInBsYW5EYXRhIiwic2NlbmVQbGFuc1JlbGF0aW9ucyIsImFuaW1hdGlvbkRlc2lnbkJyaWVmcyIsImNvbXBvbmVudEpvYklkIiwibGxtTW9kZWwiLCJhbmltYXRpb25EZXNpZ25CcmllZnNSZWxhdGlvbnMiLCJjb21wb25lbnRKb2IiLCJmZWVkYmFjayIsIiRkZWZhdWx0Rm4iLCJjcnlwdG8iLCJyYW5kb21VVUlEIiwicHJpb3JpdGl6ZWRGZWF0dXJlcyIsImFkbWluTm90ZXMiLCJmZWVkYmFja1JlbGF0aW9ucyIsImVtYWlsU3Vic2NyaWJlcnMiLCJ1bmlxdWUiLCJzdWJzY3JpYmVkQXQiLCJzb3VyY2UiLCJlbWFpbFN1YnNjcmliZXJzUmVsYXRpb25zIiwiYWdlbnRNZXNzYWdlcyIsInNlbmRlciIsInJlY2lwaWVudCIsInBheWxvYWQiLCJjb3JyZWxhdGlvbklkIiwicHJvY2Vzc2VkQXQiLCJhZ2VudE1lc3NhZ2VzSW5kZXhlcyIsImJ5VGFza0lkIiwiY3VzdG9tQ29tcG9uZW50Sm9ic1VwZGF0ZSIsImN1c3RvbUNvbXBvbmVudEpvYnNSZWNvdmVyeVVwZGF0ZSIsImNvbXBvbmVudFRlc3RDYXNlcyIsInByb21wdCIsImNhdGVnb3J5IiwiY29tcGxleGl0eSIsImVkZ2VDYXNlcyIsImNvbXBvbmVudEV2YWx1YXRpb25NZXRyaWNzIiwidGVzdENhc2VJZCIsInN1Y2Nlc3MiLCJlcnJvclN0YWdlIiwicHJvbXB0U3VibWlzc2lvblRpbWUiLCJjb2RlR2VuZXJhdGlvblN0YXJ0VGltZSIsImNvZGVHZW5lcmF0aW9uRW5kVGltZSIsInZhbGlkYXRpb25TdGFydFRpbWUiLCJ2YWxpZGF0aW9uRW5kVGltZSIsImJ1aWxkU3RhcnRUaW1lIiwiYnVpbGRFbmRUaW1lIiwidXBsb2FkU3RhcnRUaW1lIiwidXBsb2FkRW5kVGltZSIsImNvbXBvbmVudENvbXBsZXRpb25UaW1lIiwidGltZVRvRmlyc3RUb2tlbiIsImNvZGVHZW5lcmF0aW9uVGltZSIsInZhbGlkYXRpb25UaW1lIiwiYnVpbGRUaW1lIiwidXBsb2FkVGltZSIsInRvdGFsVGltZSIsInN5bnRheEVycm9yQ291bnQiLCJlc2xpbnRFcnJvckNvdW50IiwiZXNsaW50V2FybmluZ0NvdW50IiwiY29kZUxlbmd0aCIsInJlbmRlclN1Y2Nlc3MiLCJyZW5kZXJFcnJvck1lc3NhZ2UiLCJjb21wb25lbnRJZCIsInN0YXRlVHJhbnNpdGlvbnMiLCJhbmFseXNpc05vdGVzIiwiY29tcG9uZW50RXZhbHVhdGlvbk1ldHJpY3NSZWxhdGlvbnMiLCJ0ZXN0Q2FzZSIsImRlc2NyaXB0aW9uIiwidmlkZW9VcmwiLCJ0aHVtYm5haWxVcmwiLCJpc1B1YmxpYyIsInZpZXdDb3VudCIsImV4cGlyZXNBdCIsInNoYXJlZFZpZGVvc1JlbGF0aW9ucyIsInByb2plY3RNZW1vcnkiLCJtZW1vcnlUeXBlIiwibWVtb3J5S2V5IiwibWVtb3J5VmFsdWUiLCJjb25maWRlbmNlIiwic291cmNlUHJvbXB0IiwiaW1hZ2VBbmFseXNpcyIsInRyYWNlSWQiLCJwYWxldHRlIiwidHlwb2dyYXBoeSIsIm1vb2QiLCJwcm9jZXNzaW5nVGltZU1zIiwidXNlZEluU2NlbmVzIiwicHJvamVjdE1lbW9yeVJlbGF0aW9ucyIsImltYWdlQW5hbHlzaXNSZWxhdGlvbnMiLCJNRU1PUllfVFlQRVMiLCJVU0VSX1BSRUZFUkVOQ0UiLCJTQ0VORV9SRUxBVElPTlNISVAiLCJDT05WRVJTQVRJT05fQ09OVEVYVCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/database/schema.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/trpc/[trpc]/route.ts":
/*!******************************************!*\
  !*** ./src/app/api/trpc/[trpc]/route.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ handler),\n/* harmony export */   OPTIONS: () => (/* binding */ handler),\n/* harmony export */   POST: () => (/* binding */ handler),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration)\n/* harmony export */ });\n/* harmony import */ var _trpc_server_adapters_fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @trpc/server/adapters/fetch */ \"(rsc)/../../node_modules/@trpc/server/dist/adapters/fetch/index.mjs\");\n/* harmony import */ var _env__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/env */ \"(rsc)/./src/env.js\");\n/* harmony import */ var _server_api_root__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/server/api/root */ \"(rsc)/./src/server/api/root.ts\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_root__WEBPACK_IMPORTED_MODULE_2__, _server_api_trpc__WEBPACK_IMPORTED_MODULE_3__]);\n([_server_api_root__WEBPACK_IMPORTED_MODULE_2__, _server_api_trpc__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\nconst maxDuration = 180; // 3 minutes\n\n\n\n\n/**\n * This wraps the `createTRPCContext` helper and provides the required context for the tRPC API when\n * handling a HTTP request (e.g. when you make requests from Client Components).\n */ const createContext = async (req)=>{\n    return (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_3__.createTRPCContext)({\n        headers: req.headers\n    });\n};\nconst handler = async (req)=>{\n    // Handle preflight requests\n    if (req.method === 'OPTIONS') {\n        return new Response(null, {\n            status: 200,\n            headers: {\n                'Access-Control-Allow-Origin':  true ? 'http://localhost:3001' : 0,\n                'Access-Control-Allow-Methods': 'GET,OPTIONS,PATCH,DELETE,POST,PUT',\n                'Access-Control-Allow-Headers': 'X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version',\n                'Access-Control-Allow-Credentials': 'true'\n            }\n        });\n    }\n    const response = await (0,_trpc_server_adapters_fetch__WEBPACK_IMPORTED_MODULE_0__.fetchRequestHandler)({\n        endpoint: \"/api/trpc\",\n        req,\n        router: _server_api_root__WEBPACK_IMPORTED_MODULE_2__.appRouter,\n        createContext: ()=>createContext(req),\n        onError: _env__WEBPACK_IMPORTED_MODULE_1__.env.NODE_ENV === \"development\" ? ({ path, error })=>{\n            console.error(` tRPC failed on ${path ?? \"<no-path>\"}: ${error.message}`);\n        } : undefined\n    });\n    // Add CORS headers to response\n    response.headers.set('Access-Control-Allow-Origin',  true ? 'http://localhost:3001' : 0);\n    response.headers.set('Access-Control-Allow-Credentials', 'true');\n    return response;\n};\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS90cnBjL1t0cnBjXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFPLE1BQU1BLGNBQWMsSUFBSSxDQUFDLFlBQVk7QUFFc0I7QUFHdEM7QUFDa0I7QUFDUTtBQUV0RDs7O0NBR0MsR0FDRCxNQUFNSyxnQkFBZ0IsT0FBT0M7SUFDM0IsT0FBT0YsbUVBQWlCQSxDQUFDO1FBQ3ZCRyxTQUFTRCxJQUFJQyxPQUFPO0lBQ3RCO0FBQ0Y7QUFFQSxNQUFNQyxVQUFVLE9BQU9GO0lBQ3JCLDRCQUE0QjtJQUM1QixJQUFJQSxJQUFJRyxNQUFNLEtBQUssV0FBVztRQUM1QixPQUFPLElBQUlDLFNBQVMsTUFBTTtZQUN4QkMsUUFBUTtZQUNSSixTQUFTO2dCQUNQLCtCQUErQkssS0FBc0MsR0FDakUsMEJBQ0EsQ0FBeUI7Z0JBQzdCLGdDQUFnQztnQkFDaEMsZ0NBQWdDO2dCQUNoQyxvQ0FBb0M7WUFDdEM7UUFDRjtJQUNGO0lBRUEsTUFBTUMsV0FBVyxNQUFNWixnRkFBbUJBLENBQUM7UUFDekNhLFVBQVU7UUFDVlI7UUFDQVMsUUFBUVosdURBQVNBO1FBQ2pCRSxlQUFlLElBQU1BLGNBQWNDO1FBQ25DVSxTQUNFZCxxQ0FBR0EsQ0FBQ2UsUUFBUSxLQUFLLGdCQUNiLENBQUMsRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUU7WUFDZEMsUUFBUUQsS0FBSyxDQUNYLENBQUMsaUJBQWlCLEVBQUVELFFBQVEsWUFBWSxFQUFFLEVBQUVDLE1BQU1FLE9BQU8sRUFBRTtRQUUvRCxJQUNBQztJQUNSO0lBRUEsK0JBQStCO0lBQy9CVCxTQUFTTixPQUFPLENBQUNnQixHQUFHLENBQUMsK0JBQStCWCxLQUFzQyxHQUN0RiwwQkFDQSxDQUF5QjtJQUM3QkMsU0FBU04sT0FBTyxDQUFDZ0IsR0FBRyxDQUFDLG9DQUFvQztJQUV6RCxPQUFPVjtBQUNUO0FBRStEIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvYXBwL2FwaS90cnBjL1t0cnBjXS9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgbWF4RHVyYXRpb24gPSAxODA7IC8vIDMgbWludXRlc1xuXG5pbXBvcnQgeyBmZXRjaFJlcXVlc3RIYW5kbGVyIH0gZnJvbSBcIkB0cnBjL3NlcnZlci9hZGFwdGVycy9mZXRjaFwiO1xuaW1wb3J0IHsgdHlwZSBOZXh0UmVxdWVzdCB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuXG5pbXBvcnQgeyBlbnYgfSBmcm9tIFwifi9lbnZcIjtcbmltcG9ydCB7IGFwcFJvdXRlciB9IGZyb20gXCJ+L3NlcnZlci9hcGkvcm9vdFwiO1xuaW1wb3J0IHsgY3JlYXRlVFJQQ0NvbnRleHQgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3RycGNcIjtcblxuLyoqXG4gKiBUaGlzIHdyYXBzIHRoZSBgY3JlYXRlVFJQQ0NvbnRleHRgIGhlbHBlciBhbmQgcHJvdmlkZXMgdGhlIHJlcXVpcmVkIGNvbnRleHQgZm9yIHRoZSB0UlBDIEFQSSB3aGVuXG4gKiBoYW5kbGluZyBhIEhUVFAgcmVxdWVzdCAoZS5nLiB3aGVuIHlvdSBtYWtlIHJlcXVlc3RzIGZyb20gQ2xpZW50IENvbXBvbmVudHMpLlxuICovXG5jb25zdCBjcmVhdGVDb250ZXh0ID0gYXN5bmMgKHJlcTogTmV4dFJlcXVlc3QpID0+IHtcbiAgcmV0dXJuIGNyZWF0ZVRSUENDb250ZXh0KHtcbiAgICBoZWFkZXJzOiByZXEuaGVhZGVycyxcbiAgfSk7XG59O1xuXG5jb25zdCBoYW5kbGVyID0gYXN5bmMgKHJlcTogTmV4dFJlcXVlc3QpID0+IHtcbiAgLy8gSGFuZGxlIHByZWZsaWdodCByZXF1ZXN0c1xuICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7XG4gICAgICBzdGF0dXM6IDIwMCxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIFxuICAgICAgICAgID8gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMScgXG4gICAgICAgICAgOiAnaHR0cHM6Ly9hZG1pbi5iYXphYXIuaXQnLFxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcyc6ICdHRVQsT1BUSU9OUyxQQVRDSCxERUxFVEUsUE9TVCxQVVQnLFxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdYLUNTUkYtVG9rZW4sIFgtUmVxdWVzdGVkLVdpdGgsIEFjY2VwdCwgQWNjZXB0LVZlcnNpb24sIENvbnRlbnQtTGVuZ3RoLCBDb250ZW50LU1ENSwgQ29udGVudC1UeXBlLCBEYXRlLCBYLUFwaS1WZXJzaW9uJyxcbiAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJzogJ3RydWUnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hSZXF1ZXN0SGFuZGxlcih7XG4gICAgZW5kcG9pbnQ6IFwiL2FwaS90cnBjXCIsXG4gICAgcmVxLFxuICAgIHJvdXRlcjogYXBwUm91dGVyLFxuICAgIGNyZWF0ZUNvbnRleHQ6ICgpID0+IGNyZWF0ZUNvbnRleHQocmVxKSxcbiAgICBvbkVycm9yOlxuICAgICAgZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCJcbiAgICAgICAgPyAoeyBwYXRoLCBlcnJvciB9KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgICBg4p2MIHRSUEMgZmFpbGVkIG9uICR7cGF0aCA/PyBcIjxuby1wYXRoPlwifTogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgOiB1bmRlZmluZWQsXG4gIH0pO1xuXG4gIC8vIEFkZCBDT1JTIGhlYWRlcnMgdG8gcmVzcG9uc2VcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIFxuICAgID8gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMScgXG4gICAgOiAnaHR0cHM6Ly9hZG1pbi5iYXphYXIuaXQnKTtcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJywgJ3RydWUnKTtcblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG5leHBvcnQgeyBoYW5kbGVyIGFzIEdFVCwgaGFuZGxlciBhcyBQT1NULCBoYW5kbGVyIGFzIE9QVElPTlMgfTtcbiJdLCJuYW1lcyI6WyJtYXhEdXJhdGlvbiIsImZldGNoUmVxdWVzdEhhbmRsZXIiLCJlbnYiLCJhcHBSb3V0ZXIiLCJjcmVhdGVUUlBDQ29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJyZXEiLCJoZWFkZXJzIiwiaGFuZGxlciIsIm1ldGhvZCIsIlJlc3BvbnNlIiwic3RhdHVzIiwicHJvY2VzcyIsInJlc3BvbnNlIiwiZW5kcG9pbnQiLCJyb3V0ZXIiLCJvbkVycm9yIiwiTk9ERV9FTlYiLCJwYXRoIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsInVuZGVmaW5lZCIsInNldCIsIkdFVCIsIlBPU1QiLCJPUFRJT05TIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/trpc/[trpc]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/brain/orchestratorNEW.ts":
/*!**************************************!*\
  !*** ./src/brain/orchestratorNEW.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Orchestrator: () => (/* binding */ Orchestrator),\n/* harmony export */   orchestrator: () => (/* binding */ orchestrator)\n/* harmony export */ });\n/* harmony import */ var _orchestrator_functions_contextBuilder__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./orchestrator_functions/contextBuilder */ \"(rsc)/./src/brain/orchestrator_functions/contextBuilder.ts\");\n/* harmony import */ var _orchestrator_functions_intentAnalyzer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./orchestrator_functions/intentAnalyzer */ \"(rsc)/./src/brain/orchestrator_functions/intentAnalyzer.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_orchestrator_functions_contextBuilder__WEBPACK_IMPORTED_MODULE_0__]);\n_orchestrator_functions_contextBuilder__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// Simplified & Modular Orchestrator - Decision Only (Sprint 41)\n\n\nclass Orchestrator {\n    async processUserInput(input) {\n        console.log('\\n [NEW ORCHESTRATOR] === PROCESSING USER INPUT ===');\n        console.log(' [NEW ORCHESTRATOR] Input:', {\n            prompt: input.prompt,\n            projectId: input.projectId,\n            hasImages: !!input.userContext?.imageUrls?.length,\n            sceneCount: input.storyboardSoFar?.length || 0\n        });\n        try {\n            // 1. Build context\n            console.log(' [NEW ORCHESTRATOR] Step 1: Building context...');\n            input.onProgress?.(' Understanding your request...', 'building');\n            const contextPacket = await this.contextBuilder.buildContext(input);\n            console.log(' [NEW ORCHESTRATOR] Context built successfully');\n            // 2. Analyze intent and select tool\n            console.log(' [NEW ORCHESTRATOR] Step 2: Analyzing intent...');\n            input.onProgress?.(' Choosing the right approach...', 'building');\n            const toolSelection = await this.intentAnalyzer.analyzeIntent(input, contextPacket);\n            console.log(' [NEW ORCHESTRATOR] Tool selected:', {\n                tool: toolSelection.toolName,\n                reasoning: toolSelection.reasoning?.substring(0, 100) + '...'\n            });\n            if (!toolSelection.success) {\n                return {\n                    success: false,\n                    error: toolSelection.error ?? 'Failed to understand request',\n                    chatResponse: \"I couldn't understand your request. Could you please rephrase it?\"\n                };\n            }\n            // 3. Return decision (NO EXECUTION!)\n            console.log(' [NEW ORCHESTRATOR] Decision complete! Returning to router...');\n            if (!toolSelection.toolName) {\n                return {\n                    success: false,\n                    error: \"No tool selected\",\n                    chatResponse: toolSelection.clarificationQuestion || \"I need more information to help you.\"\n                };\n            }\n            const result = {\n                success: true,\n                toolUsed: toolSelection.toolName,\n                reasoning: toolSelection.reasoning,\n                chatResponse: toolSelection.userFeedback || toolSelection.reasoning,\n                // Pass along the tool selection details for execution in generation.ts\n                result: {\n                    toolName: toolSelection.toolName,\n                    toolContext: {\n                        userPrompt: input.prompt,\n                        targetSceneId: toolSelection.targetSceneId,\n                        targetDuration: toolSelection.targetDuration,\n                        referencedSceneIds: toolSelection.referencedSceneIds,\n                        imageUrls: input.userContext?.imageUrls || undefined,\n                        webContext: contextPacket.webContext\n                    },\n                    workflow: toolSelection.workflow\n                }\n            };\n            console.log(' [NEW ORCHESTRATOR] === ORCHESTRATION COMPLETE ===\\n');\n            return result;\n        } catch (error) {\n            console.error('[Orchestrator] Error:', error);\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : String(error),\n                chatResponse: \"I encountered an issue processing your request. Please try again.\"\n            };\n        }\n    }\n    constructor(){\n        this.contextBuilder = new _orchestrator_functions_contextBuilder__WEBPACK_IMPORTED_MODULE_0__.ContextBuilder();\n        this.intentAnalyzer = new _orchestrator_functions_intentAnalyzer__WEBPACK_IMPORTED_MODULE_1__.IntentAnalyzer();\n    }\n}\n// Singleton export\nconst orchestrator = new Orchestrator();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYnJhaW4vb3JjaGVzdHJhdG9yTkVXLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxnRUFBZ0U7QUFFUztBQUNBO0FBTWxFLE1BQU1FO0lBSVgsTUFBTUMsaUJBQWlCQyxLQUF5QixFQUFnQztRQUM5RUMsUUFBUUMsR0FBRyxDQUFDO1FBQ1pELFFBQVFDLEdBQUcsQ0FBQyxnQ0FBZ0M7WUFDMUNDLFFBQVFILE1BQU1HLE1BQU07WUFDcEJDLFdBQVdKLE1BQU1JLFNBQVM7WUFDMUJDLFdBQVcsQ0FBQyxDQUFFTCxNQUFNTSxXQUFXLEVBQUVDLFdBQXdCQztZQUN6REMsWUFBWVQsTUFBTVUsZUFBZSxFQUFFRixVQUFVO1FBQy9DO1FBRUEsSUFBSTtZQUNGLG1CQUFtQjtZQUNuQlAsUUFBUUMsR0FBRyxDQUFDO1lBQ1pGLE1BQU1XLFVBQVUsR0FBRyxvQ0FBb0M7WUFDdkQsTUFBTUMsZ0JBQWdCLE1BQU0sSUFBSSxDQUFDQyxjQUFjLENBQUNDLFlBQVksQ0FBQ2Q7WUFDN0RDLFFBQVFDLEdBQUcsQ0FBQztZQUVaLG9DQUFvQztZQUNwQ0QsUUFBUUMsR0FBRyxDQUFDO1lBQ1pGLE1BQU1XLFVBQVUsR0FBRyxxQ0FBcUM7WUFDeEQsTUFBTUksZ0JBQWdCLE1BQU0sSUFBSSxDQUFDQyxjQUFjLENBQUNDLGFBQWEsQ0FBQ2pCLE9BQU9ZO1lBQ3JFWCxRQUFRQyxHQUFHLENBQUMsd0NBQXdDO2dCQUNsRGdCLE1BQU1ILGNBQWNJLFFBQVE7Z0JBQzVCQyxXQUFXTCxjQUFjSyxTQUFTLEVBQUVDLFVBQVUsR0FBRyxPQUFPO1lBQzFEO1lBRUEsSUFBSSxDQUFDTixjQUFjTyxPQUFPLEVBQUU7Z0JBQzFCLE9BQU87b0JBQ0xBLFNBQVM7b0JBQ1RDLE9BQU9SLGNBQWNRLEtBQUssSUFBSTtvQkFDOUJDLGNBQWM7Z0JBQ2hCO1lBQ0Y7WUFFQSxxQ0FBcUM7WUFDckN2QixRQUFRQyxHQUFHLENBQUM7WUFFWixJQUFJLENBQUNhLGNBQWNJLFFBQVEsRUFBRTtnQkFDM0IsT0FBTztvQkFDTEcsU0FBUztvQkFDVEMsT0FBTztvQkFDUEMsY0FBY1QsY0FBY1UscUJBQXFCLElBQUk7Z0JBQ3ZEO1lBQ0Y7WUFFQSxNQUFNQyxTQUFTO2dCQUNiSixTQUFTO2dCQUNUSyxVQUFVWixjQUFjSSxRQUFRO2dCQUNoQ0MsV0FBV0wsY0FBY0ssU0FBUztnQkFDbENJLGNBQWNULGNBQWNhLFlBQVksSUFBSWIsY0FBY0ssU0FBUztnQkFDbkUsdUVBQXVFO2dCQUN2RU0sUUFBUTtvQkFDTlAsVUFBVUosY0FBY0ksUUFBUTtvQkFDaENVLGFBQWE7d0JBQ1hDLFlBQVk5QixNQUFNRyxNQUFNO3dCQUN4QjRCLGVBQWVoQixjQUFjZ0IsYUFBYTt3QkFDMUNDLGdCQUFnQmpCLGNBQWNpQixjQUFjO3dCQUM1Q0Msb0JBQW9CbEIsY0FBY2tCLGtCQUFrQjt3QkFDcEQxQixXQUFXLE1BQU9ELFdBQVcsRUFBRUMsYUFBMEIyQjt3QkFDekRDLFlBQVl2QixjQUFjdUIsVUFBVTtvQkFDdEM7b0JBQ0FDLFVBQVVyQixjQUFjcUIsUUFBUTtnQkFDbEM7WUFDRjtZQUNBbkMsUUFBUUMsR0FBRyxDQUFDO1lBQ1osT0FBT3dCO1FBRVQsRUFBRSxPQUFPSCxPQUFPO1lBQ2R0QixRQUFRc0IsS0FBSyxDQUFDLHlCQUF5QkE7WUFDdkMsT0FBTztnQkFDTEQsU0FBUztnQkFDVEMsT0FBT0EsaUJBQWlCYyxRQUFRZCxNQUFNZSxPQUFPLEdBQUdDLE9BQU9oQjtnQkFDdkRDLGNBQWM7WUFDaEI7UUFDRjtJQUNGOzthQTdFUVgsaUJBQWlCLElBQUlqQixrRkFBY0E7YUFDbkNvQixpQkFBaUIsSUFBSW5CLGtGQUFjQTs7QUE4RTdDO0FBRUEsbUJBQW1CO0FBQ1osTUFBTTJDLGVBQWUsSUFBSTFDLGVBQWUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9icmFpbi9vcmNoZXN0cmF0b3JORVcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2ltcGxpZmllZCAmIE1vZHVsYXIgT3JjaGVzdHJhdG9yIC0gRGVjaXNpb24gT25seSAoU3ByaW50IDQxKVxuXG5pbXBvcnQgeyBDb250ZXh0QnVpbGRlciB9IGZyb20gXCIuL29yY2hlc3RyYXRvcl9mdW5jdGlvbnMvY29udGV4dEJ1aWxkZXJcIjtcbmltcG9ydCB7IEludGVudEFuYWx5emVyIH0gZnJvbSBcIi4vb3JjaGVzdHJhdG9yX2Z1bmN0aW9ucy9pbnRlbnRBbmFseXplclwiO1xuaW1wb3J0IHR5cGUgeyBcbiAgT3JjaGVzdHJhdGlvbklucHV0LCBcbiAgT3JjaGVzdHJhdGlvbk91dHB1dCBcbn0gZnJvbSBcIn4vbGliL3R5cGVzL2FpL2JyYWluLnR5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBPcmNoZXN0cmF0b3Ige1xuICBwcml2YXRlIGNvbnRleHRCdWlsZGVyID0gbmV3IENvbnRleHRCdWlsZGVyKCk7XG4gIHByaXZhdGUgaW50ZW50QW5hbHl6ZXIgPSBuZXcgSW50ZW50QW5hbHl6ZXIoKTtcblxuICBhc3luYyBwcm9jZXNzVXNlcklucHV0KGlucHV0OiBPcmNoZXN0cmF0aW9uSW5wdXQpOiBQcm9taXNlPE9yY2hlc3RyYXRpb25PdXRwdXQ+IHtcbiAgICBjb25zb2xlLmxvZygnXFxu8J+noCBbTkVXIE9SQ0hFU1RSQVRPUl0gPT09IFBST0NFU1NJTkcgVVNFUiBJTlBVVCA9PT0nKTtcbiAgICBjb25zb2xlLmxvZygn8J+noCBbTkVXIE9SQ0hFU1RSQVRPUl0gSW5wdXQ6Jywge1xuICAgICAgcHJvbXB0OiBpbnB1dC5wcm9tcHQsXG4gICAgICBwcm9qZWN0SWQ6IGlucHV0LnByb2plY3RJZCxcbiAgICAgIGhhc0ltYWdlczogISEoaW5wdXQudXNlckNvbnRleHQ/LmltYWdlVXJscyBhcyBzdHJpbmdbXSk/Lmxlbmd0aCxcbiAgICAgIHNjZW5lQ291bnQ6IGlucHV0LnN0b3J5Ym9hcmRTb0Zhcj8ubGVuZ3RoIHx8IDBcbiAgICB9KTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gMS4gQnVpbGQgY29udGV4dFxuICAgICAgY29uc29sZS5sb2coJ/Cfp6AgW05FVyBPUkNIRVNUUkFUT1JdIFN0ZXAgMTogQnVpbGRpbmcgY29udGV4dC4uLicpO1xuICAgICAgaW5wdXQub25Qcm9ncmVzcz8uKCfwn6egIFVuZGVyc3RhbmRpbmcgeW91ciByZXF1ZXN0Li4uJywgJ2J1aWxkaW5nJyk7XG4gICAgICBjb25zdCBjb250ZXh0UGFja2V0ID0gYXdhaXQgdGhpcy5jb250ZXh0QnVpbGRlci5idWlsZENvbnRleHQoaW5wdXQpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfp6AgW05FVyBPUkNIRVNUUkFUT1JdIENvbnRleHQgYnVpbHQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgICAgIC8vIDIuIEFuYWx5emUgaW50ZW50IGFuZCBzZWxlY3QgdG9vbFxuICAgICAgY29uc29sZS5sb2coJ/Cfp6AgW05FVyBPUkNIRVNUUkFUT1JdIFN0ZXAgMjogQW5hbHl6aW5nIGludGVudC4uLicpO1xuICAgICAgaW5wdXQub25Qcm9ncmVzcz8uKCfwn46vIENob29zaW5nIHRoZSByaWdodCBhcHByb2FjaC4uLicsICdidWlsZGluZycpO1xuICAgICAgY29uc3QgdG9vbFNlbGVjdGlvbiA9IGF3YWl0IHRoaXMuaW50ZW50QW5hbHl6ZXIuYW5hbHl6ZUludGVudChpbnB1dCwgY29udGV4dFBhY2tldCk7XG4gICAgICBjb25zb2xlLmxvZygn8J+noCBbTkVXIE9SQ0hFU1RSQVRPUl0gVG9vbCBzZWxlY3RlZDonLCB7XG4gICAgICAgIHRvb2w6IHRvb2xTZWxlY3Rpb24udG9vbE5hbWUsXG4gICAgICAgIHJlYXNvbmluZzogdG9vbFNlbGVjdGlvbi5yZWFzb25pbmc/LnN1YnN0cmluZygwLCAxMDApICsgJy4uLidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRvb2xTZWxlY3Rpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICAgICAgZXJyb3I6IHRvb2xTZWxlY3Rpb24uZXJyb3IgPz8gJ0ZhaWxlZCB0byB1bmRlcnN0YW5kIHJlcXVlc3QnLFxuICAgICAgICAgIGNoYXRSZXNwb25zZTogXCJJIGNvdWxkbid0IHVuZGVyc3RhbmQgeW91ciByZXF1ZXN0LiBDb3VsZCB5b3UgcGxlYXNlIHJlcGhyYXNlIGl0P1wiXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIDMuIFJldHVybiBkZWNpc2lvbiAoTk8gRVhFQ1VUSU9OISlcbiAgICAgIGNvbnNvbGUubG9nKCfwn6egIFtORVcgT1JDSEVTVFJBVE9SXSBEZWNpc2lvbiBjb21wbGV0ZSEgUmV0dXJuaW5nIHRvIHJvdXRlci4uLicpO1xuICAgICAgXG4gICAgICBpZiAoIXRvb2xTZWxlY3Rpb24udG9vbE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogXCJObyB0b29sIHNlbGVjdGVkXCIsXG4gICAgICAgICAgY2hhdFJlc3BvbnNlOiB0b29sU2VsZWN0aW9uLmNsYXJpZmljYXRpb25RdWVzdGlvbiB8fCBcIkkgbmVlZCBtb3JlIGluZm9ybWF0aW9uIHRvIGhlbHAgeW91LlwiXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdG9vbFVzZWQ6IHRvb2xTZWxlY3Rpb24udG9vbE5hbWUsXG4gICAgICAgIHJlYXNvbmluZzogdG9vbFNlbGVjdGlvbi5yZWFzb25pbmcsXG4gICAgICAgIGNoYXRSZXNwb25zZTogdG9vbFNlbGVjdGlvbi51c2VyRmVlZGJhY2sgfHwgdG9vbFNlbGVjdGlvbi5yZWFzb25pbmcsIC8vIFVzZSBBSS1nZW5lcmF0ZWQgZmVlZGJhY2tcbiAgICAgICAgLy8gUGFzcyBhbG9uZyB0aGUgdG9vbCBzZWxlY3Rpb24gZGV0YWlscyBmb3IgZXhlY3V0aW9uIGluIGdlbmVyYXRpb24udHNcbiAgICAgICAgcmVzdWx0OiB7XG4gICAgICAgICAgdG9vbE5hbWU6IHRvb2xTZWxlY3Rpb24udG9vbE5hbWUsXG4gICAgICAgICAgdG9vbENvbnRleHQ6IHtcbiAgICAgICAgICAgIHVzZXJQcm9tcHQ6IGlucHV0LnByb21wdCxcbiAgICAgICAgICAgIHRhcmdldFNjZW5lSWQ6IHRvb2xTZWxlY3Rpb24udGFyZ2V0U2NlbmVJZCxcbiAgICAgICAgICAgIHRhcmdldER1cmF0aW9uOiB0b29sU2VsZWN0aW9uLnRhcmdldER1cmF0aW9uLFxuICAgICAgICAgICAgcmVmZXJlbmNlZFNjZW5lSWRzOiB0b29sU2VsZWN0aW9uLnJlZmVyZW5jZWRTY2VuZUlkcyxcbiAgICAgICAgICAgIGltYWdlVXJsczogKGlucHV0LnVzZXJDb250ZXh0Py5pbWFnZVVybHMgYXMgc3RyaW5nW10pIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHdlYkNvbnRleHQ6IGNvbnRleHRQYWNrZXQud2ViQ29udGV4dCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHdvcmtmbG93OiB0b29sU2VsZWN0aW9uLndvcmtmbG93LFxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY29uc29sZS5sb2coJ/Cfp6AgW05FVyBPUkNIRVNUUkFUT1JdID09PSBPUkNIRVNUUkFUSU9OIENPTVBMRVRFID09PVxcbicpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbT3JjaGVzdHJhdG9yXSBFcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICBjaGF0UmVzcG9uc2U6IFwiSSBlbmNvdW50ZXJlZCBhbiBpc3N1ZSBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIlxuICAgICAgfTtcbiAgICB9XG4gIH1cblxufVxuXG4vLyBTaW5nbGV0b24gZXhwb3J0XG5leHBvcnQgY29uc3Qgb3JjaGVzdHJhdG9yID0gbmV3IE9yY2hlc3RyYXRvcigpO1xuXG4vLyBFeHBvcnQgdHlwZXMgZm9yIGV4dGVybmFsIHVzZVxuZXhwb3J0IHR5cGUgeyBcbiAgT3JjaGVzdHJhdGlvbklucHV0LCBcbiAgT3JjaGVzdHJhdGlvbk91dHB1dCBcbn0gZnJvbSBcIn4vbGliL3R5cGVzL2FpL2JyYWluLnR5cGVzXCI7Il0sIm5hbWVzIjpbIkNvbnRleHRCdWlsZGVyIiwiSW50ZW50QW5hbHl6ZXIiLCJPcmNoZXN0cmF0b3IiLCJwcm9jZXNzVXNlcklucHV0IiwiaW5wdXQiLCJjb25zb2xlIiwibG9nIiwicHJvbXB0IiwicHJvamVjdElkIiwiaGFzSW1hZ2VzIiwidXNlckNvbnRleHQiLCJpbWFnZVVybHMiLCJsZW5ndGgiLCJzY2VuZUNvdW50Iiwic3Rvcnlib2FyZFNvRmFyIiwib25Qcm9ncmVzcyIsImNvbnRleHRQYWNrZXQiLCJjb250ZXh0QnVpbGRlciIsImJ1aWxkQ29udGV4dCIsInRvb2xTZWxlY3Rpb24iLCJpbnRlbnRBbmFseXplciIsImFuYWx5emVJbnRlbnQiLCJ0b29sIiwidG9vbE5hbWUiLCJyZWFzb25pbmciLCJzdWJzdHJpbmciLCJzdWNjZXNzIiwiZXJyb3IiLCJjaGF0UmVzcG9uc2UiLCJjbGFyaWZpY2F0aW9uUXVlc3Rpb24iLCJyZXN1bHQiLCJ0b29sVXNlZCIsInVzZXJGZWVkYmFjayIsInRvb2xDb250ZXh0IiwidXNlclByb21wdCIsInRhcmdldFNjZW5lSWQiLCJ0YXJnZXREdXJhdGlvbiIsInJlZmVyZW5jZWRTY2VuZUlkcyIsInVuZGVmaW5lZCIsIndlYkNvbnRleHQiLCJ3b3JrZmxvdyIsIkVycm9yIiwibWVzc2FnZSIsIlN0cmluZyIsIm9yY2hlc3RyYXRvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/brain/orchestratorNEW.ts\n");

/***/ }),

/***/ "(rsc)/./src/brain/orchestrator_functions/contextBuilder.ts":
/*!************************************************************!*\
  !*** ./src/brain/orchestrator_functions/contextBuilder.ts ***!
  \************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ContextBuilder: () => (/* binding */ ContextBuilder)\n/* harmony export */ });\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _tools_webAnalysis_WebAnalysisAgent__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../tools/webAnalysis/WebAnalysisAgent */ \"(rsc)/./src/tools/webAnalysis/WebAnalysisAgent.ts\");\n/* harmony import */ var _lib_utils_url_detection__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../lib/utils/url-detection */ \"(rsc)/./src/lib/utils/url-detection.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_bazaar_database__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__, _tools_webAnalysis_WebAnalysisAgent__WEBPACK_IMPORTED_MODULE_2__]);\n([_bazaar_database__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__, _tools_webAnalysis_WebAnalysisAgent__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// Context builder for the modular orchestrator\n// Rebuilt to use real context: web analysis, scene history, chat context\n\n\n\n\n\nclass ContextBuilder {\n    async buildContext(input) {\n        console.log('\\n [CONTEXT BUILDER] === BUILDING REAL CONTEXT ===');\n        console.log(' [CONTEXT BUILDER] Project:', input.projectId);\n        console.log(' [CONTEXT BUILDER] Has images:', !!input.userContext?.imageUrls?.length);\n        try {\n            // 1. Get scenes with FULL TSX code for cross-scene operations\n            const scenesWithCode = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id,\n                name: _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.name,\n                order: _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.order,\n                tsxCode: _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.tsxCode // CRITICAL: Full code for context\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.projectId, input.projectId)).orderBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.order);\n            // 2. Build recent chat context\n            const recentChat = (input.chatHistory || []).slice(-5);\n            // 3. Build image context from conversation\n            const imageContext = await this.buildImageContext(input);\n            // 4. Build web analysis context from URL detection\n            const webContext = await this.buildWebContext(input);\n            return {\n                // Real scene history with full TSX for cross-scene operations\n                sceneHistory: scenesWithCode.map((scene)=>({\n                        id: scene.id,\n                        name: scene.name || 'Untitled Scene',\n                        tsxCode: scene.tsxCode || '',\n                        order: scene.order\n                    })),\n                // Recent conversation for flow understanding\n                conversationContext: this.summarizeConversation(recentChat),\n                recentMessages: recentChat,\n                // Image context from uploads\n                imageContext: imageContext,\n                // Web analysis context from URL detection\n                webContext: webContext,\n                // Scene list for quick reference\n                sceneList: scenesWithCode.map((scene)=>({\n                        id: scene.id,\n                        name: scene.name || 'Untitled Scene',\n                        order: scene.order\n                    }))\n            };\n        } catch (error) {\n            console.error('[ContextBuilder] Error building context:', error);\n            // Minimal fallback\n            return {\n                sceneHistory: [],\n                conversationContext: 'New conversation',\n                recentMessages: input.chatHistory?.slice(-5) || [],\n                imageContext: {\n                    currentImages: [],\n                    recentImagesFromChat: []\n                },\n                webContext: undefined,\n                sceneList: []\n            };\n        }\n    }\n    summarizeConversation(chatHistory) {\n        if (chatHistory.length === 0) return 'New conversation';\n        const recentMessages = chatHistory.slice(-5);\n        const topics = [];\n        for (const message of recentMessages){\n            if (message.role === 'user') {\n                if (message.content.includes('create') || message.content.includes('generate')) {\n                    topics.push('scene creation');\n                }\n                if (message.content.includes('edit') || message.content.includes('change')) {\n                    topics.push('scene editing');\n                }\n                if (message.content.includes('color') || message.content.includes('background')) {\n                    topics.push('styling');\n                }\n            }\n        }\n        const uniqueTopics = Array.from(new Set(topics));\n        return uniqueTopics.length > 0 ? `Conversation about: ${uniqueTopics.join(', ')}` : 'General conversation';\n    }\n    async buildImageContext(input) {\n        // Simple: Check current request for images\n        const currentImages = input.userContext?.imageUrls || [];\n        // Extract images from recent chat history  \n        const recentImagesFromChat = [];\n        const recentChat = input.chatHistory?.slice(-10) || [];\n        for(let i = 0; i < recentChat.length; i++){\n            const msg = recentChat[i];\n            if (msg.role === 'user' && msg.imageUrls?.length > 0) {\n                recentImagesFromChat.push({\n                    position: i + 1,\n                    userPrompt: msg.content,\n                    imageUrls: msg.imageUrls\n                });\n            }\n        }\n        return {\n            currentImages,\n            recentImagesFromChat\n        };\n    }\n    async buildWebContext(input) {\n        try {\n            // Extract URL from current prompt\n            const targetUrl = (0,_lib_utils_url_detection__WEBPACK_IMPORTED_MODULE_3__.extractFirstValidUrl)(input.prompt);\n            if (!targetUrl) {\n                console.log(' [CONTEXT BUILDER] No valid URL found in prompt');\n                return undefined;\n            }\n            console.log(` [CONTEXT BUILDER] Analyzing website: ${targetUrl}`);\n            // Initialize web analysis agent\n            const webAgent = new _tools_webAnalysis_WebAnalysisAgent__WEBPACK_IMPORTED_MODULE_2__.WebAnalysisAgent();\n            // Validate URL first\n            const validation = await webAgent.validateUrl(targetUrl);\n            if (!validation.valid) {\n                console.log(` [CONTEXT BUILDER] URL validation failed: ${validation.error}`);\n                return undefined;\n            }\n            // Perform web analysis with R2 upload\n            const analysis = await webAgent.analyzeWebsite(targetUrl, input.projectId, input.userId);\n            if (!analysis.success) {\n                console.log(` [CONTEXT BUILDER] Web analysis failed: ${analysis.error}`);\n                return undefined;\n            }\n            // Return structured web context\n            if (analysis.screenshotUrls && analysis.pageData) {\n                console.log(` [CONTEXT BUILDER]  Web context created for ${analysis.pageData.title}`);\n                return {\n                    originalUrl: analysis.url,\n                    screenshotUrls: analysis.screenshotUrls,\n                    pageData: analysis.pageData,\n                    analyzedAt: analysis.analyzedAt\n                };\n            }\n            return undefined;\n        } catch (error) {\n            console.error(' [CONTEXT BUILDER] Error in web analysis:', error);\n            return undefined;\n        }\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYnJhaW4vb3JjaGVzdHJhdG9yX2Z1bmN0aW9ucy9jb250ZXh0QnVpbGRlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLCtDQUErQztBQUMvQyx5RUFBeUU7QUFFbkM7QUFDYztBQUNiO0FBRXFDO0FBQ1A7QUFFOUQsTUFBTUs7SUFFWCxNQUFNQyxhQUFhQyxLQUF5QixFQUEwQjtRQUNwRUMsUUFBUUMsR0FBRyxDQUFDO1FBQ1pELFFBQVFDLEdBQUcsQ0FBQyxpQ0FBaUNGLE1BQU1HLFNBQVM7UUFDNURGLFFBQVFDLEdBQUcsQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFFRixNQUFNSSxXQUFXLEVBQUVDLFdBQXdCQztRQUU5RixJQUFJO1lBQ0YsOERBQThEO1lBQzlELE1BQU1DLGlCQUFpQixNQUFNZCxnREFBRUEsQ0FDNUJlLE1BQU0sQ0FBQztnQkFDTkMsSUFBSWYsb0RBQU1BLENBQUNlLEVBQUU7Z0JBQ2JDLE1BQU1oQixvREFBTUEsQ0FBQ2dCLElBQUk7Z0JBQ2pCQyxPQUFPakIsb0RBQU1BLENBQUNpQixLQUFLO2dCQUNuQkMsU0FBU2xCLG9EQUFNQSxDQUFDa0IsT0FBTyxDQUFFLGtDQUFrQztZQUM3RCxHQUNDQyxJQUFJLENBQUNuQixvREFBTUEsRUFDWG9CLEtBQUssQ0FBQ25CLCtDQUFFQSxDQUFDRCxvREFBTUEsQ0FBQ1MsU0FBUyxFQUFFSCxNQUFNRyxTQUFTLEdBQzFDWSxPQUFPLENBQUNyQixvREFBTUEsQ0FBQ2lCLEtBQUs7WUFFdkIsK0JBQStCO1lBQy9CLE1BQU1LLGFBQWEsQ0FBQ2hCLE1BQU1pQixXQUFXLElBQUksRUFBRSxFQUFFQyxLQUFLLENBQUMsQ0FBQztZQUVwRCwyQ0FBMkM7WUFDM0MsTUFBTUMsZUFBZSxNQUFNLElBQUksQ0FBQ0MsaUJBQWlCLENBQUNwQjtZQUVsRCxtREFBbUQ7WUFDbkQsTUFBTXFCLGFBQWEsTUFBTSxJQUFJLENBQUNDLGVBQWUsQ0FBQ3RCO1lBRTlDLE9BQU87Z0JBQ0wsOERBQThE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WUFBWVQsU0FBU1MsVUFBVTtnQkFDakM7WUFDRjtZQUVBLE9BQU85QjtRQUVULEVBQUUsT0FBT0gsT0FBTztZQUNkN0IsUUFBUTZCLEtBQUssQ0FBQywrQ0FBK0NBO1lBQzdELE9BQU9HO1FBQ1Q7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvYnJhaW4vb3JjaGVzdHJhdG9yX2Z1bmN0aW9ucy9jb250ZXh0QnVpbGRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb250ZXh0IGJ1aWxkZXIgZm9yIHRoZSBtb2R1bGFyIG9yY2hlc3RyYXRvclxuLy8gUmVidWlsdCB0byB1c2UgcmVhbCBjb250ZXh0OiB3ZWIgYW5hbHlzaXMsIHNjZW5lIGhpc3RvcnksIGNoYXQgY29udGV4dFxuXG5pbXBvcnQgeyBkYiB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBzY2VuZXMsIG1lc3NhZ2VzIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IGVxLCBkZXNjIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgdHlwZSB7IE9yY2hlc3RyYXRpb25JbnB1dCwgQ29udGV4dFBhY2tldCB9IGZyb20gXCIuLi8uLi9saWIvdHlwZXMvYWkvYnJhaW4udHlwZXNcIjtcbmltcG9ydCB7IFdlYkFuYWx5c2lzQWdlbnQgfSBmcm9tIFwiLi4vLi4vdG9vbHMvd2ViQW5hbHlzaXMvV2ViQW5hbHlzaXNBZ2VudFwiO1xuaW1wb3J0IHsgZXh0cmFjdEZpcnN0VmFsaWRVcmwgfSBmcm9tIFwiLi4vLi4vbGliL3V0aWxzL3VybC1kZXRlY3Rpb25cIjtcblxuZXhwb3J0IGNsYXNzIENvbnRleHRCdWlsZGVyIHtcblxuICBhc3luYyBidWlsZENvbnRleHQoaW5wdXQ6IE9yY2hlc3RyYXRpb25JbnB1dCk6IFByb21pc2U8Q29udGV4dFBhY2tldD4ge1xuICAgIGNvbnNvbGUubG9nKCdcXG7wn5OaIFtDT05URVhUIEJVSUxERVJdID09PSBCVUlMRElORyBSRUFMIENPTlRFWFQgPT09Jyk7XG4gICAgY29uc29sZS5sb2coJ/Cfk5ogW0NPTlRFWFQgQlVJTERFUl0gUHJvamVjdDonLCBpbnB1dC5wcm9qZWN0SWQpO1xuICAgIGNvbnNvbGUubG9nKCfwn5OaIFtDT05URVhUIEJVSUxERVJdIEhhcyBpbWFnZXM6JywgISEoaW5wdXQudXNlckNvbnRleHQ/LmltYWdlVXJscyBhcyBzdHJpbmdbXSk/Lmxlbmd0aCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIDEuIEdldCBzY2VuZXMgd2l0aCBGVUxMIFRTWCBjb2RlIGZvciBjcm9zcy1zY2VuZSBvcGVyYXRpb25zXG4gICAgICBjb25zdCBzY2VuZXNXaXRoQ29kZSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBcbiAgICAgICAgICBpZDogc2NlbmVzLmlkLCBcbiAgICAgICAgICBuYW1lOiBzY2VuZXMubmFtZSwgXG4gICAgICAgICAgb3JkZXI6IHNjZW5lcy5vcmRlcixcbiAgICAgICAgICB0c3hDb2RlOiBzY2VuZXMudHN4Q29kZSAgLy8gQ1JJVElDQUw6IEZ1bGwgY29kZSBmb3IgY29udGV4dFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShzY2VuZXMpXG4gICAgICAgIC53aGVyZShlcShzY2VuZXMucHJvamVjdElkLCBpbnB1dC5wcm9qZWN0SWQpKVxuICAgICAgICAub3JkZXJCeShzY2VuZXMub3JkZXIpO1xuXG4gICAgICAvLyAyLiBCdWlsZCByZWNlbnQgY2hhdCBjb250ZXh0XG4gICAgICBjb25zdCByZWNlbnRDaGF0ID0gKGlucHV0LmNoYXRIaXN0b3J5IHx8IFtdKS5zbGljZSgtNSk7XG5cbiAgICAgIC8vIDMuIEJ1aWxkIGltYWdlIGNvbnRleHQgZnJvbSBjb252ZXJzYXRpb25cbiAgICAgIGNvbnN0IGltYWdlQ29udGV4dCA9IGF3YWl0IHRoaXMuYnVpbGRJbWFnZUNvbnRleHQoaW5wdXQpO1xuICAgICAgXG4gICAgICAvLyA0LiBCdWlsZCB3ZWIgYW5hbHlzaXMgY29udGV4dCBmcm9tIFVSTCBkZXRlY3Rpb25cbiAgICAgIGNvbnN0IHdlYkNvbnRleHQgPSBhd2FpdCB0aGlzLmJ1aWxkV2ViQ29udGV4dChpbnB1dCk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC8vIFJlYWwgc2NlbmUgaGlzdG9yeSB3aXRoIGZ1bGwgVFNYIGZvciBjcm9zcy1zY2VuZSBvcGVyYXRpb25zXG4gICAgICAgIHNjZW5lSGlzdG9yeTogc2NlbmVzV2l0aENvZGUubWFwKHNjZW5lID0+ICh7XG4gICAgICAgICAgaWQ6IHNjZW5lLmlkLFxuICAgICAgICAgIG5hbWU6IHNjZW5lLm5hbWUgfHwgJ1VudGl0bGVkIFNjZW5lJyxcbiAgICAgICAgICB0c3hDb2RlOiBzY2VuZS50c3hDb2RlIHx8ICcnLCAvLyBGdWxsIGNvZGUgYXZhaWxhYmxlIGZvciBjb250ZXh0XG4gICAgICAgICAgb3JkZXI6IHNjZW5lLm9yZGVyXG4gICAgICAgIH0pKSxcbiAgICAgICAgXG4gICAgICAgIC8vIFJlY2VudCBjb252ZXJzYXRpb24gZm9yIGZsb3cgdW5kZXJzdGFuZGluZ1xuICAgICAgICBjb252ZXJzYXRpb25Db250ZXh0OiB0aGlzLnN1bW1hcml6ZUNvbnZlcnNhdGlvbihyZWNlbnRDaGF0KSxcbiAgICAgICAgcmVjZW50TWVzc2FnZXM6IHJlY2VudENoYXQsXG4gICAgICAgIFxuICAgICAgICAvLyBJbWFnZSBjb250ZXh0IGZyb20gdXBsb2Fkc1xuICAgICAgICBpbWFnZUNvbnRleHQ6IGltYWdlQ29udGV4dCxcbiAgICAgICAgXG4gICAgICAgIC8vIFdlYiBhbmFseXNpcyBjb250ZXh0IGZyb20gVVJMIGRldGVjdGlvblxuICAgICAgICB3ZWJDb250ZXh0OiB3ZWJDb250ZXh0LFxuICAgICAgICBcbiAgICAgICAgLy8gU2NlbmUgbGlzdCBmb3IgcXVpY2sgcmVmZXJlbmNlXG4gICAgICAgIHNjZW5lTGlzdDogc2NlbmVzV2l0aENvZGUubWFwKHNjZW5lID0+ICh7XG4gICAgICAgICAgaWQ6IHNjZW5lLmlkLFxuICAgICAgICAgIG5hbWU6IHNjZW5lLm5hbWUgfHwgJ1VudGl0bGVkIFNjZW5lJyxcbiAgICAgICAgICBvcmRlcjogc2NlbmUub3JkZXJcbiAgICAgICAgfSkpXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDb250ZXh0QnVpbGRlcl0gRXJyb3IgYnVpbGRpbmcgY29udGV4dDonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIC8vIE1pbmltYWwgZmFsbGJhY2tcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNjZW5lSGlzdG9yeTogW10sXG4gICAgICAgIGNvbnZlcnNhdGlvbkNvbnRleHQ6ICdOZXcgY29udmVyc2F0aW9uJyxcbiAgICAgICAgcmVjZW50TWVzc2FnZXM6IGlucHV0LmNoYXRIaXN0b3J5Py5zbGljZSgtNSkgfHwgW10sXG4gICAgICAgIGltYWdlQ29udGV4dDogeyBjdXJyZW50SW1hZ2VzOiBbXSwgcmVjZW50SW1hZ2VzRnJvbUNoYXQ6IFtdIH0sXG4gICAgICAgIHdlYkNvbnRleHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgc2NlbmVMaXN0OiBbXVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuXG4gIHByaXZhdGUgc3VtbWFyaXplQ29udmVyc2F0aW9uKGNoYXRIaXN0b3J5OiBBcnJheTx7cm9sZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmd9Pik6IHN0cmluZyB7XG4gICAgaWYgKGNoYXRIaXN0b3J5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuICdOZXcgY29udmVyc2F0aW9uJztcbiAgICBcbiAgICBjb25zdCByZWNlbnRNZXNzYWdlcyA9IGNoYXRIaXN0b3J5LnNsaWNlKC01KTtcbiAgICBjb25zdCB0b3BpY3M6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIHJlY2VudE1lc3NhZ2VzKSB7XG4gICAgICBpZiAobWVzc2FnZS5yb2xlID09PSAndXNlcicpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UuY29udGVudC5pbmNsdWRlcygnY3JlYXRlJykgfHwgbWVzc2FnZS5jb250ZW50LmluY2x1ZGVzKCdnZW5lcmF0ZScpKSB7XG4gICAgICAgICAgdG9waWNzLnB1c2goJ3NjZW5lIGNyZWF0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1lc3NhZ2UuY29udGVudC5pbmNsdWRlcygnZWRpdCcpIHx8IG1lc3NhZ2UuY29udGVudC5pbmNsdWRlcygnY2hhbmdlJykpIHtcbiAgICAgICAgICB0b3BpY3MucHVzaCgnc2NlbmUgZWRpdGluZycpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtZXNzYWdlLmNvbnRlbnQuaW5jbHVkZXMoJ2NvbG9yJykgfHwgbWVzc2FnZS5jb250ZW50LmluY2x1ZGVzKCdiYWNrZ3JvdW5kJykpIHtcbiAgICAgICAgICB0b3BpY3MucHVzaCgnc3R5bGluZycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHVuaXF1ZVRvcGljcyA9IEFycmF5LmZyb20obmV3IFNldCh0b3BpY3MpKTtcbiAgICByZXR1cm4gdW5pcXVlVG9waWNzLmxlbmd0aCA+IDAgPyBgQ29udmVyc2F0aW9uIGFib3V0OiAke3VuaXF1ZVRvcGljcy5qb2luKCcsICcpfWAgOiAnR2VuZXJhbCBjb252ZXJzYXRpb24nO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBidWlsZEltYWdlQ29udGV4dChpbnB1dDogT3JjaGVzdHJhdGlvbklucHV0KSB7XG4gICAgLy8gU2ltcGxlOiBDaGVjayBjdXJyZW50IHJlcXVlc3QgZm9yIGltYWdlc1xuICAgIGNvbnN0IGN1cnJlbnRJbWFnZXMgPSBpbnB1dC51c2VyQ29udGV4dD8uaW1hZ2VVcmxzIGFzIHN0cmluZ1tdIHx8IFtdO1xuICAgIFxuICAgIC8vIEV4dHJhY3QgaW1hZ2VzIGZyb20gcmVjZW50IGNoYXQgaGlzdG9yeSAgXG4gICAgY29uc3QgcmVjZW50SW1hZ2VzRnJvbUNoYXQ6IGFueVtdID0gW107XG4gICAgY29uc3QgcmVjZW50Q2hhdCA9IGlucHV0LmNoYXRIaXN0b3J5Py5zbGljZSgtMTApIHx8IFtdO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVjZW50Q2hhdC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbXNnID0gcmVjZW50Q2hhdFtpXTtcbiAgICAgIGlmIChtc2cucm9sZSA9PT0gJ3VzZXInICYmIChtc2cgYXMgYW55KS5pbWFnZVVybHM/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVjZW50SW1hZ2VzRnJvbUNoYXQucHVzaCh7XG4gICAgICAgICAgcG9zaXRpb246IGkgKyAxLFxuICAgICAgICAgIHVzZXJQcm9tcHQ6IG1zZy5jb250ZW50LFxuICAgICAgICAgIGltYWdlVXJsczogKG1zZyBhcyBhbnkpLmltYWdlVXJsc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyBcbiAgICAgIGN1cnJlbnRJbWFnZXMsXG4gICAgICByZWNlbnRJbWFnZXNGcm9tQ2hhdFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGJ1aWxkV2ViQ29udGV4dChpbnB1dDogT3JjaGVzdHJhdGlvbklucHV0KSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEV4dHJhY3QgVVJMIGZyb20gY3VycmVudCBwcm9tcHRcbiAgICAgIGNvbnN0IHRhcmdldFVybCA9IGV4dHJhY3RGaXJzdFZhbGlkVXJsKGlucHV0LnByb21wdCk7XG4gICAgICBcbiAgICAgIGlmICghdGFyZ2V0VXJsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5OaIFtDT05URVhUIEJVSUxERVJdIE5vIHZhbGlkIFVSTCBmb3VuZCBpbiBwcm9tcHQnKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYPCfk5ogW0NPTlRFWFQgQlVJTERFUl0gQW5hbHl6aW5nIHdlYnNpdGU6ICR7dGFyZ2V0VXJsfWApO1xuICAgICAgXG4gICAgICAvLyBJbml0aWFsaXplIHdlYiBhbmFseXNpcyBhZ2VudFxuICAgICAgY29uc3Qgd2ViQWdlbnQgPSBuZXcgV2ViQW5hbHlzaXNBZ2VudCgpO1xuICAgICAgXG4gICAgICAvLyBWYWxpZGF0ZSBVUkwgZmlyc3RcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhd2FpdCB3ZWJBZ2VudC52YWxpZGF0ZVVybCh0YXJnZXRVcmwpO1xuICAgICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OaIFtDT05URVhUIEJVSUxERVJdIFVSTCB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9yfWApO1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBQZXJmb3JtIHdlYiBhbmFseXNpcyB3aXRoIFIyIHVwbG9hZFxuICAgICAgY29uc3QgYW5hbHlzaXMgPSBhd2FpdCB3ZWJBZ2VudC5hbmFseXplV2Vic2l0ZSh0YXJnZXRVcmwsIGlucHV0LnByb2plY3RJZCwgaW5wdXQudXNlcklkKTtcbiAgICAgIFxuICAgICAgaWYgKCFhbmFseXNpcy5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OaIFtDT05URVhUIEJVSUxERVJdIFdlYiBhbmFseXNpcyBmYWlsZWQ6ICR7YW5hbHlzaXMuZXJyb3J9YCk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFJldHVybiBzdHJ1Y3R1cmVkIHdlYiBjb250ZXh0XG4gICAgICBpZiAoYW5hbHlzaXMuc2NyZWVuc2hvdFVybHMgJiYgYW5hbHlzaXMucGFnZURhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk5ogW0NPTlRFWFQgQlVJTERFUl0g4pyFIFdlYiBjb250ZXh0IGNyZWF0ZWQgZm9yICR7YW5hbHlzaXMucGFnZURhdGEudGl0bGV9YCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb3JpZ2luYWxVcmw6IGFuYWx5c2lzLnVybCEsXG4gICAgICAgICAgc2NyZWVuc2hvdFVybHM6IGFuYWx5c2lzLnNjcmVlbnNob3RVcmxzLFxuICAgICAgICAgIHBhZ2VEYXRhOiBhbmFseXNpcy5wYWdlRGF0YSxcbiAgICAgICAgICBhbmFseXplZEF0OiBhbmFseXNpcy5hbmFseXplZEF0IVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ/Cfk5ogW0NPTlRFWFQgQlVJTERFUl0gRXJyb3IgaW4gd2ViIGFuYWx5c2lzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG59ICJdLCJuYW1lcyI6WyJkYiIsInNjZW5lcyIsImVxIiwiV2ViQW5hbHlzaXNBZ2VudCIsImV4dHJhY3RGaXJzdFZhbGlkVXJsIiwiQ29udGV4dEJ1aWxkZXIiLCJidWlsZENvbnRleHQiLCJpbnB1dCIsImNvbnNvbGUiLCJsb2ciLCJwcm9qZWN0SWQiLCJ1c2VyQ29udGV4dCIsImltYWdlVXJscyIsImxlbmd0aCIsInNjZW5lc1dpdGhDb2RlIiwic2VsZWN0IiwiaWQiLCJuYW1lIiwib3JkZXIiLCJ0c3hDb2RlIiwiZnJvbSIsIndoZXJlIiwib3JkZXJCeSIsInJlY2VudENoYXQiLCJjaGF0SGlzdG9yeSIsInNsaWNlIiwiaW1hZ2VDb250ZXh0IiwiYnVpbGRJbWFnZUNvbnRleHQiLCJ3ZWJDb250ZXh0IiwiYnVpbGRXZWJDb250ZXh0Iiwic2NlbmVIaXN0b3J5IiwibWFwIiwic2NlbmUiLCJjb252ZXJzYXRpb25Db250ZXh0Iiwic3VtbWFyaXplQ29udmVyc2F0aW9uIiwicmVjZW50TWVzc2FnZXMiLCJzY2VuZUxpc3QiLCJlcnJvciIsImN1cnJlbnRJbWFnZXMiLCJyZWNlbnRJbWFnZXNGcm9tQ2hhdCIsInVuZGVmaW5lZCIsInRvcGljcyIsIm1lc3NhZ2UiLCJyb2xlIiwiY29udGVudCIsImluY2x1ZGVzIiwicHVzaCIsInVuaXF1ZVRvcGljcyIsIkFycmF5IiwiU2V0Iiwiam9pbiIsImkiLCJtc2ciLCJwb3NpdGlvbiIsInVzZXJQcm9tcHQiLCJ0YXJnZXRVcmwiLCJwcm9tcHQiLCJ3ZWJBZ2VudCIsInZhbGlkYXRpb24iLCJ2YWxpZGF0ZVVybCIsInZhbGlkIiwiYW5hbHlzaXMiLCJhbmFseXplV2Vic2l0ZSIsInVzZXJJZCIsInN1Y2Nlc3MiLCJzY3JlZW5zaG90VXJscyIsInBhZ2VEYXRhIiwidGl0bGUiLCJvcmlnaW5hbFVybCIsInVybCIsImFuYWx5emVkQXQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/brain/orchestrator_functions/contextBuilder.ts\n");

/***/ }),

/***/ "(rsc)/./src/brain/orchestrator_functions/intentAnalyzer.ts":
/*!************************************************************!*\
  !*** ./src/brain/orchestrator_functions/intentAnalyzer.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   IntentAnalyzer: () => (/* binding */ IntentAnalyzer)\n/* harmony export */ });\n/* harmony import */ var _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/services/ai/aiClient.service */ \"(rsc)/./src/server/services/ai/aiClient.service.ts\");\n/* harmony import */ var _config_models_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/config/models.config */ \"(rsc)/./src/config/models.config.ts\");\n/* harmony import */ var _config_prompts_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/config/prompts.config */ \"(rsc)/./src/config/prompts.config.ts\");\n// Intent analyzer for tool selection\n\n\n\nclass IntentAnalyzer {\n    async analyzeIntent(input, contextPacket) {\n        console.log('\\n [NEW INTENT ANALYZER] === ANALYZING INTENT ===');\n        console.log(' [NEW INTENT ANALYZER] User prompt:', input.prompt.substring(0, 50) + '...');\n        try {\n            const systemPrompt = _config_prompts_config__WEBPACK_IMPORTED_MODULE_2__.SYSTEM_PROMPTS.BRAIN_ORCHESTRATOR.content;\n            const userPrompt = this.buildUserPrompt(input, contextPacket);\n            const response = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__.AIClientService.generateResponse(this.modelConfig, [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                {\n                    role: \"user\",\n                    content: userPrompt\n                }\n            ], undefined, {\n                responseFormat: {\n                    type: \"json_object\"\n                }\n            });\n            const rawOutput = response.content;\n            if (!rawOutput) {\n                throw new Error(\"No response from Brain LLM\");\n            }\n            console.log(' [NEW INTENT ANALYZER] Brain responded, parsing decision...');\n            const parsed = this.extractJsonFromResponse(rawOutput);\n            // Debug log to see what brain actually returned\n            console.log(' [NEW INTENT ANALYZER] Raw parsed JSON:', JSON.stringify(parsed, null, 2));\n            const result = this.processBrainDecision(parsed, input);\n            console.log(' [NEW INTENT ANALYZER] Decision:', {\n                toolName: result.toolName,\n                success: result.success,\n                reasoning: result.reasoning?.substring(0, 50) + '...'\n            });\n            return result;\n        } catch (error) {\n            console.error('[IntentAnalyzer] Error:', error);\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : \"Intent analysis failed\"\n            };\n        }\n    }\n    buildUserPrompt(input, contextPacket) {\n        const { prompt, storyboardSoFar } = input;\n        // Build storyboard context with clear ordering and recency\n        let storyboardInfo = \"No scenes yet\";\n        if (storyboardSoFar && storyboardSoFar.length > 0) {\n            storyboardInfo = storyboardSoFar.map((scene, i)=>{\n                const sceneNum = i + 1;\n                const isNewest = i === storyboardSoFar.length - 1;\n                const isFirst = i === 0;\n                const durationSec = (scene.duration / 30).toFixed(1); // Convert frames to seconds\n                return `Scene ${sceneNum}: \"${scene.name}\" (ID: ${scene.id}, Duration: ${scene.duration} frames / ${durationSec}s)${isNewest ? ' [NEWEST/LAST ADDED]' : ''}${isFirst ? ' [FIRST]' : ''}`;\n            }).join('\\n');\n            // Add helpful context about recent actions\n            if (storyboardSoFar.length > 0) {\n                storyboardInfo += `\\n\\nIMPORTANT: When user says \"it\" or \"the scene\" right after adding content, they usually mean the NEWEST scene (Scene ${storyboardSoFar.length}).`;\n            }\n            if (input.userContext?.sceneId) {\n                const selected = storyboardSoFar.find((s)=>s.id === input.userContext?.sceneId);\n                if (selected) storyboardInfo += `\\nUSER SELECTED: \"${selected.name}\"`;\n            }\n        }\n        // Add image context\n        let imageInfo = \"\";\n        if (contextPacket.imageContext && contextPacket.imageContext.recentImagesFromChat && contextPacket.imageContext.recentImagesFromChat.length > 0) {\n            const images = contextPacket.imageContext.recentImagesFromChat;\n            imageInfo = `\\nIMAGES IN CONVERSATION:`;\n            images.forEach((img)=>{\n                imageInfo += `\\n${img.position}. \"${img.userPrompt}\" [${img.imageUrls.length} image(s)]`;\n            });\n            imageInfo += `\\n\\nWhen user references images:\n- \"the image\" or \"this image\"  most recent image (position ${images.length})\n- \"first/second/third image\"  by position number\n- \"image 1/2/3\"  by position number\n- \"earlier image\"  previous images in conversation\n\nNOTE: All tools are multimodal. When images are referenced, include them in the tool's imageUrls parameter.`;\n        }\n        // Check if current prompt has images  \n        const currentImageUrls = input.userContext?.imageUrls || [];\n        if (currentImageUrls.length > 0) {\n            imageInfo += `\\n\\nCURRENT MESSAGE: Includes ${currentImageUrls.length} image(s) uploaded with this request.`;\n        }\n        // Add conversation context with recent action detection\n        let chatInfo = \"\";\n        if (contextPacket.conversationContext !== 'New conversation') {\n            chatInfo = `\\nCONVERSATION: ${contextPacket.conversationContext}`;\n            // Check if last message indicates we just added a scene\n            const lastMessages = contextPacket.recentMessages || [];\n            if (lastMessages.length >= 2) {\n                const lastAssistantMsg = [\n                    ...lastMessages\n                ].reverse().find((m)=>m.role === 'assistant');\n                if (lastAssistantMsg && (lastAssistantMsg.content.includes('added') || lastAssistantMsg.content.includes('created') || lastAssistantMsg.content.includes('I\\'ve added'))) {\n                    chatInfo += `\\nRECENT: Just added a new scene (likely Scene ${storyboardSoFar?.length || 'latest'})`;\n                }\n            }\n        }\n        // Add web analysis context\n        let webInfo = \"\";\n        if (contextPacket.webContext) {\n            const web = contextPacket.webContext;\n            webInfo = `\\nWEB ANALYSIS CONTEXT:\nWebsite: ${web.pageData.title} (${web.originalUrl})\nDescription: ${web.pageData.description || 'No description'}\nKey Headings: ${web.pageData.headings.slice(0, 3).join(', ')}\nScreenshots: Desktop (${web.screenshotUrls.desktop}) & Mobile (${web.screenshotUrls.mobile})\nAnalyzed: ${new Date(web.analyzedAt).toLocaleString()}\n\nThe AI has access to visual screenshots of this website and can reference them for brand matching, design inspiration, and style consistency.`;\n        }\n        return `USER: \"${prompt}\"\n\nSTORYBOARD:\n${storyboardInfo}${imageInfo}${chatInfo}${webInfo}\n\nRespond with JSON only.`;\n    }\n    extractJsonFromResponse(content) {\n        if (!content || typeof content !== 'string') {\n            throw new Error('Empty or invalid response content');\n        }\n        const cleaned = content.trim();\n        if (cleaned.startsWith('```')) {\n            const lines = cleaned.split('\\n');\n            const startIndex = lines.findIndex((line)=>line.includes('```json') || line === '```');\n            const endIndex = lines.findIndex((line, index)=>index > startIndex && line.includes('```'));\n            if (startIndex !== -1 && endIndex !== -1) {\n                const jsonLines = lines.slice(startIndex + 1, endIndex);\n                const jsonString = jsonLines.join('\\n').trim();\n                if (!jsonString) {\n                    throw new Error('Empty JSON content in markdown block');\n                }\n                return JSON.parse(jsonString);\n            }\n        }\n        return JSON.parse(cleaned);\n    }\n    processBrainDecision(parsed, input) {\n        // Check for multi-step workflow\n        if (parsed.workflow && Array.isArray(parsed.workflow)) {\n            return {\n                success: true,\n                workflow: parsed.workflow,\n                reasoning: parsed.reasoning || \"Multi-step workflow planned\"\n            };\n        }\n        // Handle clarification responses\n        if (parsed.needsClarification) {\n            return {\n                success: true,\n                needsClarification: true,\n                clarificationQuestion: parsed.clarificationQuestion,\n                reasoning: parsed.reasoning\n            };\n        }\n        // Single tool operation\n        const result = {\n            success: true,\n            toolName: parsed.toolName,\n            reasoning: parsed.reasoning,\n            targetSceneId: parsed.targetSceneId,\n            targetDuration: parsed.targetDuration,\n            referencedSceneIds: parsed.referencedSceneIds,\n            userFeedback: parsed.userFeedback\n        };\n        // Extract requested duration\n        const requestedDurationSeconds = this.extractRequestedDuration(input.prompt);\n        if (requestedDurationSeconds) {\n            result.requestedDurationSeconds = requestedDurationSeconds;\n        }\n        return result;\n    }\n    extractRequestedDuration(prompt) {\n        const durationMatch = prompt.match(/\\b(\\d+)\\s*(?:seconds?|sec|se[ocn]{1,3}ds?)\\b/i);\n        if (durationMatch && durationMatch[1]) {\n            const seconds = parseInt(durationMatch[1], 10);\n            if (!isNaN(seconds) && seconds > 0) {\n                return seconds;\n            }\n        }\n        return undefined;\n    }\n    constructor(){\n        this.modelConfig = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_1__.getModel)(\"brain\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYnJhaW4vb3JjaGVzdHJhdG9yX2Z1bmN0aW9ucy9pbnRlbnRBbmFseXplci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEscUNBQXFDO0FBRW1DO0FBQ3RCO0FBQ087QUFHbEQsTUFBTUc7SUFHWCxNQUFNQyxjQUFjQyxLQUF5QixFQUFFQyxhQUE0QixFQUFnQztRQUN6R0MsUUFBUUMsR0FBRyxDQUFDO1FBQ1pELFFBQVFDLEdBQUcsQ0FBQyx5Q0FBeUNILE1BQU1JLE1BQU0sQ0FBQ0MsU0FBUyxDQUFDLEdBQUcsTUFBTTtRQUVyRixJQUFJO1lBQ0YsTUFBTUMsZUFBZVQsa0VBQWNBLENBQUNVLGtCQUFrQixDQUFDQyxPQUFPO1lBQzlELE1BQU1DLGFBQWEsSUFBSSxDQUFDQyxlQUFlLENBQUNWLE9BQU9DO1lBRS9DLE1BQU1VLFdBQVcsTUFBTWhCLGlGQUFlQSxDQUFDaUIsZ0JBQWdCLENBQ3JELElBQUksQ0FBQ0MsV0FBVyxFQUNoQjtnQkFDRTtvQkFBRUMsTUFBTTtvQkFBVU4sU0FBU0Y7Z0JBQWE7Z0JBQ3hDO29CQUFFUSxNQUFNO29CQUFRTixTQUFTQztnQkFBVzthQUNyQyxFQUNETSxXQUNBO2dCQUFFQyxnQkFBZ0I7b0JBQUVDLE1BQU07Z0JBQWM7WUFBRTtZQUc1QyxNQUFNQyxZQUFZUCxTQUFTSCxPQUFPO1lBQ2xDLElBQUksQ0FBQ1UsV0FBVztnQkFDZCxNQUFNLElBQUlDLE1BQU07WUFDbEI7WUFFQWpCLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU1pQixTQUFTLElBQUksQ0FBQ0MsdUJBQXVCLENBQUNIO1lBRTVDLGdEQUFnRDtZQUNoRGhCLFFBQVFDLEdBQUcsQ0FBQyw2Q0FBNkNtQixLQUFLQyxTQUFTLENBQUNILFFBQVEsTUFBTTtZQUV0RixNQUFNSSxTQUFTLElBQUksQ0FBQ0Msb0JBQW9CLENBQUNMLFFBQVFwQjtZQUVqREUsUUFBUUMsR0FBRyxDQUFDLHNDQUFzQztnQkFDaER1QixVQUFVRixPQUFPRSxRQUFRO2dC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QUFpQztRQUNqQyxJQUFJUixPQUFPK0Usa0JBQWtCLEVBQUU7WUFDN0IsT0FBTztnQkFDTHhFLFNBQVM7Z0JBQ1R3RSxvQkFBb0I7Z0JBQ3BCQyx1QkFBdUJoRixPQUFPZ0YscUJBQXFCO2dCQUNuRHhFLFdBQVdSLE9BQU9RLFNBQVM7WUFDN0I7UUFDRjtRQUVBLHdCQUF3QjtRQUN4QixNQUFNSixTQUE4QjtZQUNsQ0csU0FBUztZQUNURCxVQUFVTixPQUFPTSxRQUFRO1lBQ3pCRSxXQUFXUixPQUFPUSxTQUFTO1lBQzNCeUUsZUFBZWpGLE9BQU9pRixhQUFhO1lBQ25DQyxnQkFBZ0JsRixPQUFPa0YsY0FBYztZQUNyQ0Msb0JBQW9CbkYsT0FBT21GLGtCQUFrQjtZQUM3Q0MsY0FBY3BGLE9BQU9vRixZQUFZO1FBQ25DO1FBRUEsNkJBQTZCO1FBQzdCLE1BQU1DLDJCQUEyQixJQUFJLENBQUNDLHdCQUF3QixDQUFDMUcsTUFBTUksTUFBTTtRQUMzRSxJQUFJcUcsMEJBQTBCO1lBQzVCakYsT0FBT2lGLHdCQUF3QixHQUFHQTtRQUNwQztRQUVBLE9BQU9qRjtJQUNUO0lBRVFrRix5QkFBeUJ0RyxNQUFjLEVBQXNCO1FBQ25FLE1BQU11RyxnQkFBZ0J2RyxPQUFPd0csS0FBSyxDQUFDO1FBQ25DLElBQUlELGlCQUFpQkEsYUFBYSxDQUFDLEVBQUUsRUFBRTtZQUNyQyxNQUFNRSxVQUFVQyxTQUFTSCxhQUFhLENBQUMsRUFBRSxFQUFFO1lBQzNDLElBQUksQ0FBQ0ksTUFBTUYsWUFBWUEsVUFBVSxHQUFHO2dCQUNsQyxPQUFPQTtZQUNUO1FBQ0Y7UUFDQSxPQUFPOUY7SUFDVDs7YUF2TlFGLGNBQWNqQiwrREFBUUEsQ0FBQzs7QUF3TmpDIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvYnJhaW4vb3JjaGVzdHJhdG9yX2Z1bmN0aW9ucy9pbnRlbnRBbmFseXplci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbnRlbnQgYW5hbHl6ZXIgZm9yIHRvb2wgc2VsZWN0aW9uXG5cbmltcG9ydCB7IEFJQ2xpZW50U2VydmljZSB9IGZyb20gXCJ+L3NlcnZlci9zZXJ2aWNlcy9haS9haUNsaWVudC5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBnZXRNb2RlbCB9IGZyb20gXCJ+L2NvbmZpZy9tb2RlbHMuY29uZmlnXCI7XG5pbXBvcnQgeyBTWVNURU1fUFJPTVBUUyB9IGZyb20gXCJ+L2NvbmZpZy9wcm9tcHRzLmNvbmZpZ1wiO1xuaW1wb3J0IHR5cGUgeyBPcmNoZXN0cmF0aW9uSW5wdXQsIFRvb2xTZWxlY3Rpb25SZXN1bHQsIENvbnRleHRQYWNrZXQgfSBmcm9tIFwifi9saWIvdHlwZXMvYWkvYnJhaW4udHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIEludGVudEFuYWx5emVyIHtcbiAgcHJpdmF0ZSBtb2RlbENvbmZpZyA9IGdldE1vZGVsKFwiYnJhaW5cIik7XG4gIFxuICBhc3luYyBhbmFseXplSW50ZW50KGlucHV0OiBPcmNoZXN0cmF0aW9uSW5wdXQsIGNvbnRleHRQYWNrZXQ6IENvbnRleHRQYWNrZXQpOiBQcm9taXNlPFRvb2xTZWxlY3Rpb25SZXN1bHQ+IHtcbiAgICBjb25zb2xlLmxvZygnXFxu8J+OryBbTkVXIElOVEVOVCBBTkFMWVpFUl0gPT09IEFOQUxZWklORyBJTlRFTlQgPT09Jyk7XG4gICAgY29uc29sZS5sb2coJ/Cfjq8gW05FVyBJTlRFTlQgQU5BTFlaRVJdIFVzZXIgcHJvbXB0OicsIGlucHV0LnByb21wdC5zdWJzdHJpbmcoMCwgNTApICsgJy4uLicpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBTWVNURU1fUFJPTVBUUy5CUkFJTl9PUkNIRVNUUkFUT1IuY29udGVudDtcbiAgICAgIGNvbnN0IHVzZXJQcm9tcHQgPSB0aGlzLmJ1aWxkVXNlclByb21wdChpbnB1dCwgY29udGV4dFBhY2tldCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQUlDbGllbnRTZXJ2aWNlLmdlbmVyYXRlUmVzcG9uc2UoXG4gICAgICAgIHRoaXMubW9kZWxDb25maWcsXG4gICAgICAgIFtcbiAgICAgICAgICB7IHJvbGU6IFwic3lzdGVtXCIsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9LFxuICAgICAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHVzZXJQcm9tcHQgfSxcbiAgICAgICAgXSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB7IHJlc3BvbnNlRm9ybWF0OiB7IHR5cGU6IFwianNvbl9vYmplY3RcIiB9IH1cbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJhd091dHB1dCA9IHJlc3BvbnNlLmNvbnRlbnQ7XG4gICAgICBpZiAoIXJhd091dHB1dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyByZXNwb25zZSBmcm9tIEJyYWluIExMTVwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ/Cfjq8gW05FVyBJTlRFTlQgQU5BTFlaRVJdIEJyYWluIHJlc3BvbmRlZCwgcGFyc2luZyBkZWNpc2lvbi4uLicpO1xuICAgICAgY29uc3QgcGFyc2VkID0gdGhpcy5leHRyYWN0SnNvbkZyb21SZXNwb25zZShyYXdPdXRwdXQpO1xuICAgICAgXG4gICAgICAvLyBEZWJ1ZyBsb2cgdG8gc2VlIHdoYXQgYnJhaW4gYWN0dWFsbHkgcmV0dXJuZWRcbiAgICAgIGNvbnNvbGUubG9nKCfwn46vIFtORVcgSU5URU5UIEFOQUxZWkVSXSBSYXcgcGFyc2VkIEpTT046JywgSlNPTi5zdHJpbmdpZnkocGFyc2VkLCBudWxsLCAyKSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucHJvY2Vzc0JyYWluRGVjaXNpb24ocGFyc2VkLCBpbnB1dCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn46vIFtORVcgSU5URU5UIEFOQUxZWkVSXSBEZWNpc2lvbjonLCB7XG4gICAgICAgIHRvb2xOYW1lOiByZXN1bHQudG9vbE5hbWUsXG4gICAgICAgIHN1Y2Nlc3M6IHJlc3VsdC5zdWNjZXNzLFxuICAgICAgICByZWFzb25pbmc6IHJlc3VsdC5yZWFzb25pbmc/LnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0ludGVudEFuYWx5emVyXSBFcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJJbnRlbnQgYW5hbHlzaXMgZmFpbGVkXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRVc2VyUHJvbXB0KGlucHV0OiBPcmNoZXN0cmF0aW9uSW5wdXQsIGNvbnRleHRQYWNrZXQ6IENvbnRleHRQYWNrZXQpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgcHJvbXB0LCBzdG9yeWJvYXJkU29GYXIgfSA9IGlucHV0O1xuICAgIFxuICAgIC8vIEJ1aWxkIHN0b3J5Ym9hcmQgY29udGV4dCB3aXRoIGNsZWFyIG9yZGVyaW5nIGFuZCByZWNlbmN5XG4gICAgbGV0IHN0b3J5Ym9hcmRJbmZvID0gXCJObyBzY2VuZXMgeWV0XCI7XG4gICAgaWYgKHN0b3J5Ym9hcmRTb0ZhciAmJiBzdG9yeWJvYXJkU29GYXIubGVuZ3RoID4gMCkge1xuICAgICAgc3Rvcnlib2FyZEluZm8gPSBzdG9yeWJvYXJkU29GYXIubWFwKChzY2VuZSwgaSkgPT4ge1xuICAgICAgICBjb25zdCBzY2VuZU51bSA9IGkgKyAxO1xuICAgICAgICBjb25zdCBpc05ld2VzdCA9IGkgPT09IHN0b3J5Ym9hcmRTb0Zhci5sZW5ndGggLSAxO1xuICAgICAgICBjb25zdCBpc0ZpcnN0ID0gaSA9PT0gMDtcbiAgICAgICAgY29uc3QgZHVyYXRpb25TZWMgPSAoc2NlbmUuZHVyYXRpb24gLyAzMCkudG9GaXhlZCgxKTsgLy8gQ29udmVydCBmcmFtZXMgdG8gc2Vjb25kc1xuICAgICAgICByZXR1cm4gYFNjZW5lICR7c2NlbmVOdW19OiBcIiR7c2NlbmUubmFtZX1cIiAoSUQ6ICR7c2NlbmUuaWR9LCBEdXJhdGlvbjogJHtzY2VuZS5kdXJhdGlvbn0gZnJhbWVzIC8gJHtkdXJhdGlvblNlY31zKSR7aXNOZXdlc3QgPyAnIFtORVdFU1QvTEFTVCBBRERFRF0nIDogJyd9JHtpc0ZpcnN0ID8gJyBbRklSU1RdJyA6ICcnfWA7XG4gICAgICB9KS5qb2luKCdcXG4nKTtcbiAgICAgIFxuICAgICAgLy8gQWRkIGhlbHBmdWwgY29udGV4dCBhYm91dCByZWNlbnQgYWN0aW9uc1xuICAgICAgaWYgKHN0b3J5Ym9hcmRTb0Zhci5sZW5ndGggPiAwKSB7XG4gICAgICAgIHN0b3J5Ym9hcmRJbmZvICs9IGBcXG5cXG5JTVBPUlRBTlQ6IFdoZW4gdXNlciBzYXlzIFwiaXRcIiBvciBcInRoZSBzY2VuZVwiIHJpZ2h0IGFmdGVyIGFkZGluZyBjb250ZW50LCB0aGV5IHVzdWFsbHkgbWVhbiB0aGUgTkVXRVNUIHNjZW5lIChTY2VuZSAke3N0b3J5Ym9hcmRTb0Zhci5sZW5ndGh9KS5gO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoaW5wdXQudXNlckNvbnRleHQ/LnNjZW5lSWQpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBzdG9yeWJvYXJkU29GYXIuZmluZChzID0+IHMuaWQgPT09IGlucHV0LnVzZXJDb250ZXh0Py5zY2VuZUlkKTtcbiAgICAgICAgaWYgKHNlbGVjdGVkKSBzdG9yeWJvYXJkSW5mbyArPSBgXFxuVVNFUiBTRUxFQ1RFRDogXCIke3NlbGVjdGVkLm5hbWV9XCJgO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgaW1hZ2UgY29udGV4dFxuICAgIGxldCBpbWFnZUluZm8gPSBcIlwiO1xuICAgIGlmIChjb250ZXh0UGFja2V0LmltYWdlQ29udGV4dCAmJiBjb250ZXh0UGFja2V0LmltYWdlQ29udGV4dC5yZWNlbnRJbWFnZXNGcm9tQ2hhdCAmJiBjb250ZXh0UGFja2V0LmltYWdlQ29udGV4dC5yZWNlbnRJbWFnZXNGcm9tQ2hhdC5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBpbWFnZXMgPSBjb250ZXh0UGFja2V0LmltYWdlQ29udGV4dC5yZWNlbnRJbWFnZXNGcm9tQ2hhdDtcbiAgICAgIGltYWdlSW5mbyA9IGBcXG5JTUFHRVMgSU4gQ09OVkVSU0FUSU9OOmA7XG4gICAgICBpbWFnZXMuZm9yRWFjaCgoaW1nOiBhbnkpID0+IHtcbiAgICAgICAgaW1hZ2VJbmZvICs9IGBcXG4ke2ltZy5wb3NpdGlvbn0uIFwiJHtpbWcudXNlclByb21wdH1cIiBbJHtpbWcuaW1hZ2VVcmxzLmxlbmd0aH0gaW1hZ2UocyldYDtcbiAgICAgIH0pO1xuICAgICAgaW1hZ2VJbmZvICs9IGBcXG5cXG5XaGVuIHVzZXIgcmVmZXJlbmNlcyBpbWFnZXM6XG4tIFwidGhlIGltYWdlXCIgb3IgXCJ0aGlzIGltYWdlXCIg4oaSIG1vc3QgcmVjZW50IGltYWdlIChwb3NpdGlvbiAke2ltYWdlcy5sZW5ndGh9KVxuLSBcImZpcnN0L3NlY29uZC90aGlyZCBpbWFnZVwiIOKGkiBieSBwb3NpdGlvbiBudW1iZXJcbi0gXCJpbWFnZSAxLzIvM1wiIOKGkiBieSBwb3NpdGlvbiBudW1iZXJcbi0gXCJlYXJsaWVyIGltYWdlXCIg4oaSIHByZXZpb3VzIGltYWdlcyBpbiBjb252ZXJzYXRpb25cblxuTk9URTogQWxsIHRvb2xzIGFyZSBtdWx0aW1vZGFsLiBXaGVuIGltYWdlcyBhcmUgcmVmZXJlbmNlZCwgaW5jbHVkZSB0aGVtIGluIHRoZSB0b29sJ3MgaW1hZ2VVcmxzIHBhcmFtZXRlci5gO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiBjdXJyZW50IHByb21wdCBoYXMgaW1hZ2VzICBcbiAgICBjb25zdCBjdXJyZW50SW1hZ2VVcmxzID0gKGlucHV0LnVzZXJDb250ZXh0Py5pbWFnZVVybHMgYXMgc3RyaW5nW10pIHx8IFtdO1xuICAgIGlmIChjdXJyZW50SW1hZ2VVcmxzLmxlbmd0aCA+IDApIHtcbiAgICAgIGltYWdlSW5mbyArPSBgXFxuXFxuQ1VSUkVOVCBNRVNTQUdFOiBJbmNsdWRlcyAke2N1cnJlbnRJbWFnZVVybHMubGVuZ3RofSBpbWFnZShzKSB1cGxvYWRlZCB3aXRoIHRoaXMgcmVxdWVzdC5gO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgY29udmVyc2F0aW9uIGNvbnRleHQgd2l0aCByZWNlbnQgYWN0aW9uIGRldGVjdGlvblxuICAgIGxldCBjaGF0SW5mbyA9IFwiXCI7XG4gICAgaWYgKGNvbnRleHRQYWNrZXQuY29udmVyc2F0aW9uQ29udGV4dCAhPT0gJ05ldyBjb252ZXJzYXRpb24nKSB7XG4gICAgICBjaGF0SW5mbyA9IGBcXG5DT05WRVJTQVRJT046ICR7Y29udGV4dFBhY2tldC5jb252ZXJzYXRpb25Db250ZXh0fWA7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIGxhc3QgbWVzc2FnZSBpbmRpY2F0ZXMgd2UganVzdCBhZGRlZCBhIHNjZW5lXG4gICAgICBjb25zdCBsYXN0TWVzc2FnZXMgPSBjb250ZXh0UGFja2V0LnJlY2VudE1lc3NhZ2VzIHx8IFtdO1xuICAgICAgaWYgKGxhc3RNZXNzYWdlcy5sZW5ndGggPj0gMikge1xuICAgICAgICBjb25zdCBsYXN0QXNzaXN0YW50TXNnID0gWy4uLmxhc3RNZXNzYWdlc10ucmV2ZXJzZSgpLmZpbmQobSA9PiBtLnJvbGUgPT09ICdhc3Npc3RhbnQnKTtcbiAgICAgICAgaWYgKGxhc3RBc3Npc3RhbnRNc2cgJiYgKFxuICAgICAgICAgIGxhc3RBc3Npc3RhbnRNc2cuY29udGVudC5pbmNsdWRlcygnYWRkZWQnKSB8fCBcbiAgICAgICAgICBsYXN0QXNzaXN0YW50TXNnLmNvbnRlbnQuaW5jbHVkZXMoJ2NyZWF0ZWQnKSB8fFxuICAgICAgICAgIGxhc3RBc3Npc3RhbnRNc2cuY29udGVudC5pbmNsdWRlcygnSVxcJ3ZlIGFkZGVkJylcbiAgICAgICAgKSkge1xuICAgICAgICAgIGNoYXRJbmZvICs9IGBcXG5SRUNFTlQ6IEp1c3QgYWRkZWQgYSBuZXcgc2NlbmUgKGxpa2VseSBTY2VuZSAke3N0b3J5Ym9hcmRTb0Zhcj8ubGVuZ3RoIHx8ICdsYXRlc3QnfSlgO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHdlYiBhbmFseXNpcyBjb250ZXh0XG4gICAgbGV0IHdlYkluZm8gPSBcIlwiO1xuICAgIGlmIChjb250ZXh0UGFja2V0LndlYkNvbnRleHQpIHtcbiAgICAgIGNvbnN0IHdlYiA9IGNvbnRleHRQYWNrZXQud2ViQ29udGV4dDtcbiAgICAgIHdlYkluZm8gPSBgXFxuV0VCIEFOQUxZU0lTIENPTlRFWFQ6XG5XZWJzaXRlOiAke3dlYi5wYWdlRGF0YS50aXRsZX0gKCR7d2ViLm9yaWdpbmFsVXJsfSlcbkRlc2NyaXB0aW9uOiAke3dlYi5wYWdlRGF0YS5kZXNjcmlwdGlvbiB8fCAnTm8gZGVzY3JpcHRpb24nfVxuS2V5IEhlYWRpbmdzOiAke3dlYi5wYWdlRGF0YS5oZWFkaW5ncy5zbGljZSgwLCAzKS5qb2luKCcsICcpfVxuU2NyZWVuc2hvdHM6IERlc2t0b3AgKCR7d2ViLnNjcmVlbnNob3RVcmxzLmRlc2t0b3B9KSAmIE1vYmlsZSAoJHt3ZWIuc2NyZWVuc2hvdFVybHMubW9iaWxlfSlcbkFuYWx5emVkOiAke25ldyBEYXRlKHdlYi5hbmFseXplZEF0KS50b0xvY2FsZVN0cmluZygpfVxuXG5UaGUgQUkgaGFzIGFjY2VzcyB0byB2aXN1YWwgc2NyZWVuc2hvdHMgb2YgdGhpcyB3ZWJzaXRlIGFuZCBjYW4gcmVmZXJlbmNlIHRoZW0gZm9yIGJyYW5kIG1hdGNoaW5nLCBkZXNpZ24gaW5zcGlyYXRpb24sIGFuZCBzdHlsZSBjb25zaXN0ZW5jeS5gO1xuICAgIH1cblxuICAgIHJldHVybiBgVVNFUjogXCIke3Byb21wdH1cIlxuXG5TVE9SWUJPQVJEOlxuJHtzdG9yeWJvYXJkSW5mb30ke2ltYWdlSW5mb30ke2NoYXRJbmZvfSR7d2ViSW5mb31cblxuUmVzcG9uZCB3aXRoIEpTT04gb25seS5gO1xuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0SnNvbkZyb21SZXNwb25zZShjb250ZW50OiBzdHJpbmcpOiBhbnkge1xuICAgIGlmICghY29udGVudCB8fCB0eXBlb2YgY29udGVudCAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRW1wdHkgb3IgaW52YWxpZCByZXNwb25zZSBjb250ZW50Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgY2xlYW5lZCA9IGNvbnRlbnQudHJpbSgpO1xuXG4gICAgaWYgKGNsZWFuZWQuc3RhcnRzV2l0aCgnYGBgJykpIHtcbiAgICAgIGNvbnN0IGxpbmVzID0gY2xlYW5lZC5zcGxpdCgnXFxuJyk7XG4gICAgICBjb25zdCBzdGFydEluZGV4ID0gbGluZXMuZmluZEluZGV4KGxpbmUgPT4gbGluZS5pbmNsdWRlcygnYGBganNvbicpIHx8IGxpbmUgPT09ICdgYGAnKTtcbiAgICAgIGNvbnN0IGVuZEluZGV4ID0gbGluZXMuZmluZEluZGV4KChsaW5lLCBpbmRleCkgPT4gaW5kZXggPiBzdGFydEluZGV4ICYmIGxpbmUuaW5jbHVkZXMoJ2BgYCcpKTtcbiAgICAgIFxuICAgICAgaWYgKHN0YXJ0SW5kZXggIT09IC0xICYmIGVuZEluZGV4ICE9PSAtMSkge1xuICAgICAgICBjb25zdCBqc29uTGluZXMgPSBsaW5lcy5zbGljZShzdGFydEluZGV4ICsgMSwgZW5kSW5kZXgpO1xuICAgICAgICBjb25zdCBqc29uU3RyaW5nID0ganNvbkxpbmVzLmpvaW4oJ1xcbicpLnRyaW0oKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghanNvblN0cmluZykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRW1wdHkgSlNPTiBjb250ZW50IGluIG1hcmtkb3duIGJsb2NrJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25TdHJpbmcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBKU09OLnBhcnNlKGNsZWFuZWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBwcm9jZXNzQnJhaW5EZWNpc2lvbihwYXJzZWQ6IGFueSwgaW5wdXQ6IE9yY2hlc3RyYXRpb25JbnB1dCk6IFRvb2xTZWxlY3Rpb25SZXN1bHQge1xuICAgIC8vIENoZWNrIGZvciBtdWx0aS1zdGVwIHdvcmtmbG93XG4gICAgaWYgKHBhcnNlZC53b3JrZmxvdyAmJiBBcnJheS5pc0FycmF5KHBhcnNlZC53b3JrZmxvdykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHdvcmtmbG93OiBwYXJzZWQud29ya2Zsb3csXG4gICAgICAgIHJlYXNvbmluZzogcGFyc2VkLnJlYXNvbmluZyB8fCBcIk11bHRpLXN0ZXAgd29ya2Zsb3cgcGxhbm5lZFwiLFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIGNsYXJpZmljYXRpb24gcmVzcG9uc2VzXG4gICAgaWYgKHBhcnNlZC5uZWVkc0NsYXJpZmljYXRpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG5lZWRzQ2xhcmlmaWNhdGlvbjogdHJ1ZSxcbiAgICAgICAgY2xhcmlmaWNhdGlvblF1ZXN0aW9uOiBwYXJzZWQuY2xhcmlmaWNhdGlvblF1ZXN0aW9uLFxuICAgICAgICByZWFzb25pbmc6IHBhcnNlZC5yZWFzb25pbmdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gU2luZ2xlIHRvb2wgb3BlcmF0aW9uXG4gICAgY29uc3QgcmVzdWx0OiBUb29sU2VsZWN0aW9uUmVzdWx0ID0ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHRvb2xOYW1lOiBwYXJzZWQudG9vbE5hbWUsXG4gICAgICByZWFzb25pbmc6IHBhcnNlZC5yZWFzb25pbmcsXG4gICAgICB0YXJnZXRTY2VuZUlkOiBwYXJzZWQudGFyZ2V0U2NlbmVJZCxcbiAgICAgIHRhcmdldER1cmF0aW9uOiBwYXJzZWQudGFyZ2V0RHVyYXRpb24sIC8vIFBhc3MgdGhyb3VnaCB0YXJnZXREdXJhdGlvbiBmb3IgdHJpbVxuICAgICAgcmVmZXJlbmNlZFNjZW5lSWRzOiBwYXJzZWQucmVmZXJlbmNlZFNjZW5lSWRzLCAvLyBQYXNzIHRocm91Z2ggcmVmZXJlbmNlZCBzY2VuZXNcbiAgICAgIHVzZXJGZWVkYmFjazogcGFyc2VkLnVzZXJGZWVkYmFjayxcbiAgICB9O1xuXG4gICAgLy8gRXh0cmFjdCByZXF1ZXN0ZWQgZHVyYXRpb25cbiAgICBjb25zdCByZXF1ZXN0ZWREdXJhdGlvblNlY29uZHMgPSB0aGlzLmV4dHJhY3RSZXF1ZXN0ZWREdXJhdGlvbihpbnB1dC5wcm9tcHQpO1xuICAgIGlmIChyZXF1ZXN0ZWREdXJhdGlvblNlY29uZHMpIHtcbiAgICAgIHJlc3VsdC5yZXF1ZXN0ZWREdXJhdGlvblNlY29uZHMgPSByZXF1ZXN0ZWREdXJhdGlvblNlY29uZHM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdFJlcXVlc3RlZER1cmF0aW9uKHByb21wdDogc3RyaW5nKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBkdXJhdGlvbk1hdGNoID0gcHJvbXB0Lm1hdGNoKC9cXGIoXFxkKylcXHMqKD86c2Vjb25kcz98c2VjfHNlW29jbl17MSwzfWRzPylcXGIvaSk7XG4gICAgaWYgKGR1cmF0aW9uTWF0Y2ggJiYgZHVyYXRpb25NYXRjaFsxXSkge1xuICAgICAgY29uc3Qgc2Vjb25kcyA9IHBhcnNlSW50KGR1cmF0aW9uTWF0Y2hbMV0sIDEwKTtcbiAgICAgIGlmICghaXNOYU4oc2Vjb25kcykgJiYgc2Vjb25kcyA+IDApIHtcbiAgICAgICAgcmV0dXJuIHNlY29uZHM7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn0gIl0sIm5hbWVzIjpbIkFJQ2xpZW50U2VydmljZSIsImdldE1vZGVsIiwiU1lTVEVNX1BST01QVFMiLCJJbnRlbnRBbmFseXplciIsImFuYWx5emVJbnRlbnQiLCJpbnB1dCIsImNvbnRleHRQYWNrZXQiLCJjb25zb2xlIiwibG9nIiwicHJvbXB0Iiwic3Vic3RyaW5nIiwic3lzdGVtUHJvbXB0IiwiQlJBSU5fT1JDSEVTVFJBVE9SIiwiY29udGVudCIsInVzZXJQcm9tcHQiLCJidWlsZFVzZXJQcm9tcHQiLCJyZXNwb25zZSIsImdlbmVyYXRlUmVzcG9uc2UiLCJtb2RlbENvbmZpZyIsInJvbGUiLCJ1bmRlZmluZWQiLCJyZXNwb25zZUZvcm1hdCIsInR5cGUiLCJyYXdPdXRwdXQiLCJFcnJvciIsInBhcnNlZCIsImV4dHJhY3RKc29uRnJvbVJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc3VsdCIsInByb2Nlc3NCcmFpbkRlY2lzaW9uIiwidG9vbE5hbWUiLCJzdWNjZXNzIiwicmVhc29uaW5nIiwiZXJyb3IiLCJtZXNzYWdlIiwic3Rvcnlib2FyZFNvRmFyIiwic3Rvcnlib2FyZEluZm8iLCJsZW5ndGgiLCJtYXAiLCJzY2VuZSIsImkiLCJzY2VuZU51bSIsImlzTmV3ZXN0IiwiaXNGaXJzdCIsImR1cmF0aW9uU2VjIiwiZHVyYXRpb24iLCJ0b0ZpeGVkIiwibmFtZSIsImlkIiwiam9pbiIsInVzZXJDb250ZXh0Iiwic2NlbmVJZCIsInNlbGVjdGVkIiwiZmluZCIsInMiLCJpbWFnZUluZm8iLCJpbWFnZUNvbnRleHQiLCJyZWNlbnRJbWFnZXNGcm9tQ2hhdCIsImltYWdlcyIsImZvckVhY2giLCJpbWciLCJwb3NpdGlvbiIsImltYWdlVXJscyIsImN1cnJlbnRJbWFnZVVybHMiLCJjaGF0SW5mbyIsImNvbnZlcnNhdGlvbkNvbnRleHQiLCJsYXN0TWVzc2FnZXMiLCJyZWNlbnRNZXNzYWdlcyIsImxhc3RBc3Npc3RhbnRNc2ciLCJyZXZlcnNlIiwibSIsImluY2x1ZGVzIiwid2ViSW5mbyIsIndlYkNvbnRleHQiLCJ3ZWIiLCJwYWdlRGF0YSIsInRpdGxlIiwib3JpZ2luYWxVcmwiLCJkZXNjcmlwdGlvbiIsImhlYWRpbmdzIiwic2xpY2UiLCJzY3JlZW5zaG90VXJscyIsImRlc2t0b3AiLCJtb2JpbGUiLCJEYXRlIiwiYW5hbHl6ZWRBdCIsInRvTG9jYWxlU3RyaW5nIiwiY2xlYW5lZCIsInRyaW0iLCJzdGFydHNXaXRoIiwibGluZXMiLCJzcGxpdCIsInN0YXJ0SW5kZXgiLCJmaW5kSW5kZXgiLCJsaW5lIiwiZW5kSW5kZXgiLCJpbmRleCIsImpzb25MaW5lcyIsImpzb25TdHJpbmciLCJwYXJzZSIsIndvcmtmbG93IiwiQXJyYXkiLCJpc0FycmF5IiwibmVlZHNDbGFyaWZpY2F0aW9uIiwiY2xhcmlmaWNhdGlvblF1ZXN0aW9uIiwidGFyZ2V0U2NlbmVJZCIsInRhcmdldER1cmF0aW9uIiwicmVmZXJlbmNlZFNjZW5lSWRzIiwidXNlckZlZWRiYWNrIiwicmVxdWVzdGVkRHVyYXRpb25TZWNvbmRzIiwiZXh0cmFjdFJlcXVlc3RlZER1cmF0aW9uIiwiZHVyYXRpb25NYXRjaCIsIm1hdGNoIiwic2Vjb25kcyIsInBhcnNlSW50IiwiaXNOYU4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/brain/orchestrator_functions/intentAnalyzer.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/models.config.ts":
/*!*************************************!*\
  !*** ./src/config/models.config.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ACTIVE_MODEL_PACK: () => (/* binding */ ACTIVE_MODEL_PACK),\n/* harmony export */   MODEL_PACKS: () => (/* binding */ MODEL_PACKS),\n/* harmony export */   ModelConfigSchema: () => (/* binding */ ModelConfigSchema),\n/* harmony export */   ModelPackSchema: () => (/* binding */ ModelPackSchema),\n/* harmony export */   ModelProviderSchema: () => (/* binding */ ModelProviderSchema),\n/* harmony export */   getActiveModelPack: () => (/* binding */ getActiveModelPack),\n/* harmony export */   getClient: () => (/* binding */ getClient),\n/* harmony export */   getModel: () => (/* binding */ getModel),\n/* harmony export */   getModelManifest: () => (/* binding */ getModelManifest),\n/* harmony export */   getPackDescription: () => (/* binding */ getPackDescription),\n/* harmony export */   listAvailablePacks: () => (/* binding */ listAvailablePacks),\n/* harmony export */   logCurrentModelConfiguration: () => (/* binding */ logCurrentModelConfiguration),\n/* harmony export */   resolveModel: () => (/* binding */ resolveModel)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var openai_shims_node__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai/shims/node */ \"(rsc)/../../node_modules/openai/shims/node.mjs\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! openai */ \"(rsc)/../../node_modules/openai/index.mjs\");\n/* harmony import */ var _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @anthropic-ai/sdk */ \"(rsc)/../../node_modules/@anthropic-ai/sdk/index.mjs\");\n//src/config/models.config.ts\n\n// =============================================================================\n// RUNTIME VALIDATION SCHEMAS\n// =============================================================================\nconst ModelProviderSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n    'openai',\n    'anthropic'\n]);\nconst ModelConfigSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    provider: ModelProviderSchema,\n    model: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    temperature: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().gte(0).lte(2).optional(),\n    maxTokens: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive().optional(),\n    apiKey: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n});\n// Simplified schema for only the models we actually use\nconst ModelPackSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    name: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    description: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    models: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        // Core orchestration\n        brain: ModelConfigSchema,\n        // Code generation\n        codeGenerator: ModelConfigSchema,\n        editScene: ModelConfigSchema,\n        // Simple utilities\n        titleGenerator: ModelConfigSchema\n    })\n});\n// =============================================================================\n// MODEL PACKS (Only what we actually use)\n// =============================================================================\n//  OPTIMAL PACK: Best balance of speed, cost, and quality\nconst optimalPack = {\n    name: 'Optimal Pack',\n    description: 'Best balance of speed, cost, and quality',\n    models: {\n        brain: {\n            provider: 'openai',\n            model: 'gpt-4.1-mini',\n            temperature: 0.4\n        },\n        codeGenerator: {\n            provider: 'anthropic',\n            model: 'claude-sonnet-4-20250514',\n            temperature: 0.3,\n            maxTokens: 16000\n        },\n        editScene: {\n            provider: 'anthropic',\n            model: 'claude-sonnet-4-20250514',\n            temperature: 0.3,\n            maxTokens: 16000\n        },\n        titleGenerator: {\n            provider: 'openai',\n            model: 'gpt-4o-mini',\n            temperature: 0.5,\n            maxTokens: 400\n        }\n    }\n};\n//  ANTHROPIC PACK: All Claude models\nconst anthropicPack = {\n    name: 'Anthropic Pack',\n    description: 'Claude models only - excellent for code generation',\n    models: {\n        brain: {\n            provider: 'anthropic',\n            model: 'claude-sonnet-4-20250514',\n            temperature: 0.6\n        },\n        codeGenerator: {\n            provider: 'anthropic',\n            model: 'claude-sonnet-4-20250514',\n            temperature: 0.3,\n            maxTokens: 16000\n        },\n        editScene: {\n            provider: 'anthropic',\n            model: 'claude-sonnet-4-20250514',\n            temperature: 0.3,\n            maxTokens: 16000\n        },\n        titleGenerator: {\n            provider: 'anthropic',\n            model: 'claude-sonnet-4-20250514',\n            temperature: 0.5,\n            maxTokens: 100\n        }\n    }\n};\n//  OPENAI PACK: All OpenAI models\nconst openaiPack = {\n    name: 'OpenAI Pack',\n    description: 'OpenAI models only - GPT-4.1 for intelligence, GPT-4o-mini for speed',\n    models: {\n        brain: {\n            provider: 'openai',\n            model: 'gpt-4.1',\n            temperature: 0.6\n        },\n        codeGenerator: {\n            provider: 'openai',\n            model: 'gpt-4.1',\n            temperature: 0.3,\n            maxTokens: 16000\n        },\n        editScene: {\n            provider: 'openai',\n            model: 'gpt-4.1',\n            temperature: 0.3,\n            maxTokens: 16000\n        },\n        titleGenerator: {\n            provider: 'openai',\n            model: 'gpt-4o-mini',\n            temperature: 0.5,\n            maxTokens: 100\n        }\n    }\n};\n// Validate all packs at runtime\nconst MODEL_PACKS = {\n    'optimal-pack': ModelPackSchema.parse(optimalPack),\n    'anthropic-pack': ModelPackSchema.parse(anthropicPack),\n    'openai-pack': ModelPackSchema.parse(openaiPack)\n};\n// =============================================================================\n// ENVIRONMENT-DRIVEN ACTIVE PACK\n// =============================================================================\nconst ACTIVE_MODEL_PACK = process.env.MODEL_PACK ?? 'optimal-pack';\n// Get the currently active model configuration\nfunction getActiveModelPack() {\n    const pack = MODEL_PACKS[ACTIVE_MODEL_PACK];\n    if (!pack) {\n        throw new Error(`Model pack \"${ACTIVE_MODEL_PACK}\" not found. Available packs: ${Object.keys(MODEL_PACKS).join(', ')}`);\n    }\n    return pack;\n}\nfunction getModel(key) {\n    const model = getActiveModelPack().models[key];\n    if (!model) {\n        throw new Error(`Model \"${String(key)}\" missing in active pack \"${ACTIVE_MODEL_PACK}\"`);\n    }\n    return model;\n}\n// =============================================================================\n// PER-REQUEST OVERRIDE HOOK\n// =============================================================================\nfunction resolveModel(key, overrides) {\n    const base = getModel(key);\n    return {\n        ...base,\n        ...overrides\n    };\n}\n// =============================================================================\n// PROVIDER CLIENT REGISTRY\n// =============================================================================\n\n\n\nconst clientCache = new Map();\nfunction createClient(provider) {\n    switch(provider){\n        case 'openai':\n            return new openai__WEBPACK_IMPORTED_MODULE_3__[\"default\"]({\n                apiKey: process.env.OPENAI_API_KEY\n            });\n        case 'anthropic':\n            return new _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n                apiKey: process.env.ANTHROPIC_API_KEY\n            });\n        default:\n            throw new Error(`Unsupported provider: ${provider}`);\n    }\n}\nfunction getClient(provider) {\n    if (!clientCache.has(provider)) {\n        clientCache.set(provider, createClient(provider));\n    }\n    return clientCache.get(provider);\n}\n// =============================================================================\n// UTILITY FUNCTIONS\n// =============================================================================\nfunction listAvailablePacks() {\n    return Object.keys(MODEL_PACKS);\n}\nfunction getPackDescription(packName) {\n    const pack = MODEL_PACKS[packName];\n    return pack ? pack.description : 'Pack not found';\n}\n// =============================================================================\n// OBSERVABILITY & HEALTH CHECK\n// =============================================================================\nfunction getModelManifest() {\n    const pack = getActiveModelPack();\n    return {\n        environment: \"development\" || 0,\n        activePack: ACTIVE_MODEL_PACK,\n        packName: pack.name,\n        packDescription: pack.description,\n        models: {\n            brain: `${pack.models.brain.provider}/${pack.models.brain.model}`,\n            codeGenerator: `${pack.models.codeGenerator.provider}/${pack.models.codeGenerator.model}`,\n            editScene: `${pack.models.editScene.provider}/${pack.models.editScene.model}`,\n            titleGenerator: `${pack.models.titleGenerator.provider}/${pack.models.titleGenerator.model}`\n        },\n        availablePacks: listAvailablePacks()\n    };\n}\n// Development helper to log current configuration\nfunction logCurrentModelConfiguration() {\n    if (true) {\n        const manifest = getModelManifest();\n        console.log(' Model Management System');\n        console.log(' Active Pack:', manifest.activePack);\n        console.log(' Description:', manifest.packDescription);\n        console.log(' Models:', manifest.models);\n        console.log(' Environment:', manifest.environment);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxFQUFFK0IsS0FBS2YsTUFBTSxDQUFDRSxhQUFhLENBQUNqQixLQUFLLEVBQUU7WUFDekZrQixXQUFXLEdBQUdZLEtBQUtmLE1BQU0sQ0FBQ0csU0FBUyxDQUFDbkIsUUFBUSxDQUFDLENBQUMsRUFBRStCLEtBQUtmLE1BQU0sQ0FBQ0csU0FBUyxDQUFDbEIsS0FBSyxFQUFFO1lBQzdFbUIsZ0JBQWdCLEdBQUdXLEtBQUtmLE1BQU0sQ0FBQ0ksY0FBYyxDQUFDcEIsUUFBUSxDQUFDLENBQUMsRUFBRStCLEtBQUtmLE1BQU0sQ0FBQ0ksY0FBYyxDQUFDbkIsS0FBSyxFQUFFO1FBQzlGO1FBQ0EyRCxnQkFBZ0JQO0lBQ2xCO0FBQ0Y7QUFFQSxrREFBa0Q7QUFDM0MsU0FBU1E7SUFDZCxJQUFJbEMsSUFBc0MsRUFBRTtRQUMxQyxNQUFNbUMsV0FBV047UUFDakJPLFFBQVFDLEdBQUcsQ0FBQztRQUNaRCxRQUFRQyxHQUFHLENBQUMsbUJBQW1CRixTQUFTSixVQUFVO1FBQ2xESyxRQUFRQyxHQUFHLENBQUMsbUJBQW1CRixTQUFTSCxlQUFlO1FBQ3ZESSxRQUFRQyxHQUFHLENBQUMsY0FBY0YsU0FBUzlDLE1BQU07UUFDekMrQyxRQUFRQyxHQUFHLENBQUMsbUJBQW1CRixTQUFTTCxXQUFXO0lBQ3JEO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9jb25maWcvbW9kZWxzLmNvbmZpZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvL3NyYy9jb25maWcvbW9kZWxzLmNvbmZpZy50c1xuXG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJVTlRJTUUgVkFMSURBVElPTiBTQ0hFTUFTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY29uc3QgTW9kZWxQcm92aWRlclNjaGVtYSA9IHouZW51bShbJ29wZW5haScsICdhbnRocm9waWMnXSk7XG5cbmV4cG9ydCBjb25zdCBNb2RlbENvbmZpZ1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgcHJvdmlkZXI6IE1vZGVsUHJvdmlkZXJTY2hlbWEsXG4gIG1vZGVsOiB6LnN0cmluZygpLm1pbigxKSxcbiAgdGVtcGVyYXR1cmU6IHoubnVtYmVyKCkuZ3RlKDApLmx0ZSgyKS5vcHRpb25hbCgpLFxuICBtYXhUb2tlbnM6IHoubnVtYmVyKCkuaW50KCkucG9zaXRpdmUoKS5vcHRpb25hbCgpLFxuICBhcGlLZXk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG4vLyBTaW1wbGlmaWVkIHNjaGVtYSBmb3Igb25seSB0aGUgbW9kZWxzIHdlIGFjdHVhbGx5IHVzZVxuZXhwb3J0IGNvbnN0IE1vZGVsUGFja1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgbmFtZTogei5zdHJpbmcoKS5taW4oMSksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm1pbigxKSxcbiAgbW9kZWxzOiB6Lm9iamVjdCh7XG4gICAgLy8gQ29yZSBvcmNoZXN0cmF0aW9uXG4gICAgYnJhaW46IE1vZGVsQ29uZmlnU2NoZW1hLFxuICAgIFxuICAgIC8vIENvZGUgZ2VuZXJhdGlvblxuICAgIGNvZGVHZW5lcmF0b3I6IE1vZGVsQ29uZmlnU2NoZW1hLFxuICAgIGVkaXRTY2VuZTogTW9kZWxDb25maWdTY2hlbWEsXG4gICAgXG4gICAgLy8gU2ltcGxlIHV0aWxpdGllc1xuICAgIHRpdGxlR2VuZXJhdG9yOiBNb2RlbENvbmZpZ1NjaGVtYSxcbiAgfSksXG59KTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEUgREVGSU5JVElPTlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIE1vZGVsUHJvdmlkZXIgPSB6LmluZmVyPHR5cGVvZiBNb2RlbFByb3ZpZGVyU2NoZW1hPjtcbmV4cG9ydCB0eXBlIE1vZGVsQ29uZmlnID0gei5pbmZlcjx0eXBlb2YgTW9kZWxDb25maWdTY2hlbWE+O1xuZXhwb3J0IHR5cGUgTW9kZWxQYWNrID0gei5pbmZlcjx0eXBlb2YgTW9kZWxQYWNrU2NoZW1hPjtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PREVMIFBBQ0tTIChPbmx5IHdoYXQgd2UgYWN0dWFsbHkgdXNlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8g8J+OryBPUFRJTUFMIFBBQ0s6IEJlc3QgYmFsYW5jZSBvZiBzcGVlZCwgY29zdCwgYW5kIHF1YWxpdHlcbmNvbnN0IG9wdGltYWxQYWNrOiBNb2RlbFBhY2sgPSB7XG4gIG5hbWU6ICdPcHRpbWFsIFBhY2snLFxuICBkZXNjcmlwdGlvbjogJ0Jlc3QgYmFsYW5jZSBvZiBzcGVlZCwgY29zdCwgYW5kIHF1YWxpdHknLFxuICBtb2RlbHM6IHtcbiAgICBicmFpbjogeyBwcm92aWRlcjogJ29wZW5haScsIG1vZGVsOiAnZ3B0LTQuMS1taW5pJywgdGVtcGVyYXR1cmU6IDAuNCB9LFxuICAgIGNvZGVHZW5lcmF0b3I6IHsgcHJvdmlkZXI6ICdhbnRocm9waWMnLCBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIHRlbXBlcmF0dXJlOiAwLjMsIG1heFRva2VuczogMTYwMDAgfSxcbiAgICBlZGl0U2NlbmU6IHsgcHJvdmlkZXI6ICdhbnRocm9waWMnLCBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIHRlbXBlcmF0dXJlOiAwLjMsIG1heFRva2VuczogMTYwMDAgfSxcbiAgICB0aXRsZUdlbmVyYXRvcjogeyBwcm92aWRlcjogJ29wZW5haScsIG1vZGVsOiAnZ3B0LTRvLW1pbmknLCB0ZW1wZXJhdHVyZTogMC41LCBtYXhUb2tlbnM6IDQwMCB9XG4gIH1cbn07XG5cbi8vIPCfpJYgQU5USFJPUElDIFBBQ0s6IEFsbCBDbGF1ZGUgbW9kZWxzXG5jb25zdCBhbnRocm9waWNQYWNrOiBNb2RlbFBhY2sgPSB7XG4gIG5hbWU6ICdBbnRocm9waWMgUGFjaycsXG4gIGRlc2NyaXB0aW9uOiAnQ2xhdWRlIG1vZGVscyBvbmx5IC0gZXhjZWxsZW50IGZvciBjb2RlIGdlbmVyYXRpb24nLFxuICBtb2RlbHM6IHtcbiAgICBicmFpbjogeyBwcm92aWRlcjogJ2FudGhyb3BpYycsIG1vZGVsOiAnY2xhdWRlLXNvbm5ldC00LTIwMjUwNTE0JywgdGVtcGVyYXR1cmU6IDAuNiB9LFxuICAgIGNvZGVHZW5lcmF0b3I6IHsgcHJvdmlkZXI6ICdhbnRocm9waWMnLCBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIHRlbXBlcmF0dXJlOiAwLjMsIG1heFRva2VuczogMTYwMDAgfSxcbiAgICBlZGl0U2NlbmU6IHsgcHJvdmlkZXI6ICdhbnRocm9waWMnLCBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIHRlbXBlcmF0dXJlOiAwLjMsIG1heFRva2VuczogMTYwMDAgfSxcbiAgICB0aXRsZUdlbmVyYXRvcjogeyBwcm92aWRlcjogJ2FudGhyb3BpYycsIG1vZGVsOiAnY2xhdWRlLXNvbm5ldC00LTIwMjUwNTE0JywgdGVtcGVyYXR1cmU6IDAuNSwgbWF4VG9rZW5zOiAxMDAgfVxuICB9XG59O1xuXG4vLyDwn5qAIE9QRU5BSSBQQUNLOiBBbGwgT3BlbkFJIG1vZGVsc1xuY29uc3Qgb3BlbmFpUGFjazogTW9kZWxQYWNrID0ge1xuICBuYW1lOiAnT3BlbkFJIFBhY2snLFxuICBkZXNjcmlwdGlvbjogJ09wZW5BSSBtb2RlbHMgb25seSAtIEdQVC00LjEgZm9yIGludGVsbGlnZW5jZSwgR1BULTRvLW1pbmkgZm9yIHNwZWVkJyxcbiAgbW9kZWxzOiB7XG4gICAgYnJhaW46IHsgcHJvdmlkZXI6ICdvcGVuYWknLCBtb2RlbDogJ2dwdC00LjEnLCB0ZW1wZXJhdHVyZTogMC42IH0sXG4gICAgY29kZUdlbmVyYXRvcjogeyBwcm92aWRlcjogJ29wZW5haScsIG1vZGVsOiAnZ3B0LTQuMScsIHRlbXBlcmF0dXJlOiAwLjMsIG1heFRva2VuczogMTYwMDAgfSxcbiAgICBlZGl0U2NlbmU6IHsgcHJvdmlkZXI6ICdvcGVuYWknLCBtb2RlbDogJ2dwdC00LjEnLCB0ZW1wZXJhdHVyZTogMC4zLCBtYXhUb2tlbnM6IDE2MDAwIH0sXG4gICAgdGl0bGVHZW5lcmF0b3I6IHsgcHJvdmlkZXI6ICdvcGVuYWknLCBtb2RlbDogJ2dwdC00by1taW5pJywgdGVtcGVyYXR1cmU6IDAuNSwgbWF4VG9rZW5zOiAxMDAgfVxuICB9XG59O1xuXG4vLyBWYWxpZGF0ZSBhbGwgcGFja3MgYXQgcnVudGltZVxuZXhwb3J0IGNvbnN0IE1PREVMX1BBQ0tTOiBSZWNvcmQ8c3RyaW5nLCBNb2RlbFBhY2s+ID0ge1xuICAnb3B0aW1hbC1wYWNrJzogTW9kZWxQYWNrU2NoZW1hLnBhcnNlKG9wdGltYWxQYWNrKSxcbiAgJ2FudGhyb3BpYy1wYWNrJzogTW9kZWxQYWNrU2NoZW1hLnBhcnNlKGFudGhyb3BpY1BhY2spLFxuICAnb3BlbmFpLXBhY2snOiBNb2RlbFBhY2tTY2hlbWEucGFyc2Uob3BlbmFpUGFjayksXG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRU5WSVJPTk1FTlQtRFJJVkVOIEFDVElWRSBQQUNLXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY29uc3QgQUNUSVZFX01PREVMX1BBQ0sgPSBwcm9jZXNzLmVudi5NT0RFTF9QQUNLID8/ICdvcHRpbWFsLXBhY2snO1xuXG4vLyBHZXQgdGhlIGN1cnJlbnRseSBhY3RpdmUgbW9kZWwgY29uZmlndXJhdGlvblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFjdGl2ZU1vZGVsUGFjaygpOiBNb2RlbFBhY2sge1xuICBjb25zdCBwYWNrID0gTU9ERUxfUEFDS1NbQUNUSVZFX01PREVMX1BBQ0tdO1xuICBpZiAoIXBhY2spIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1vZGVsIHBhY2sgXCIke0FDVElWRV9NT0RFTF9QQUNLfVwiIG5vdCBmb3VuZC4gQXZhaWxhYmxlIHBhY2tzOiAke09iamVjdC5rZXlzKE1PREVMX1BBQ0tTKS5qb2luKCcsICcpfWApO1xuICB9XG4gIHJldHVybiBwYWNrO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gR0VORVJJQyBNT0RFTCBHRVRURVIgV0lUSCBUWVBFIFNBRkVUWVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgTW9kZWxLZXkgPSBrZXlvZiBNb2RlbFBhY2tbJ21vZGVscyddO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9kZWw8SyBleHRlbmRzIE1vZGVsS2V5PihrZXk6IEspOiBNb2RlbFBhY2tbJ21vZGVscyddW0tdIHtcbiAgY29uc3QgbW9kZWwgPSBnZXRBY3RpdmVNb2RlbFBhY2soKS5tb2RlbHNba2V5XTtcbiAgaWYgKCFtb2RlbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgTW9kZWwgXCIke1N0cmluZyhrZXkpfVwiIG1pc3NpbmcgaW4gYWN0aXZlIHBhY2sgXCIke0FDVElWRV9NT0RFTF9QQUNLfVwiYCk7XG4gIH1cbiAgcmV0dXJuIG1vZGVsO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUEVSLVJFUVVFU1QgT1ZFUlJJREUgSE9PS1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVNb2RlbChcbiAga2V5OiBNb2RlbEtleSxcbiAgb3ZlcnJpZGVzPzogUGFydGlhbDxNb2RlbENvbmZpZz4sXG4pOiBNb2RlbENvbmZpZyB7XG4gIGNvbnN0IGJhc2UgPSBnZXRNb2RlbChrZXkpIGFzIE1vZGVsQ29uZmlnO1xuICByZXR1cm4geyAuLi5iYXNlLCAuLi5vdmVycmlkZXMgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBST1ZJREVSIENMSUVOVCBSRUdJU1RSWVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IFwib3BlbmFpL3NoaW1zL25vZGVcIjtcbmltcG9ydCBPcGVuQUkgZnJvbSAnb3BlbmFpJztcbmltcG9ydCBBbnRocm9waWMgZnJvbSAnQGFudGhyb3BpYy1haS9zZGsnO1xuXG50eXBlIExMTUNsaWVudCA9IE9wZW5BSSB8IEFudGhyb3BpYztcblxuY29uc3QgY2xpZW50Q2FjaGUgPSBuZXcgTWFwPE1vZGVsUHJvdmlkZXIsIExMTUNsaWVudD4oKTtcblxuZnVuY3Rpb24gY3JlYXRlQ2xpZW50KHByb3ZpZGVyOiBNb2RlbFByb3ZpZGVyKTogTExNQ2xpZW50IHtcbiAgc3dpdGNoIChwcm92aWRlcikge1xuICAgIGNhc2UgJ29wZW5haSc6XG4gICAgICByZXR1cm4gbmV3IE9wZW5BSSh7XG4gICAgICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gICAgICB9KTtcbiAgICBjYXNlICdhbnRocm9waWMnOlxuICAgICAgcmV0dXJuIG5ldyBBbnRocm9waWMoe1xuICAgICAgICBhcGlLZXk6IHByb2Nlc3MuZW52LkFOVEhST1BJQ19BUElfS0VZLFxuICAgICAgfSk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgcHJvdmlkZXI6ICR7cHJvdmlkZXJ9YCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENsaWVudChwcm92aWRlcjogTW9kZWxQcm92aWRlcik6IExMTUNsaWVudCB7XG4gIGlmICghY2xpZW50Q2FjaGUuaGFzKHByb3ZpZGVyKSkge1xuICAgIGNsaWVudENhY2hlLnNldChwcm92aWRlciwgY3JlYXRlQ2xpZW50KHByb3ZpZGVyKSk7XG4gIH1cbiAgcmV0dXJuIGNsaWVudENhY2hlLmdldChwcm92aWRlcikhO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElUWSBGVU5DVElPTlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBsaXN0QXZhaWxhYmxlUGFja3MoKTogc3RyaW5nW10ge1xuICByZXR1cm4gT2JqZWN0LmtleXMoTU9ERUxfUEFDS1MpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFja0Rlc2NyaXB0aW9uKHBhY2tOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBwYWNrID0gTU9ERUxfUEFDS1NbcGFja05hbWVdO1xuICByZXR1cm4gcGFjayA/IHBhY2suZGVzY3JpcHRpb24gOiAnUGFjayBub3QgZm91bmQnO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gT0JTRVJWQUJJTElUWSAmIEhFQUxUSCBDSEVDS1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vZGVsTWFuaWZlc3QoKSB7XG4gIGNvbnN0IHBhY2sgPSBnZXRBY3RpdmVNb2RlbFBhY2soKTtcbiAgcmV0dXJuIHtcbiAgICBlbnZpcm9ubWVudDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgJ2RldmVsb3BtZW50JyxcbiAgICBhY3RpdmVQYWNrOiBBQ1RJVkVfTU9ERUxfUEFDSyxcbiAgICBwYWNrTmFtZTogcGFjay5uYW1lLFxuICAgIHBhY2tEZXNjcmlwdGlvbjogcGFjay5kZXNjcmlwdGlvbixcbiAgICBtb2RlbHM6IHtcbiAgICAgIGJyYWluOiBgJHtwYWNrLm1vZGVscy5icmFpbi5wcm92aWRlcn0vJHtwYWNrLm1vZGVscy5icmFpbi5tb2RlbH1gLFxuICAgICAgY29kZUdlbmVyYXRvcjogYCR7cGFjay5tb2RlbHMuY29kZUdlbmVyYXRvci5wcm92aWRlcn0vJHtwYWNrLm1vZGVscy5jb2RlR2VuZXJhdG9yLm1vZGVsfWAsXG4gICAgICBlZGl0U2NlbmU6IGAke3BhY2subW9kZWxzLmVkaXRTY2VuZS5wcm92aWRlcn0vJHtwYWNrLm1vZGVscy5lZGl0U2NlbmUubW9kZWx9YCxcbiAgICAgIHRpdGxlR2VuZXJhdG9yOiBgJHtwYWNrLm1vZGVscy50aXRsZUdlbmVyYXRvci5wcm92aWRlcn0vJHtwYWNrLm1vZGVscy50aXRsZUdlbmVyYXRvci5tb2RlbH1gLFxuICAgIH0sXG4gICAgYXZhaWxhYmxlUGFja3M6IGxpc3RBdmFpbGFibGVQYWNrcygpLFxuICB9O1xufVxuXG4vLyBEZXZlbG9wbWVudCBoZWxwZXIgdG8gbG9nIGN1cnJlbnQgY29uZmlndXJhdGlvblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ0N1cnJlbnRNb2RlbENvbmZpZ3VyYXRpb24oKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgIGNvbnN0IG1hbmlmZXN0ID0gZ2V0TW9kZWxNYW5pZmVzdCgpO1xuICAgIGNvbnNvbGUubG9nKCfwn6SWIE1vZGVsIE1hbmFnZW1lbnQgU3lzdGVtJyk7XG4gICAgY29uc29sZS5sb2coJ/Cfk6YgQWN0aXZlIFBhY2s6JywgbWFuaWZlc3QuYWN0aXZlUGFjayk7XG4gICAgY29uc29sZS5sb2coJ/Cfk50gRGVzY3JpcHRpb246JywgbWFuaWZlc3QucGFja0Rlc2NyaXB0aW9uKTtcbiAgICBjb25zb2xlLmxvZygn8J+UpyBNb2RlbHM6JywgbWFuaWZlc3QubW9kZWxzKTtcbiAgICBjb25zb2xlLmxvZygn8J+MjSBFbnZpcm9ubWVudDonLCBtYW5pZmVzdC5lbnZpcm9ubWVudCk7XG4gIH1cbn0iXSwibmFtZXMiOlsieiIsIk1vZGVsUHJvdmlkZXJTY2hlbWEiLCJlbnVtIiwiTW9kZWxDb25maWdTY2hlbWEiLCJvYmplY3QiLCJwcm92aWRlciIsIm1vZGVsIiwic3RyaW5nIiwibWluIiwidGVtcGVyYXR1cmUiLCJudW1iZXIiLCJndGUiLCJsdGUiLCJvcHRpb25hbCIsIm1heFRva2VucyIsImludCIsInBvc2l0aXZlIiwiYXBpS2V5IiwiTW9kZWxQYWNrU2NoZW1hIiwibmFtZSIsImRlc2NyaXB0aW9uIiwibW9kZWxzIiwiYnJhaW4iLCJjb2RlR2VuZXJhdG9yIiwiZWRpdFNjZW5lIiwidGl0bGVHZW5lcmF0b3IiLCJvcHRpbWFsUGFjayIsImFudGhyb3BpY1BhY2siLCJvcGVuYWlQYWNrIiwiTU9ERUxfUEFDS1MiLCJwYXJzZSIsIkFDVElWRV9NT0RFTF9QQUNLIiwicHJvY2VzcyIsImVudiIsIk1PREVMX1BBQ0siLCJnZXRBY3RpdmVNb2RlbFBhY2siLCJwYWNrIiwiRXJyb3IiLCJPYmplY3QiLCJrZXlzIiwiam9pbiIsImdldE1vZGVsIiwia2V5IiwiU3RyaW5nIiwicmVzb2x2ZU1vZGVsIiwib3ZlcnJpZGVzIiwiYmFzZSIsIk9wZW5BSSIsIkFudGhyb3BpYyIsImNsaWVudENhY2hlIiwiTWFwIiwiY3JlYXRlQ2xpZW50IiwiT1BFTkFJX0FQSV9LRVkiLCJBTlRIUk9QSUNfQVBJX0tFWSIsImdldENsaWVudCIsImhhcyIsInNldCIsImdldCIsImxpc3RBdmFpbGFibGVQYWNrcyIsImdldFBhY2tEZXNjcmlwdGlvbiIsInBhY2tOYW1lIiwiZ2V0TW9kZWxNYW5pZmVzdCIsImVudmlyb25tZW50IiwiYWN0aXZlUGFjayIsInBhY2tEZXNjcmlwdGlvbiIsImF2YWlsYWJsZVBhY2tzIiwibG9nQ3VycmVudE1vZGVsQ29uZmlndXJhdGlvbiIsIm1hbmlmZXN0IiwiY29uc29sZSIsImxvZyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/config/models.config.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/prompts.config.ts":
/*!**************************************!*\
  !*** ./src/config/prompts.config.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PROMPTS: () => (/* binding */ PROMPTS),\n/* harmony export */   SYSTEM_PROMPTS: () => (/* binding */ SYSTEM_PROMPTS),\n/* harmony export */   getParameterizedPrompt: () => (/* binding */ getParameterizedPrompt),\n/* harmony export */   getSystemPrompt: () => (/* binding */ getSystemPrompt)\n/* harmony export */ });\n/* harmony import */ var _prompts_active_brain_orchestrator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prompts/active/brain-orchestrator */ \"(rsc)/./src/config/prompts/active/brain-orchestrator.ts\");\n/* harmony import */ var _prompts_active_code_generator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./prompts/active/code-generator */ \"(rsc)/./src/config/prompts/active/code-generator.ts\");\n/* harmony import */ var _prompts_active_code_editor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./prompts/active/code-editor */ \"(rsc)/./src/config/prompts/active/code-editor.ts\");\n/* harmony import */ var _prompts_active_title_generator__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./prompts/active/title-generator */ \"(rsc)/./src/config/prompts/active/title-generator.ts\");\n/**\n * Modular Prompts Configuration\n * \n * This file imports all active prompts from individual files.\n * Deprecated prompts are kept in the deprecated folder for reference.\n * \n * Active Prompts (4 total):\n * 1. BRAIN_ORCHESTRATOR - Tool selection\n * 2. CODE_GENERATOR - Universal scene creation\n * 3. CODE_EDITOR - Universal scene editing\n * 4. TITLE_GENERATOR - Project titles\n */ \n\n\n\n// Export all prompts as a single object for backward compatibility\nconst SYSTEM_PROMPTS = {\n    // Core prompts\n    BRAIN_ORCHESTRATOR: _prompts_active_brain_orchestrator__WEBPACK_IMPORTED_MODULE_0__.BRAIN_ORCHESTRATOR,\n    CODE_GENERATOR: _prompts_active_code_generator__WEBPACK_IMPORTED_MODULE_1__.CODE_GENERATOR,\n    CODE_EDITOR: _prompts_active_code_editor__WEBPACK_IMPORTED_MODULE_2__.CODE_EDITOR,\n    TITLE_GENERATOR: _prompts_active_title_generator__WEBPACK_IMPORTED_MODULE_3__.TITLE_GENERATOR\n};\n// Helper to get system prompt with proper typing\nfunction getSystemPrompt(key) {\n    const prompt = SYSTEM_PROMPTS[key];\n    if (!prompt) {\n        console.warn(`Prompt not found: ${key}`);\n        return '';\n    }\n    return prompt.content;\n}\n// Helper to get parameterized prompt (replaces placeholders)\nfunction getParameterizedPrompt(key, params) {\n    const prompt = SYSTEM_PROMPTS[key];\n    if (!prompt) {\n        console.warn(`Prompt not found: ${key}`);\n        return {\n            role: 'system',\n            content: ''\n        };\n    }\n    let content = prompt.content;\n    // Replace all placeholders\n    Object.entries(params).forEach(([key, value])=>{\n        content = content.replace(new RegExp(`{{${key}}}`, 'g'), value);\n    });\n    return {\n        role: prompt.role,\n        content\n    };\n}\n// Re-export the main content for direct access\nconst PROMPTS = {\n    brainOrchestrator: _prompts_active_brain_orchestrator__WEBPACK_IMPORTED_MODULE_0__.BRAIN_ORCHESTRATOR.content,\n    codeGenerator: _prompts_active_code_generator__WEBPACK_IMPORTED_MODULE_1__.CODE_GENERATOR.content,\n    codeEditor: _prompts_active_code_editor__WEBPACK_IMPORTED_MODULE_2__.CODE_EDITOR.content,\n    titleGenerator: _prompts_active_title_generator__WEBPACK_IMPORTED_MODULE_3__.TITLE_GENERATOR.content\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29uZmlnL3Byb21wdHMuY29uZmlnLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0NBV0MsR0FFd0U7QUFDUjtBQUNOO0FBQ1E7QUFFbkUsbUVBQW1FO0FBQzVELE1BQU1JLGlCQUFpQjtJQUM1QixlQUFlO0lBQ2ZKLGtCQUFrQkEsb0ZBQUFBO0lBQ2xCQyxjQUFjQSw0RUFBQUE7SUFDZEMsV0FBV0Esc0VBQUFBO0lBQ1hDLGVBQWVBLDhFQUFBQTtBQUVqQixFQUFXO0FBS1gsaURBQWlEO0FBQzFDLFNBQVNFLGdCQUFnQkMsR0FBb0I7SUFDbEQsTUFBTUMsU0FBU0gsY0FBYyxDQUFDRSxJQUFJO0lBQ2xDLElBQUksQ0FBQ0MsUUFBUTtRQUNYQyxRQUFRQyxJQUFJLENBQUMsQ0FBQyxrQkFBa0IsRUFBRUgsS0FBSztRQUN2QyxPQUFPO0lBQ1Q7SUFDQSxPQUFPQyxPQUFPRyxPQUFPO0FBQ3ZCO0FBRUEsNkRBQTZEO0FBQ3RELFNBQVNDLHVCQUNkTCxHQUFvQixFQUNwQk0sTUFBOEI7SUFFOUIsTUFBTUwsU0FBU0gsY0FBYyxDQUFDRSxJQUFJO0lBQ2xDLElBQUksQ0FBQ0MsUUFBUTtRQUNYQyxRQUFRQyxJQUFJLENBQUMsQ0FBQyxrQkFBa0IsRUFBRUgsS0FBSztRQUN2QyxPQUFPO1lBQUVPLE1BQU07WUFBVUgsU0FBUztRQUFHO0lBQ3ZDO0lBRUEsSUFBSUEsVUFBVUgsT0FBT0csT0FBTztJQUU1QiwyQkFBMkI7SUFDM0JJLE9BQU9DLE9BQU8sQ0FBQ0gsUUFBUUksT0FBTyxDQUFDLENBQUMsQ0FBQ1YsS0FBS1csTUFBTTtRQUMxQ1AsVUFBVUEsUUFBUVEsT0FBTyxDQUFDLElBQUlDLE9BQU8sQ0FBQyxFQUFFLEVBQUViLElBQUksRUFBRSxDQUFDLEVBQUUsTUFBTVc7SUFDM0Q7SUFFQSxPQUFPO1FBQ0xKLE1BQU1OLE9BQU9NLElBQUk7UUFDakJIO0lBQ0Y7QUFDRjtBQUVBLCtDQUErQztBQUN4QyxNQUFNVSxVQUFVO0lBQ3JCQyxtQkFBbUJyQixrRkFBa0JBLENBQUNVLE9BQU87SUFDN0NZLGVBQWVyQiwwRUFBY0EsQ0FBQ1MsT0FBTztJQUNyQ2EsWUFBWXJCLG9FQUFXQSxDQUFDUSxPQUFPO0lBQy9CYyxnQkFBZ0JyQiw0RUFBZUEsQ0FBQ08sT0FBTztBQUN6QyxFQUFXIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvY29uZmlnL3Byb21wdHMuY29uZmlnLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9kdWxhciBQcm9tcHRzIENvbmZpZ3VyYXRpb25cbiAqIFxuICogVGhpcyBmaWxlIGltcG9ydHMgYWxsIGFjdGl2ZSBwcm9tcHRzIGZyb20gaW5kaXZpZHVhbCBmaWxlcy5cbiAqIERlcHJlY2F0ZWQgcHJvbXB0cyBhcmUga2VwdCBpbiB0aGUgZGVwcmVjYXRlZCBmb2xkZXIgZm9yIHJlZmVyZW5jZS5cbiAqIFxuICogQWN0aXZlIFByb21wdHMgKDQgdG90YWwpOlxuICogMS4gQlJBSU5fT1JDSEVTVFJBVE9SIC0gVG9vbCBzZWxlY3Rpb25cbiAqIDIuIENPREVfR0VORVJBVE9SIC0gVW5pdmVyc2FsIHNjZW5lIGNyZWF0aW9uXG4gKiAzLiBDT0RFX0VESVRPUiAtIFVuaXZlcnNhbCBzY2VuZSBlZGl0aW5nXG4gKiA0LiBUSVRMRV9HRU5FUkFUT1IgLSBQcm9qZWN0IHRpdGxlc1xuICovXG5cbmltcG9ydCB7IEJSQUlOX09SQ0hFU1RSQVRPUiB9IGZyb20gJy4vcHJvbXB0cy9hY3RpdmUvYnJhaW4tb3JjaGVzdHJhdG9yJztcbmltcG9ydCB7IENPREVfR0VORVJBVE9SIH0gZnJvbSAnLi9wcm9tcHRzL2FjdGl2ZS9jb2RlLWdlbmVyYXRvcic7XG5pbXBvcnQgeyBDT0RFX0VESVRPUiB9IGZyb20gJy4vcHJvbXB0cy9hY3RpdmUvY29kZS1lZGl0b3InO1xuaW1wb3J0IHsgVElUTEVfR0VORVJBVE9SIH0gZnJvbSAnLi9wcm9tcHRzL2FjdGl2ZS90aXRsZS1nZW5lcmF0b3InO1xuXG4vLyBFeHBvcnQgYWxsIHByb21wdHMgYXMgYSBzaW5nbGUgb2JqZWN0IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5leHBvcnQgY29uc3QgU1lTVEVNX1BST01QVFMgPSB7XG4gIC8vIENvcmUgcHJvbXB0c1xuICBCUkFJTl9PUkNIRVNUUkFUT1IsXG4gIENPREVfR0VORVJBVE9SLFxuICBDT0RFX0VESVRPUixcbiAgVElUTEVfR0VORVJBVE9SLFxuICBcbn0gYXMgY29uc3Q7XG5cbi8vIFR5cGUgZm9yIHByb21wdCBrZXlzXG5leHBvcnQgdHlwZSBTeXN0ZW1Qcm9tcHRLZXkgPSBrZXlvZiB0eXBlb2YgU1lTVEVNX1BST01QVFM7XG5cbi8vIEhlbHBlciB0byBnZXQgc3lzdGVtIHByb21wdCB3aXRoIHByb3BlciB0eXBpbmdcbmV4cG9ydCBmdW5jdGlvbiBnZXRTeXN0ZW1Qcm9tcHQoa2V5OiBTeXN0ZW1Qcm9tcHRLZXkpOiBzdHJpbmcge1xuICBjb25zdCBwcm9tcHQgPSBTWVNURU1fUFJPTVBUU1trZXldO1xuICBpZiAoIXByb21wdCkge1xuICAgIGNvbnNvbGUud2FybihgUHJvbXB0IG5vdCBmb3VuZDogJHtrZXl9YCk7XG4gICAgcmV0dXJuICcnO1xuICB9XG4gIHJldHVybiBwcm9tcHQuY29udGVudDtcbn1cblxuLy8gSGVscGVyIHRvIGdldCBwYXJhbWV0ZXJpemVkIHByb21wdCAocmVwbGFjZXMgcGxhY2Vob2xkZXJzKVxuZXhwb3J0IGZ1bmN0aW9uIGdldFBhcmFtZXRlcml6ZWRQcm9tcHQoXG4gIGtleTogU3lzdGVtUHJvbXB0S2V5LFxuICBwYXJhbXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbik6IHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN0cmluZyB9IHtcbiAgY29uc3QgcHJvbXB0ID0gU1lTVEVNX1BST01QVFNba2V5XTtcbiAgaWYgKCFwcm9tcHQpIHtcbiAgICBjb25zb2xlLndhcm4oYFByb21wdCBub3QgZm91bmQ6ICR7a2V5fWApO1xuICAgIHJldHVybiB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiAnJyB9O1xuICB9XG4gIFxuICBsZXQgY29udGVudCA9IHByb21wdC5jb250ZW50O1xuICBcbiAgLy8gUmVwbGFjZSBhbGwgcGxhY2Vob2xkZXJzXG4gIE9iamVjdC5lbnRyaWVzKHBhcmFtcykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZShuZXcgUmVnRXhwKGB7eyR7a2V5fX19YCwgJ2cnKSwgdmFsdWUpO1xuICB9KTtcbiAgXG4gIHJldHVybiB7XG4gICAgcm9sZTogcHJvbXB0LnJvbGUsXG4gICAgY29udGVudFxuICB9O1xufVxuXG4vLyBSZS1leHBvcnQgdGhlIG1haW4gY29udGVudCBmb3IgZGlyZWN0IGFjY2Vzc1xuZXhwb3J0IGNvbnN0IFBST01QVFMgPSB7XG4gIGJyYWluT3JjaGVzdHJhdG9yOiBCUkFJTl9PUkNIRVNUUkFUT1IuY29udGVudCxcbiAgY29kZUdlbmVyYXRvcjogQ09ERV9HRU5FUkFUT1IuY29udGVudCxcbiAgY29kZUVkaXRvcjogQ09ERV9FRElUT1IuY29udGVudCxcbiAgdGl0bGVHZW5lcmF0b3I6IFRJVExFX0dFTkVSQVRPUi5jb250ZW50LFxufSBhcyBjb25zdDsiXSwibmFtZXMiOlsiQlJBSU5fT1JDSEVTVFJBVE9SIiwiQ09ERV9HRU5FUkFUT1IiLCJDT0RFX0VESVRPUiIsIlRJVExFX0dFTkVSQVRPUiIsIlNZU1RFTV9QUk9NUFRTIiwiZ2V0U3lzdGVtUHJvbXB0Iiwia2V5IiwicHJvbXB0IiwiY29uc29sZSIsIndhcm4iLCJjb250ZW50IiwiZ2V0UGFyYW1ldGVyaXplZFByb21wdCIsInBhcmFtcyIsInJvbGUiLCJPYmplY3QiLCJlbnRyaWVzIiwiZm9yRWFjaCIsInZhbHVlIiwicmVwbGFjZSIsIlJlZ0V4cCIsIlBST01QVFMiLCJicmFpbk9yY2hlc3RyYXRvciIsImNvZGVHZW5lcmF0b3IiLCJjb2RlRWRpdG9yIiwidGl0bGVHZW5lcmF0b3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/config/prompts.config.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/prompts/active/brain-orchestrator.ts":
/*!*********************************************************!*\
  !*** ./src/config/prompts/active/brain-orchestrator.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BRAIN_ORCHESTRATOR: () => (/* binding */ BRAIN_ORCHESTRATOR)\n/* harmony export */ });\n/**\n * Brain Orchestrator Prompt\n * Used by: src/brain/orchestrator_functions/intentAnalyzer.ts\n * Purpose: Analyzes user intent and selects the appropriate tool\n */ const BRAIN_ORCHESTRATOR = {\n    role: 'system',\n    content: `You are the Brain Orchestrator for Bazaar-Vid, responsible for understanding user intent and selecting the appropriate tool.\n\nAVAILABLE TOOLS:\n1. addScene - Create a new scene from scratch or from images\n2. editScene - Modify an existing scene (animations, content, styling)\n3. deleteScene - Remove a scene\n4. trimScene - Fast duration adjustment (cut/extend without changing animations)\n\nDECISION PROCESS:\n1. Analyze the user's request carefully\n2. Determine if they want to create, modify, delete, or adjust duration\n3. For edits/trims, identify which scene they're referring to:\n   - \"it\", \"the scene\", \"that\" right after discussing a scene  that specific scene\n   - \"the animation\", \"make it\" in context of recent work  the NEWEST scene\n   - No specific reference but follows an ADD  probably wants to edit the scene just added\n   - Scene numbers: \"scene 1\", \"scene 2\"  by position in timeline\n   - \"first scene\", \"last scene\", \"newest scene\"  by position\n4. Consider any images provided in the conversation\n\nDURATION CHANGES - CHOOSE WISELY:\n- Use \"trimScene\" for: \"cut last X seconds\", \"remove X seconds\", \"make it X seconds long\", \"make scene X, Y seconds\"\n   This simply cuts or extends the scene duration without modifying animations (PREFERRED - faster)\n- Use \"editScene\" for: \"speed up\", \"slow down\", \"compress animations to X seconds\", \"fit animations into X seconds\"\n   This requires adjusting animation timings to fit the new duration (slower)\n\nRESPONSE FORMAT (JSON):\n{\n  \"toolName\": \"addScene\" | \"editScene\" | \"deleteScene\" | \"trimScene\",\n  \"reasoning\": \"Clear explanation of why this tool was chosen\",\n  \"targetSceneId\": \"scene-id-if-editing-deleting-or-trimming\",\n  \"targetDuration\": 120, // FOR TRIM ONLY: Calculate exact frame count (e.g., \"cut 1 second\" from 150 frames = 120)\n  \"referencedSceneIds\": [\"scene-1-id\", \"scene-2-id\"], // When user mentions other scenes for style/color matching\n  \"userFeedback\": \"Brief, friendly message about what you're doing\",\n  \"needsClarification\": false,\n  \"clarificationQuestion\": \"Optional: Ask user to clarify if ambiguous\"\n}\n\nWHEN TO SET referencedSceneIds:\n- User says \"like scene X\", \"match scene X\", \"same as scene X\", \"similar to scene X\"\n- User mentions colors/styles from specific scenes: \"use the blue from scene 1\"\n- User says \"use the background/animation/style from scene X\"\n- User references multiple scenes: \"combine scene 1's colors with scene 2's animations\"\n- DO NOT set for general edits without scene references\n\nCRITICAL: If you need clarification, you MUST set:\n- \"needsClarification\": true\n- \"clarificationQuestion\": \"Your question here\"\n- \"toolName\": null (not undefined)\n\nOtherwise, you MUST provide a valid toolName.\n\nTRIM CALCULATION EXAMPLES:\n- User: \"cut the last second\" (scene is 150 frames)  targetDuration: 120\n- User: \"make it 3 seconds\"  targetDuration: 90 (3 seconds  30fps)\n- User: \"add 2 seconds\" (scene is 90 frames)  targetDuration: 150\n- User: \"cut in half\" (scene is 180 frames)  targetDuration: 90\n\nCLARIFICATION EXAMPLES:\n- \"make scene 1 3 seconds\"  trimScene with targetDuration: 90\n- \"cut last 2 seconds from scene 3\"  trimScene with targetDuration calculated\n- \"compress scene 2 animations to 5 seconds\"  editScene (animation timing change)\n\nIMPORTANT:\n- Be decisive when intent is clear\n- Ask for clarification only when truly ambiguous\n- For trim operations, you MUST provide targetSceneId\n- Keep reasoning concise but clear`\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29uZmlnL3Byb21wdHMvYWN0aXZlL2JyYWluLW9yY2hlc3RyYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7Q0FJQyxHQUVNLE1BQU1BLHFCQUFxQjtJQUNoQ0MsTUFBTTtJQUNOQyxTQUFTLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztrQ0FrRXNCLENBQUM7QUFDbkMsRUFBRSIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2NvbmZpZy9wcm9tcHRzL2FjdGl2ZS9icmFpbi1vcmNoZXN0cmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBCcmFpbiBPcmNoZXN0cmF0b3IgUHJvbXB0XG4gKiBVc2VkIGJ5OiBzcmMvYnJhaW4vb3JjaGVzdHJhdG9yX2Z1bmN0aW9ucy9pbnRlbnRBbmFseXplci50c1xuICogUHVycG9zZTogQW5hbHl6ZXMgdXNlciBpbnRlbnQgYW5kIHNlbGVjdHMgdGhlIGFwcHJvcHJpYXRlIHRvb2xcbiAqL1xuXG5leHBvcnQgY29uc3QgQlJBSU5fT1JDSEVTVFJBVE9SID0ge1xuICByb2xlOiAnc3lzdGVtJyBhcyBjb25zdCxcbiAgY29udGVudDogYFlvdSBhcmUgdGhlIEJyYWluIE9yY2hlc3RyYXRvciBmb3IgQmF6YWFyLVZpZCwgcmVzcG9uc2libGUgZm9yIHVuZGVyc3RhbmRpbmcgdXNlciBpbnRlbnQgYW5kIHNlbGVjdGluZyB0aGUgYXBwcm9wcmlhdGUgdG9vbC5cblxuQVZBSUxBQkxFIFRPT0xTOlxuMS4gYWRkU2NlbmUgLSBDcmVhdGUgYSBuZXcgc2NlbmUgZnJvbSBzY3JhdGNoIG9yIGZyb20gaW1hZ2VzXG4yLiBlZGl0U2NlbmUgLSBNb2RpZnkgYW4gZXhpc3Rpbmcgc2NlbmUgKGFuaW1hdGlvbnMsIGNvbnRlbnQsIHN0eWxpbmcpXG4zLiBkZWxldGVTY2VuZSAtIFJlbW92ZSBhIHNjZW5lXG40LiB0cmltU2NlbmUgLSBGYXN0IGR1cmF0aW9uIGFkanVzdG1lbnQgKGN1dC9leHRlbmQgd2l0aG91dCBjaGFuZ2luZyBhbmltYXRpb25zKVxuXG5ERUNJU0lPTiBQUk9DRVNTOlxuMS4gQW5hbHl6ZSB0aGUgdXNlcidzIHJlcXVlc3QgY2FyZWZ1bGx5XG4yLiBEZXRlcm1pbmUgaWYgdGhleSB3YW50IHRvIGNyZWF0ZSwgbW9kaWZ5LCBkZWxldGUsIG9yIGFkanVzdCBkdXJhdGlvblxuMy4gRm9yIGVkaXRzL3RyaW1zLCBpZGVudGlmeSB3aGljaCBzY2VuZSB0aGV5J3JlIHJlZmVycmluZyB0bzpcbiAgIC0gXCJpdFwiLCBcInRoZSBzY2VuZVwiLCBcInRoYXRcIiByaWdodCBhZnRlciBkaXNjdXNzaW5nIGEgc2NlbmUg4oaSIHRoYXQgc3BlY2lmaWMgc2NlbmVcbiAgIC0gXCJ0aGUgYW5pbWF0aW9uXCIsIFwibWFrZSBpdFwiIGluIGNvbnRleHQgb2YgcmVjZW50IHdvcmsg4oaSIHRoZSBORVdFU1Qgc2NlbmVcbiAgIC0gTm8gc3BlY2lmaWMgcmVmZXJlbmNlIGJ1dCBmb2xsb3dzIGFuIEFERCDihpIgcHJvYmFibHkgd2FudHMgdG8gZWRpdCB0aGUgc2NlbmUganVzdCBhZGRlZFxuICAgLSBTY2VuZSBudW1iZXJzOiBcInNjZW5lIDFcIiwgXCJzY2VuZSAyXCIg4oaSIGJ5IHBvc2l0aW9uIGluIHRpbWVsaW5lXG4gICAtIFwiZmlyc3Qgc2NlbmVcIiwgXCJsYXN0IHNjZW5lXCIsIFwibmV3ZXN0IHNjZW5lXCIg4oaSIGJ5IHBvc2l0aW9uXG40LiBDb25zaWRlciBhbnkgaW1hZ2VzIHByb3ZpZGVkIGluIHRoZSBjb252ZXJzYXRpb25cblxuRFVSQVRJT04gQ0hBTkdFUyAtIENIT09TRSBXSVNFTFk6XG4tIFVzZSBcInRyaW1TY2VuZVwiIGZvcjogXCJjdXQgbGFzdCBYIHNlY29uZHNcIiwgXCJyZW1vdmUgWCBzZWNvbmRzXCIsIFwibWFrZSBpdCBYIHNlY29uZHMgbG9uZ1wiLCBcIm1ha2Ugc2NlbmUgWCwgWSBzZWNvbmRzXCJcbiAg4oaSIFRoaXMgc2ltcGx5IGN1dHMgb3IgZXh0ZW5kcyB0aGUgc2NlbmUgZHVyYXRpb24gd2l0aG91dCBtb2RpZnlpbmcgYW5pbWF0aW9ucyAoUFJFRkVSUkVEIC0gZmFzdGVyKVxuLSBVc2UgXCJlZGl0U2NlbmVcIiBmb3I6IFwic3BlZWQgdXBcIiwgXCJzbG93IGRvd25cIiwgXCJjb21wcmVzcyBhbmltYXRpb25zIHRvIFggc2Vjb25kc1wiLCBcImZpdCBhbmltYXRpb25zIGludG8gWCBzZWNvbmRzXCJcbiAg4oaSIFRoaXMgcmVxdWlyZXMgYWRqdXN0aW5nIGFuaW1hdGlvbiB0aW1pbmdzIHRvIGZpdCB0aGUgbmV3IGR1cmF0aW9uIChzbG93ZXIpXG5cblJFU1BPTlNFIEZPUk1BVCAoSlNPTik6XG57XG4gIFwidG9vbE5hbWVcIjogXCJhZGRTY2VuZVwiIHwgXCJlZGl0U2NlbmVcIiB8IFwiZGVsZXRlU2NlbmVcIiB8IFwidHJpbVNjZW5lXCIsXG4gIFwicmVhc29uaW5nXCI6IFwiQ2xlYXIgZXhwbGFuYXRpb24gb2Ygd2h5IHRoaXMgdG9vbCB3YXMgY2hvc2VuXCIsXG4gIFwidGFyZ2V0U2NlbmVJZFwiOiBcInNjZW5lLWlkLWlmLWVkaXRpbmctZGVsZXRpbmctb3ItdHJpbW1pbmdcIixcbiAgXCJ0YXJnZXREdXJhdGlvblwiOiAxMjAsIC8vIEZPUiBUUklNIE9OTFk6IENhbGN1bGF0ZSBleGFjdCBmcmFtZSBjb3VudCAoZS5nLiwgXCJjdXQgMSBzZWNvbmRcIiBmcm9tIDE1MCBmcmFtZXMgPSAxMjApXG4gIFwicmVmZXJlbmNlZFNjZW5lSWRzXCI6IFtcInNjZW5lLTEtaWRcIiwgXCJzY2VuZS0yLWlkXCJdLCAvLyBXaGVuIHVzZXIgbWVudGlvbnMgb3RoZXIgc2NlbmVzIGZvciBzdHlsZS9jb2xvciBtYXRjaGluZ1xuICBcInVzZXJGZWVkYmFja1wiOiBcIkJyaWVmLCBmcmllbmRseSBtZXNzYWdlIGFib3V0IHdoYXQgeW91J3JlIGRvaW5nXCIsXG4gIFwibmVlZHNDbGFyaWZpY2F0aW9uXCI6IGZhbHNlLFxuICBcImNsYXJpZmljYXRpb25RdWVzdGlvblwiOiBcIk9wdGlvbmFsOiBBc2sgdXNlciB0byBjbGFyaWZ5IGlmIGFtYmlndW91c1wiXG59XG5cbldIRU4gVE8gU0VUIHJlZmVyZW5jZWRTY2VuZUlkczpcbi0gVXNlciBzYXlzIFwibGlrZSBzY2VuZSBYXCIsIFwibWF0Y2ggc2NlbmUgWFwiLCBcInNhbWUgYXMgc2NlbmUgWFwiLCBcInNpbWlsYXIgdG8gc2NlbmUgWFwiXG4tIFVzZXIgbWVudGlvbnMgY29sb3JzL3N0eWxlcyBmcm9tIHNwZWNpZmljIHNjZW5lczogXCJ1c2UgdGhlIGJsdWUgZnJvbSBzY2VuZSAxXCJcbi0gVXNlciBzYXlzIFwidXNlIHRoZSBiYWNrZ3JvdW5kL2FuaW1hdGlvbi9zdHlsZSBmcm9tIHNjZW5lIFhcIlxuLSBVc2VyIHJlZmVyZW5jZXMgbXVsdGlwbGUgc2NlbmVzOiBcImNvbWJpbmUgc2NlbmUgMSdzIGNvbG9ycyB3aXRoIHNjZW5lIDIncyBhbmltYXRpb25zXCJcbi0gRE8gTk9UIHNldCBmb3IgZ2VuZXJhbCBlZGl0cyB3aXRob3V0IHNjZW5lIHJlZmVyZW5jZXNcblxuQ1JJVElDQUw6IElmIHlvdSBuZWVkIGNsYXJpZmljYXRpb24sIHlvdSBNVVNUIHNldDpcbi0gXCJuZWVkc0NsYXJpZmljYXRpb25cIjogdHJ1ZVxuLSBcImNsYXJpZmljYXRpb25RdWVzdGlvblwiOiBcIllvdXIgcXVlc3Rpb24gaGVyZVwiXG4tIFwidG9vbE5hbWVcIjogbnVsbCAobm90IHVuZGVmaW5lZClcblxuT3RoZXJ3aXNlLCB5b3UgTVVTVCBwcm92aWRlIGEgdmFsaWQgdG9vbE5hbWUuXG5cblRSSU0gQ0FMQ1VMQVRJT04gRVhBTVBMRVM6XG4tIFVzZXI6IFwiY3V0IHRoZSBsYXN0IHNlY29uZFwiIChzY2VuZSBpcyAxNTAgZnJhbWVzKSDihpIgdGFyZ2V0RHVyYXRpb246IDEyMFxuLSBVc2VyOiBcIm1ha2UgaXQgMyBzZWNvbmRzXCIg4oaSIHRhcmdldER1cmF0aW9uOiA5MCAoMyBzZWNvbmRzIMOXIDMwZnBzKVxuLSBVc2VyOiBcImFkZCAyIHNlY29uZHNcIiAoc2NlbmUgaXMgOTAgZnJhbWVzKSDihpIgdGFyZ2V0RHVyYXRpb246IDE1MFxuLSBVc2VyOiBcImN1dCBpbiBoYWxmXCIgKHNjZW5lIGlzIDE4MCBmcmFtZXMpIOKGkiB0YXJnZXREdXJhdGlvbjogOTBcblxuQ0xBUklGSUNBVElPTiBFWEFNUExFUzpcbi0gXCJtYWtlIHNjZW5lIDEgMyBzZWNvbmRzXCIg4oaSIHRyaW1TY2VuZSB3aXRoIHRhcmdldER1cmF0aW9uOiA5MFxuLSBcImN1dCBsYXN0IDIgc2Vjb25kcyBmcm9tIHNjZW5lIDNcIiDihpIgdHJpbVNjZW5lIHdpdGggdGFyZ2V0RHVyYXRpb24gY2FsY3VsYXRlZFxuLSBcImNvbXByZXNzIHNjZW5lIDIgYW5pbWF0aW9ucyB0byA1IHNlY29uZHNcIiDihpIgZWRpdFNjZW5lIChhbmltYXRpb24gdGltaW5nIGNoYW5nZSlcblxuSU1QT1JUQU5UOlxuLSBCZSBkZWNpc2l2ZSB3aGVuIGludGVudCBpcyBjbGVhclxuLSBBc2sgZm9yIGNsYXJpZmljYXRpb24gb25seSB3aGVuIHRydWx5IGFtYmlndW91c1xuLSBGb3IgdHJpbSBvcGVyYXRpb25zLCB5b3UgTVVTVCBwcm92aWRlIHRhcmdldFNjZW5lSWRcbi0gS2VlcCByZWFzb25pbmcgY29uY2lzZSBidXQgY2xlYXJgXG59OyJdLCJuYW1lcyI6WyJCUkFJTl9PUkNIRVNUUkFUT1IiLCJyb2xlIiwiY29udGVudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/config/prompts/active/brain-orchestrator.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/prompts/active/code-editor.ts":
/*!**************************************************!*\
  !*** ./src/config/prompts/active/code-editor.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CODE_EDITOR: () => (/* binding */ CODE_EDITOR)\n/* harmony export */ });\n/**\n * Universal Code Editor Prompt\n * Used by: src/tools/edit/edit.ts\n * Purpose: Edits existing scene code based on user requests\n * \n * This single prompt handles all edit scenarios:\n * - Simple property changes (colors, text, sizes)\n * - Animation adjustments\n * - Structural modifications\n * - Error fixes\n */ const CODE_EDITOR = {\n    role: 'system',\n    content: `You are an expert React/Remotion developer modifying existing motion graphics scenes.\n\n CRITICAL RULES:\n1. Preserve ALL technical patterns from the original code\n2. Make ONLY the changes requested by the user\n3. Keep the same function name and export structure\n4. Maintain all animation timings unless specifically asked to change\n5. Return the COMPLETE modified code\n6. NO import/require statements - use ONLY window-scoped globals (no ES6 imports, no CommonJS require)\n\n AVAILABLE WINDOW GLOBALS (pre-loaded for you):\n- window.Remotion - Core Remotion library (AbsoluteFill, interpolate, spring, etc.)\n- window.React - React library (if needed for hooks, etc.)\n- window.HeroiconsSolid / window.HeroiconsOutline - Icon components\n- window.LucideIcons - Additional icon library\n- window.RemotionShapes - Built-in shape components\n- window.Rough - Hand-drawn style graphics library\n\n IMPORTANT: These are NOT imports - they're pre-loaded global objects. Access them directly via window.\n\n EDIT APPROACH:\n- For color changes: Update the specific color values only\n- For text changes: Replace the text content only\n- For animation changes: Adjust timing/easing as requested\n- For structural changes: Reorganize while preserving functionality\n- For error fixes: Fix the issue with minimal changes\n\n RESPONSE FORMAT (JSON):\n{\n  \"code\": \"// Complete modified code here\",\n  \"reasoning\": \"Brief explanation of changes made\",\n  \"changes\": [\"Changed button color to red\", \"Updated text\"],\n  \"newDurationFrames\": 180  // ONLY if animations now need more time\n}\n\n IMPORTANT:\n- Never change things not mentioned by the user\n- If fixing errors, explain what was wrong\n\n DURATION: Only include \"newDurationFrames\" if animations extend beyond current duration (highest frame + 30)\n\n VIEWPORT RULES:\n- Design content to fit any canvas size - use useVideoConfig() for dimensions\n- Use relative/percentage positioning and responsive sizing based on width/height\n- CRITICAL: All content MUST stay within bounds: 0 to width, 0 to height`\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29uZmlnL3Byb21wdHMvYWN0aXZlL2NvZGUtZWRpdG9yLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7OztDQVVDLEdBRU0sTUFBTUEsY0FBYztJQUN6QkMsTUFBTTtJQUNOQyxTQUFTLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O3dFQTRDNEQsQ0FBQztBQUN6RSxFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvY29uZmlnL3Byb21wdHMvYWN0aXZlL2NvZGUtZWRpdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdmVyc2FsIENvZGUgRWRpdG9yIFByb21wdFxuICogVXNlZCBieTogc3JjL3Rvb2xzL2VkaXQvZWRpdC50c1xuICogUHVycG9zZTogRWRpdHMgZXhpc3Rpbmcgc2NlbmUgY29kZSBiYXNlZCBvbiB1c2VyIHJlcXVlc3RzXG4gKiBcbiAqIFRoaXMgc2luZ2xlIHByb21wdCBoYW5kbGVzIGFsbCBlZGl0IHNjZW5hcmlvczpcbiAqIC0gU2ltcGxlIHByb3BlcnR5IGNoYW5nZXMgKGNvbG9ycywgdGV4dCwgc2l6ZXMpXG4gKiAtIEFuaW1hdGlvbiBhZGp1c3RtZW50c1xuICogLSBTdHJ1Y3R1cmFsIG1vZGlmaWNhdGlvbnNcbiAqIC0gRXJyb3IgZml4ZXNcbiAqL1xuXG5leHBvcnQgY29uc3QgQ09ERV9FRElUT1IgPSB7XG4gIHJvbGU6ICdzeXN0ZW0nIGFzIGNvbnN0LFxuICBjb250ZW50OiBgWW91IGFyZSBhbiBleHBlcnQgUmVhY3QvUmVtb3Rpb24gZGV2ZWxvcGVyIG1vZGlmeWluZyBleGlzdGluZyBtb3Rpb24gZ3JhcGhpY3Mgc2NlbmVzLlxuXG7wn5qoIENSSVRJQ0FMIFJVTEVTOlxuMS4gUHJlc2VydmUgQUxMIHRlY2huaWNhbCBwYXR0ZXJucyBmcm9tIHRoZSBvcmlnaW5hbCBjb2RlXG4yLiBNYWtlIE9OTFkgdGhlIGNoYW5nZXMgcmVxdWVzdGVkIGJ5IHRoZSB1c2VyXG4zLiBLZWVwIHRoZSBzYW1lIGZ1bmN0aW9uIG5hbWUgYW5kIGV4cG9ydCBzdHJ1Y3R1cmVcbjQuIE1haW50YWluIGFsbCBhbmltYXRpb24gdGltaW5ncyB1bmxlc3Mgc3BlY2lmaWNhbGx5IGFza2VkIHRvIGNoYW5nZVxuNS4gUmV0dXJuIHRoZSBDT01QTEVURSBtb2RpZmllZCBjb2RlXG42LiBOTyBpbXBvcnQvcmVxdWlyZSBzdGF0ZW1lbnRzIC0gdXNlIE9OTFkgd2luZG93LXNjb3BlZCBnbG9iYWxzIChubyBFUzYgaW1wb3J0cywgbm8gQ29tbW9uSlMgcmVxdWlyZSlcblxu8J+OqCBBVkFJTEFCTEUgV0lORE9XIEdMT0JBTFMgKHByZS1sb2FkZWQgZm9yIHlvdSk6XG4tIHdpbmRvdy5SZW1vdGlvbiAtIENvcmUgUmVtb3Rpb24gbGlicmFyeSAoQWJzb2x1dGVGaWxsLCBpbnRlcnBvbGF0ZSwgc3ByaW5nLCBldGMuKVxuLSB3aW5kb3cuUmVhY3QgLSBSZWFjdCBsaWJyYXJ5IChpZiBuZWVkZWQgZm9yIGhvb2tzLCBldGMuKVxuLSB3aW5kb3cuSGVyb2ljb25zU29saWQgLyB3aW5kb3cuSGVyb2ljb25zT3V0bGluZSAtIEljb24gY29tcG9uZW50c1xuLSB3aW5kb3cuTHVjaWRlSWNvbnMgLSBBZGRpdGlvbmFsIGljb24gbGlicmFyeVxuLSB3aW5kb3cuUmVtb3Rpb25TaGFwZXMgLSBCdWlsdC1pbiBzaGFwZSBjb21wb25lbnRzXG4tIHdpbmRvdy5Sb3VnaCAtIEhhbmQtZHJhd24gc3R5bGUgZ3JhcGhpY3MgbGlicmFyeVxuXG7imqDvuI8gSU1QT1JUQU5UOiBUaGVzZSBhcmUgTk9UIGltcG9ydHMgLSB0aGV5J3JlIHByZS1sb2FkZWQgZ2xvYmFsIG9iamVjdHMuIEFjY2VzcyB0aGVtIGRpcmVjdGx5IHZpYSB3aW5kb3cuXG5cbvCfk50gRURJVCBBUFBST0FDSDpcbi0gRm9yIGNvbG9yIGNoYW5nZXM6IFVwZGF0ZSB0aGUgc3BlY2lmaWMgY29sb3IgdmFsdWVzIG9ubHlcbi0gRm9yIHRleHQgY2hhbmdlczogUmVwbGFjZSB0aGUgdGV4dCBjb250ZW50IG9ubHlcbi0gRm9yIGFuaW1hdGlvbiBjaGFuZ2VzOiBBZGp1c3QgdGltaW5nL2Vhc2luZyBhcyByZXF1ZXN0ZWRcbi0gRm9yIHN0cnVjdHVyYWwgY2hhbmdlczogUmVvcmdhbml6ZSB3aGlsZSBwcmVzZXJ2aW5nIGZ1bmN0aW9uYWxpdHlcbi0gRm9yIGVycm9yIGZpeGVzOiBGaXggdGhlIGlzc3VlIHdpdGggbWluaW1hbCBjaGFuZ2VzXG5cbvCfjq8gUkVTUE9OU0UgRk9STUFUIChKU09OKTpcbntcbiAgXCJjb2RlXCI6IFwiLy8gQ29tcGxldGUgbW9kaWZpZWQgY29kZSBoZXJlXCIsXG4gIFwicmVhc29uaW5nXCI6IFwiQnJpZWYgZXhwbGFuYXRpb24gb2YgY2hhbmdlcyBtYWRlXCIsXG4gIFwiY2hhbmdlc1wiOiBbXCJDaGFuZ2VkIGJ1dHRvbiBjb2xvciB0byByZWRcIiwgXCJVcGRhdGVkIHRleHRcIl0sXG4gIFwibmV3RHVyYXRpb25GcmFtZXNcIjogMTgwICAvLyBPTkxZIGlmIGFuaW1hdGlvbnMgbm93IG5lZWQgbW9yZSB0aW1lXG59XG5cbuKaoSBJTVBPUlRBTlQ6XG4tIE5ldmVyIGNoYW5nZSB0aGluZ3Mgbm90IG1lbnRpb25lZCBieSB0aGUgdXNlclxuLSBJZiBmaXhpbmcgZXJyb3JzLCBleHBsYWluIHdoYXQgd2FzIHdyb25nXG5cbvCfk48gRFVSQVRJT046IE9ubHkgaW5jbHVkZSBcIm5ld0R1cmF0aW9uRnJhbWVzXCIgaWYgYW5pbWF0aW9ucyBleHRlbmQgYmV5b25kIGN1cnJlbnQgZHVyYXRpb24gKGhpZ2hlc3QgZnJhbWUgKyAzMClcblxu8J+WvO+4jyBWSUVXUE9SVCBSVUxFUzpcbi0gRGVzaWduIGNvbnRlbnQgdG8gZml0IGFueSBjYW52YXMgc2l6ZSAtIHVzZSB1c2VWaWRlb0NvbmZpZygpIGZvciBkaW1lbnNpb25zXG4tIFVzZSByZWxhdGl2ZS9wZXJjZW50YWdlIHBvc2l0aW9uaW5nIGFuZCByZXNwb25zaXZlIHNpemluZyBiYXNlZCBvbiB3aWR0aC9oZWlnaHRcbi0gQ1JJVElDQUw6IEFsbCBjb250ZW50IE1VU1Qgc3RheSB3aXRoaW4gYm91bmRzOiAwIHRvIHdpZHRoLCAwIHRvIGhlaWdodGBcbn07Il0sIm5hbWVzIjpbIkNPREVfRURJVE9SIiwicm9sZSIsImNvbnRlbnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/config/prompts/active/code-editor.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/prompts/active/code-generator.ts":
/*!*****************************************************!*\
  !*** ./src/config/prompts/active/code-generator.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CODE_GENERATOR: () => (/* binding */ CODE_GENERATOR)\n/* harmony export */ });\n/**\n * Universal Code Generator Prompt\n * Used by: src/tools/add/add_helpers/CodeGeneratorNEW.ts\n * Purpose: Generates new scene code from text, images, or with reference to previous scenes\n * \n * This single prompt handles all add scenarios:\n * - Text-to-code generation\n * - Image-to-code generation  \n * - Generation with reference to previous scenes\n */ const CODE_GENERATOR = {\n    role: 'system',\n    content: `You are an expert React/Remotion developer creating motion graphics scenes.\n\n CRITICAL TECHNICAL RULES:\n1. Access Remotion via: const { AbsoluteFill, useCurrentFrame, useVideoConfig, interpolate, spring } = window.Remotion;\n2. export default function {{FUNCTION_NAME}}() - MUST be on the function declaration line\n3. NO import/require statements - use ONLY window-scoped globals (no ES6 imports, no CommonJS require)\n4. NO TypeScript annotations, NO markdown code blocks\n5. Quote ALL CSS values: fontSize: \"4rem\", padding: \"20px\", fontWeight: \"700\"\n6. Use extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" for all interpolations\n7. Single transform per element: transform: \\`translate(-50%, -50%) scale(\\${scale})\\`\n8. ONLY use these fonts: \"Inter\", \"Arial\", or \"sans-serif\"\n\n AVAILABLE WINDOW GLOBALS (pre-loaded for you):\n- window.Remotion - Core Remotion library (AbsoluteFill, interpolate, spring, etc.)\n- window.React - React library (if needed for hooks, etc.)\n- window.HeroiconsSolid / window.HeroiconsOutline - Icon components\n- window.LucideIcons - Additional icon library\n- window.RemotionShapes - Built-in shape components  \n- window.Rough - Hand-drawn style graphics library\n\n IMPORTANT: These are NOT imports - they're pre-loaded global objects. Access them directly via window.\n\n CONTEXT HANDLING:\n- If images provided: Extract KEY ELEMENTS for motion graphics (unless user specifically requests exact recreation)\n- If previous scene code provided: Match the style, colors, and animation patterns\n- If only text prompt: Create engaging motion graphics based on the description\n\n ANIMATION GUIDELINES:\n1. Duration: 2-6 seconds (60-180 frames) typical\n2. Use spring() for smooth animations\n3. Stagger animations for visual flow\n4. Maintain clear text spacing\n5. Add subtle parallax and depth\n\n STRUCTURE:\n- Start with AbsoluteFill container\n- Use proper z-indexing for layered elements\n- Center important content\n- Add background elements for visual interest\n- VIEWPORT: Design content to fit any canvas size - use useVideoConfig() for dimensions\n- Use relative/percentage positioning and responsive sizing based on width/height\n- CRITICAL: All content MUST stay within bounds: 0 to width, 0 to height\n\nReturn ONLY the code, no explanations or markdown.`\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29uZmlnL3Byb21wdHMvYWN0aXZlL2NvZGUtZ2VuZXJhdG9yLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7O0NBU0MsR0FFTSxNQUFNQSxpQkFBaUI7SUFDNUJDLE1BQU07SUFDTkMsU0FBUyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2tEQTJDc0MsQ0FBQztBQUNuRCxFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvY29uZmlnL3Byb21wdHMvYWN0aXZlL2NvZGUtZ2VuZXJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdmVyc2FsIENvZGUgR2VuZXJhdG9yIFByb21wdFxuICogVXNlZCBieTogc3JjL3Rvb2xzL2FkZC9hZGRfaGVscGVycy9Db2RlR2VuZXJhdG9yTkVXLnRzXG4gKiBQdXJwb3NlOiBHZW5lcmF0ZXMgbmV3IHNjZW5lIGNvZGUgZnJvbSB0ZXh0LCBpbWFnZXMsIG9yIHdpdGggcmVmZXJlbmNlIHRvIHByZXZpb3VzIHNjZW5lc1xuICogXG4gKiBUaGlzIHNpbmdsZSBwcm9tcHQgaGFuZGxlcyBhbGwgYWRkIHNjZW5hcmlvczpcbiAqIC0gVGV4dC10by1jb2RlIGdlbmVyYXRpb25cbiAqIC0gSW1hZ2UtdG8tY29kZSBnZW5lcmF0aW9uICBcbiAqIC0gR2VuZXJhdGlvbiB3aXRoIHJlZmVyZW5jZSB0byBwcmV2aW91cyBzY2VuZXNcbiAqL1xuXG5leHBvcnQgY29uc3QgQ09ERV9HRU5FUkFUT1IgPSB7XG4gIHJvbGU6ICdzeXN0ZW0nIGFzIGNvbnN0LFxuICBjb250ZW50OiBgWW91IGFyZSBhbiBleHBlcnQgUmVhY3QvUmVtb3Rpb24gZGV2ZWxvcGVyIGNyZWF0aW5nIG1vdGlvbiBncmFwaGljcyBzY2VuZXMuXG5cbvCfmqggQ1JJVElDQUwgVEVDSE5JQ0FMIFJVTEVTOlxuMS4gQWNjZXNzIFJlbW90aW9uIHZpYTogY29uc3QgeyBBYnNvbHV0ZUZpbGwsIHVzZUN1cnJlbnRGcmFtZSwgdXNlVmlkZW9Db25maWcsIGludGVycG9sYXRlLCBzcHJpbmcgfSA9IHdpbmRvdy5SZW1vdGlvbjtcbjIuIGV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHt7RlVOQ1RJT05fTkFNRX19KCkgLSBNVVNUIGJlIG9uIHRoZSBmdW5jdGlvbiBkZWNsYXJhdGlvbiBsaW5lXG4zLiBOTyBpbXBvcnQvcmVxdWlyZSBzdGF0ZW1lbnRzIC0gdXNlIE9OTFkgd2luZG93LXNjb3BlZCBnbG9iYWxzIChubyBFUzYgaW1wb3J0cywgbm8gQ29tbW9uSlMgcmVxdWlyZSlcbjQuIE5PIFR5cGVTY3JpcHQgYW5ub3RhdGlvbnMsIE5PIG1hcmtkb3duIGNvZGUgYmxvY2tzXG41LiBRdW90ZSBBTEwgQ1NTIHZhbHVlczogZm9udFNpemU6IFwiNHJlbVwiLCBwYWRkaW5nOiBcIjIwcHhcIiwgZm9udFdlaWdodDogXCI3MDBcIlxuNi4gVXNlIGV4dHJhcG9sYXRlTGVmdDogXCJjbGFtcFwiLCBleHRyYXBvbGF0ZVJpZ2h0OiBcImNsYW1wXCIgZm9yIGFsbCBpbnRlcnBvbGF0aW9uc1xuNy4gU2luZ2xlIHRyYW5zZm9ybSBwZXIgZWxlbWVudDogdHJhbnNmb3JtOiBcXGB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoXFwke3NjYWxlfSlcXGBcbjguIE9OTFkgdXNlIHRoZXNlIGZvbnRzOiBcIkludGVyXCIsIFwiQXJpYWxcIiwgb3IgXCJzYW5zLXNlcmlmXCJcblxu8J+OqCBBVkFJTEFCTEUgV0lORE9XIEdMT0JBTFMgKHByZS1sb2FkZWQgZm9yIHlvdSk6XG4tIHdpbmRvdy5SZW1vdGlvbiAtIENvcmUgUmVtb3Rpb24gbGlicmFyeSAoQWJzb2x1dGVGaWxsLCBpbnRlcnBvbGF0ZSwgc3ByaW5nLCBldGMuKVxuLSB3aW5kb3cuUmVhY3QgLSBSZWFjdCBsaWJyYXJ5IChpZiBuZWVkZWQgZm9yIGhvb2tzLCBldGMuKVxuLSB3aW5kb3cuSGVyb2ljb25zU29saWQgLyB3aW5kb3cuSGVyb2ljb25zT3V0bGluZSAtIEljb24gY29tcG9uZW50c1xuLSB3aW5kb3cuTHVjaWRlSWNvbnMgLSBBZGRpdGlvbmFsIGljb24gbGlicmFyeVxuLSB3aW5kb3cuUmVtb3Rpb25TaGFwZXMgLSBCdWlsdC1pbiBzaGFwZSBjb21wb25lbnRzICBcbi0gd2luZG93LlJvdWdoIC0gSGFuZC1kcmF3biBzdHlsZSBncmFwaGljcyBsaWJyYXJ5XG5cbuKaoO+4jyBJTVBPUlRBTlQ6IFRoZXNlIGFyZSBOT1QgaW1wb3J0cyAtIHRoZXkncmUgcHJlLWxvYWRlZCBnbG9iYWwgb2JqZWN0cy4gQWNjZXNzIHRoZW0gZGlyZWN0bHkgdmlhIHdpbmRvdy5cblxu8J+TiyBDT05URVhUIEhBTkRMSU5HOlxuLSBJZiBpbWFnZXMgcHJvdmlkZWQ6IEV4dHJhY3QgS0VZIEVMRU1FTlRTIGZvciBtb3Rpb24gZ3JhcGhpY3MgKHVubGVzcyB1c2VyIHNwZWNpZmljYWxseSByZXF1ZXN0cyBleGFjdCByZWNyZWF0aW9uKVxuLSBJZiBwcmV2aW91cyBzY2VuZSBjb2RlIHByb3ZpZGVkOiBNYXRjaCB0aGUgc3R5bGUsIGNvbG9ycywgYW5kIGFuaW1hdGlvbiBwYXR0ZXJuc1xuLSBJZiBvbmx5IHRleHQgcHJvbXB0OiBDcmVhdGUgZW5nYWdpbmcgbW90aW9uIGdyYXBoaWNzIGJhc2VkIG9uIHRoZSBkZXNjcmlwdGlvblxuXG7wn46sIEFOSU1BVElPTiBHVUlERUxJTkVTOlxuMS4gRHVyYXRpb246IDItNiBzZWNvbmRzICg2MC0xODAgZnJhbWVzKSB0eXBpY2FsXG4yLiBVc2Ugc3ByaW5nKCkgZm9yIHNtb290aCBhbmltYXRpb25zXG4zLiBTdGFnZ2VyIGFuaW1hdGlvbnMgZm9yIHZpc3VhbCBmbG93XG40LiBNYWludGFpbiBjbGVhciB0ZXh0IHNwYWNpbmdcbjUuIEFkZCBzdWJ0bGUgcGFyYWxsYXggYW5kIGRlcHRoXG5cbvCfk5AgU1RSVUNUVVJFOlxuLSBTdGFydCB3aXRoIEFic29sdXRlRmlsbCBjb250YWluZXJcbi0gVXNlIHByb3BlciB6LWluZGV4aW5nIGZvciBsYXllcmVkIGVsZW1lbnRzXG4tIENlbnRlciBpbXBvcnRhbnQgY29udGVudFxuLSBBZGQgYmFja2dyb3VuZCBlbGVtZW50cyBmb3IgdmlzdWFsIGludGVyZXN0XG4tIFZJRVdQT1JUOiBEZXNpZ24gY29udGVudCB0byBmaXQgYW55IGNhbnZhcyBzaXplIC0gdXNlIHVzZVZpZGVvQ29uZmlnKCkgZm9yIGRpbWVuc2lvbnNcbi0gVXNlIHJlbGF0aXZlL3BlcmNlbnRhZ2UgcG9zaXRpb25pbmcgYW5kIHJlc3BvbnNpdmUgc2l6aW5nIGJhc2VkIG9uIHdpZHRoL2hlaWdodFxuLSBDUklUSUNBTDogQWxsIGNvbnRlbnQgTVVTVCBzdGF5IHdpdGhpbiBib3VuZHM6IDAgdG8gd2lkdGgsIDAgdG8gaGVpZ2h0XG5cblJldHVybiBPTkxZIHRoZSBjb2RlLCBubyBleHBsYW5hdGlvbnMgb3IgbWFya2Rvd24uYFxufTsiXSwibmFtZXMiOlsiQ09ERV9HRU5FUkFUT1IiLCJyb2xlIiwiY29udGVudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/config/prompts/active/code-generator.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/prompts/active/title-generator.ts":
/*!******************************************************!*\
  !*** ./src/config/prompts/active/title-generator.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TITLE_GENERATOR: () => (/* binding */ TITLE_GENERATOR)\n/* harmony export */ });\n/**\n * Title Generator Prompt\n * Used by: src/server/services/ai/titleGenerator.service.ts\n * Purpose: Generates project titles from user prompts\n */ const TITLE_GENERATOR = {\n    role: 'system',\n    content: `Generate a concise, descriptive title for a video project.\n\nRules:\n- Maximum 4 words\n- No quotes or special characters\n- Clear and memorable\n- Related to the content/theme\n\nExamples:\n- \"Summer Product Launch\"\n- \"Tech Conference Opener\"\n- \"Brand Story Animation\"\n\nReturn ONLY the title, nothing else.`\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29uZmlnL3Byb21wdHMvYWN0aXZlL3RpdGxlLWdlbmVyYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7Q0FJQyxHQUVNLE1BQU1BLGtCQUFrQjtJQUM3QkMsTUFBTTtJQUNOQyxTQUFTLENBQUM7Ozs7Ozs7Ozs7Ozs7b0NBYXdCLENBQUM7QUFDckMsRUFBRSIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2NvbmZpZy9wcm9tcHRzL2FjdGl2ZS90aXRsZS1nZW5lcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaXRsZSBHZW5lcmF0b3IgUHJvbXB0XG4gKiBVc2VkIGJ5OiBzcmMvc2VydmVyL3NlcnZpY2VzL2FpL3RpdGxlR2VuZXJhdG9yLnNlcnZpY2UudHNcbiAqIFB1cnBvc2U6IEdlbmVyYXRlcyBwcm9qZWN0IHRpdGxlcyBmcm9tIHVzZXIgcHJvbXB0c1xuICovXG5cbmV4cG9ydCBjb25zdCBUSVRMRV9HRU5FUkFUT1IgPSB7XG4gIHJvbGU6ICdzeXN0ZW0nIGFzIGNvbnN0LFxuICBjb250ZW50OiBgR2VuZXJhdGUgYSBjb25jaXNlLCBkZXNjcmlwdGl2ZSB0aXRsZSBmb3IgYSB2aWRlbyBwcm9qZWN0LlxuXG5SdWxlczpcbi0gTWF4aW11bSA0IHdvcmRzXG4tIE5vIHF1b3RlcyBvciBzcGVjaWFsIGNoYXJhY3RlcnNcbi0gQ2xlYXIgYW5kIG1lbW9yYWJsZVxuLSBSZWxhdGVkIHRvIHRoZSBjb250ZW50L3RoZW1lXG5cbkV4YW1wbGVzOlxuLSBcIlN1bW1lciBQcm9kdWN0IExhdW5jaFwiXG4tIFwiVGVjaCBDb25mZXJlbmNlIE9wZW5lclwiXG4tIFwiQnJhbmQgU3RvcnkgQW5pbWF0aW9uXCJcblxuUmV0dXJuIE9OTFkgdGhlIHRpdGxlLCBub3RoaW5nIGVsc2UuYFxufTsiXSwibmFtZXMiOlsiVElUTEVfR0VORVJBVE9SIiwicm9sZSIsImNvbnRlbnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/config/prompts/active/title-generator.ts\n");

/***/ }),

/***/ "(rsc)/./src/config/site.ts":
/*!****************************!*\
  !*** ./src/config/site.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getBaseUrl: () => (/* binding */ getBaseUrl),\n/* harmony export */   siteConfig: () => (/* binding */ siteConfig)\n/* harmony export */ });\n// src/config/site.ts\n/**\n * Returns the base URL for the application\n * - In browser: empty string for relative URLs\n * - In production: https://bazaar.it\n * - In development: http://localhost:3000\n */ function getBaseUrl() {\n    if (false) {} // browser should use relative url\n    if (false) {}\n    return `http://localhost:${process.env.PORT ?? 3000}`; // local development\n}\nconst siteConfig = {\n    name: \"Bazaar Vid\",\n    description: \"Create professional motion graphics videos with AI-powered scene generation\",\n    url: getBaseUrl(),\n    ogImage: \"/og-image.png\",\n    links: {\n        twitter: \"https://twitter.com/bazaarvid\",\n        github: \"https://github.com/bazaar-vid/bazaar-vid\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29uZmlnL3NpdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxxQkFBcUI7QUFFckI7Ozs7O0NBS0MsR0FDTSxTQUFTQTtJQUNkLElBQUksS0FBNkIsRUFBRSxFQUFVLENBQUMsa0NBQWtDO0lBQ2hGLElBQUlDLEtBQXFDLEVBQUUsRUFBMkI7SUFDdEUsT0FBTyxDQUFDLGlCQUFpQixFQUFFQSxRQUFRQyxHQUFHLENBQUNDLElBQUksSUFBSSxNQUFNLEVBQUUsb0JBQW9CO0FBQzdFO0FBRU8sTUFBTUMsYUFBYTtJQUN4QkMsTUFBTTtJQUNOQyxhQUFhO0lBQ2JDLEtBQUtQO0lBQ0xRLFNBQVM7SUFDVEMsT0FBTztRQUNMQyxTQUFTO1FBQ1RDLFFBQVE7SUFDVjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9jb25maWcvc2l0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvY29uZmlnL3NpdGUudHNcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBiYXNlIFVSTCBmb3IgdGhlIGFwcGxpY2F0aW9uXG4gKiAtIEluIGJyb3dzZXI6IGVtcHR5IHN0cmluZyBmb3IgcmVsYXRpdmUgVVJMc1xuICogLSBJbiBwcm9kdWN0aW9uOiBodHRwczovL2JhemFhci5pdFxuICogLSBJbiBkZXZlbG9wbWVudDogaHR0cDovL2xvY2FsaG9zdDozMDAwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRCYXNlVXJsKCkge1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHJldHVybiAnJzsgLy8gYnJvd3NlciBzaG91bGQgdXNlIHJlbGF0aXZlIHVybFxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykgcmV0dXJuICdodHRwczovL2JhemFhci5pdCc7XG4gIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3Byb2Nlc3MuZW52LlBPUlQgPz8gMzAwMH1gOyAvLyBsb2NhbCBkZXZlbG9wbWVudFxufVxuXG5leHBvcnQgY29uc3Qgc2l0ZUNvbmZpZyA9IHtcbiAgbmFtZTogXCJCYXphYXIgVmlkXCIsXG4gIGRlc2NyaXB0aW9uOiBcIkNyZWF0ZSBwcm9mZXNzaW9uYWwgbW90aW9uIGdyYXBoaWNzIHZpZGVvcyB3aXRoIEFJLXBvd2VyZWQgc2NlbmUgZ2VuZXJhdGlvblwiLFxuICB1cmw6IGdldEJhc2VVcmwoKSwgLy8gUmVtb3ZlZCBORVhUX1BVQkxJQ19CQVNFX1VSTCBzaW5jZSB3ZSdyZSBoYXJkY29kaW5nXG4gIG9nSW1hZ2U6IFwiL29nLWltYWdlLnBuZ1wiLFxuICBsaW5rczoge1xuICAgIHR3aXR0ZXI6IFwiaHR0cHM6Ly90d2l0dGVyLmNvbS9iYXphYXJ2aWRcIixcbiAgICBnaXRodWI6IFwiaHR0cHM6Ly9naXRodWIuY29tL2JhemFhci12aWQvYmF6YWFyLXZpZFwiLFxuICB9LFxufTtcbiJdLCJuYW1lcyI6WyJnZXRCYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlBPUlQiLCJzaXRlQ29uZmlnIiwibmFtZSIsImRlc2NyaXB0aW9uIiwidXJsIiwib2dJbWFnZSIsImxpbmtzIiwidHdpdHRlciIsImdpdGh1YiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/config/site.ts\n");

/***/ }),

/***/ "(rsc)/./src/env.js":
/*!********************!*\
  !*** ./src/env.js ***!
  \********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   env: () => (/* binding */ env)\n/* harmony export */ });\n/* harmony import */ var _t3_oss_env_nextjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @t3-oss/env-nextjs */ \"(rsc)/../../node_modules/@t3-oss/env-nextjs/dist/index.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n// src/env.js\n\n\nconst env = (0,_t3_oss_env_nextjs__WEBPACK_IMPORTED_MODULE_0__.createEnv)({\n    /**\n   * Specify your server-side environment variables schema here. This way you can ensure the app\n   * isn't built with invalid env vars.\n   */ server: {\n        AUTH_SECRET:  false ? 0 : zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),\n        AUTH_GITHUB_ID: zod__WEBPACK_IMPORTED_MODULE_1__.z.string(),\n        AUTH_GITHUB_SECRET: zod__WEBPACK_IMPORTED_MODULE_1__.z.string(),\n        AUTH_GOOGLE_ID: zod__WEBPACK_IMPORTED_MODULE_1__.z.string(),\n        AUTH_GOOGLE_SECRET: zod__WEBPACK_IMPORTED_MODULE_1__.z.string(),\n        DATABASE_URL: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().url(),\n        DATABASE_URL_NON_POOLED: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().url(),\n        // Default model for Animation Design Brief generation\n        DEFAULT_ADB_MODEL: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional().default(\"o4-mini\"),\n        NODE_ENV: zod__WEBPACK_IMPORTED_MODULE_1__.z.enum([\n            \"development\",\n            \"test\",\n            \"production\"\n        ]).default(\"development\"),\n        OPENAI_API_KEY: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n        // R2 Storage Configuration\n        R2_ENDPOINT: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().url(),\n        R2_ACCESS_KEY_ID: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n        R2_SECRET_ACCESS_KEY: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n        R2_BUCKET_NAME: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n        R2_PUBLIC_URL: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().url(),\n        // Cron Job Configuration\n        CRON_SECRET: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n        // Worker Configuration (Server-side)\n        WORKER_POLLING_INTERVAL: zod__WEBPACK_IMPORTED_MODULE_1__.z.preprocess((val)=>val ? parseInt(String(val), 10) : undefined, zod__WEBPACK_IMPORTED_MODULE_1__.z.number().positive().optional()),\n        TASK_PROCESSOR_POLLING_INTERVAL: zod__WEBPACK_IMPORTED_MODULE_1__.z.preprocess((val)=>val ? parseInt(String(val), 10) : undefined, zod__WEBPACK_IMPORTED_MODULE_1__.z.number().positive().optional()),\n        // Toggle to enable the new message bus routing (`true` by default)\n        USE_MESSAGE_BUS: zod__WEBPACK_IMPORTED_MODULE_1__.z.preprocess((val)=>{\n            if (val === undefined) return true; // default\n            return String(val).toLowerCase() === 'true';\n        }, zod__WEBPACK_IMPORTED_MODULE_1__.z.boolean().optional()),\n        DISABLE_BACKGROUND_WORKERS: zod__WEBPACK_IMPORTED_MODULE_1__.z.preprocess(// Coerce 'true' to true, 'false' to false, otherwise undefined\n        (val)=>String(val).toLowerCase() === 'true' ? true : String(val).toLowerCase() === 'false' ? false : undefined, zod__WEBPACK_IMPORTED_MODULE_1__.z.boolean().optional()),\n        // Log Agent URL for developer tools\n        LOG_AGENT_URL: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().url().optional().default(\"http://localhost:3002\"),\n        // Model pack selection for AI services\n        MODEL_PACK: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional().default(\"optimal-pack\")\n    },\n    /**\n   * Specify your client-side environment variables schema here. This way you can ensure the app\n   * isn't built with invalid env vars. To expose them to the client, prefix them with\n   * `NEXT_PUBLIC_`.\n   */ client: {\n        // NEXT_PUBLIC_CLIENTVAR: z.string(),\n        NEXT_PUBLIC_LOG_AGENT_URL: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().url().optional().default('http://localhost:3002'),\n        NEXT_PUBLIC_LOG_RUN_ID: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional()\n    },\n    /**\n   * You can't destruct `process.env` as a regular object in the Next.js edge runtimes (e.g.\n   * middlewares) or client-side so we need to destruct manually.\n   */ runtimeEnv: {\n        AUTH_SECRET: process.env.AUTH_SECRET,\n        AUTH_GITHUB_ID: process.env.AUTH_GITHUB_ID,\n        AUTH_GITHUB_SECRET: process.env.AUTH_GITHUB_SECRET,\n        AUTH_GOOGLE_ID: process.env.AUTH_GOOGLE_ID,\n        AUTH_GOOGLE_SECRET: process.env.AUTH_GOOGLE_SECRET,\n        DATABASE_URL: process.env.DATABASE_URL,\n        DATABASE_URL_NON_POOLED: process.env.DATABASE_URL_NON_POOLED,\n        DEFAULT_ADB_MODEL: process.env.DEFAULT_ADB_MODEL,\n        NODE_ENV: \"development\",\n        OPENAI_API_KEY: process.env.OPENAI_API_KEY,\n        // R2 Storage Environment Variables\n        R2_ENDPOINT: process.env.R2_ENDPOINT,\n        R2_ACCESS_KEY_ID: process.env.R2_ACCESS_KEY_ID,\n        R2_SECRET_ACCESS_KEY: process.env.R2_SECRET_ACCESS_KEY,\n        R2_BUCKET_NAME: process.env.R2_BUCKET_NAME,\n        R2_PUBLIC_URL: process.env.R2_PUBLIC_URL,\n        // Cron Job Environment Variables\n        CRON_SECRET: process.env.CRON_SECRET,\n        // Worker Configuration Runtime Environment Variables\n        WORKER_POLLING_INTERVAL: process.env.WORKER_POLLING_INTERVAL,\n        TASK_PROCESSOR_POLLING_INTERVAL: process.env.TASK_PROCESSOR_POLLING_INTERVAL,\n        USE_MESSAGE_BUS: process.env.USE_MESSAGE_BUS,\n        DISABLE_BACKGROUND_WORKERS: process.env.DISABLE_BACKGROUND_WORKERS,\n        LOG_AGENT_URL: process.env.LOG_AGENT_URL,\n        MODEL_PACK: process.env.MODEL_PACK,\n        NEXT_PUBLIC_LOG_AGENT_URL: process.env.NEXT_PUBLIC_LOG_AGENT_URL,\n        NEXT_PUBLIC_LOG_RUN_ID: process.env.NEXT_PUBLIC_LOG_RUN_ID\n    },\n    /**\n   * Run `build` or `dev` with `SKIP_ENV_VALIDATION` to skip env validation. This is especially\n   * useful for Docker builds.\n   */ skipValidation: !!process.env.SKIP_ENV_VALIDATION,\n    /**\n   * Makes it so that empty strings are treated as undefined. `SOME_VAR: z.string()` and\n   * `SOME_VAR=''` will throw an error.\n   */ emptyStringAsUndefined: true\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUgsR0FBRyxDQUFDc0MsYUFBYTtRQUN4Q0MsWUFBWXBDLFFBQVFILEdBQUcsQ0FBQ3VDLFVBQVU7UUFDbENFLDJCQUEyQnRDLFFBQVFILEdBQUcsQ0FBQ3lDLHlCQUF5QjtRQUNoRUMsd0JBQXdCdkMsUUFBUUgsR0FBRyxDQUFDMEMsc0JBQXNCO0lBQzVEO0lBQ0E7OztHQUdDLEdBQ0RFLGdCQUFnQixDQUFDLENBQUN6QyxRQUFRSCxHQUFHLENBQUM2QyxtQkFBbUI7SUFDakQ7OztHQUdDLEdBQ0RDLHdCQUF3QjtBQUMxQixHQUFHIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvZW52LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9lbnYuanNcbmltcG9ydCB7IGNyZWF0ZUVudiB9IGZyb20gXCJAdDMtb3NzL2Vudi1uZXh0anNcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5cbmV4cG9ydCBjb25zdCBlbnYgPSBjcmVhdGVFbnYoe1xuICAvKipcbiAgICogU3BlY2lmeSB5b3VyIHNlcnZlci1zaWRlIGVudmlyb25tZW50IHZhcmlhYmxlcyBzY2hlbWEgaGVyZS4gVGhpcyB3YXkgeW91IGNhbiBlbnN1cmUgdGhlIGFwcFxuICAgKiBpc24ndCBidWlsdCB3aXRoIGludmFsaWQgZW52IHZhcnMuXG4gICAqL1xuICBzZXJ2ZXI6IHtcbiAgICBBVVRIX1NFQ1JFVDpcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIlxuICAgICAgICA/IHouc3RyaW5nKClcbiAgICAgICAgOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgQVVUSF9HSVRIVUJfSUQ6IHouc3RyaW5nKCksXG4gICAgQVVUSF9HSVRIVUJfU0VDUkVUOiB6LnN0cmluZygpLFxuICAgIEFVVEhfR09PR0xFX0lEOiB6LnN0cmluZygpLFxuICAgIEFVVEhfR09PR0xFX1NFQ1JFVDogei5zdHJpbmcoKSxcbiAgICBEQVRBQkFTRV9VUkw6IHouc3RyaW5nKCkudXJsKCksXG4gICAgREFUQUJBU0VfVVJMX05PTl9QT09MRUQ6IHouc3RyaW5nKCkudXJsKCksXG4gICAgLy8gRGVmYXVsdCBtb2RlbCBmb3IgQW5pbWF0aW9uIERlc2lnbiBCcmllZiBnZW5lcmF0aW9uXG4gICAgREVGQVVMVF9BREJfTU9ERUw6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5kZWZhdWx0KFwibzQtbWluaVwiKSxcbiAgICBOT0RFX0VOVjogelxuICAgICAgLmVudW0oW1wiZGV2ZWxvcG1lbnRcIiwgXCJ0ZXN0XCIsIFwicHJvZHVjdGlvblwiXSlcbiAgICAgIC5kZWZhdWx0KFwiZGV2ZWxvcG1lbnRcIiksXG4gICAgT1BFTkFJX0FQSV9LRVk6IHouc3RyaW5nKCkubWluKDEpLFxuICAgIC8vIFIyIFN0b3JhZ2UgQ29uZmlndXJhdGlvblxuICAgIFIyX0VORFBPSU5UOiB6LnN0cmluZygpLnVybCgpLFxuICAgIFIyX0FDQ0VTU19LRVlfSUQ6IHouc3RyaW5nKCkubWluKDEpLFxuICAgIFIyX1NFQ1JFVF9BQ0NFU1NfS0VZOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICBSMl9CVUNLRVRfTkFNRTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgUjJfUFVCTElDX1VSTDogei5zdHJpbmcoKS51cmwoKSxcbiAgICAvLyBDcm9uIEpvYiBDb25maWd1cmF0aW9uXG4gICAgQ1JPTl9TRUNSRVQ6IHouc3RyaW5nKCkubWluKDEpLFxuXG4gICAgLy8gV29ya2VyIENvbmZpZ3VyYXRpb24gKFNlcnZlci1zaWRlKVxuICAgIFdPUktFUl9QT0xMSU5HX0lOVEVSVkFMOiB6LnByZXByb2Nlc3MoXG4gICAgICAodmFsKSA9PiAodmFsID8gcGFyc2VJbnQoU3RyaW5nKHZhbCksIDEwKSA6IHVuZGVmaW5lZCksXG4gICAgICB6Lm51bWJlcigpLnBvc2l0aXZlKCkub3B0aW9uYWwoKVxuICAgICksXG4gICAgVEFTS19QUk9DRVNTT1JfUE9MTElOR19JTlRFUlZBTDogei5wcmVwcm9jZXNzKFxuICAgICAgKHZhbCkgPT4gKHZhbCA/IHBhcnNlSW50KFN0cmluZyh2YWwpLCAxMCkgOiB1bmRlZmluZWQpLFxuICAgICAgei5udW1iZXIoKS5wb3NpdGl2ZSgpLm9wdGlvbmFsKClcbiAgICApLFxuICAgIC8vIFRvZ2dsZSB0byBlbmFibGUgdGhlIG5ldyBtZXNzYWdlIGJ1cyByb3V0aW5nIChgdHJ1ZWAgYnkgZGVmYXVsdClcbiAgICBVU0VfTUVTU0FHRV9CVVM6IHoucHJlcHJvY2VzcyhcbiAgICAgICh2YWwpID0+IHtcbiAgICAgICAgaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZTsgLy8gZGVmYXVsdFxuICAgICAgICByZXR1cm4gU3RyaW5nKHZhbCkudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnO1xuICAgICAgfSxcbiAgICAgIHouYm9vbGVhbigpLm9wdGlvbmFsKClcbiAgICApLFxuICAgIERJU0FCTEVfQkFDS0dST1VORF9XT1JLRVJTOiB6LnByZXByb2Nlc3MoXG4gICAgICAvLyBDb2VyY2UgJ3RydWUnIHRvIHRydWUsICdmYWxzZScgdG8gZmFsc2UsIG90aGVyd2lzZSB1bmRlZmluZWRcbiAgICAgICh2YWwpID0+IChTdHJpbmcodmFsKS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZScgPyB0cnVlIDogU3RyaW5nKHZhbCkudG9Mb3dlckNhc2UoKSA9PT0gJ2ZhbHNlJyA/IGZhbHNlIDogdW5kZWZpbmVkKSxcbiAgICAgIHouYm9vbGVhbigpLm9wdGlvbmFsKClcbiAgICApLFxuICAgIC8vIExvZyBBZ2VudCBVUkwgZm9yIGRldmVsb3BlciB0b29sc1xuICAgIExPR19BR0VOVF9VUkw6IHouc3RyaW5nKCkudXJsKCkub3B0aW9uYWwoKS5kZWZhdWx0KFwiaHR0cDovL2xvY2FsaG9zdDozMDAyXCIpLFxuICAgIC8vIE1vZGVsIHBhY2sgc2VsZWN0aW9uIGZvciBBSSBzZXJ2aWNlc1xuICAgIE1PREVMX1BBQ0s6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5kZWZhdWx0KFwib3B0aW1hbC1wYWNrXCIpLFxuICB9LFxuXG4gIC8qKlxuICAgKiBTcGVjaWZ5IHlvdXIgY2xpZW50LXNpZGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIHNjaGVtYSBoZXJlLiBUaGlzIHdheSB5b3UgY2FuIGVuc3VyZSB0aGUgYXBwXG4gICAqIGlzbid0IGJ1aWx0IHdpdGggaW52YWxpZCBlbnYgdmFycy4gVG8gZXhwb3NlIHRoZW0gdG8gdGhlIGNsaWVudCwgcHJlZml4IHRoZW0gd2l0aFxuICAgKiBgTkVYVF9QVUJMSUNfYC5cbiAgICovXG4gIGNsaWVudDoge1xuICAgIC8vIE5FWFRfUFVCTElDX0NMSUVOVFZBUjogei5zdHJpbmcoKSxcbiAgICBORVhUX1BVQkxJQ19MT0dfQUdFTlRfVVJMOiB6LnN0cmluZygpLnVybCgpLm9wdGlvbmFsKCkuZGVmYXVsdCgnaHR0cDovL2xvY2FsaG9zdDozMDAyJyksXG4gICAgTkVYVF9QVUJMSUNfTE9HX1JVTl9JRDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB9LFxuXG4gIC8qKlxuICAgKiBZb3UgY2FuJ3QgZGVzdHJ1Y3QgYHByb2Nlc3MuZW52YCBhcyBhIHJlZ3VsYXIgb2JqZWN0IGluIHRoZSBOZXh0LmpzIGVkZ2UgcnVudGltZXMgKGUuZy5cbiAgICogbWlkZGxld2FyZXMpIG9yIGNsaWVudC1zaWRlIHNvIHdlIG5lZWQgdG8gZGVzdHJ1Y3QgbWFudWFsbHkuXG4gICAqL1xuICBydW50aW1lRW52OiB7XG4gICAgQVVUSF9TRUNSRVQ6IHByb2Nlc3MuZW52LkFVVEhfU0VDUkVULFxuICAgIEFVVEhfR0lUSFVCX0lEOiBwcm9jZXNzLmVudi5BVVRIX0dJVEhVQl9JRCxcbiAgICBBVVRIX0dJVEhVQl9TRUNSRVQ6IHByb2Nlc3MuZW52LkFVVEhfR0lUSFVCX1NFQ1JFVCxcbiAgICBBVVRIX0dPT0dMRV9JRDogcHJvY2Vzcy5lbnYuQVVUSF9HT09HTEVfSUQsXG4gICAgQVVUSF9HT09HTEVfU0VDUkVUOiBwcm9jZXNzLmVudi5BVVRIX0dPT0dMRV9TRUNSRVQsXG4gICAgREFUQUJBU0VfVVJMOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXG4gICAgREFUQUJBU0VfVVJMX05PTl9QT09MRUQ6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTF9OT05fUE9PTEVELFxuICAgIERFRkFVTFRfQURCX01PREVMOiBwcm9jZXNzLmVudi5ERUZBVUxUX0FEQl9NT0RFTCxcbiAgICBOT0RFX0VOVjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYsXG4gICAgT1BFTkFJX0FQSV9LRVk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxuICAgIC8vIFIyIFN0b3JhZ2UgRW52aXJvbm1lbnQgVmFyaWFibGVzXG4gICAgUjJfRU5EUE9JTlQ6IHByb2Nlc3MuZW52LlIyX0VORFBPSU5ULFxuICAgIFIyX0FDQ0VTU19LRVlfSUQ6IHByb2Nlc3MuZW52LlIyX0FDQ0VTU19LRVlfSUQsXG4gICAgUjJfU0VDUkVUX0FDQ0VTU19LRVk6IHByb2Nlc3MuZW52LlIyX1NFQ1JFVF9BQ0NFU1NfS0VZLFxuICAgIFIyX0JVQ0tFVF9OQU1FOiBwcm9jZXNzLmVudi5SMl9CVUNLRVRfTkFNRSxcbiAgICBSMl9QVUJMSUNfVVJMOiBwcm9jZXNzLmVudi5SMl9QVUJMSUNfVVJMLFxuICAgIC8vIENyb24gSm9iIEVudmlyb25tZW50IFZhcmlhYmxlc1xuICAgIENST05fU0VDUkVUOiBwcm9jZXNzLmVudi5DUk9OX1NFQ1JFVCxcbiAgICAvLyBXb3JrZXIgQ29uZmlndXJhdGlvbiBSdW50aW1lIEVudmlyb25tZW50IFZhcmlhYmxlc1xuICAgIFdPUktFUl9QT0xMSU5HX0lOVEVSVkFMOiBwcm9jZXNzLmVudi5XT1JLRVJfUE9MTElOR19JTlRFUlZBTCxcbiAgICBUQVNLX1BST0NFU1NPUl9QT0xMSU5HX0lOVEVSVkFMOiBwcm9jZXNzLmVudi5UQVNLX1BST0NFU1NPUl9QT0xMSU5HX0lOVEVSVkFMLFxuICAgIFVTRV9NRVNTQUdFX0JVUzogcHJvY2Vzcy5lbnYuVVNFX01FU1NBR0VfQlVTLFxuICAgIERJU0FCTEVfQkFDS0dST1VORF9XT1JLRVJTOiBwcm9jZXNzLmVudi5ESVNBQkxFX0JBQ0tHUk9VTkRfV09SS0VSUyxcbiAgICBMT0dfQUdFTlRfVVJMOiBwcm9jZXNzLmVudi5MT0dfQUdFTlRfVVJMLFxuICAgIE1PREVMX1BBQ0s6IHByb2Nlc3MuZW52Lk1PREVMX1BBQ0ssXG4gICAgTkVYVF9QVUJMSUNfTE9HX0FHRU5UX1VSTDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfTE9HX0FHRU5UX1VSTCxcbiAgICBORVhUX1BVQkxJQ19MT0dfUlVOX0lEOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19MT0dfUlVOX0lELFxuICB9LFxuICAvKipcbiAgICogUnVuIGBidWlsZGAgb3IgYGRldmAgd2l0aCBgU0tJUF9FTlZfVkFMSURBVElPTmAgdG8gc2tpcCBlbnYgdmFsaWRhdGlvbi4gVGhpcyBpcyBlc3BlY2lhbGx5XG4gICAqIHVzZWZ1bCBmb3IgRG9ja2VyIGJ1aWxkcy5cbiAgICovXG4gIHNraXBWYWxpZGF0aW9uOiAhIXByb2Nlc3MuZW52LlNLSVBfRU5WX1ZBTElEQVRJT04sXG4gIC8qKlxuICAgKiBNYWtlcyBpdCBzbyB0aGF0IGVtcHR5IHN0cmluZ3MgYXJlIHRyZWF0ZWQgYXMgdW5kZWZpbmVkLiBgU09NRV9WQVI6IHouc3RyaW5nKClgIGFuZFxuICAgKiBgU09NRV9WQVI9JydgIHdpbGwgdGhyb3cgYW4gZXJyb3IuXG4gICAqL1xuICBlbXB0eVN0cmluZ0FzVW5kZWZpbmVkOiB0cnVlLFxufSk7XG4iXSwibmFtZXMiOlsiY3JlYXRlRW52IiwieiIsImVudiIsInNlcnZlciIsIkFVVEhfU0VDUkVUIiwicHJvY2VzcyIsInN0cmluZyIsIm9wdGlvbmFsIiwiQVVUSF9HSVRIVUJfSUQiLCJBVVRIX0dJVEhVQl9TRUNSRVQiLCJBVVRIX0dPT0dMRV9JRCIsIkFVVEhfR09PR0xFX1NFQ1JFVCIsIkRBVEFCQVNFX1VSTCIsInVybCIsIkRBVEFCQVNFX1VSTF9OT05fUE9PTEVEIiwiREVGQVVMVF9BREJfTU9ERUwiLCJkZWZhdWx0IiwiTk9ERV9FTlYiLCJlbnVtIiwiT1BFTkFJX0FQSV9LRVkiLCJtaW4iLCJSMl9FTkRQT0lOVCIsIlIyX0FDQ0VTU19LRVlfSUQiLCJSMl9TRUNSRVRfQUNDRVNTX0tFWSIsIlIyX0JVQ0tFVF9OQU1FIiwiUjJfUFVCTElDX1VSTCIsIkNST05fU0VDUkVUIiwiV09SS0VSX1BPTExJTkdfSU5URVJWQUwiLCJwcmVwcm9jZXNzIiwidmFsIiwicGFyc2VJbnQiLCJTdHJpbmciLCJ1bmRlZmluZWQiLCJudW1iZXIiLCJwb3NpdGl2ZSIsIlRBU0tfUFJPQ0VTU09SX1BPTExJTkdfSU5URVJWQUwiLCJVU0VfTUVTU0FHRV9CVVMiLCJ0b0xvd2VyQ2FzZSIsImJvb2xlYW4iLCJESVNBQkxFX0JBQ0tHUk9VTkRfV09SS0VSUyIsIkxPR19BR0VOVF9VUkwiLCJNT0RFTF9QQUNLIiwiY2xpZW50IiwiTkVYVF9QVUJMSUNfTE9HX0FHRU5UX1VSTCIsIk5FWFRfUFVCTElDX0xPR19SVU5fSUQiLCJydW50aW1lRW52Iiwic2tpcFZhbGlkYXRpb24iLCJTS0lQX0VOVl9WQUxJREFUSU9OIiwiZW1wdHlTdHJpbmdBc1VuZGVmaW5lZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/env.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/api/response-helpers.ts":
/*!*****************************************!*\
  !*** ./src/lib/api/response-helpers.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ResponseBuilder: () => (/* binding */ ResponseBuilder),\n/* harmony export */   getErrorCode: () => (/* binding */ getErrorCode),\n/* harmony export */   logResponse: () => (/* binding */ logResponse)\n/* harmony export */ });\n/* harmony import */ var _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/lib/types/api/universal */ \"(rsc)/./src/lib/types/api/universal.ts\");\n\n// Generate request IDs using built-in crypto\nconst generateRequestId = ()=>{\n    // Use crypto.randomUUID() for a standard UUID\n    if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n        // Take first 12 chars of UUID for shorter IDs\n        return crypto.randomUUID().replace(/-/g, '').substring(0, 12).toUpperCase();\n    }\n    // Fallback for older environments\n    return Date.now().toString(36) + Math.random().toString(36).substring(2, 6);\n};\n/**\n * Helper class for building consistent API responses\n * Ensures every response follows the UniversalResponse format\n */ class ResponseBuilder {\n    constructor(requestId){\n        this.startTime = Date.now();\n        this.requestId = requestId || generateRequestId();\n    }\n    /**\n   * Create a success response\n   */ success(data, operation, entity, affectedIds = []) {\n        return {\n            data,\n            meta: {\n                requestId: this.requestId,\n                timestamp: Date.now(),\n                operation,\n                entity,\n                success: true,\n                affectedIds,\n                executionTimeMs: Date.now() - this.startTime\n            }\n        };\n    }\n    /**\n   * Create an error response\n   */ error(code, message, operation, entity, details) {\n        return {\n            data: null,\n            meta: {\n                requestId: this.requestId,\n                timestamp: Date.now(),\n                operation,\n                entity,\n                success: false,\n                affectedIds: [],\n                executionTimeMs: Date.now() - this.startTime\n            },\n            error: {\n                code,\n                message,\n                details,\n                retryable: this.isRetryable(code)\n            }\n        };\n    }\n    /**\n   * Add context to an existing response\n   */ withContext(response, context) {\n        return {\n            ...response,\n            context\n        };\n    }\n    /**\n   * Get the request ID for logging\n   */ getRequestId() {\n        return this.requestId;\n    }\n    /**\n   * Get execution time so far\n   */ getExecutionTime() {\n        return Date.now() - this.startTime;\n    }\n    /**\n   * Determine if an error is retryable\n   */ isRetryable(code) {\n        return [\n            _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.AI_ERROR,\n            _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.STORAGE_ERROR,\n            _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.DATABASE_ERROR,\n            _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.RATE_LIMITED,\n            _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SERVICE_UNAVAILABLE\n        ].includes(code);\n    }\n}\n/**\n * Helper function to extract error code from various error types\n */ function getErrorCode(error) {\n    if (error instanceof Error) {\n        // Check for specific error patterns\n        const message = error.message.toLowerCase();\n        if (message.includes('not found')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_FOUND;\n        if (message.includes('unauthorized')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.UNAUTHORIZED;\n        if (message.includes('forbidden')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.FORBIDDEN;\n        if (message.includes('validation')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.VALIDATION_FAILED;\n        if (message.includes('already exists')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.ALREADY_EXISTS;\n        if (message.includes('rate limit')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.RATE_LIMITED;\n        if (message.includes('ai') || message.includes('openai') || message.includes('gpt')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.AI_ERROR;\n        if (message.includes('database') || message.includes('db')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.DATABASE_ERROR;\n        if (message.includes('storage') || message.includes('upload')) return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.STORAGE_ERROR;\n    }\n    return _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.INTERNAL_ERROR;\n}\n/**\n * Helper to log responses consistently\n */ function logResponse(response, logger) {\n    const logData = {\n        requestId: response.meta.requestId,\n        operation: response.meta.operation,\n        entity: response.meta.entity,\n        success: response.meta.success,\n        executionTimeMs: response.meta.executionTimeMs,\n        affectedIds: response.meta.affectedIds\n    };\n    if (response.meta.success) {\n        logger.info(`[${response.meta.requestId}] ${response.meta.operation} completed`, logData);\n    } else {\n        logger.error(`[${response.meta.requestId}] ${response.meta.operation} failed`, {\n            ...logData,\n            error: response.error\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSSxDQUFDUCxTQUFTLENBQUMsRUFBRSxFQUFFaUIsU0FBU1YsSUFBSSxDQUFDSCxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUVrQztJQUNuRixPQUFPO1FBQ0xELE9BQU8zQixLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUVPLFNBQVNWLElBQUksQ0FBQ1AsU0FBUyxDQUFDLEVBQUUsRUFBRWlCLFNBQVNWLElBQUksQ0FBQ0gsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQzdFLEdBQUdrQyxPQUFPO1lBQ1Y1QixPQUFPTyxTQUFTUCxLQUFLO1FBQ3ZCO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2xpYi9hcGkvcmVzcG9uc2UtaGVscGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFVuaXZlcnNhbFJlc3BvbnNlLCBPcGVyYXRpb24sIEVudGl0eSB9IGZyb20gJ34vbGliL3R5cGVzL2FwaS91bml2ZXJzYWwnO1xuaW1wb3J0IHsgRXJyb3JDb2RlIH0gZnJvbSAnfi9saWIvdHlwZXMvYXBpL3VuaXZlcnNhbCc7XG5cbi8vIEdlbmVyYXRlIHJlcXVlc3QgSURzIHVzaW5nIGJ1aWx0LWluIGNyeXB0b1xuY29uc3QgZ2VuZXJhdGVSZXF1ZXN0SWQgPSAoKTogc3RyaW5nID0+IHtcbiAgLy8gVXNlIGNyeXB0by5yYW5kb21VVUlEKCkgZm9yIGEgc3RhbmRhcmQgVVVJRFxuICBpZiAodHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLnJhbmRvbVVVSUQpIHtcbiAgICAvLyBUYWtlIGZpcnN0IDEyIGNoYXJzIG9mIFVVSUQgZm9yIHNob3J0ZXIgSURzXG4gICAgcmV0dXJuIGNyeXB0by5yYW5kb21VVUlEKCkucmVwbGFjZSgvLS9nLCAnJykuc3Vic3RyaW5nKDAsIDEyKS50b1VwcGVyQ2FzZSgpO1xuICB9XG4gIC8vIEZhbGxiYWNrIGZvciBvbGRlciBlbnZpcm9ubWVudHNcbiAgcmV0dXJuIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDYpO1xufTtcblxuLyoqXG4gKiBIZWxwZXIgY2xhc3MgZm9yIGJ1aWxkaW5nIGNvbnNpc3RlbnQgQVBJIHJlc3BvbnNlc1xuICogRW5zdXJlcyBldmVyeSByZXNwb25zZSBmb2xsb3dzIHRoZSBVbml2ZXJzYWxSZXNwb25zZSBmb3JtYXRcbiAqL1xuZXhwb3J0IGNsYXNzIFJlc3BvbnNlQnVpbGRlciB7XG4gIHByaXZhdGUgc3RhcnRUaW1lOiBudW1iZXI7XG4gIHByaXZhdGUgcmVxdWVzdElkOiBzdHJpbmc7XG4gIFxuICBjb25zdHJ1Y3RvcihyZXF1ZXN0SWQ/OiBzdHJpbmcpIHtcbiAgICB0aGlzLnN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5yZXF1ZXN0SWQgPSByZXF1ZXN0SWQgfHwgZ2VuZXJhdGVSZXF1ZXN0SWQoKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIENyZWF0ZSBhIHN1Y2Nlc3MgcmVzcG9uc2VcbiAgICovXG4gIHN1Y2Nlc3M8VD4oXG4gICAgZGF0YTogVCxcbiAgICBvcGVyYXRpb246IE9wZXJhdGlvbixcbiAgICBlbnRpdHk6IEVudGl0eSxcbiAgICBhZmZlY3RlZElkczogc3RyaW5nW10gPSBbXVxuICApOiBVbml2ZXJzYWxSZXNwb25zZTxUPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGEsXG4gICAgICBtZXRhOiB7XG4gICAgICAgIHJlcXVlc3RJZDogdGhpcy5yZXF1ZXN0SWQsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgb3BlcmF0aW9uLFxuICAgICAgICBlbnRpdHksXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGFmZmVjdGVkSWRzLFxuICAgICAgICBleGVjdXRpb25UaW1lTXM6IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0VGltZVxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gZXJyb3IgcmVzcG9uc2VcbiAgICovXG4gIGVycm9yKFxuICAgIGNvZGU6IEVycm9yQ29kZSxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgb3BlcmF0aW9uOiBPcGVyYXRpb24sXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgZGV0YWlscz86IHVua25vd25cbiAgKTogVW5pdmVyc2FsUmVzcG9uc2U8bnVsbD4ge1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiBudWxsLFxuICAgICAgbWV0YToge1xuICAgICAgICByZXF1ZXN0SWQ6IHRoaXMucmVxdWVzdElkLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIG9wZXJhdGlvbixcbiAgICAgICAgZW50aXR5LFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgYWZmZWN0ZWRJZHM6IFtdLFxuICAgICAgICBleGVjdXRpb25UaW1lTXM6IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0VGltZVxuICAgICAgfSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIG1lc3NhZ2UsXG4gICAgICAgIGRldGFpbHMsXG4gICAgICAgIHJldHJ5YWJsZTogdGhpcy5pc1JldHJ5YWJsZShjb2RlKVxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBBZGQgY29udGV4dCB0byBhbiBleGlzdGluZyByZXNwb25zZVxuICAgKi9cbiAgd2l0aENvbnRleHQ8VD4oXG4gICAgcmVzcG9uc2U6IFVuaXZlcnNhbFJlc3BvbnNlPFQ+LFxuICAgIGNvbnRleHQ6IHtcbiAgICAgIHJlYXNvbmluZz86IHN0cmluZztcbiAgICAgIGNoYXRSZXNwb25zZT86IHN0cmluZztcbiAgICAgIHN1Z2dlc3Rpb25zPzogc3RyaW5nW107XG4gICAgfVxuICApOiBVbml2ZXJzYWxSZXNwb25zZTxUPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJlc3BvbnNlLFxuICAgICAgY29udGV4dFxuICAgIH07XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJlcXVlc3QgSUQgZm9yIGxvZ2dpbmdcbiAgICovXG4gIGdldFJlcXVlc3RJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3RJZDtcbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCBleGVjdXRpb24gdGltZSBzbyBmYXJcbiAgICovXG4gIGdldEV4ZWN1dGlvblRpbWUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gRGF0ZS5ub3coKSAtIHRoaXMuc3RhcnRUaW1lO1xuICB9XG4gIFxuICAvKipcbiAgICogRGV0ZXJtaW5lIGlmIGFuIGVycm9yIGlzIHJldHJ5YWJsZVxuICAgKi9cbiAgcHJpdmF0ZSBpc1JldHJ5YWJsZShjb2RlOiBFcnJvckNvZGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gW1xuICAgICAgRXJyb3JDb2RlLkFJX0VSUk9SLFxuICAgICAgRXJyb3JDb2RlLlNUT1JBR0VfRVJST1IsXG4gICAgICBFcnJvckNvZGUuREFUQUJBU0VfRVJST1IsXG4gICAgICBFcnJvckNvZGUuUkFURV9MSU1JVEVELFxuICAgICAgRXJyb3JDb2RlLlNFUlZJQ0VfVU5BVkFJTEFCTEVcbiAgICBdLmluY2x1ZGVzKGNvZGUpO1xuICB9XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGV4dHJhY3QgZXJyb3IgY29kZSBmcm9tIHZhcmlvdXMgZXJyb3IgdHlwZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVycm9yQ29kZShlcnJvcjogdW5rbm93bik6IEVycm9yQ29kZSB7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgLy8gQ2hlY2sgZm9yIHNwZWNpZmljIGVycm9yIHBhdHRlcm5zXG4gICAgY29uc3QgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UudG9Mb3dlckNhc2UoKTtcbiAgICBcbiAgICBpZiAobWVzc2FnZS5pbmNsdWRlcygnbm90IGZvdW5kJykpIHJldHVybiBFcnJvckNvZGUuTk9UX0ZPVU5EO1xuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCd1bmF1dGhvcml6ZWQnKSkgcmV0dXJuIEVycm9yQ29kZS5VTkFVVEhPUklaRUQ7XG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ2ZvcmJpZGRlbicpKSByZXR1cm4gRXJyb3JDb2RlLkZPUkJJRERFTjtcbiAgICBpZiAobWVzc2FnZS5pbmNsdWRlcygndmFsaWRhdGlvbicpKSByZXR1cm4gRXJyb3JDb2RlLlZBTElEQVRJT05fRkFJTEVEO1xuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdhbHJlYWR5IGV4aXN0cycpKSByZXR1cm4gRXJyb3JDb2RlLkFMUkVBRFlfRVhJU1RTO1xuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdyYXRlIGxpbWl0JykpIHJldHVybiBFcnJvckNvZGUuUkFURV9MSU1JVEVEO1xuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdhaScpIHx8IG1lc3NhZ2UuaW5jbHVkZXMoJ29wZW5haScpIHx8IG1lc3NhZ2UuaW5jbHVkZXMoJ2dwdCcpKSByZXR1cm4gRXJyb3JDb2RlLkFJX0VSUk9SO1xuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdkYXRhYmFzZScpIHx8IG1lc3NhZ2UuaW5jbHVkZXMoJ2RiJykpIHJldHVybiBFcnJvckNvZGUuREFUQUJBU0VfRVJST1I7XG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ3N0b3JhZ2UnKSB8fCBtZXNzYWdlLmluY2x1ZGVzKCd1cGxvYWQnKSkgcmV0dXJuIEVycm9yQ29kZS5TVE9SQUdFX0VSUk9SO1xuICB9XG4gIFxuICByZXR1cm4gRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBsb2cgcmVzcG9uc2VzIGNvbnNpc3RlbnRseVxuICovXG5leHBvcnQgZnVuY3Rpb24gbG9nUmVzcG9uc2U8VD4ocmVzcG9uc2U6IFVuaXZlcnNhbFJlc3BvbnNlPFQ+LCBsb2dnZXI6IGFueSk6IHZvaWQge1xuICBjb25zdCBsb2dEYXRhID0ge1xuICAgIHJlcXVlc3RJZDogcmVzcG9uc2UubWV0YS5yZXF1ZXN0SWQsXG4gICAgb3BlcmF0aW9uOiByZXNwb25zZS5tZXRhLm9wZXJhdGlvbixcbiAgICBlbnRpdHk6IHJlc3BvbnNlLm1ldGEuZW50aXR5LFxuICAgIHN1Y2Nlc3M6IHJlc3BvbnNlLm1ldGEuc3VjY2VzcyxcbiAgICBleGVjdXRpb25UaW1lTXM6IHJlc3BvbnNlLm1ldGEuZXhlY3V0aW9uVGltZU1zLFxuICAgIGFmZmVjdGVkSWRzOiByZXNwb25zZS5tZXRhLmFmZmVjdGVkSWRzLFxuICB9O1xuICBcbiAgaWYgKHJlc3BvbnNlLm1ldGEuc3VjY2Vzcykge1xuICAgIGxvZ2dlci5pbmZvKGBbJHtyZXNwb25zZS5tZXRhLnJlcXVlc3RJZH1dICR7cmVzcG9uc2UubWV0YS5vcGVyYXRpb259IGNvbXBsZXRlZGAsIGxvZ0RhdGEpO1xuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5lcnJvcihgWyR7cmVzcG9uc2UubWV0YS5yZXF1ZXN0SWR9XSAke3Jlc3BvbnNlLm1ldGEub3BlcmF0aW9ufSBmYWlsZWRgLCB7XG4gICAgICAuLi5sb2dEYXRhLFxuICAgICAgZXJyb3I6IHJlc3BvbnNlLmVycm9yXG4gICAgfSk7XG4gIH1cbn0iXSwibmFtZXMiOlsiRXJyb3JDb2RlIiwiZ2VuZXJhdGVSZXF1ZXN0SWQiLCJjcnlwdG8iLCJyYW5kb21VVUlEIiwicmVwbGFjZSIsInN1YnN0cmluZyIsInRvVXBwZXJDYXNlIiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwiTWF0aCIsInJhbmRvbSIsIlJlc3BvbnNlQnVpbGRlciIsImNvbnN0cnVjdG9yIiwicmVxdWVzdElkIiwic3RhcnRUaW1lIiwic3VjY2VzcyIsImRhdGEiLCJvcGVyYXRpb24iLCJlbnRpdHkiLCJhZmZlY3RlZElkcyIsIm1ldGEiLCJ0aW1lc3RhbXAiLCJleGVjdXRpb25UaW1lTXMiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsInJldHJ5YWJsZSIsImlzUmV0cnlhYmxlIiwid2l0aENvbnRleHQiLCJyZXNwb25zZSIsImNvbnRleHQiLCJnZXRSZXF1ZXN0SWQiLCJnZXRFeGVjdXRpb25UaW1lIiwiQUlfRVJST1IiLCJTVE9SQUdFX0VSUk9SIiwiREFUQUJBU0VfRVJST1IiLCJSQVRFX0xJTUlURUQiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiaW5jbHVkZXMiLCJnZXRFcnJvckNvZGUiLCJFcnJvciIsInRvTG93ZXJDYXNlIiwiTk9UX0ZPVU5EIiwiVU5BVVRIT1JJWkVEIiwiRk9SQklEREVOIiwiVkFMSURBVElPTl9GQUlMRUQiLCJBTFJFQURZX0VYSVNUUyIsIklOVEVSTkFMX0VSUk9SIiwibG9nUmVzcG9uc2UiLCJsb2dnZXIiLCJsb2dEYXRhIiwiaW5mbyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/api/response-helpers.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/types/ai/brain.types.ts":
/*!*****************************************!*\
  !*** ./src/lib/types/ai/brain.types.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TOOL_OPERATION_MAP: () => (/* binding */ TOOL_OPERATION_MAP),\n/* harmony export */   isValidToolName: () => (/* binding */ isValidToolName)\n/* harmony export */ });\n/**\n * Brain/AI Types - Consolidated\n * Single source of truth for all AI/orchestration related types\n * \n * IMPORTANT: We use simple, flat architecture - no complexity types\n * Field names MUST match database: tsxCode (not code), name (not sceneName)\n */ // ============================================================================\n// TOOL NAMES - Only the 4 actual tools we have\n// ============================================================================\n// ============================================================================\n// TOOL TO OPERATION MAPPING - Single source of truth\n// ============================================================================\nconst TOOL_OPERATION_MAP = {\n    addScene: 'scene.create',\n    editScene: 'scene.update',\n    trimScene: 'scene.update',\n    deleteScene: 'scene.delete'\n};\n// ============================================================================\n// TYPE GUARDS\n// ============================================================================\nfunction isValidToolName(value) {\n    return [\n        'addScene',\n        'editScene',\n        'deleteScene',\n        'trimScene'\n    ].includes(value);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3R5cGVzL2FpL2JyYWluLnR5cGVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7OztDQU1DLEdBRUQsK0VBQStFO0FBQy9FLCtDQUErQztBQUMvQywrRUFBK0U7QUFJL0UsK0VBQStFO0FBQy9FLHFEQUFxRDtBQUNyRCwrRUFBK0U7QUFFeEUsTUFBTUEscUJBQXFCO0lBQ2hDQyxVQUFVO0lBQ1ZDLFdBQVc7SUFDWEMsV0FBVztJQUNYQyxhQUFhO0FBQ2YsRUFBVztBQTZKWCwrRUFBK0U7QUFDL0UsY0FBYztBQUNkLCtFQUErRTtBQUV4RSxTQUFTQyxnQkFBZ0JDLEtBQWE7SUFDM0MsT0FBTztRQUFDO1FBQVk7UUFBYTtRQUFlO0tBQVksQ0FBQ0MsUUFBUSxDQUFDRDtBQUN4RSIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2xpYi90eXBlcy9haS9icmFpbi50eXBlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJyYWluL0FJIFR5cGVzIC0gQ29uc29saWRhdGVkXG4gKiBTaW5nbGUgc291cmNlIG9mIHRydXRoIGZvciBhbGwgQUkvb3JjaGVzdHJhdGlvbiByZWxhdGVkIHR5cGVzXG4gKiBcbiAqIElNUE9SVEFOVDogV2UgdXNlIHNpbXBsZSwgZmxhdCBhcmNoaXRlY3R1cmUgLSBubyBjb21wbGV4aXR5IHR5cGVzXG4gKiBGaWVsZCBuYW1lcyBNVVNUIG1hdGNoIGRhdGFiYXNlOiB0c3hDb2RlIChub3QgY29kZSksIG5hbWUgKG5vdCBzY2VuZU5hbWUpXG4gKi9cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVE9PTCBOQU1FUyAtIE9ubHkgdGhlIDQgYWN0dWFsIHRvb2xzIHdlIGhhdmVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgVG9vbE5hbWUgPSAnYWRkU2NlbmUnIHwgJ2VkaXRTY2VuZScgfCAnZGVsZXRlU2NlbmUnIHwgJ3RyaW1TY2VuZSc7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRPT0wgVE8gT1BFUkFUSU9OIE1BUFBJTkcgLSBTaW5nbGUgc291cmNlIG9mIHRydXRoXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBUT09MX09QRVJBVElPTl9NQVAgPSB7XG4gIGFkZFNjZW5lOiAnc2NlbmUuY3JlYXRlJyxcbiAgZWRpdFNjZW5lOiAnc2NlbmUudXBkYXRlJyxcbiAgdHJpbVNjZW5lOiAnc2NlbmUudXBkYXRlJyxcbiAgZGVsZXRlU2NlbmU6ICdzY2VuZS5kZWxldGUnXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBUb29sT3BlcmF0aW9uVHlwZSA9IHR5cGVvZiBUT09MX09QRVJBVElPTl9NQVBbVG9vbE5hbWVdO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBCUkFJTiBERUNJU0lPTiAtIFdoYXQgdGhlIG9yY2hlc3RyYXRvciByZXR1cm5zXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnJhaW5EZWNpc2lvbiB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIFxuICAvLyBUb29sIHNlbGVjdGlvblxuICB0b29sTmFtZT86IFRvb2xOYW1lO1xuICBcbiAgLy8gQ29udGV4dCBmb3IgdGhlIHNlbGVjdGVkIHRvb2xcbiAgdG9vbENvbnRleHQ/OiB7XG4gICAgdXNlclByb21wdDogc3RyaW5nO1xuICAgIHRhcmdldFNjZW5lSWQ/OiBzdHJpbmc7XG4gICAgdGFyZ2V0RHVyYXRpb24/OiBudW1iZXI7IC8vIEZvciB0cmltIG9wZXJhdGlvbnNcbiAgICByZWZlcmVuY2VkU2NlbmVJZHM/OiBzdHJpbmdbXTsgLy8gRm9yIGNyb3NzLXNjZW5lIHJlZmVyZW5jZXNcbiAgICBpbWFnZVVybHM/OiBzdHJpbmdbXTtcbiAgICB2aXNpb25BbmFseXNpcz86IGFueTtcbiAgICBlcnJvckRldGFpbHM/OiBzdHJpbmc7XG4gICAgd2ViQ29udGV4dD86IHtcbiAgICAgIG9yaWdpbmFsVXJsOiBzdHJpbmc7XG4gICAgICBzY3JlZW5zaG90VXJsczoge1xuICAgICAgICBkZXNrdG9wOiBzdHJpbmc7XG4gICAgICAgIG1vYmlsZTogc3RyaW5nO1xuICAgICAgfTtcbiAgICAgIHBhZ2VEYXRhOiB7XG4gICAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgICBoZWFkaW5nczogc3RyaW5nW107XG4gICAgICAgIHVybDogc3RyaW5nO1xuICAgICAgfTtcbiAgICAgIGFuYWx5emVkQXQ6IHN0cmluZztcbiAgICB9O1xuICB9O1xuICBcbiAgLy8gQnJhaW4ncyByZWFzb25pbmdcbiAgcmVhc29uaW5nPzogc3RyaW5nO1xuICBcbiAgLy8gQ2hhdCByZXNwb25zZSB0byBzaG93IHVzZXJcbiAgY2hhdFJlc3BvbnNlPzogc3RyaW5nO1xuICBcbiAgLy8gRXJyb3IgaWYgZGVjaXNpb24gZmFpbGVkXG4gIGVycm9yPzogc3RyaW5nO1xuICBcbiAgLy8gQ2xhcmlmaWNhdGlvbiBuZWVkZWRcbiAgbmVlZHNDbGFyaWZpY2F0aW9uPzogYm9vbGVhbjtcbiAgY2xhcmlmaWNhdGlvblF1ZXN0aW9uPzogc3RyaW5nO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBPUkNIRVNUUkFUSU9OIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3JjaGVzdHJhdGlvbklucHV0IHtcbiAgcHJvbXB0OiBzdHJpbmc7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgdXNlckNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgc3Rvcnlib2FyZFNvRmFyPzogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGR1cmF0aW9uOiBudW1iZXI7XG4gICAgb3JkZXI6IG51bWJlcjtcbiAgICB0c3hDb2RlOiBzdHJpbmc7XG4gIH0+O1xuICBjaGF0SGlzdG9yeT86IEFycmF5PHtyb2xlOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZ30+O1xuICBvblByb2dyZXNzPzogKHN0YWdlOiBzdHJpbmcsIHN0YXR1czogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9yY2hlc3RyYXRpb25PdXRwdXQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICByZXN1bHQ/OiB7XG4gICAgdG9vbE5hbWU6IFRvb2xOYW1lO1xuICAgIHRvb2xDb250ZXh0OiBCcmFpbkRlY2lzaW9uWyd0b29sQ29udGV4dCddO1xuICB9O1xuICByZWFzb25pbmc/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xuICBjaGF0UmVzcG9uc2U/OiBzdHJpbmc7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENPTlRFWFQgUEFDS0VUIC0gV2hhdCBjb250ZXh0IGJ1aWxkZXIgY3JlYXRlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRleHRQYWNrZXQge1xuICAvLyBSZWFsIHNjZW5lIGhpc3Rvcnkgd2l0aCBmdWxsIFRTWCBjb2RlIGZvciBjcm9zcy1zY2VuZSBvcGVyYXRpb25zXG4gIHNjZW5lSGlzdG9yeTogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHRzeENvZGU6IHN0cmluZzsgIC8vIENSSVRJQ0FMOiBGdWxsIGNvZGUgZm9yIGNyb3NzLXNjZW5lIHJlZmVyZW5jZXNcbiAgICBvcmRlcjogbnVtYmVyO1xuICB9PjtcbiAgXG4gIC8vIFJlY2VudCBjb252ZXJzYXRpb24gY29udGV4dFxuICBjb252ZXJzYXRpb25Db250ZXh0OiBzdHJpbmc7XG4gIHJlY2VudE1lc3NhZ2VzOiBBcnJheTx7XG4gICAgcm9sZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgfT47XG4gIFxuICAvLyBJbWFnZSBjb250ZXh0IGZyb20gdXBsb2Fkc1xuICBpbWFnZUNvbnRleHQ6IHtcbiAgICBjdXJyZW50SW1hZ2VzPzogc3RyaW5nW107XG4gICAgcmVjZW50SW1hZ2VzRnJvbUNoYXQ/OiBBcnJheTx7XG4gICAgICBwb3NpdGlvbjogbnVtYmVyO1xuICAgICAgdXNlclByb21wdDogc3RyaW5nO1xuICAgICAgaW1hZ2VVcmxzOiBzdHJpbmdbXTtcbiAgICB9PjtcbiAgfTtcbiAgXG4gIC8vIFdlYiBhbmFseXNpcyBjb250ZXh0IGZyb20gVVJMIGRldGVjdGlvblxuICB3ZWJDb250ZXh0Pzoge1xuICAgIG9yaWdpbmFsVXJsOiBzdHJpbmc7XG4gICAgc2NyZWVuc2hvdFVybHM6IHtcbiAgICAgIGRlc2t0b3A6IHN0cmluZztcbiAgICAgIG1vYmlsZTogc3RyaW5nO1xuICAgIH07XG4gICAgcGFnZURhdGE6IHtcbiAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICAgIGhlYWRpbmdzOiBzdHJpbmdbXTtcbiAgICAgIHVybDogc3RyaW5nO1xuICAgIH07XG4gICAgYW5hbHl6ZWRBdDogc3RyaW5nO1xuICB9O1xuICBcbiAgLy8gU2NlbmUgbGlzdCBmb3IgcXVpY2sgcmVmZXJlbmNlXG4gIHNjZW5lTGlzdDogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIG9yZGVyOiBudW1iZXI7XG4gIH0+O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUT09MIFNFTEVDVElPTiBSRVNVTFQgLSBJbnRlcm5hbCB1c2UgYnkgaW50ZW50IGFuYWx5emVyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbFNlbGVjdGlvblJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHRvb2xOYW1lPzogVG9vbE5hbWU7XG4gIHRhcmdldFNjZW5lSWQ/OiBzdHJpbmc7XG4gIHRhcmdldER1cmF0aW9uPzogbnVtYmVyOyAvLyBGb3IgdHJpbSBvcGVyYXRpb25zIC0gZXhhY3QgZnJhbWUgY291bnRcbiAgcmVmZXJlbmNlZFNjZW5lSWRzPzogc3RyaW5nW107IC8vIEZvciBjcm9zcy1zY2VuZSBzdHlsZS9jb2xvciBtYXRjaGluZ1xuICByZWFzb25pbmc/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xuICBuZWVkc0NsYXJpZmljYXRpb24/OiBib29sZWFuO1xuICBjbGFyaWZpY2F0aW9uUXVlc3Rpb24/OiBzdHJpbmc7XG4gIHVzZXJGZWVkYmFjaz86IHN0cmluZztcbiAgcmVxdWVzdGVkRHVyYXRpb25TZWNvbmRzPzogbnVtYmVyO1xuICB3b3JrZmxvdz86IEFycmF5PGFueT47XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEUgR1VBUkRTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkVG9vbE5hbWUodmFsdWU6IHN0cmluZyk6IHZhbHVlIGlzIFRvb2xOYW1lIHtcbiAgcmV0dXJuIFsnYWRkU2NlbmUnLCAnZWRpdFNjZW5lJywgJ2RlbGV0ZVNjZW5lJywgJ3RyaW1TY2VuZSddLmluY2x1ZGVzKHZhbHVlKTtcbn0iXSwibmFtZXMiOlsiVE9PTF9PUEVSQVRJT05fTUFQIiwiYWRkU2NlbmUiLCJlZGl0U2NlbmUiLCJ0cmltU2NlbmUiLCJkZWxldGVTY2VuZSIsImlzVmFsaWRUb29sTmFtZSIsInZhbHVlIiwiaW5jbHVkZXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/types/ai/brain.types.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/types/api/universal.ts":
/*!****************************************!*\
  !*** ./src/lib/types/api/universal.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ErrorCode: () => (/* binding */ ErrorCode),\n/* harmony export */   isErrorResponse: () => (/* binding */ isErrorResponse),\n/* harmony export */   isSuccessResponse: () => (/* binding */ isSuccessResponse)\n/* harmony export */ });\n/**\n * Universal response format for ALL API operations\n * Every single endpoint MUST return this format\n */ // Import entities from generated types (TICKET-001)\n// Standardized error codes\nvar ErrorCode = /*#__PURE__*/ function(ErrorCode) {\n    // Validation errors\n    ErrorCode[\"VALIDATION_FAILED\"] = \"VALIDATION_FAILED\";\n    ErrorCode[\"INVALID_INPUT\"] = \"INVALID_INPUT\";\n    // Resource errors\n    ErrorCode[\"NOT_FOUND\"] = \"NOT_FOUND\";\n    ErrorCode[\"ALREADY_EXISTS\"] = \"ALREADY_EXISTS\";\n    // Permission errors\n    ErrorCode[\"UNAUTHORIZED\"] = \"UNAUTHORIZED\";\n    ErrorCode[\"FORBIDDEN\"] = \"FORBIDDEN\";\n    // External service errors\n    ErrorCode[\"AI_ERROR\"] = \"AI_ERROR\";\n    ErrorCode[\"STORAGE_ERROR\"] = \"STORAGE_ERROR\";\n    ErrorCode[\"DATABASE_ERROR\"] = \"DATABASE_ERROR\";\n    // System errors\n    ErrorCode[\"INTERNAL_ERROR\"] = \"INTERNAL_ERROR\";\n    ErrorCode[\"RATE_LIMITED\"] = \"RATE_LIMITED\";\n    ErrorCode[\"SERVICE_UNAVAILABLE\"] = \"SERVICE_UNAVAILABLE\";\n    return ErrorCode;\n}({});\n// Type guards for better TypeScript support\nfunction isSuccessResponse(response) {\n    return response.meta.success === true && response.data !== null;\n}\nfunction isErrorResponse(response) {\n    return response.meta.success === false && response.error !== undefined;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3R5cGVzL2FwaS91bml2ZXJzYWwudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7OztDQUdDLEdBRUQsb0RBQW9EO0FBb0RwRCwyQkFBMkI7QUFDcEIsdUNBQUtBO0lBQ1Ysb0JBQW9COzs7SUFJcEIsa0JBQWtCOzs7SUFJbEIsb0JBQW9COzs7SUFJcEIsMEJBQTBCOzs7O0lBSzFCLGdCQUFnQjs7OztXQWxCTkE7TUFzQlg7QUFFRCw0Q0FBNEM7QUFDckMsU0FBU0Msa0JBQXFCQyxRQUE4QjtJQUNqRSxPQUFPQSxTQUFTQyxJQUFJLENBQUNDLE9BQU8sS0FBSyxRQUFRRixTQUFTRyxJQUFJLEtBQUs7QUFDN0Q7QUFFTyxTQUFTQyxnQkFBbUJKLFFBQThCO0lBQy9ELE9BQU9BLFNBQVNDLElBQUksQ0FBQ0MsT0FBTyxLQUFLLFNBQVNGLFNBQVNLLEtBQUssS0FBS0M7QUFDL0QiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9saWIvdHlwZXMvYXBpL3VuaXZlcnNhbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXZlcnNhbCByZXNwb25zZSBmb3JtYXQgZm9yIEFMTCBBUEkgb3BlcmF0aW9uc1xuICogRXZlcnkgc2luZ2xlIGVuZHBvaW50IE1VU1QgcmV0dXJuIHRoaXMgZm9ybWF0XG4gKi9cblxuLy8gSW1wb3J0IGVudGl0aWVzIGZyb20gZ2VuZXJhdGVkIHR5cGVzIChUSUNLRVQtMDAxKVxuaW1wb3J0IHR5cGUgeyBTY2VuZUVudGl0eSB9IGZyb20gXCJ+L2dlbmVyYXRlZC9lbnRpdGllc1wiO1xuXG4vKipcbiAqIFRoZSB1bml2ZXJzYWwgcmVzcG9uc2Ugd3JhcHBlciB0aGF0IGVuc3VyZXMgY29uc2lzdGVuY3lcbiAqIEB0ZW1wbGF0ZSBURGF0YSAtIFRoZSBhY3R1YWwgZGF0YSB0eXBlIGJlaW5nIHJldHVybmVkXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVW5pdmVyc2FsUmVzcG9uc2U8VERhdGEgPSB1bmtub3duPiB7XG4gIC8vIFRoZSBhY3R1YWwgZGF0YSAobnVsbCBvbiBlcnJvcilcbiAgZGF0YTogVERhdGE7XG4gIFxuICAvLyBNZXRhZGF0YSBhYm91dCB0aGUgb3BlcmF0aW9uXG4gIG1ldGE6IHtcbiAgICByZXF1ZXN0SWQ6IHN0cmluZzsgICAgICAvLyBVbmlxdWUgSUQgZm9yIHRyYWNpbmdcbiAgICB0aW1lc3RhbXA6IG51bWJlcjsgICAgICAvLyBXaGVuIHJlc3BvbnNlIHdhcyBjcmVhdGVkXG4gICAgb3BlcmF0aW9uOiBPcGVyYXRpb247ICAgLy8gV2hhdCBvcGVyYXRpb24gd2FzIHBlcmZvcm1lZFxuICAgIGVudGl0eTogRW50aXR5OyAgICAgICAgIC8vIFdoYXQgZW50aXR5IHdhcyBhZmZlY3RlZFxuICAgIHN1Y2Nlc3M6IGJvb2xlYW47ICAgICAgIC8vIERpZCBpdCBzdWNjZWVkP1xuICAgIGFmZmVjdGVkSWRzOiBzdHJpbmdbXTsgIC8vIFdoYXQgSURzIHdlcmUgY3JlYXRlZC91cGRhdGVkL2RlbGV0ZWRcbiAgICBleGVjdXRpb25UaW1lTXM6IG51bWJlcjsgLy8gSG93IGxvbmcgaXQgdG9va1xuICB9O1xuICBcbiAgLy8gT3B0aW9uYWwgY29udGV4dCAocmVhc29uaW5nLCBzdWdnZXN0aW9ucywgZXRjKVxuICBjb250ZXh0Pzoge1xuICAgIHJlYXNvbmluZz86IHN0cmluZzsgICAgICAvLyBXaHkgdGhlIEFJIG1hZGUgdGhpcyBkZWNpc2lvblxuICAgIGNoYXRSZXNwb25zZT86IHN0cmluZzsgICAvLyBNZXNzYWdlIGZvciB0aGUgdXNlclxuICAgIHN1Z2dlc3Rpb25zPzogc3RyaW5nW107ICAvLyBXaGF0IHVzZXIgY291bGQgZG8gbmV4dFxuICB9O1xuICBcbiAgLy8gRXJyb3IgaW5mb3JtYXRpb24gKG9ubHkgcHJlc2VudCBvbiBmYWlsdXJlKVxuICBlcnJvcj86IHtcbiAgICBjb2RlOiBFcnJvckNvZGU7ICAgICAgICAvLyBTdGFuZGFyZGl6ZWQgZXJyb3IgY29kZVxuICAgIG1lc3NhZ2U6IHN0cmluZzsgICAgICAgIC8vIEh1bWFuLXJlYWRhYmxlIG1lc3NhZ2VcbiAgICBkZXRhaWxzPzogdW5rbm93bjsgICAgICAvLyBUZWNobmljYWwgZGV0YWlscyBmb3IgZGVidWdnaW5nXG4gICAgcmV0cnlhYmxlOiBib29sZWFuOyAgICAgLy8gQ2FuIHRoaXMgYmUgcmV0cmllZD9cbiAgfTtcbn1cblxuLy8gQWxsIHBvc3NpYmxlIG9wZXJhdGlvbnMgaW4gdGhlIHN5c3RlbVxuZXhwb3J0IHR5cGUgT3BlcmF0aW9uID0gXG4gIHwgJ3NjZW5lLmNyZWF0ZSdcbiAgfCAnc2NlbmUudXBkYXRlJyBcbiAgfCAnc2NlbmUuZGVsZXRlJ1xuICB8ICdzY2VuZS5hbmFseXplJ1xuICB8ICdicmFpbi5kZWNpZGUnXG4gIHwgJ3Byb2plY3QucmVhZCdcbiAgfCAncHJvamVjdC51cGRhdGUnXG4gIHwgJ3VzZXIuYXV0aGVudGljYXRlJztcblxuLy8gQWxsIGVudGl0aWVzIGluIHRoZSBzeXN0ZW1cbmV4cG9ydCB0eXBlIEVudGl0eSA9ICdzY2VuZScgfCAncHJvamVjdCcgfCAndXNlcicgfCAnZGVjaXNpb24nO1xuXG4vLyBTdGFuZGFyZGl6ZWQgZXJyb3IgY29kZXNcbmV4cG9ydCBlbnVtIEVycm9yQ29kZSB7XG4gIC8vIFZhbGlkYXRpb24gZXJyb3JzXG4gIFZBTElEQVRJT05fRkFJTEVEID0gJ1ZBTElEQVRJT05fRkFJTEVEJyxcbiAgSU5WQUxJRF9JTlBVVCA9ICdJTlZBTElEX0lOUFVUJyxcbiAgXG4gIC8vIFJlc291cmNlIGVycm9yc1xuICBOT1RfRk9VTkQgPSAnTk9UX0ZPVU5EJyxcbiAgQUxSRUFEWV9FWElTVFMgPSAnQUxSRUFEWV9FWElTVFMnLFxuICBcbiAgLy8gUGVybWlzc2lvbiBlcnJvcnNcbiAgVU5BVVRIT1JJWkVEID0gJ1VOQVVUSE9SSVpFRCcsXG4gIEZPUkJJRERFTiA9ICdGT1JCSURERU4nLFxuICBcbiAgLy8gRXh0ZXJuYWwgc2VydmljZSBlcnJvcnNcbiAgQUlfRVJST1IgPSAnQUlfRVJST1InLFxuICBTVE9SQUdFX0VSUk9SID0gJ1NUT1JBR0VfRVJST1InLFxuICBEQVRBQkFTRV9FUlJPUiA9ICdEQVRBQkFTRV9FUlJPUicsXG4gIFxuICAvLyBTeXN0ZW0gZXJyb3JzXG4gIElOVEVSTkFMX0VSUk9SID0gJ0lOVEVSTkFMX0VSUk9SJyxcbiAgUkFURV9MSU1JVEVEID0gJ1JBVEVfTElNSVRFRCcsXG4gIFNFUlZJQ0VfVU5BVkFJTEFCTEUgPSAnU0VSVklDRV9VTkFWQUlMQUJMRSdcbn1cblxuLy8gVHlwZSBndWFyZHMgZm9yIGJldHRlciBUeXBlU2NyaXB0IHN1cHBvcnRcbmV4cG9ydCBmdW5jdGlvbiBpc1N1Y2Nlc3NSZXNwb25zZTxUPihyZXNwb25zZTogVW5pdmVyc2FsUmVzcG9uc2U8VD4pOiByZXNwb25zZSBpcyBVbml2ZXJzYWxSZXNwb25zZTxUPiAmIHsgZGF0YTogVCB9IHtcbiAgcmV0dXJuIHJlc3BvbnNlLm1ldGEuc3VjY2VzcyA9PT0gdHJ1ZSAmJiByZXNwb25zZS5kYXRhICE9PSBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNFcnJvclJlc3BvbnNlPFQ+KHJlc3BvbnNlOiBVbml2ZXJzYWxSZXNwb25zZTxUPik6IHJlc3BvbnNlIGlzIFVuaXZlcnNhbFJlc3BvbnNlPFQ+ICYgeyBlcnJvcjogTm9uTnVsbGFibGU8VW5pdmVyc2FsUmVzcG9uc2U8VD5bJ2Vycm9yJ10+IH0ge1xuICByZXR1cm4gcmVzcG9uc2UubWV0YS5zdWNjZXNzID09PSBmYWxzZSAmJiByZXNwb25zZS5lcnJvciAhPT0gdW5kZWZpbmVkO1xufVxuXG4vLyBDb21tb24gcmVzcG9uc2UgdHlwZXMgZm9yIHNjZW5lc1xuZXhwb3J0IHR5cGUgU2NlbmVDcmVhdGVSZXNwb25zZSA9IFVuaXZlcnNhbFJlc3BvbnNlPFNjZW5lRW50aXR5PjtcbmV4cG9ydCB0eXBlIFNjZW5lVXBkYXRlUmVzcG9uc2UgPSBVbml2ZXJzYWxSZXNwb25zZTxTY2VuZUVudGl0eT47XG5leHBvcnQgdHlwZSBTY2VuZURlbGV0ZVJlc3BvbnNlID0gVW5pdmVyc2FsUmVzcG9uc2U8eyBkZWxldGVkSWQ6IHN0cmluZyB9PjtcbmV4cG9ydCB0eXBlIFNjZW5lTGlzdFJlc3BvbnNlID0gVW5pdmVyc2FsUmVzcG9uc2U8U2NlbmVFbnRpdHlbXT47Il0sIm5hbWVzIjpbIkVycm9yQ29kZSIsImlzU3VjY2Vzc1Jlc3BvbnNlIiwicmVzcG9uc2UiLCJtZXRhIiwic3VjY2VzcyIsImRhdGEiLCJpc0Vycm9yUmVzcG9uc2UiLCJlcnJvciIsInVuZGVmaW5lZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/types/api/universal.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/types/shared/json-patch.ts":
/*!********************************************!*\
  !*** ./src/lib/types/shared/json-patch.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   jsonPatchSchema: () => (/* binding */ jsonPatchSchema),\n/* harmony export */   operationSchema: () => (/* binding */ operationSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/**\n * RFC-6902 JSON-Patch operation list  the subset we care about for MVP.\n * Later you can switch to `import { Operation } from \"fast-json-patch\"`\n * if you install that lib, the shape is identical.\n */ \n// Based on RFC 6902 JSON Patch standard\nconst operationSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    op: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"add\",\n        \"remove\",\n        \"replace\",\n        \"move\",\n        \"copy\",\n        \"test\"\n    ]),\n    path: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().startsWith(\"/\"),\n    value: zod__WEBPACK_IMPORTED_MODULE_0__.z.unknown().optional(),\n    from: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().startsWith(\"/\").optional()\n});\nconst jsonPatchSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.array(operationSchema);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3R5cGVzL3NoYXJlZC9qc29uLXBhdGNoLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOzs7O0NBSUMsR0FDdUI7QUFFeEIsd0NBQXdDO0FBQ2pDLE1BQU1DLGtCQUFrQkQsa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUN0Q0MsSUFBSUgsa0NBQUNBLENBQUNJLElBQUksQ0FBQztRQUFDO1FBQU87UUFBVTtRQUFXO1FBQVE7UUFBUTtLQUFPO0lBQy9EQyxNQUFNTCxrQ0FBQ0EsQ0FBQ00sTUFBTSxHQUFHQyxVQUFVLENBQUM7SUFDNUJDLE9BQU9SLGtDQUFDQSxDQUFDUyxPQUFPLEdBQUdDLFFBQVE7SUFDM0JDLE1BQU1YLGtDQUFDQSxDQUFDTSxNQUFNLEdBQUdDLFVBQVUsQ0FBQyxLQUFLRyxRQUFRO0FBQzNDLEdBQUc7QUFFSSxNQUFNRSxrQkFBa0JaLGtDQUFDQSxDQUFDYSxLQUFLLENBQUNaLGlCQUFpQiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2xpYi90eXBlcy9zaGFyZWQvanNvbi1wYXRjaC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJGQy02OTAyIEpTT04tUGF0Y2ggb3BlcmF0aW9uIGxpc3Qg4oCTIHRoZSBzdWJzZXQgd2UgY2FyZSBhYm91dCBmb3IgTVZQLlxuICogTGF0ZXIgeW91IGNhbiBzd2l0Y2ggdG8gYGltcG9ydCB7IE9wZXJhdGlvbiB9IGZyb20gXCJmYXN0LWpzb24tcGF0Y2hcImBcbiAqIGlmIHlvdSBpbnN0YWxsIHRoYXQgbGliLCB0aGUgc2hhcGUgaXMgaWRlbnRpY2FsLlxuICovXG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuXG4vLyBCYXNlZCBvbiBSRkMgNjkwMiBKU09OIFBhdGNoIHN0YW5kYXJkXG5leHBvcnQgY29uc3Qgb3BlcmF0aW9uU2NoZW1hID0gei5vYmplY3Qoe1xuICBvcDogei5lbnVtKFtcImFkZFwiLCBcInJlbW92ZVwiLCBcInJlcGxhY2VcIiwgXCJtb3ZlXCIsIFwiY29weVwiLCBcInRlc3RcIl0pLFxuICBwYXRoOiB6LnN0cmluZygpLnN0YXJ0c1dpdGgoXCIvXCIpLFxuICB2YWx1ZTogei51bmtub3duKCkub3B0aW9uYWwoKSxcbiAgZnJvbTogei5zdHJpbmcoKS5zdGFydHNXaXRoKFwiL1wiKS5vcHRpb25hbCgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBqc29uUGF0Y2hTY2hlbWEgPSB6LmFycmF5KG9wZXJhdGlvblNjaGVtYSk7XG5cbmV4cG9ydCB0eXBlIEpzb25QYXRjaE9wZXJhdGlvbiA9IHouaW5mZXI8dHlwZW9mIG9wZXJhdGlvblNjaGVtYT47XG5leHBvcnQgdHlwZSBKc29uUGF0Y2ggPSB6LmluZmVyPHR5cGVvZiBqc29uUGF0Y2hTY2hlbWE+OyJdLCJuYW1lcyI6WyJ6Iiwib3BlcmF0aW9uU2NoZW1hIiwib2JqZWN0Iiwib3AiLCJlbnVtIiwicGF0aCIsInN0cmluZyIsInN0YXJ0c1dpdGgiLCJ2YWx1ZSIsInVua25vd24iLCJvcHRpb25hbCIsImZyb20iLCJqc29uUGF0Y2hTY2hlbWEiLCJhcnJheSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/types/shared/json-patch.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/types/video/remotion-constants.ts":
/*!***************************************************!*\
  !*** ./src/lib/types/video/remotion-constants.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BG_COLOR_ANIMATIONS: () => (/* binding */ BG_COLOR_ANIMATIONS),\n/* harmony export */   COMP_NAME: () => (/* binding */ COMP_NAME),\n/* harmony export */   CompositionProps: () => (/* binding */ CompositionProps),\n/* harmony export */   DEFAULT_PROJECT_PROPS: () => (/* binding */ DEFAULT_PROJECT_PROPS),\n/* harmony export */   DIRECTIONS: () => (/* binding */ DIRECTIONS),\n/* harmony export */   DURATION_IN_FRAMES: () => (/* binding */ DURATION_IN_FRAMES),\n/* harmony export */   DemoTimelineProps: () => (/* binding */ DemoTimelineProps),\n/* harmony export */   GRADIENT_TYPES: () => (/* binding */ GRADIENT_TYPES),\n/* harmony export */   PARTICLE_TYPES: () => (/* binding */ PARTICLE_TYPES),\n/* harmony export */   SCENE_TYPES: () => (/* binding */ SCENE_TYPES),\n/* harmony export */   SHAPES: () => (/* binding */ SHAPES),\n/* harmony export */   SHAPE_ANIMATIONS: () => (/* binding */ SHAPE_ANIMATIONS),\n/* harmony export */   SVG_ANIMATIONS: () => (/* binding */ SVG_ANIMATIONS),\n/* harmony export */   SVG_ICONS: () => (/* binding */ SVG_ICONS),\n/* harmony export */   TEXT_ANIMATIONS: () => (/* binding */ TEXT_ANIMATIONS),\n/* harmony export */   TRANSITIONS: () => (/* binding */ TRANSITIONS),\n/* harmony export */   VIDEO_FPS: () => (/* binding */ VIDEO_FPS),\n/* harmony export */   VIDEO_HEIGHT: () => (/* binding */ VIDEO_HEIGHT),\n/* harmony export */   VIDEO_WIDTH: () => (/* binding */ VIDEO_WIDTH),\n/* harmony export */   createDefaultProjectProps: () => (/* binding */ createDefaultProjectProps),\n/* harmony export */   defaultDemoProps: () => (/* binding */ defaultDemoProps),\n/* harmony export */   defaultMyCompProps: () => (/* binding */ defaultMyCompProps)\n/* harmony export */ });\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm/v4.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n// src/types/remotion-constants.ts\n// Use a browser-compatible UUID generation approach instead of Node's crypto\n\n\nconst COMP_NAME = \"MyComp\";\nconst CompositionProps = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    title: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n});\nconst defaultMyCompProps = {\n    title: \"Bazaar-Vid\"\n};\nconst DemoTimelineProps = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    title: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n    author: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n    imageUrl: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n});\nconst defaultDemoProps = {\n    title: \"Bazaar-Vid\",\n    author: \"You\",\n    imageUrl: \"/demo.jpg\"\n};\n// Function to generate default project props with a welcome scene\nfunction createDefaultProjectProps() {\n    const welcomeSceneId = (0,uuid__WEBPACK_IMPORTED_MODULE_1__[\"default\"])();\n    return {\n        meta: {\n            duration: 300,\n            title: \"New Project\",\n            backgroundColor: \"#0f0f23\"\n        },\n        scenes: [\n            {\n                id: welcomeSceneId,\n                type: \"welcome\",\n                start: 0,\n                duration: 300,\n                data: {\n                    name: \"Welcome Scene\",\n                    code: `//src/remotion/components/scenes/WelcomeScene.tsx\nconst { AbsoluteFill, useCurrentFrame, useVideoConfig, interpolate, random, spring, Sequence, Img } = window.Remotion;\n\nexport default function WelcomeScene({\n  title = \"Welcome to Bazaar\",\n  subtitle = \"Transform Your Ideas Into Motion\",\n  backgroundColor = \"#0f0f23\",\n  textColor = \"#ffffff\"\n}) {\n  const frame = useCurrentFrame();\n  const { fps, durationInFrames, width, height } = useVideoConfig();\n\n  // Multi-stage animation sequences (10 seconds total)\n  // Stage 1: Logo reveal (0-2s)\n  // Stage 2: Main title and subtitle (1.5-3.5s)\n  // Stage 3: Feature showcase (3.5-6s) - FAST!\n  // Stage 4: Call to action (6-10s)\n\n  // Global exit animation (last 1 second)\n  const exitStart = durationInFrames - fps;\n  const globalFadeOut = interpolate(\n    frame,\n    [exitStart, durationInFrames],\n    [1, 0],\n    { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n  );\n  const globalScaleOut = interpolate(\n    frame,\n    [exitStart, durationInFrames],\n    [1, 0.95],\n    { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n  );\n\n  // Responsive sizing based on canvas width\n  const isMobile = width < 600;\n  const isTablet = width < 900;\n\n  // Logo reveal animation (0-2 seconds)\n  const logoRevealStart = 0;\n  const logoRevealEnd = fps * 2;\n  const logoProgress = spring({\n    frame: frame - logoRevealStart,\n    fps,\n    config: {\n      damping: 100,\n      stiffness: 200,\n      mass: 0.5,\n    },\n  });\n\n  // Main title animation (1.5-3.5 seconds)\n  const titleStart = fps * 1.5;\n  const titleEnd = fps * 3.5;\n  const titleOpacity = interpolate(\n    frame,\n    [titleStart, titleStart + fps * 0.8],\n    [0, 1],\n    { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n  );\n  \n  const titleScale = spring({\n    frame: frame - titleStart,\n    fps,\n    config: { damping: 20, stiffness: 100 },\n  });\n\n  // Typewriter effect for title\n  const titleText = title || \"Welcome to Bazaar\";\n  const titleCharsToShow = Math.floor(\n    interpolate(\n      frame,\n      [titleStart, titleStart + fps * 1.2], // 1.2 seconds to type\n      [0, titleText.length],\n      { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n    )\n  );\n  const displayedTitle = titleText.slice(0, titleCharsToShow);\n\n  // Subtitle animation with elegant fade\n  const subtitleStart = fps * 2;\n  const subtitleOpacity = interpolate(\n    frame,\n    [subtitleStart, subtitleStart + fps * 0.5],\n    [0, 1],\n    { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n  );\n\n  // Feature cards animation (3.5-6 seconds) - MUCH FASTER!\n  const featuresStart = fps * 3.5;\n  const feature1Start = featuresStart;\n  const feature2Start = featuresStart + fps * 0.2; // Only 0.2s delay\n  const feature3Start = featuresStart + fps * 0.4; // Only 0.4s delay\n\n  // Call to action animation (6-10 seconds)\n  const ctaStart = fps * 6;\n  const ctaScale = spring({\n    frame: frame - ctaStart,\n    fps,\n    config: { damping: 15, stiffness: 150 },\n  });\n\n  // Typewriter effect for CTA\n  const ctaText = \"Type your first prompt to begin...\";\n  const ctaCharsToShow = Math.floor(\n    interpolate(\n      frame,\n      [ctaStart + fps * 0.5, ctaStart + fps * 2], // 1.5 seconds to type\n      [0, ctaText.length],\n      { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n    )\n  );\n  const displayedCta = ctaText.slice(0, ctaCharsToShow);\n\n  // Advanced background effects\n  const bgGradientAngle = interpolate(\n    frame,\n    [0, durationInFrames],\n    [0, 360],\n    { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n  );\n\n  const bgPulse = Math.sin(frame * 0.02) * 0.1 + 1;\n\n  // Particle system with depth\n  const particleCount = 60;\n  const particles = [...Array(particleCount)].map((_, i) => {\n    const layer = i < 20 ? 'back' : i < 40 ? 'mid' : 'front';\n    const size = layer === 'back' ? 2 : layer === 'mid' ? 3 : 4;\n    const speed = layer === 'back' ? 0.5 : layer === 'mid' ? 1 : 1.5;\n    const opacity = layer === 'back' ? 0.3 : layer === 'mid' ? 0.5 : 0.7;\n    \n    const startX = random(\\`particle-x-\\${i}\\`) * 100;\n    const startY = random(\\`particle-y-\\${i}\\`) * 120 - 10;\n    const amplitude = random(\\`particle-amp-\\${i}\\`) * 20 + 10;\n    \n    const x = startX + Math.sin(frame * 0.02 * speed + i) * amplitude;\n    const y = ((startY + frame * speed * 0.3) % 120) - 10;\n    \n    return { x, y, size, opacity: opacity * interpolate(\n      frame,\n      [0, fps * 2],\n      [0, 1],\n      { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n    )};\n  });\n\n  // Feature card animation helper - FAST entrance\n  const getFeatureAnimation = (startFrame) => {\n    const progress = spring({\n      frame: frame - startFrame,\n      fps,\n      config: { damping: 15, stiffness: 200 }, // Stiffer spring for snappier animation\n    });\n    const slideIn = interpolate(\n      frame,\n      [startFrame, startFrame + fps * 0.3], // Only 0.3 seconds to slide in\n      [50, 0], // Reduced slide distance\n      { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n    );\n    return { progress, slideIn };\n  };\n\n  return (\n    <AbsoluteFill\n      style={{\n        background: \\`\n          radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.1) 0%, transparent 50%),\n          linear-gradient(\\${bgGradientAngle}deg, #0f0f23, #1a0f2e, #0f0f23)\n        \\`,\n        fontFamily: \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif\",\n        position: \"relative\",\n        overflow: \"hidden\",\n        opacity: globalFadeOut,\n        transform: \\`scale(\\${globalScaleOut})\\`,\n        transformOrigin: \"center center\",\n      }}\n    >\n      {/* Animated particle system with depth layers */}\n      <div style={{ position: \"absolute\", inset: 0 }}>\n        {particles.map((particle, i) => (\n          <div\n            key={i}\n            style={{\n              position: \"absolute\",\n              left: \\`\\${particle.x}%\\`,\n              top: \\`\\${particle.y}%\\`,\n              width: \\`\\${particle.size}px\\`,\n              height: \\`\\${particle.size}px\\`,\n              backgroundColor: \"#a855f7\",\n              borderRadius: \"50%\",\n              opacity: particle.opacity,\n              filter: \"blur(1px)\",\n              boxShadow: \"0 0 10px rgba(168, 85, 247, 0.5)\",\n            }}\n          />\n        ))}\n      </div>\n\n      {/* Animated grid background */}\n      <div\n        style={{\n          position: \"absolute\",\n          inset: 0,\n          backgroundImage: \\`\n            repeating-linear-gradient(0deg, rgba(168, 85, 247, 0.03) 0px, transparent 1px, transparent 100px, rgba(168, 85, 247, 0.03) 101px),\n            repeating-linear-gradient(90deg, rgba(168, 85, 247, 0.03) 0px, transparent 1px, transparent 100px, rgba(168, 85, 247, 0.03) 101px)\n          \\`,\n          transform: \\`scale(\\${bgPulse})\\`,\n          opacity: interpolate(frame, [0, fps * 2], [0, 1]),\n        }}\n      />\n\n      {/* Stage 1: Logo reveal */}\n      {frame >= logoRevealStart && frame < logoRevealEnd && (\n        <AbsoluteFill\n          style={{\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            transform: \\`scale(\\${logoProgress})\\`,\n            opacity: interpolate(\n              frame,\n              [logoRevealEnd - fps * 0.3, logoRevealEnd],\n              [1, 0],\n              { extrapolateLeft: \"clamp\", extrapolateRight: \"clamp\" }\n            ),\n          }}\n        >\n          <div\n            style={{\n              width: \"120px\",\n              height: \"120px\",\n              background: \"linear-gradient(135deg, #a855f7, #3b82f6)\",\n              borderRadius: \"30px\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              boxShadow: \"0 20px 60px rgba(168, 85, 247, 0.4)\",\n              transform: \\`rotate(\\${interpolate(frame, [0, fps * 2], [0, 180])}deg)\\`,\n            }}\n          >\n            <div\n              style={{\n                fontSize: \"60px\",\n                fontWeight: \"bold\",\n                color: \"white\",\n                transform: \\`rotate(\\${interpolate(frame, [0, fps * 2], [0, -180])}deg)\\`,\n              }}\n            >\n              B\n            </div>\n          </div>\n        </AbsoluteFill>\n      )}\n\n      {/* Stage 2: Main title and subtitle */}\n      <Sequence from={titleStart} durationInFrames={titleEnd - titleStart}>\n        <AbsoluteFill\n          style={{\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            flexDirection: \"column\",\n          }}\n        >\n          <h1\n            style={{\n              fontSize: isMobile ? \"2.5rem\" : isTablet ? \"3.5rem\" : \"5rem\",\n              fontWeight: \"800\",\n              margin: 0,\n              opacity: titleOpacity,\n              transform: \\`scale(\\${titleScale})\\`,\n              background: \"linear-gradient(135deg, #ffffff, #a855f7, #3b82f6)\",\n              backgroundClip: \"text\",\n              WebkitBackgroundClip: \"text\",\n              WebkitTextFillColor: \"transparent\",\n              letterSpacing: \"-2px\",\n              textAlign: \"center\",\n              filter: \"drop-shadow(0 4px 20px rgba(168, 85, 247, 0.3))\",\n              padding: \"0 20px\",\n            }}\n          >\n            {displayedTitle}\n            <span style={{\n              opacity: Math.floor(frame / 15) % 2 ? 1 : 0,\n              marginLeft: \"2px\"\n            }}>|</span>\n          </h1>\n          \n          <p\n            style={{\n              fontSize: isMobile ? \"1.2rem\" : isTablet ? \"1.5rem\" : \"2rem\",\n              fontWeight: \"300\",\n              color: \"#e0e0e0\",\n              marginTop: \"1rem\",\n              opacity: subtitleOpacity,\n              transform: \\`translateY(\\${interpolate(\n                frame,\n                [subtitleStart, subtitleStart + fps],\n                [30, 0]\n              )}px)\\`,\n              letterSpacing: \"1px\",\n              textAlign: \"center\",\n              padding: \"0 20px\",\n              maxWidth: isMobile ? \"90%\" : \"80%\",\n            }}\n          >\n            {subtitle}\n          </p>\n        </AbsoluteFill>\n      </Sequence>\n\n      {/* Stage 3: Feature showcase */}\n      <Sequence from={featuresStart} durationInFrames={fps * 2.5}>\n        <AbsoluteFill\n          style={{\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            padding: \"0 5%\",\n          }}\n        >\n          <div\n            style={{\n              display: \"flex\",\n              gap: isMobile ? \"1rem\" : \"2rem\",\n              maxWidth: isMobile ? \"100%\" : \"1200px\",\n              width: \"100%\",\n              justifyContent: \"center\",\n              flexWrap: isMobile ? \"nowrap\" : \"wrap\",\n              flexDirection: isMobile ? \"column\" : \"row\",\n              alignItems: \"center\",\n              padding: isMobile ? \"0 20px\" : \"0\",\n            }}\n          >\n            {/* Feature 1: Upload Image */}\n            <div\n              style={{\n                ...getFeatureCardStyle(),\n                transform: \\`translateX(\\${getFeatureAnimation(feature1Start).slideIn}px) scale(\\${getFeatureAnimation(feature1Start).progress})\\`,\n                opacity: getFeatureAnimation(feature1Start).progress,\n              }}\n            >\n              <div style={getIconStyle(\"#a855f7\")}></div>\n              <h3 style={getFeatureTitle()}>Upload Images</h3>\n              <p style={getFeatureDescription()}>\n                Start with your own visuals\n              </p>\n            </div>\n\n            {/* Feature 2: AI Generation */}\n            <div\n              style={{\n                ...getFeatureCardStyle(),\n                transform: \\`translateX(\\${getFeatureAnimation(feature2Start).slideIn}px) scale(\\${getFeatureAnimation(feature2Start).progress})\\`,\n                opacity: getFeatureAnimation(feature2Start).progress,\n              }}\n            >\n              <div style={getIconStyle(\"#3b82f6\")}></div>\n              <h3 style={getFeatureTitle()}>AI-Powered</h3>\n              <p style={getFeatureDescription()}>\n                Generate motion graphics instantly\n              </p>\n            </div>\n\n            {/* Feature 3: Export Ready */}\n            <div\n              style={{\n                ...getFeatureCardStyle(),\n                transform: \\`translateX(\\${getFeatureAnimation(feature3Start).slideIn}px) scale(\\${getFeatureAnimation(feature3Start).progress})\\`,\n                opacity: getFeatureAnimation(feature3Start).progress,\n              }}\n            >\n              <div style={getIconStyle(\"#10b981\")}></div>\n              <h3 style={getFeatureTitle()}>Twitter-Ready</h3>\n              <p style={getFeatureDescription()}>\n                Export in minutes, not hours\n              </p>\n            </div>\n          </div>\n        </AbsoluteFill>\n      </Sequence>\n\n      {/* Stage 4: Call to action */}\n      <Sequence from={ctaStart} durationInFrames={fps * 4}>\n        <AbsoluteFill\n          style={{\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            flexDirection: \"column\",\n          }}\n        >\n          <div\n            style={{\n              transform: \\`scale(\\${ctaScale})\\`,\n              textAlign: \"center\",\n            }}\n          >\n            <div\n              style={{\n                fontSize: \"2.5rem\",\n                fontWeight: \"600\",\n                color: \"white\",\n                marginBottom: \"2rem\",\n                opacity: interpolate(\n                  frame,\n                  [ctaStart, ctaStart + fps],\n                  [0, 1]\n                ),\n              }}\n            >\n              Ready to Create?\n            </div>\n            \n            <div\n              style={{\n                background: \"linear-gradient(135deg, #a855f7, #3b82f6)\",\n                padding: \"1.5rem 3rem\",\n                borderRadius: \"100px\",\n                fontSize: \"1.2rem\",\n                fontWeight: \"600\",\n                color: \"white\",\n                boxShadow: \"0 10px 40px rgba(168, 85, 247, 0.4)\",\n                transform: \\`translateY(\\${interpolate(\n                  frame,\n                  [ctaStart + fps * 0.5, ctaStart + fps * 1.5],\n                  [20, 0]\n                )}px)\\`,\n                opacity: interpolate(\n                  frame,\n                  [ctaStart + fps * 0.5, ctaStart + fps * 1.5],\n                  [0, 1]\n                ),\n              }}\n            >\n              {displayedCta}\n              <span style={{\n                opacity: Math.floor(frame / 15) % 2 ? 1 : 0,\n                marginLeft: \"2px\"\n              }}>|</span>\n            </div>\n\n            {/* Pulsing indicator */}\n            <div\n              style={{\n                marginTop: \"2rem\",\n                display: \"flex\",\n                gap: \"0.5rem\",\n                justifyContent: \"center\",\n                opacity: interpolate(\n                  frame,\n                  [ctaStart + fps * 2, ctaStart + fps * 3],\n                  [0, 1]\n                ),\n              }}\n            >\n              {[0, 1, 2].map((i) => (\n                <div\n                  key={i}\n                  style={{\n                    width: \"8px\",\n                    height: \"8px\",\n                    borderRadius: \"50%\",\n                    backgroundColor: \"#a855f7\",\n                    opacity: Math.sin((frame - ctaStart - fps * 2) * 0.05 + i * 1.5) * 0.5 + 0.5,\n                  }}\n                />\n              ))}\n            </div>\n          </div>\n        </AbsoluteFill>\n      </Sequence>\n    </AbsoluteFill>\n  );\n\n  // Helper functions for consistent styling\n  function getFeatureCardStyle() {\n    return {\n      background: \"rgba(255, 255, 255, 0.05)\",\n      backdropFilter: \"blur(20px)\",\n      border: \"1px solid rgba(255, 255, 255, 0.1)\",\n      borderRadius: \"20px\",\n      padding: isMobile ? \"1.5rem\" : \"2rem\",\n      width: isMobile ? \"100%\" : \"300px\",\n      maxWidth: isMobile ? \"280px\" : \"300px\",\n      textAlign: \"center\",\n      boxShadow: \"0 10px 30px rgba(0, 0, 0, 0.2)\",\n    };\n  }\n\n  function getIconStyle(color) {\n    return {\n      fontSize: \"3rem\",\n      marginBottom: \"1rem\",\n      filter: \\`drop-shadow(0 0 20px \\${color})\\`,\n    };\n  }\n\n  function getFeatureTitle() {\n    return {\n      fontSize: \"1.5rem\",\n      fontWeight: \"600\",\n      color: \"white\",\n      marginBottom: \"0.5rem\",\n    };\n  }\n\n  function getFeatureDescription() {\n    return {\n      fontSize: \"1rem\",\n      color: \"rgba(255, 255, 255, 0.7)\",\n      lineHeight: \"1.5\",\n    };\n  }\n}`,\n                    isWelcomeScene: true\n                }\n            }\n        ]\n    };\n}\n// Legacy constant for backward compatibility - but should not be used for new projects\nconst DEFAULT_PROJECT_PROPS = {\n    meta: {\n        duration: 150,\n        title: \"My First Video\"\n    },\n    scenes: [\n        {\n            id: (0,uuid__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(),\n            type: \"text\",\n            start: 0,\n            duration: 60,\n            data: {\n                text: \"Welcome to your new video\",\n                color: \"#FFFFFF\",\n                fontSize: 70,\n                backgroundColor: \"#000000\"\n            }\n        }\n    ]\n};\n// Constants for scene types\nconst SCENE_TYPES = [\n    \"welcome\",\n    \"text\",\n    \"image\",\n    \"custom\",\n    \"background-color\",\n    \"shape\",\n    \"simple-shape\",\n    \"gradient\",\n    \"particles\",\n    \"text-animation\",\n    \"split-screen\",\n    \"zoom-pan\",\n    \"svg-animation\",\n    \"simple-colored-shape\"\n];\n// Constants for shape types\nconst SHAPES = [\n    \"circle\",\n    \"square\",\n    \"triangle\",\n    \"star\",\n    \"heart\"\n];\n// Constants for transitions\nconst TRANSITIONS = [\n    \"fade\",\n    \"slide\",\n    \"wipe\"\n];\n// Constants for directions\nconst DIRECTIONS = [\n    \"from-left\",\n    \"from-right\",\n    \"from-top\",\n    \"from-bottom\"\n];\n// Constants for text animations\nconst TEXT_ANIMATIONS = [\n    \"typewriter\",\n    \"fadeLetters\",\n    \"slideUp\",\n    \"bounce\",\n    \"wavy\"\n];\n// Constants for shape animations\nconst SHAPE_ANIMATIONS = [\n    \"pulse\",\n    \"rotate\",\n    \"bounce\",\n    \"scale\"\n];\n// Constants for background color animations\nconst BG_COLOR_ANIMATIONS = [\n    \"fade\",\n    \"spring\",\n    \"pulse\"\n];\n// Constants for gradient types\nconst GRADIENT_TYPES = [\n    \"linear\",\n    \"radial\",\n    \"conic\"\n];\n// Constants for particle types\nconst PARTICLE_TYPES = [\n    \"circle\",\n    \"square\",\n    \"dot\",\n    \"star\"\n];\n// Constants for SVG animations\nconst SVG_ANIMATIONS = [\n    \"draw\",\n    \"scale\",\n    \"rotate\",\n    \"fade\",\n    \"moveIn\"\n];\n// Constants for SVG icons\nconst SVG_ICONS = [\n    \"circle\",\n    \"square\",\n    \"triangle\",\n    \"star\",\n    \"heart\",\n    \"checkmark\",\n    \"cross\",\n    \"arrow\"\n];\nconst DURATION_IN_FRAMES = 200;\nconst VIDEO_WIDTH = 1280;\nconst VIDEO_HEIGHT = 720;\nconst VIDEO_FPS = 30;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3R5cGVzL3ZpZGVvL3JlbW90aW9uLWNvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxrQ0FBa0M7QUFDbEMsNkVBQTZFO0FBQ3pDO0FBQ1o7QUFHakIsTUFBTUcsWUFBWSxTQUFTO0FBRTNCLE1BQU1DLG1CQUFtQkYsa0NBQUNBLENBQUNHLE1BQU0sQ0FBQztJQUN2Q0MsT0FBT0osa0NBQUNBLENBQUNLLE1BQU07QUFDakIsR0FBRztBQUVJLE1BQU1DLHFCQUF1RDtJQUNsRUYsT0FBTztBQUNULEVBQUU7QUFFSyxNQUFNRyxvQkFBb0JQLGtDQUFDQSxDQUFDRyxNQUFNLENBQUM7SUFDeENDLE9BQU9KLGtDQUFDQSxDQUFDSyxNQUFNO0lBQ2ZHLFFBQVFSLGtDQUFDQSxDQUFDSyxNQUFNO0lBQ2hCSSxVQUFVVCxrQ0FBQ0EsQ0FBQ0ssTUFBTTtBQUNwQixHQUFHO0FBRUksTUFBTUssbUJBQXNEO0lBQ2pFTixPQUFPO0lBQ1BJLFFBQVE7SUFDUkMsVUFBVTtBQUNaLEVBQUU7QUFFRixrRUFBa0U7QUFDM0QsU0FBU0U7SUFDZCxNQUFNQyxpQkFBaUJiLGdEQUFNQTtJQUU3QixPQUFPO1FBQ0xjLE1BQU07WUFDSkMsVUFBVTtZQUNWVixPQUFPO1lBQ1BXLGlCQUFpQjtRQUNuQjtRQUNBQyxRQUFRO1lBQ047Z0JBQ0VDLElBQUlMO2dCQUNKTSxNQUFNO2dCQUNOQyxPQUFPO2dCQUNQTCxVQUFVO2dCQUNWTSxNQUFNO29CQUNKQyxNQUFNO29CQUNOQyxNQUFNLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0ErZmhCLENBQUM7b0JBQ1FDLGdCQUFnQjtnQkFDbEI7WUFDRjtTQUNEO0lBQ0g7QUFDRjtBQUVBLHVGQUF1RjtBQUNoRixNQUFNQyx3QkFBb0M7SUFDL0NYLE1BQU07UUFDSkMsVUFBVTtRQUNWVixPQUFPO0lBQ1Q7SUFDQVksUUFBUTtRQUNOO1lBQ0VDLElBQUlsQixnREFBTUE7WUFDVm1CLE1BQU07WUFDTkMsT0FBTztZQUNQTCxVQUFVO1lBQ1ZNLE1BQU07Z0JBQ0pLLE1BQU07Z0JBQ05DLE9BQU87Z0JBQ1BDLFVBQVU7Z0JBQ1ZaLGlCQUFpQjtZQUNuQjtRQUNGO0tBQ0Q7QUFDSCxFQUFFO0FBRUYsNEJBQTRCO0FBQ3JCLE1BQU1hLGNBQWM7SUFDekI7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNELENBQVU7QUFLWCw0QkFBNEI7QUFDckIsTUFBTUMsU0FBUztJQUFDO0lBQVU7SUFBVTtJQUFZO0lBQVE7Q0FBUSxDQUFVO0FBR2pGLDRCQUE0QjtBQUNyQixNQUFNQyxjQUFjO0lBQUM7SUFBUTtJQUFTO0NBQU8sQ0FBVTtBQUc5RCwyQkFBMkI7QUFDcEIsTUFBTUMsYUFBYTtJQUFDO0lBQWE7SUFBYztJQUFZO0NBQWMsQ0FBVTtBQUcxRixnQ0FBZ0M7QUFDekIsTUFBTUMsa0JBQWtCO0lBQUM7SUFBYztJQUFlO0lBQVc7SUFBVTtDQUFPLENBQVU7QUFHbkcsaUNBQWlDO0FBQzFCLE1BQU1DLG1CQUFtQjtJQUFDO0lBQVM7SUFBVTtJQUFVO0NBQVEsQ0FBVTtBQUdoRiw0Q0FBNEM7QUFDckMsTUFBTUMsc0JBQXNCO0lBQUM7SUFBUTtJQUFVO0NBQVEsQ0FBVTtBQUd4RSwrQkFBK0I7QUFDeEIsTUFBTUMsaUJBQWlCO0lBQUM7SUFBVTtJQUFVO0NBQVEsQ0FBVTtBQUdyRSwrQkFBK0I7QUFDeEIsTUFBTUMsaUJBQWlCO0lBQUM7SUFBVTtJQUFVO0lBQU87Q0FBTyxDQUFVO0FBRzNFLCtCQUErQjtBQUN4QixNQUFNQyxpQkFBaUI7SUFBQztJQUFRO0lBQVM7SUFBVTtJQUFRO0NBQVMsQ0FBVTtBQUdyRiwwQkFBMEI7QUFDbkIsTUFBTUMsWUFBWTtJQUFDO0lBQVU7SUFBVTtJQUFZO0lBQVE7SUFBUztJQUFhO0lBQVM7Q0FBUSxDQUFVO0FBRzVHLE1BQU1DLHFCQUFxQixJQUFJO0FBQy9CLE1BQU1DLGNBQWMsS0FBSztBQUN6QixNQUFNQyxlQUFlLElBQUk7QUFDekIsTUFBTUMsWUFBWSxHQUFHIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvbGliL3R5cGVzL3ZpZGVvL3JlbW90aW9uLWNvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvdHlwZXMvcmVtb3Rpb24tY29uc3RhbnRzLnRzXG4vLyBVc2UgYSBicm93c2VyLWNvbXBhdGlibGUgVVVJRCBnZW5lcmF0aW9uIGFwcHJvYWNoIGluc3RlYWQgb2YgTm9kZSdzIGNyeXB0b1xuaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCc7XG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuaW1wb3J0IHR5cGUgeyBJbnB1dFByb3BzIH0gZnJvbSBcIi4vaW5wdXQtcHJvcHNcIjtcblxuZXhwb3J0IGNvbnN0IENPTVBfTkFNRSA9IFwiTXlDb21wXCI7XG5cbmV4cG9ydCBjb25zdCBDb21wb3NpdGlvblByb3BzID0gei5vYmplY3Qoe1xuICB0aXRsZTogei5zdHJpbmcoKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdE15Q29tcFByb3BzOiB6LmluZmVyPHR5cGVvZiBDb21wb3NpdGlvblByb3BzPiA9IHtcbiAgdGl0bGU6IFwiQmF6YWFyLVZpZFwiLFxufTtcblxuZXhwb3J0IGNvbnN0IERlbW9UaW1lbGluZVByb3BzID0gei5vYmplY3Qoe1xuICB0aXRsZTogei5zdHJpbmcoKSxcbiAgYXV0aG9yOiB6LnN0cmluZygpLFxuICBpbWFnZVVybDogei5zdHJpbmcoKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdERlbW9Qcm9wczogei5pbmZlcjx0eXBlb2YgRGVtb1RpbWVsaW5lUHJvcHM+ID0ge1xuICB0aXRsZTogXCJCYXphYXItVmlkXCIsXG4gIGF1dGhvcjogXCJZb3VcIixcbiAgaW1hZ2VVcmw6IFwiL2RlbW8uanBnXCIsXG59O1xuXG4vLyBGdW5jdGlvbiB0byBnZW5lcmF0ZSBkZWZhdWx0IHByb2plY3QgcHJvcHMgd2l0aCBhIHdlbGNvbWUgc2NlbmVcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0UHJvamVjdFByb3BzKCk6IElucHV0UHJvcHMge1xuICBjb25zdCB3ZWxjb21lU2NlbmVJZCA9IHV1aWR2NCgpO1xuICBcbiAgcmV0dXJuIHtcbiAgICBtZXRhOiB7IFxuICAgICAgZHVyYXRpb246IDMwMCwgLy8gMTAgc2Vjb25kcyBhdCAzMGZwcyAtIG1vcmUgc25hcHB5XG4gICAgICB0aXRsZTogXCJOZXcgUHJvamVjdFwiLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiMwZjBmMjNcIlxuICAgIH0sXG4gICAgc2NlbmVzOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiB3ZWxjb21lU2NlbmVJZCxcbiAgICAgICAgdHlwZTogXCJ3ZWxjb21lXCIsXG4gICAgICAgIHN0YXJ0OiAwLFxuICAgICAgICBkdXJhdGlvbjogMzAwLCAvLyAxMCBzZWNvbmRzIGF0IDMwZnBzXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBuYW1lOiBcIldlbGNvbWUgU2NlbmVcIixcbiAgICAgICAgICBjb2RlOiBgLy9zcmMvcmVtb3Rpb24vY29tcG9uZW50cy9zY2VuZXMvV2VsY29tZVNjZW5lLnRzeFxuY29uc3QgeyBBYnNvbHV0ZUZpbGwsIHVzZUN1cnJlbnRGcmFtZSwgdXNlVmlkZW9Db25maWcsIGludGVycG9sYXRlLCByYW5kb20sIHNwcmluZywgU2VxdWVuY2UsIEltZyB9ID0gd2luZG93LlJlbW90aW9uO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBXZWxjb21lU2NlbmUoe1xuICB0aXRsZSA9IFwiV2VsY29tZSB0byBCYXphYXJcIixcbiAgc3VidGl0bGUgPSBcIlRyYW5zZm9ybSBZb3VyIElkZWFzIEludG8gTW90aW9uXCIsXG4gIGJhY2tncm91bmRDb2xvciA9IFwiIzBmMGYyM1wiLFxuICB0ZXh0Q29sb3IgPSBcIiNmZmZmZmZcIlxufSkge1xuICBjb25zdCBmcmFtZSA9IHVzZUN1cnJlbnRGcmFtZSgpO1xuICBjb25zdCB7IGZwcywgZHVyYXRpb25JbkZyYW1lcywgd2lkdGgsIGhlaWdodCB9ID0gdXNlVmlkZW9Db25maWcoKTtcblxuICAvLyBNdWx0aS1zdGFnZSBhbmltYXRpb24gc2VxdWVuY2VzICgxMCBzZWNvbmRzIHRvdGFsKVxuICAvLyBTdGFnZSAxOiBMb2dvIHJldmVhbCAoMC0ycylcbiAgLy8gU3RhZ2UgMjogTWFpbiB0aXRsZSBhbmQgc3VidGl0bGUgKDEuNS0zLjVzKVxuICAvLyBTdGFnZSAzOiBGZWF0dXJlIHNob3djYXNlICgzLjUtNnMpIC0gRkFTVCFcbiAgLy8gU3RhZ2UgNDogQ2FsbCB0byBhY3Rpb24gKDYtMTBzKVxuXG4gIC8vIEdsb2JhbCBleGl0IGFuaW1hdGlvbiAobGFzdCAxIHNlY29uZClcbiAgY29uc3QgZXhpdFN0YXJ0ID0gZHVyYXRpb25JbkZyYW1lcyAtIGZwcztcbiAgY29uc3QgZ2xvYmFsRmFkZU91dCA9IGludGVycG9sYXRlKFxuICAgIGZyYW1lLFxuICAgIFtleGl0U3RhcnQsIGR1cmF0aW9uSW5GcmFtZXNdLFxuICAgIFsxLCAwXSxcbiAgICB7IGV4dHJhcG9sYXRlTGVmdDogXCJjbGFtcFwiLCBleHRyYXBvbGF0ZVJpZ2h0OiBcImNsYW1wXCIgfVxuICApO1xuICBjb25zdCBnbG9iYWxTY2FsZU91dCA9IGludGVycG9sYXRlKFxuICAgIGZyYW1lLFxuICAgIFtleGl0U3RhcnQsIGR1cmF0aW9uSW5GcmFtZXNdLFxuICAgIFsxLCAwLjk1XSxcbiAgICB7IGV4dHJhcG9sYXRlTGVmdDogXCJjbGFtcFwiLCBleHRyYXBvbGF0ZVJpZ2h0OiBcImNsYW1wXCIgfVxuICApO1xuXG4gIC8vIFJlc3BvbnNpdmUgc2l6aW5nIGJhc2VkIG9uIGNhbnZhcyB3aWR0aFxuICBjb25zdCBpc01vYmlsZSA9IHdpZHRoIDwgNjAwO1xuICBjb25zdCBpc1RhYmxldCA9IHdpZHRoIDwgOTAwO1xuXG4gIC8vIExvZ28gcmV2ZWFsIGFuaW1hdGlvbiAoMC0yIHNlY29uZHMpXG4gIGNvbnN0IGxvZ29SZXZlYWxTdGFydCA9IDA7XG4gIGNvbnN0IGxvZ29SZXZlYWxFbmQgPSBmcHMgKiAyO1xuICBjb25zdCBsb2dvUHJvZ3Jlc3MgPSBzcHJpbmcoe1xuICAgIGZyYW1lOiBmcmFtZSAtIGxvZ29SZXZlYWxTdGFydCxcbiAgICBmcHMsXG4gICAgY29uZmlnOiB7XG4gICAgICBkYW1waW5nOiAxMDAsXG4gICAgICBzdGlmZm5lc3M6IDIwMCxcbiAgICAgIG1hc3M6IDAuNSxcbiAgICB9LFxuICB9KTtcblxuICAvLyBNYWluIHRpdGxlIGFuaW1hdGlvbiAoMS41LTMuNSBzZWNvbmRzKVxuICBjb25zdCB0aXRsZVN0YXJ0ID0gZnBzICogMS41O1xuICBjb25zdCB0aXRsZUVuZCA9IGZwcyAqIDMuNTtcbiAgY29uc3QgdGl0bGVPcGFjaXR5ID0gaW50ZXJwb2xhdGUoXG4gICAgZnJhbWUsXG4gICAgW3RpdGxlU3RhcnQsIHRpdGxlU3RhcnQgKyBmcHMgKiAwLjhdLFxuICAgIFswLCAxXSxcbiAgICB7IGV4dHJhcG9sYXRlTGVmdDogXCJjbGFtcFwiLCBleHRyYXBvbGF0ZVJpZ2h0OiBcImNsYW1wXCIgfVxuICApO1xuICBcbiAgY29uc3QgdGl0bGVTY2FsZSA9IHNwcmluZyh7XG4gICAgZnJhbWU6IGZyYW1lIC0gdGl0bGVTdGFydCxcbiAgICBmcHMsXG4gICAgY29uZmlnOiB7IGRhbXBpbmc6IDIwLCBzdGlmZm5lc3M6IDEwMCB9LFxuICB9KTtcblxuICAvLyBUeXBld3JpdGVyIGVmZmVjdCBmb3IgdGl0bGVcbiAgY29uc3QgdGl0bGVUZXh0ID0gdGl0bGUgfHwgXCJXZWxjb21lIHRvIEJhemFhclwiO1xuICBjb25zdCB0aXRsZUNoYXJzVG9TaG93ID0gTWF0aC5mbG9vcihcbiAgICBpbnRlcnBvbGF0ZShcbiAgICAgIGZyYW1lLFxuICAgICAgW3RpdGxlU3RhcnQsIHRpdGxlU3RhcnQgKyBmcHMgKiAxLjJdLCAvLyAxLjIgc2Vjb25kcyB0byB0eXBlXG4gICAgICBbMCwgdGl0bGVUZXh0Lmxlbmd0aF0sXG4gICAgICB7IGV4dHJhcG9sYXRlTGVmdDogXCJjbGFtcFwiLCBleHRyYXBvbGF0ZVJpZ2h0OiBcImNsYW1wXCIgfVxuICAgIClcbiAgKTtcbiAgY29uc3QgZGlzcGxheWVkVGl0bGUgPSB0aXRsZVRleHQuc2xpY2UoMCwgdGl0bGVDaGFyc1RvU2hvdyk7XG5cbiAgLy8gU3VidGl0bGUgYW5pbWF0aW9uIHdpdGggZWxlZ2FudCBmYWRlXG4gIGNvbnN0IHN1YnRpdGxlU3RhcnQgPSBmcHMgKiAyO1xuICBjb25zdCBzdWJ0aXRsZU9wYWNpdHkgPSBpbnRlcnBvbGF0ZShcbiAgICBmcmFtZSxcbiAgICBbc3VidGl0bGVTdGFydCwgc3VidGl0bGVTdGFydCArIGZwcyAqIDAuNV0sXG4gICAgWzAsIDFdLFxuICAgIHsgZXh0cmFwb2xhdGVMZWZ0OiBcImNsYW1wXCIsIGV4dHJhcG9sYXRlUmlnaHQ6IFwiY2xhbXBcIiB9XG4gICk7XG5cbiAgLy8gRmVhdHVyZSBjYXJkcyBhbmltYXRpb24gKDMuNS02IHNlY29uZHMpIC0gTVVDSCBGQVNURVIhXG4gIGNvbnN0IGZlYXR1cmVzU3RhcnQgPSBmcHMgKiAzLjU7XG4gIGNvbnN0IGZlYXR1cmUxU3RhcnQgPSBmZWF0dXJlc1N0YXJ0O1xuICBjb25zdCBmZWF0dXJlMlN0YXJ0ID0gZmVhdHVyZXNTdGFydCArIGZwcyAqIDAuMjsgLy8gT25seSAwLjJzIGRlbGF5XG4gIGNvbnN0IGZlYXR1cmUzU3RhcnQgPSBmZWF0dXJlc1N0YXJ0ICsgZnBzICogMC40OyAvLyBPbmx5IDAuNHMgZGVsYXlcblxuICAvLyBDYWxsIHRvIGFjdGlvbiBhbmltYXRpb24gKDYtMTAgc2Vjb25kcylcbiAgY29uc3QgY3RhU3RhcnQgPSBmcHMgKiA2O1xuICBjb25zdCBjdGFTY2FsZSA9IHNwcmluZyh7XG4gICAgZnJhbWU6IGZyYW1lIC0gY3RhU3RhcnQsXG4gICAgZnBzLFxuICAgIGNvbmZpZzogeyBkYW1waW5nOiAxNSwgc3RpZmZuZXNzOiAxNTAgfSxcbiAgfSk7XG5cbiAgLy8gVHlwZXdyaXRlciBlZmZlY3QgZm9yIENUQVxuICBjb25zdCBjdGFUZXh0ID0gXCJUeXBlIHlvdXIgZmlyc3QgcHJvbXB0IHRvIGJlZ2luLi4uXCI7XG4gIGNvbnN0IGN0YUNoYXJzVG9TaG93ID0gTWF0aC5mbG9vcihcbiAgICBpbnRlcnBvbGF0ZShcbiAgICAgIGZyYW1lLFxuICAgICAgW2N0YVN0YXJ0ICsgZnBzICogMC41LCBjdGFTdGFydCArIGZwcyAqIDJdLCAvLyAxLjUgc2Vjb25kcyB0byB0eXBlXG4gICAgICBbMCwgY3RhVGV4dC5sZW5ndGhdLFxuICAgICAgeyBleHRyYXBvbGF0ZUxlZnQ6IFwiY2xhbXBcIiwgZXh0cmFwb2xhdGVSaWdodDogXCJjbGFtcFwiIH1cbiAgICApXG4gICk7XG4gIGNvbnN0IGRpc3BsYXllZEN0YSA9IGN0YVRleHQuc2xpY2UoMCwgY3RhQ2hhcnNUb1Nob3cpO1xuXG4gIC8vIEFkdmFuY2VkIGJhY2tncm91bmQgZWZmZWN0c1xuICBjb25zdCBiZ0dyYWRpZW50QW5nbGUgPSBpbnRlcnBvbGF0ZShcbiAgICBmcmFtZSxcbiAgICBbMCwgZHVyYXRpb25JbkZyYW1lc10sXG4gICAgWzAsIDM2MF0sXG4gICAgeyBleHRyYXBvbGF0ZUxlZnQ6IFwiY2xhbXBcIiwgZXh0cmFwb2xhdGVSaWdodDogXCJjbGFtcFwiIH1cbiAgKTtcblxuICBjb25zdCBiZ1B1bHNlID0gTWF0aC5zaW4oZnJhbWUgKiAwLjAyKSAqIDAuMSArIDE7XG5cbiAgLy8gUGFydGljbGUgc3lzdGVtIHdpdGggZGVwdGhcbiAgY29uc3QgcGFydGljbGVDb3VudCA9IDYwO1xuICBjb25zdCBwYXJ0aWNsZXMgPSBbLi4uQXJyYXkocGFydGljbGVDb3VudCldLm1hcCgoXywgaSkgPT4ge1xuICAgIGNvbnN0IGxheWVyID0gaSA8IDIwID8gJ2JhY2snIDogaSA8IDQwID8gJ21pZCcgOiAnZnJvbnQnO1xuICAgIGNvbnN0IHNpemUgPSBsYXllciA9PT0gJ2JhY2snID8gMiA6IGxheWVyID09PSAnbWlkJyA/IDMgOiA0O1xuICAgIGNvbnN0IHNwZWVkID0gbGF5ZXIgPT09ICdiYWNrJyA/IDAuNSA6IGxheWVyID09PSAnbWlkJyA/IDEgOiAxLjU7XG4gICAgY29uc3Qgb3BhY2l0eSA9IGxheWVyID09PSAnYmFjaycgPyAwLjMgOiBsYXllciA9PT0gJ21pZCcgPyAwLjUgOiAwLjc7XG4gICAgXG4gICAgY29uc3Qgc3RhcnRYID0gcmFuZG9tKFxcYHBhcnRpY2xlLXgtXFwke2l9XFxgKSAqIDEwMDtcbiAgICBjb25zdCBzdGFydFkgPSByYW5kb20oXFxgcGFydGljbGUteS1cXCR7aX1cXGApICogMTIwIC0gMTA7XG4gICAgY29uc3QgYW1wbGl0dWRlID0gcmFuZG9tKFxcYHBhcnRpY2xlLWFtcC1cXCR7aX1cXGApICogMjAgKyAxMDtcbiAgICBcbiAgICBjb25zdCB4ID0gc3RhcnRYICsgTWF0aC5zaW4oZnJhbWUgKiAwLjAyICogc3BlZWQgKyBpKSAqIGFtcGxpdHVkZTtcbiAgICBjb25zdCB5ID0gKChzdGFydFkgKyBmcmFtZSAqIHNwZWVkICogMC4zKSAlIDEyMCkgLSAxMDtcbiAgICBcbiAgICByZXR1cm4geyB4LCB5LCBzaXplLCBvcGFjaXR5OiBvcGFjaXR5ICogaW50ZXJwb2xhdGUoXG4gICAgICBmcmFtZSxcbiAgICAgIFswLCBmcHMgKiAyXSxcbiAgICAgIFswLCAxXSxcbiAgICAgIHsgZXh0cmFwb2xhdGVMZWZ0OiBcImNsYW1wXCIsIGV4dHJhcG9sYXRlUmlnaHQ6IFwiY2xhbXBcIiB9XG4gICAgKX07XG4gIH0pO1xuXG4gIC8vIEZlYXR1cmUgY2FyZCBhbmltYXRpb24gaGVscGVyIC0gRkFTVCBlbnRyYW5jZVxuICBjb25zdCBnZXRGZWF0dXJlQW5pbWF0aW9uID0gKHN0YXJ0RnJhbWUpID0+IHtcbiAgICBjb25zdCBwcm9ncmVzcyA9IHNwcmluZyh7XG4gICAgICBmcmFtZTogZnJhbWUgLSBzdGFydEZyYW1lLFxuICAgICAgZnBzLFxuICAgICAgY29uZmlnOiB7IGRhbXBpbmc6IDE1LCBzdGlmZm5lc3M6IDIwMCB9LCAvLyBTdGlmZmVyIHNwcmluZyBmb3Igc25hcHBpZXIgYW5pbWF0aW9uXG4gICAgfSk7XG4gICAgY29uc3Qgc2xpZGVJbiA9IGludGVycG9sYXRlKFxuICAgICAgZnJhbWUsXG4gICAgICBbc3RhcnRGcmFtZSwgc3RhcnRGcmFtZSArIGZwcyAqIDAuM10sIC8vIE9ubHkgMC4zIHNlY29uZHMgdG8gc2xpZGUgaW5cbiAgICAgIFs1MCwgMF0sIC8vIFJlZHVjZWQgc2xpZGUgZGlzdGFuY2VcbiAgICAgIHsgZXh0cmFwb2xhdGVMZWZ0OiBcImNsYW1wXCIsIGV4dHJhcG9sYXRlUmlnaHQ6IFwiY2xhbXBcIiB9XG4gICAgKTtcbiAgICByZXR1cm4geyBwcm9ncmVzcywgc2xpZGVJbiB9O1xuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPEFic29sdXRlRmlsbFxuICAgICAgc3R5bGU9e3tcbiAgICAgICAgYmFja2dyb3VuZDogXFxgXG4gICAgICAgICAgcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCA1MCUgNTAlLCByZ2JhKDE2OCwgODUsIDI0NywgMC4xKSAwJSwgdHJhbnNwYXJlbnQgNTAlKSxcbiAgICAgICAgICBsaW5lYXItZ3JhZGllbnQoXFwke2JnR3JhZGllbnRBbmdsZX1kZWcsICMwZjBmMjMsICMxYTBmMmUsICMwZjBmMjMpXG4gICAgICAgIFxcYCxcbiAgICAgICAgZm9udEZhbWlseTogXCItYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgc2Fucy1zZXJpZlwiLFxuICAgICAgICBwb3NpdGlvbjogXCJyZWxhdGl2ZVwiLFxuICAgICAgICBvdmVyZmxvdzogXCJoaWRkZW5cIixcbiAgICAgICAgb3BhY2l0eTogZ2xvYmFsRmFkZU91dCxcbiAgICAgICAgdHJhbnNmb3JtOiBcXGBzY2FsZShcXCR7Z2xvYmFsU2NhbGVPdXR9KVxcYCxcbiAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiBcImNlbnRlciBjZW50ZXJcIixcbiAgICAgIH19XG4gICAgPlxuICAgICAgey8qIEFuaW1hdGVkIHBhcnRpY2xlIHN5c3RlbSB3aXRoIGRlcHRoIGxheWVycyAqL31cbiAgICAgIDxkaXYgc3R5bGU9e3sgcG9zaXRpb246IFwiYWJzb2x1dGVcIiwgaW5zZXQ6IDAgfX0+XG4gICAgICAgIHtwYXJ0aWNsZXMubWFwKChwYXJ0aWNsZSwgaSkgPT4gKFxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGtleT17aX1cbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgIGxlZnQ6IFxcYFxcJHtwYXJ0aWNsZS54fSVcXGAsXG4gICAgICAgICAgICAgIHRvcDogXFxgXFwke3BhcnRpY2xlLnl9JVxcYCxcbiAgICAgICAgICAgICAgd2lkdGg6IFxcYFxcJHtwYXJ0aWNsZS5zaXplfXB4XFxgLFxuICAgICAgICAgICAgICBoZWlnaHQ6IFxcYFxcJHtwYXJ0aWNsZS5zaXplfXB4XFxgLFxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2E4NTVmN1wiLFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IFwiNTAlXCIsXG4gICAgICAgICAgICAgIG9wYWNpdHk6IHBhcnRpY2xlLm9wYWNpdHksXG4gICAgICAgICAgICAgIGZpbHRlcjogXCJibHVyKDFweClcIixcbiAgICAgICAgICAgICAgYm94U2hhZG93OiBcIjAgMCAxMHB4IHJnYmEoMTY4LCA4NSwgMjQ3LCAwLjUpXCIsXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICkpfVxuICAgICAgPC9kaXY+XG5cbiAgICAgIHsvKiBBbmltYXRlZCBncmlkIGJhY2tncm91bmQgKi99XG4gICAgICA8ZGl2XG4gICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICBpbnNldDogMCxcbiAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IFxcYFxuICAgICAgICAgICAgcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCgwZGVnLCByZ2JhKDE2OCwgODUsIDI0NywgMC4wMykgMHB4LCB0cmFuc3BhcmVudCAxcHgsIHRyYW5zcGFyZW50IDEwMHB4LCByZ2JhKDE2OCwgODUsIDI0NywgMC4wMykgMTAxcHgpLFxuICAgICAgICAgICAgcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgxNjgsIDg1LCAyNDcsIDAuMDMpIDBweCwgdHJhbnNwYXJlbnQgMXB4LCB0cmFuc3BhcmVudCAxMDBweCwgcmdiYSgxNjgsIDg1LCAyNDcsIDAuMDMpIDEwMXB4KVxuICAgICAgICAgIFxcYCxcbiAgICAgICAgICB0cmFuc2Zvcm06IFxcYHNjYWxlKFxcJHtiZ1B1bHNlfSlcXGAsXG4gICAgICAgICAgb3BhY2l0eTogaW50ZXJwb2xhdGUoZnJhbWUsIFswLCBmcHMgKiAyXSwgWzAsIDFdKSxcbiAgICAgICAgfX1cbiAgICAgIC8+XG5cbiAgICAgIHsvKiBTdGFnZSAxOiBMb2dvIHJldmVhbCAqL31cbiAgICAgIHtmcmFtZSA+PSBsb2dvUmV2ZWFsU3RhcnQgJiYgZnJhbWUgPCBsb2dvUmV2ZWFsRW5kICYmIChcbiAgICAgICAgPEFic29sdXRlRmlsbFxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHNjYWxlKFxcJHtsb2dvUHJvZ3Jlc3N9KVxcYCxcbiAgICAgICAgICAgIG9wYWNpdHk6IGludGVycG9sYXRlKFxuICAgICAgICAgICAgICBmcmFtZSxcbiAgICAgICAgICAgICAgW2xvZ29SZXZlYWxFbmQgLSBmcHMgKiAwLjMsIGxvZ29SZXZlYWxFbmRdLFxuICAgICAgICAgICAgICBbMSwgMF0sXG4gICAgICAgICAgICAgIHsgZXh0cmFwb2xhdGVMZWZ0OiBcImNsYW1wXCIsIGV4dHJhcG9sYXRlUmlnaHQ6IFwiY2xhbXBcIiB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICB3aWR0aDogXCIxMjBweFwiLFxuICAgICAgICAgICAgICBoZWlnaHQ6IFwiMTIwcHhcIixcbiAgICAgICAgICAgICAgYmFja2dyb3VuZDogXCJsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjYTg1NWY3LCAjM2I4MmY2KVwiLFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IFwiMzBweFwiLFxuICAgICAgICAgICAgICBkaXNwbGF5OiBcImZsZXhcIixcbiAgICAgICAgICAgICAgYWxpZ25JdGVtczogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIGJveFNoYWRvdzogXCIwIDIwcHggNjBweCByZ2JhKDE2OCwgODUsIDI0NywgMC40KVwiLFxuICAgICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHJvdGF0ZShcXCR7aW50ZXJwb2xhdGUoZnJhbWUsIFswLCBmcHMgKiAyXSwgWzAsIDE4MF0pfWRlZylcXGAsXG4gICAgICAgICAgICB9fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogXCI2MHB4XCIsXG4gICAgICAgICAgICAgICAgZm9udFdlaWdodDogXCJib2xkXCIsXG4gICAgICAgICAgICAgICAgY29sb3I6IFwid2hpdGVcIixcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHJvdGF0ZShcXCR7aW50ZXJwb2xhdGUoZnJhbWUsIFswLCBmcHMgKiAyXSwgWzAsIC0xODBdKX1kZWcpXFxgLFxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBCXG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9BYnNvbHV0ZUZpbGw+XG4gICAgICApfVxuXG4gICAgICB7LyogU3RhZ2UgMjogTWFpbiB0aXRsZSBhbmQgc3VidGl0bGUgKi99XG4gICAgICA8U2VxdWVuY2UgZnJvbT17dGl0bGVTdGFydH0gZHVyYXRpb25JbkZyYW1lcz17dGl0bGVFbmQgLSB0aXRsZVN0YXJ0fT5cbiAgICAgICAgPEFic29sdXRlRmlsbFxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBmbGV4RGlyZWN0aW9uOiBcImNvbHVtblwiLFxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICA8aDFcbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIGZvbnRTaXplOiBpc01vYmlsZSA/IFwiMi41cmVtXCIgOiBpc1RhYmxldCA/IFwiMy41cmVtXCIgOiBcIjVyZW1cIixcbiAgICAgICAgICAgICAgZm9udFdlaWdodDogXCI4MDBcIixcbiAgICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICAgICAgICBvcGFjaXR5OiB0aXRsZU9wYWNpdHksXG4gICAgICAgICAgICAgIHRyYW5zZm9ybTogXFxgc2NhbGUoXFwke3RpdGxlU2NhbGV9KVxcYCxcbiAgICAgICAgICAgICAgYmFja2dyb3VuZDogXCJsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZmZmZmZmLCAjYTg1NWY3LCAjM2I4MmY2KVwiLFxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ2xpcDogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgIFdlYmtpdEJhY2tncm91bmRDbGlwOiBcInRleHRcIixcbiAgICAgICAgICAgICAgV2Via2l0VGV4dEZpbGxDb2xvcjogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiBcIi0ycHhcIixcbiAgICAgICAgICAgICAgdGV4dEFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICBmaWx0ZXI6IFwiZHJvcC1zaGFkb3coMCA0cHggMjBweCByZ2JhKDE2OCwgODUsIDI0NywgMC4zKSlcIixcbiAgICAgICAgICAgICAgcGFkZGluZzogXCIwIDIwcHhcIixcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2Rpc3BsYXllZFRpdGxlfVxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9e3tcbiAgICAgICAgICAgICAgb3BhY2l0eTogTWF0aC5mbG9vcihmcmFtZSAvIDE1KSAlIDIgPyAxIDogMCxcbiAgICAgICAgICAgICAgbWFyZ2luTGVmdDogXCIycHhcIlxuICAgICAgICAgICAgfX0+fDwvc3Bhbj5cbiAgICAgICAgICA8L2gxPlxuICAgICAgICAgIFxuICAgICAgICAgIDxwXG4gICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICBmb250U2l6ZTogaXNNb2JpbGUgPyBcIjEuMnJlbVwiIDogaXNUYWJsZXQgPyBcIjEuNXJlbVwiIDogXCIycmVtXCIsXG4gICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IFwiMzAwXCIsXG4gICAgICAgICAgICAgIGNvbG9yOiBcIiNlMGUwZTBcIixcbiAgICAgICAgICAgICAgbWFyZ2luVG9wOiBcIjFyZW1cIixcbiAgICAgICAgICAgICAgb3BhY2l0eTogc3VidGl0bGVPcGFjaXR5LFxuICAgICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHRyYW5zbGF0ZVkoXFwke2ludGVycG9sYXRlKFxuICAgICAgICAgICAgICAgIGZyYW1lLFxuICAgICAgICAgICAgICAgIFtzdWJ0aXRsZVN0YXJ0LCBzdWJ0aXRsZVN0YXJ0ICsgZnBzXSxcbiAgICAgICAgICAgICAgICBbMzAsIDBdXG4gICAgICAgICAgICAgICl9cHgpXFxgLFxuICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiBcIjFweFwiLFxuICAgICAgICAgICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIHBhZGRpbmc6IFwiMCAyMHB4XCIsXG4gICAgICAgICAgICAgIG1heFdpZHRoOiBpc01vYmlsZSA/IFwiOTAlXCIgOiBcIjgwJVwiLFxuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7c3VidGl0bGV9XG4gICAgICAgICAgPC9wPlxuICAgICAgICA8L0Fic29sdXRlRmlsbD5cbiAgICAgIDwvU2VxdWVuY2U+XG5cbiAgICAgIHsvKiBTdGFnZSAzOiBGZWF0dXJlIHNob3djYXNlICovfVxuICAgICAgPFNlcXVlbmNlIGZyb209e2ZlYXR1cmVzU3RhcnR9IGR1cmF0aW9uSW5GcmFtZXM9e2ZwcyAqIDIuNX0+XG4gICAgICAgIDxBYnNvbHV0ZUZpbGxcbiAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgcGFkZGluZzogXCIwIDUlXCIsXG4gICAgICAgICAgfX1cbiAgICAgICAgPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIGRpc3BsYXk6IFwiZmxleFwiLFxuICAgICAgICAgICAgICBnYXA6IGlzTW9iaWxlID8gXCIxcmVtXCIgOiBcIjJyZW1cIixcbiAgICAgICAgICAgICAgbWF4V2lkdGg6IGlzTW9iaWxlID8gXCIxMDAlXCIgOiBcIjEyMDBweFwiLFxuICAgICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICBmbGV4V3JhcDogaXNNb2JpbGUgPyBcIm5vd3JhcFwiIDogXCJ3cmFwXCIsXG4gICAgICAgICAgICAgIGZsZXhEaXJlY3Rpb246IGlzTW9iaWxlID8gXCJjb2x1bW5cIiA6IFwicm93XCIsXG4gICAgICAgICAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIHBhZGRpbmc6IGlzTW9iaWxlID8gXCIwIDIwcHhcIiA6IFwiMFwiLFxuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7LyogRmVhdHVyZSAxOiBVcGxvYWQgSW1hZ2UgKi99XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgLi4uZ2V0RmVhdHVyZUNhcmRTdHlsZSgpLFxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogXFxgdHJhbnNsYXRlWChcXCR7Z2V0RmVhdHVyZUFuaW1hdGlvbihmZWF0dXJlMVN0YXJ0KS5zbGlkZUlufXB4KSBzY2FsZShcXCR7Z2V0RmVhdHVyZUFuaW1hdGlvbihmZWF0dXJlMVN0YXJ0KS5wcm9ncmVzc30pXFxgLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IGdldEZlYXR1cmVBbmltYXRpb24oZmVhdHVyZTFTdGFydCkucHJvZ3Jlc3MsXG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2dldEljb25TdHlsZShcIiNhODU1ZjdcIil9PvCfk7g8L2Rpdj5cbiAgICAgICAgICAgICAgPGgzIHN0eWxlPXtnZXRGZWF0dXJlVGl0bGUoKX0+VXBsb2FkIEltYWdlczwvaDM+XG4gICAgICAgICAgICAgIDxwIHN0eWxlPXtnZXRGZWF0dXJlRGVzY3JpcHRpb24oKX0+XG4gICAgICAgICAgICAgICAgU3RhcnQgd2l0aCB5b3VyIG93biB2aXN1YWxzXG4gICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICB7LyogRmVhdHVyZSAyOiBBSSBHZW5lcmF0aW9uICovfVxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgIC4uLmdldEZlYXR1cmVDYXJkU3R5bGUoKSxcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHRyYW5zbGF0ZVgoXFwke2dldEZlYXR1cmVBbmltYXRpb24oZmVhdHVyZTJTdGFydCkuc2xpZGVJbn1weCkgc2NhbGUoXFwke2dldEZlYXR1cmVBbmltYXRpb24oZmVhdHVyZTJTdGFydCkucHJvZ3Jlc3N9KVxcYCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiBnZXRGZWF0dXJlQW5pbWF0aW9uKGZlYXR1cmUyU3RhcnQpLnByb2dyZXNzLFxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtnZXRJY29uU3R5bGUoXCIjM2I4MmY2XCIpfT7inKg8L2Rpdj5cbiAgICAgICAgICAgICAgPGgzIHN0eWxlPXtnZXRGZWF0dXJlVGl0bGUoKX0+QUktUG93ZXJlZDwvaDM+XG4gICAgICAgICAgICAgIDxwIHN0eWxlPXtnZXRGZWF0dXJlRGVzY3JpcHRpb24oKX0+XG4gICAgICAgICAgICAgICAgR2VuZXJhdGUgbW90aW9uIGdyYXBoaWNzIGluc3RhbnRseVxuICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgey8qIEZlYXR1cmUgMzogRXhwb3J0IFJlYWR5ICovfVxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgIC4uLmdldEZlYXR1cmVDYXJkU3R5bGUoKSxcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHRyYW5zbGF0ZVgoXFwke2dldEZlYXR1cmVBbmltYXRpb24oZmVhdHVyZTNTdGFydCkuc2xpZGVJbn1weCkgc2NhbGUoXFwke2dldEZlYXR1cmVBbmltYXRpb24oZmVhdHVyZTNTdGFydCkucHJvZ3Jlc3N9KVxcYCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiBnZXRGZWF0dXJlQW5pbWF0aW9uKGZlYXR1cmUzU3RhcnQpLnByb2dyZXNzLFxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtnZXRJY29uU3R5bGUoXCIjMTBiOTgxXCIpfT7wn5qAPC9kaXY+XG4gICAgICAgICAgICAgIDxoMyBzdHlsZT17Z2V0RmVhdHVyZVRpdGxlKCl9PlR3aXR0ZXItUmVhZHk8L2gzPlxuICAgICAgICAgICAgICA8cCBzdHlsZT17Z2V0RmVhdHVyZURlc2NyaXB0aW9uKCl9PlxuICAgICAgICAgICAgICAgIEV4cG9ydCBpbiBtaW51dGVzLCBub3QgaG91cnNcbiAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQWJzb2x1dGVGaWxsPlxuICAgICAgPC9TZXF1ZW5jZT5cblxuICAgICAgey8qIFN0YWdlIDQ6IENhbGwgdG8gYWN0aW9uICovfVxuICAgICAgPFNlcXVlbmNlIGZyb209e2N0YVN0YXJ0fSBkdXJhdGlvbkluRnJhbWVzPXtmcHMgKiA0fT5cbiAgICAgICAgPEFic29sdXRlRmlsbFxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBmbGV4RGlyZWN0aW9uOiBcImNvbHVtblwiLFxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICB0cmFuc2Zvcm06IFxcYHNjYWxlKFxcJHtjdGFTY2FsZX0pXFxgLFxuICAgICAgICAgICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICB9fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogXCIyLjVyZW1cIixcbiAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiBcIjYwMFwiLFxuICAgICAgICAgICAgICAgIGNvbG9yOiBcIndoaXRlXCIsXG4gICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiBcIjJyZW1cIixcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiBpbnRlcnBvbGF0ZShcbiAgICAgICAgICAgICAgICAgIGZyYW1lLFxuICAgICAgICAgICAgICAgICAgW2N0YVN0YXJ0LCBjdGFTdGFydCArIGZwc10sXG4gICAgICAgICAgICAgICAgICBbMCwgMV1cbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBSZWFkeSB0byBDcmVhdGU/XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IFwibGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2E4NTVmNywgIzNiODJmNilcIixcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiBcIjEuNXJlbSAzcmVtXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiBcIjEwMHB4XCIsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IFwiMS4ycmVtXCIsXG4gICAgICAgICAgICAgICAgZm9udFdlaWdodDogXCI2MDBcIixcbiAgICAgICAgICAgICAgICBjb2xvcjogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgICAgIGJveFNoYWRvdzogXCIwIDEwcHggNDBweCByZ2JhKDE2OCwgODUsIDI0NywgMC40KVwiLFxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogXFxgdHJhbnNsYXRlWShcXCR7aW50ZXJwb2xhdGUoXG4gICAgICAgICAgICAgICAgICBmcmFtZSxcbiAgICAgICAgICAgICAgICAgIFtjdGFTdGFydCArIGZwcyAqIDAuNSwgY3RhU3RhcnQgKyBmcHMgKiAxLjVdLFxuICAgICAgICAgICAgICAgICAgWzIwLCAwXVxuICAgICAgICAgICAgICAgICl9cHgpXFxgLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IGludGVycG9sYXRlKFxuICAgICAgICAgICAgICAgICAgZnJhbWUsXG4gICAgICAgICAgICAgICAgICBbY3RhU3RhcnQgKyBmcHMgKiAwLjUsIGN0YVN0YXJ0ICsgZnBzICogMS41XSxcbiAgICAgICAgICAgICAgICAgIFswLCAxXVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtkaXNwbGF5ZWRDdGF9XG4gICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogTWF0aC5mbG9vcihmcmFtZSAvIDE1KSAlIDIgPyAxIDogMCxcbiAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiBcIjJweFwiXG4gICAgICAgICAgICAgIH19Pnw8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgey8qIFB1bHNpbmcgaW5kaWNhdG9yICovfVxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgIG1hcmdpblRvcDogXCIycmVtXCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogXCJmbGV4XCIsXG4gICAgICAgICAgICAgICAgZ2FwOiBcIjAuNXJlbVwiLFxuICAgICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IGludGVycG9sYXRlKFxuICAgICAgICAgICAgICAgICAgZnJhbWUsXG4gICAgICAgICAgICAgICAgICBbY3RhU3RhcnQgKyBmcHMgKiAyLCBjdGFTdGFydCArIGZwcyAqIDNdLFxuICAgICAgICAgICAgICAgICAgWzAsIDFdXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge1swLCAxLCAyXS5tYXAoKGkpID0+IChcbiAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICBrZXk9e2l9XG4gICAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogXCI4cHhcIixcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBcIjhweFwiLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IFwiNTAlXCIsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjYTg1NWY3XCIsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IE1hdGguc2luKChmcmFtZSAtIGN0YVN0YXJ0IC0gZnBzICogMikgKiAwLjA1ICsgaSAqIDEuNSkgKiAwLjUgKyAwLjUsXG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQWJzb2x1dGVGaWxsPlxuICAgICAgPC9TZXF1ZW5jZT5cbiAgICA8L0Fic29sdXRlRmlsbD5cbiAgKTtcblxuICAvLyBIZWxwZXIgZnVuY3Rpb25zIGZvciBjb25zaXN0ZW50IHN0eWxpbmdcbiAgZnVuY3Rpb24gZ2V0RmVhdHVyZUNhcmRTdHlsZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmFja2dyb3VuZDogXCJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMDUpXCIsXG4gICAgICBiYWNrZHJvcEZpbHRlcjogXCJibHVyKDIwcHgpXCIsXG4gICAgICBib3JkZXI6IFwiMXB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKVwiLFxuICAgICAgYm9yZGVyUmFkaXVzOiBcIjIwcHhcIixcbiAgICAgIHBhZGRpbmc6IGlzTW9iaWxlID8gXCIxLjVyZW1cIiA6IFwiMnJlbVwiLFxuICAgICAgd2lkdGg6IGlzTW9iaWxlID8gXCIxMDAlXCIgOiBcIjMwMHB4XCIsXG4gICAgICBtYXhXaWR0aDogaXNNb2JpbGUgPyBcIjI4MHB4XCIgOiBcIjMwMHB4XCIsXG4gICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXG4gICAgICBib3hTaGFkb3c6IFwiMCAxMHB4IDMwcHggcmdiYSgwLCAwLCAwLCAwLjIpXCIsXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEljb25TdHlsZShjb2xvcikge1xuICAgIHJldHVybiB7XG4gICAgICBmb250U2l6ZTogXCIzcmVtXCIsXG4gICAgICBtYXJnaW5Cb3R0b206IFwiMXJlbVwiLFxuICAgICAgZmlsdGVyOiBcXGBkcm9wLXNoYWRvdygwIDAgMjBweCBcXCR7Y29sb3J9KVxcYCxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RmVhdHVyZVRpdGxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICBmb250U2l6ZTogXCIxLjVyZW1cIixcbiAgICAgIGZvbnRXZWlnaHQ6IFwiNjAwXCIsXG4gICAgICBjb2xvcjogXCJ3aGl0ZVwiLFxuICAgICAgbWFyZ2luQm90dG9tOiBcIjAuNXJlbVwiLFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGZWF0dXJlRGVzY3JpcHRpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZvbnRTaXplOiBcIjFyZW1cIixcbiAgICAgIGNvbG9yOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC43KVwiLFxuICAgICAgbGluZUhlaWdodDogXCIxLjVcIixcbiAgICB9O1xuICB9XG59YCxcbiAgICAgICAgICBpc1dlbGNvbWVTY2VuZTogdHJ1ZSwgLy8gRmxhZyB0byBpZGVudGlmeSB0aGlzIGFzIHRoZSB3ZWxjb21lIHNjZW5lXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgXSxcbiAgfTtcbn1cblxuLy8gTGVnYWN5IGNvbnN0YW50IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IC0gYnV0IHNob3VsZCBub3QgYmUgdXNlZCBmb3IgbmV3IHByb2plY3RzXG5leHBvcnQgY29uc3QgREVGQVVMVF9QUk9KRUNUX1BST1BTOiBJbnB1dFByb3BzID0ge1xuICBtZXRhOiB7IFxuICAgIGR1cmF0aW9uOiAxNTAsIFxuICAgIHRpdGxlOiBcIk15IEZpcnN0IFZpZGVvXCIgXG4gIH0sXG4gIHNjZW5lczogW1xuICAgIHtcbiAgICAgIGlkOiB1dWlkdjQoKSxcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgc3RhcnQ6IDAsXG4gICAgICBkdXJhdGlvbjogNjAsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHRleHQ6IFwiV2VsY29tZSB0byB5b3VyIG5ldyB2aWRlb1wiLFxuICAgICAgICBjb2xvcjogXCIjRkZGRkZGXCIsXG4gICAgICAgIGZvbnRTaXplOiA3MCxcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiMwMDAwMDBcIixcbiAgICAgIH0sXG4gICAgfVxuICBdLFxufTtcblxuLy8gQ29uc3RhbnRzIGZvciBzY2VuZSB0eXBlc1xuZXhwb3J0IGNvbnN0IFNDRU5FX1RZUEVTID0gW1xuICBcIndlbGNvbWVcIixcbiAgXCJ0ZXh0XCIsIFxuICBcImltYWdlXCIsIFxuICBcImN1c3RvbVwiLCBcbiAgXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFxuICBcInNoYXBlXCIsIFxuICBcInNpbXBsZS1zaGFwZVwiLCBcbiAgXCJncmFkaWVudFwiLCBcbiAgXCJwYXJ0aWNsZXNcIiwgXG4gIFwidGV4dC1hbmltYXRpb25cIiwgXG4gIFwic3BsaXQtc2NyZWVuXCIsIFxuICBcInpvb20tcGFuXCIsIFxuICBcInN2Zy1hbmltYXRpb25cIixcbiAgXCJzaW1wbGUtY29sb3JlZC1zaGFwZVwiLCBcbl0gYXMgY29uc3Q7XG5cbi8vIEV4cG9ydCB0aGUgdHlwZSBkZXJpdmVkIGZyb20gdGhlIGNvbnN0YW50XG5leHBvcnQgdHlwZSBTY2VuZVR5cGUgPSAodHlwZW9mIFNDRU5FX1RZUEVTKVtudW1iZXJdO1xuXG4vLyBDb25zdGFudHMgZm9yIHNoYXBlIHR5cGVzXG5leHBvcnQgY29uc3QgU0hBUEVTID0gW1wiY2lyY2xlXCIsIFwic3F1YXJlXCIsIFwidHJpYW5nbGVcIiwgXCJzdGFyXCIsIFwiaGVhcnRcIl0gYXMgY29uc3Q7XG5leHBvcnQgdHlwZSBTaGFwZSA9ICh0eXBlb2YgU0hBUEVTKVtudW1iZXJdO1xuXG4vLyBDb25zdGFudHMgZm9yIHRyYW5zaXRpb25zXG5leHBvcnQgY29uc3QgVFJBTlNJVElPTlMgPSBbXCJmYWRlXCIsIFwic2xpZGVcIiwgXCJ3aXBlXCJdIGFzIGNvbnN0O1xuZXhwb3J0IHR5cGUgVHJhbnNpdGlvbiA9ICh0eXBlb2YgVFJBTlNJVElPTlMpW251bWJlcl07XG5cbi8vIENvbnN0YW50cyBmb3IgZGlyZWN0aW9uc1xuZXhwb3J0IGNvbnN0IERJUkVDVElPTlMgPSBbXCJmcm9tLWxlZnRcIiwgXCJmcm9tLXJpZ2h0XCIsIFwiZnJvbS10b3BcIiwgXCJmcm9tLWJvdHRvbVwiXSBhcyBjb25zdDtcbmV4cG9ydCB0eXBlIERpcmVjdGlvbiA9ICh0eXBlb2YgRElSRUNUSU9OUylbbnVtYmVyXTtcblxuLy8gQ29uc3RhbnRzIGZvciB0ZXh0IGFuaW1hdGlvbnNcbmV4cG9ydCBjb25zdCBURVhUX0FOSU1BVElPTlMgPSBbXCJ0eXBld3JpdGVyXCIsIFwiZmFkZUxldHRlcnNcIiwgXCJzbGlkZVVwXCIsIFwiYm91bmNlXCIsIFwid2F2eVwiXSBhcyBjb25zdDtcbmV4cG9ydCB0eXBlIFRleHRBbmltYXRpb24gPSAodHlwZW9mIFRFWFRfQU5JTUFUSU9OUylbbnVtYmVyXTtcblxuLy8gQ29uc3RhbnRzIGZvciBzaGFwZSBhbmltYXRpb25zXG5leHBvcnQgY29uc3QgU0hBUEVfQU5JTUFUSU9OUyA9IFtcInB1bHNlXCIsIFwicm90YXRlXCIsIFwiYm91bmNlXCIsIFwic2NhbGVcIl0gYXMgY29uc3Q7XG5leHBvcnQgdHlwZSBTaGFwZUFuaW1hdGlvbiA9ICh0eXBlb2YgU0hBUEVfQU5JTUFUSU9OUylbbnVtYmVyXTtcblxuLy8gQ29uc3RhbnRzIGZvciBiYWNrZ3JvdW5kIGNvbG9yIGFuaW1hdGlvbnNcbmV4cG9ydCBjb25zdCBCR19DT0xPUl9BTklNQVRJT05TID0gW1wiZmFkZVwiLCBcInNwcmluZ1wiLCBcInB1bHNlXCJdIGFzIGNvbnN0O1xuZXhwb3J0IHR5cGUgQmdDb2xvckFuaW1hdGlvbiA9ICh0eXBlb2YgQkdfQ09MT1JfQU5JTUFUSU9OUylbbnVtYmVyXTtcblxuLy8gQ29uc3RhbnRzIGZvciBncmFkaWVudCB0eXBlc1xuZXhwb3J0IGNvbnN0IEdSQURJRU5UX1RZUEVTID0gW1wibGluZWFyXCIsIFwicmFkaWFsXCIsIFwiY29uaWNcIl0gYXMgY29uc3Q7XG5leHBvcnQgdHlwZSBHcmFkaWVudFR5cGUgPSAodHlwZW9mIEdSQURJRU5UX1RZUEVTKVtudW1iZXJdO1xuXG4vLyBDb25zdGFudHMgZm9yIHBhcnRpY2xlIHR5cGVzXG5leHBvcnQgY29uc3QgUEFSVElDTEVfVFlQRVMgPSBbXCJjaXJjbGVcIiwgXCJzcXVhcmVcIiwgXCJkb3RcIiwgXCJzdGFyXCJdIGFzIGNvbnN0O1xuZXhwb3J0IHR5cGUgUGFydGljbGVUeXBlID0gKHR5cGVvZiBQQVJUSUNMRV9UWVBFUylbbnVtYmVyXTtcblxuLy8gQ29uc3RhbnRzIGZvciBTVkcgYW5pbWF0aW9uc1xuZXhwb3J0IGNvbnN0IFNWR19BTklNQVRJT05TID0gW1wiZHJhd1wiLCBcInNjYWxlXCIsIFwicm90YXRlXCIsIFwiZmFkZVwiLCBcIm1vdmVJblwiXSBhcyBjb25zdDtcbmV4cG9ydCB0eXBlIFN2Z0FuaW1hdGlvbiA9ICh0eXBlb2YgU1ZHX0FOSU1BVElPTlMpW251bWJlcl07XG5cbi8vIENvbnN0YW50cyBmb3IgU1ZHIGljb25zXG5leHBvcnQgY29uc3QgU1ZHX0lDT05TID0gW1wiY2lyY2xlXCIsIFwic3F1YXJlXCIsIFwidHJpYW5nbGVcIiwgXCJzdGFyXCIsIFwiaGVhcnRcIiwgXCJjaGVja21hcmtcIiwgXCJjcm9zc1wiLCBcImFycm93XCJdIGFzIGNvbnN0O1xuZXhwb3J0IHR5cGUgU3ZnSWNvbiA9ICh0eXBlb2YgU1ZHX0lDT05TKVtudW1iZXJdO1xuXG5leHBvcnQgY29uc3QgRFVSQVRJT05fSU5fRlJBTUVTID0gMjAwO1xuZXhwb3J0IGNvbnN0IFZJREVPX1dJRFRIID0gMTI4MDtcbmV4cG9ydCBjb25zdCBWSURFT19IRUlHSFQgPSA3MjA7XG5leHBvcnQgY29uc3QgVklERU9fRlBTID0gMzA7Il0sIm5hbWVzIjpbInY0IiwidXVpZHY0IiwieiIsIkNPTVBfTkFNRSIsIkNvbXBvc2l0aW9uUHJvcHMiLCJvYmplY3QiLCJ0aXRsZSIsInN0cmluZyIsImRlZmF1bHRNeUNvbXBQcm9wcyIsIkRlbW9UaW1lbGluZVByb3BzIiwiYXV0aG9yIiwiaW1hZ2VVcmwiLCJkZWZhdWx0RGVtb1Byb3BzIiwiY3JlYXRlRGVmYXVsdFByb2plY3RQcm9wcyIsIndlbGNvbWVTY2VuZUlkIiwibWV0YSIsImR1cmF0aW9uIiwiYmFja2dyb3VuZENvbG9yIiwic2NlbmVzIiwiaWQiLCJ0eXBlIiwic3RhcnQiLCJkYXRhIiwibmFtZSIsImNvZGUiLCJpc1dlbGNvbWVTY2VuZSIsIkRFRkFVTFRfUFJPSkVDVF9QUk9QUyIsInRleHQiLCJjb2xvciIsImZvbnRTaXplIiwiU0NFTkVfVFlQRVMiLCJTSEFQRVMiLCJUUkFOU0lUSU9OUyIsIkRJUkVDVElPTlMiLCJURVhUX0FOSU1BVElPTlMiLCJTSEFQRV9BTklNQVRJT05TIiwiQkdfQ09MT1JfQU5JTUFUSU9OUyIsIkdSQURJRU5UX1RZUEVTIiwiUEFSVElDTEVfVFlQRVMiLCJTVkdfQU5JTUFUSU9OUyIsIlNWR19JQ09OUyIsIkRVUkFUSU9OX0lOX0ZSQU1FUyIsIlZJREVPX1dJRFRIIiwiVklERU9fSEVJR0hUIiwiVklERU9fRlBTIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/types/video/remotion-constants.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/codeDurationExtractor.ts":
/*!************************************************!*\
  !*** ./src/lib/utils/codeDurationExtractor.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   analyzeDuration: () => (/* binding */ analyzeDuration),\n/* harmony export */   extractDurationFromCode: () => (/* binding */ extractDurationFromCode),\n/* harmony export */   framesToSeconds: () => (/* binding */ framesToSeconds),\n/* harmony export */   secondsToFrames: () => (/* binding */ secondsToFrames)\n/* harmony export */ });\n/**\n * Extracts the actual duration from generated Remotion code by analyzing\n * interpolate() calls, animation timings, and frame-based logic.\n * \n * This fixes the issue where scenes always show 6 seconds (180 frames) instead\n * of the actual animation duration specified in the generated code.\n */ /**\n * Calculate intelligent scene duration by adding buffers based on animation complexity\n */ function calculateSmartDuration(rawAnimationDuration, code, ranges) {\n    const MIN_PRACTICAL_DURATION = 60; // 2 seconds minimum for any scene\n    const BUFFER_FRAMES = 30; // 1 second buffer for breathing room\n    // Start with the raw animation duration\n    let smartDuration = rawAnimationDuration;\n    // Always add a basic buffer for breathing room\n    smartDuration += BUFFER_FRAMES;\n    // Add complexity-based adjustments\n    const codeLength = code.length;\n    const animationCount = ranges.length;\n    const hasMultipleAnimations = animationCount > 1;\n    const hasComplexLogic = code.includes('if') || code.includes('switch') || code.includes('map');\n    // Extra buffer for complex scenes\n    if (codeLength > 2000 || hasMultipleAnimations || hasComplexLogic) {\n        smartDuration += 15; // Extra 0.5 seconds for complex scenes\n    }\n    // Ensure minimum practical duration\n    smartDuration = Math.max(smartDuration, MIN_PRACTICAL_DURATION);\n    return smartDuration;\n}\nfunction extractDurationFromCode(code) {\n    const DEFAULT_DURATION = 180; // 6 seconds at 30fps - fallback only\n    const MIN_ANIMATION_DURATION = 30; // 1 second minimum for valid animation detection\n    const MIN_PRACTICAL_DURATION = 60; // 2 seconds minimum for a practical scene\n    const MAX_DURATION = 900; // 30 seconds maximum\n    try {\n        // Remove comments and clean the code for parsing\n        const cleanCode = code.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '').replace(/\\/\\/.*$/gm, '');\n        const ranges = [];\n        // Pattern 1: Direct interpolate calls with frame ranges\n        // Example: interpolate(frame, [0, 90], [0, 1])\n        const interpolateRegex = /interpolate\\s*\\(\\s*\\w+\\s*,\\s*\\[\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\]/g;\n        let match;\n        while((match = interpolateRegex.exec(cleanCode)) !== null){\n            const startFrame = match[1] ? parseInt(match[1], 10) : NaN;\n            const endFrame = match[2] ? parseInt(match[2], 10) : NaN;\n            if (!isNaN(startFrame) && !isNaN(endFrame) && endFrame > startFrame) {\n                ranges.push({\n                    startFrame,\n                    endFrame,\n                    purpose: 'interpolate'\n                });\n            }\n        }\n        // Pattern 2: Spring animations with durationInFrames\n        // Example: spring({frame, fps, from: 0, to: 1, durationInFrames: fps * 0.8})\n        const springRegex = /spring\\s*\\(\\s*\\{[^}]*durationInFrames:\\s*fps\\s*\\*\\s*([\\d.]+)[^}]*\\}/g;\n        while((match = springRegex.exec(cleanCode)) !== null){\n            const multiplier = match[1] ? parseFloat(match[1]) : NaN;\n            if (!isNaN(multiplier) && multiplier > 0) {\n                const durationFrames = Math.round(30 * multiplier); // Assume 30fps\n                ranges.push({\n                    startFrame: 0,\n                    endFrame: durationFrames,\n                    purpose: 'spring-animation'\n                });\n            }\n        }\n        // Pattern 3: Frame offset patterns (for staggered animations)\n        // Example: frame - 38, frame - 16\n        const frameOffsetRegex = /frame\\s*-\\s*(\\d+)/g;\n        while((match = frameOffsetRegex.exec(cleanCode)) !== null){\n            const offset = match[1] ? parseInt(match[1], 10) : NaN;\n            if (!isNaN(offset) && offset > 0) {\n                ranges.push({\n                    startFrame: offset,\n                    endFrame: offset + 30,\n                    purpose: 'frame-offset'\n                });\n            }\n        }\n        // Pattern 4: FPS-based duration patterns\n        // Example: fps * 0.8, fps * 1.5\n        const fpsDurationRegex = /fps\\s*\\*\\s*([\\d.]+)/g;\n        while((match = fpsDurationRegex.exec(cleanCode)) !== null){\n            const multiplier = match[1] ? parseFloat(match[1]) : NaN;\n            if (!isNaN(multiplier) && multiplier > 0) {\n                const durationFrames = Math.round(30 * multiplier); // Assume 30fps\n                ranges.push({\n                    startFrame: 0,\n                    endFrame: durationFrames,\n                    purpose: 'fps-duration'\n                });\n            }\n        }\n        // Pattern 5: useCurrentFrame with explicit frame checks\n        // Example: frame < 60, frame > 120\n        const frameComparisonRegex = /frame\\s*[<>]=?\\s*(\\d+)/g;\n        while((match = frameComparisonRegex.exec(cleanCode)) !== null){\n            const frameValue = match[1] ? parseInt(match[1], 10) : NaN;\n            if (!isNaN(frameValue) && frameValue > 0) {\n                ranges.push({\n                    startFrame: 0,\n                    endFrame: frameValue,\n                    purpose: 'frame-comparison'\n                });\n            }\n        }\n        // Pattern 6: Animation duration comments or constants\n        // Example: // Duration: 3 seconds, const DURATION = 90\n        const durationCommentRegex = /(?:duration|DURATION).*?(\\d+).*?(?:second|frame)/gi;\n        while((match = durationCommentRegex.exec(cleanCode)) !== null){\n            const value = match[1] ? parseInt(match[1], 10) : NaN;\n            if (!isNaN(value)) {\n                // If it's seconds, convert to frames (assuming 30fps)\n                const frames = match[0] && match[0].toLowerCase().includes('second') ? value * 30 : value;\n                if (frames > 0) {\n                    ranges.push({\n                        startFrame: 0,\n                        endFrame: frames,\n                        purpose: 'duration-comment'\n                    });\n                }\n            }\n        }\n        // Pattern 7: Sequence-based animations with delays\n        // Example: delay + duration patterns\n        const sequenceRegex = /(\\w+)\\s*\\+\\s*(\\d+)|delay.*?(\\d+).*?duration.*?(\\d+)/gi;\n        while((match = sequenceRegex.exec(cleanCode)) !== null){\n            // Look for delay + duration patterns\n            const delay = match[3] ? parseInt(match[3], 10) : 0;\n            const duration = match[4] ? parseInt(match[4], 10) : match[2] ? parseInt(match[2], 10) : 0;\n            if (!isNaN(delay) && !isNaN(duration) && duration > 0) {\n                ranges.push({\n                    startFrame: delay,\n                    endFrame: delay + duration,\n                    purpose: 'sequence'\n                });\n            }\n        }\n        // If no ranges found, look for any numeric values that might represent frames\n        if (ranges.length === 0) {\n            const numberRegex = /\\b(\\d{2,3})\\b/g;\n            const numbers = [];\n            while((match = numberRegex.exec(cleanCode)) !== null){\n                const num = match[1] ? parseInt(match[1], 10) : NaN;\n                // Only consider reasonable frame numbers (between 30 and 900)\n                if (!isNaN(num) && num >= MIN_ANIMATION_DURATION && num <= MAX_DURATION) {\n                    numbers.push(num);\n                }\n            }\n            if (numbers.length > 0) {\n                // Use the largest reasonable number as likely duration\n                const maxFrames = Math.max(...numbers);\n                ranges.push({\n                    startFrame: 0,\n                    endFrame: maxFrames,\n                    purpose: 'numeric-heuristic'\n                });\n            }\n        }\n        // Calculate the maximum end frame from all ranges\n        if (ranges.length > 0) {\n            const rawAnimationDuration = Math.max(...ranges.map((r)=>r.endFrame));\n            // Validate the extracted animation duration\n            if (rawAnimationDuration >= MIN_ANIMATION_DURATION && rawAnimationDuration <= MAX_DURATION) {\n                //  SMART DURATION: Add intelligent buffer based on animation complexity\n                const smartDuration = calculateSmartDuration(rawAnimationDuration, code, ranges);\n                // console.log(`[CodeDurationExtractor] Raw animation: ${rawAnimationDuration} frames  Smart duration: ${smartDuration} frames from ${ranges.length} range(s)`);\n                //console.log(`[CodeDurationExtractor] Ranges found:`, ranges);\n                return smartDuration;\n            } else {\n            // console.warn(`[CodeDurationExtractor] Extracted duration ${rawAnimationDuration} frames is outside valid range (${MIN_ANIMATION_DURATION}-${MAX_DURATION}), using default`);\n            }\n        }\n        //  console.warn(`[CodeDurationExtractor] No valid animation ranges found in code, using default ${DEFAULT_DURATION} frames`);\n        return DEFAULT_DURATION;\n    } catch (error) {\n        // console.error('[CodeDurationExtractor] Error parsing code:', error);\n        return DEFAULT_DURATION;\n    }\n}\n/**\n * Helper function to convert seconds to frames at 30fps\n */ function secondsToFrames(seconds) {\n    return Math.round(seconds * 30);\n}\n/**\n * Helper function to convert frames to seconds at 30fps\n */ function framesToSeconds(frames) {\n    return Math.round(frames / 30 * 10) / 10; // Round to 1 decimal place\n}\n/**\n * Analyze code and provide a human-readable duration summary\n */ function analyzeDuration(code) {\n    const frames = extractDurationFromCode(code);\n    const seconds = framesToSeconds(frames);\n    // Determine confidence based on what was found in the code\n    let confidence = 'low';\n    let source = 'default fallback';\n    if (code.includes('spring(') && code.includes('durationInFrames')) {\n        confidence = 'high';\n        source = 'spring animations + smart buffer';\n    } else if (code.includes('interpolate(')) {\n        confidence = 'high';\n        source = 'interpolate calls + smart buffer';\n    } else if (code.includes('fps *') || /frame\\s*-\\s*\\d+/.test(code)) {\n        confidence = 'medium';\n        source = 'fps timing + frame offsets + smart buffer';\n    } else if (code.includes('frame')) {\n        confidence = 'medium';\n        source = 'frame logic + smart buffer';\n    } else if (/\\b\\d{2,3}\\b/.test(code)) {\n        confidence = 'low';\n        source = 'numeric heuristics + smart buffer';\n    }\n    return {\n        frames,\n        seconds,\n        confidence,\n        source\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3V0aWxzL2NvZGVEdXJhdGlvbkV4dHJhY3Rvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7OztDQU1DLEdBUUQ7O0NBRUMsR0FDRCxTQUFTQSx1QkFBdUJDLG9CQUE0QixFQUFFQyxJQUFZLEVBQUVDLE1BQXdCO0lBQ2xHLE1BQU1DLHlCQUF5QixJQUFJLGtDQUFrQztJQUNyRSxNQUFNQyxnQkFBZ0IsSUFBSSxxQ0FBcUM7SUFFL0Qsd0NBQXdDO0lBQ3hDLElBQUlDLGdCQUFnQkw7SUFFcEIsK0NBQStDO0lBQy9DSyxpQkFBaUJEO0lBRWpCLG1DQUFtQztJQUNuQyxNQUFNRSxhQUFhTCxLQUFLTSxNQUFNO0lBQzlCLE1BQU1DLGlCQUFpQk4sT0FBT0ssTUFBTTtJQUNwQyxNQUFNRSx3QkFBd0JELGlCQUFpQjtJQUMvQyxNQUFNRSxrQkFBa0JULEtBQUtVLFFBQVEsQ0FBQyxTQUFTVixLQUFLVSxRQUFRLENBQUMsYUFBYVYsS0FBS1UsUUFBUSxDQUFDO0lBRXhGLGtDQUFrQztJQUNsQyxJQUFJTCxhQUFhLFFBQVFHLHlCQUF5QkMsaUJBQWlCO1FBQ2pFTCxpQkFBaUIsSUFBSSx1Q0FBdUM7SUFDOUQ7SUFFQSxvQ0FBb0M7SUFDcENBLGdCQUFnQk8sS0FBS0MsR0FBRyxDQUFDUixlQUFlRjtJQUV4QyxPQUFPRTtBQUNUO0FBRU8sU0FBU1Msd0JBQXdCYixJQUFZO0lBQ2xELE1BQU1jLG1CQUFtQixLQUFLLHFDQUFxQztJQUNuRSxNQUFNQyx5QkFBeUIsSUFBSSxpREFBaUQ7SUFDcEYsTUFBTWIseUJBQXlCLElBQUksMENBQTBDO0lBQzdFLE1BQU1jLGVBQWUsS0FBSyxxQkFBcUI7SUFFL0MsSUFBSTtRQUNGLGlEQUFpRDtRQUNqRCxNQUFNQyxZQUFZakIsS0FBS2tCLE9BQU8sQ0FBQyxxQkFBcUIsSUFBSUEsT0FBTyxDQUFDLGFBQWE7UUFFN0UsTUFBTWpCLFNBQTJCLEVBQUU7UUFFbkMsd0RBQXdEO1FBQ3hELCtDQUErQztR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Q00sU0FBU3VCLGdCQUFnQnhELElBQVk7SUFNMUMsTUFBTXlDLFNBQVM1Qix3QkFBd0JiO0lBQ3ZDLE1BQU1zRCxVQUFVQyxnQkFBZ0JkO0lBRWhDLDJEQUEyRDtJQUMzRCxJQUFJZ0IsYUFBd0M7SUFDNUMsSUFBSUMsU0FBUztJQUViLElBQUkxRCxLQUFLVSxRQUFRLENBQUMsY0FBY1YsS0FBS1UsUUFBUSxDQUFDLHFCQUFxQjtRQUNqRStDLGFBQWE7UUFDYkMsU0FBUztJQUNYLE9BQU8sSUFBSTFELEtBQUtVLFFBQVEsQ0FBQyxpQkFBaUI7UUFDeEMrQyxhQUFhO1FBQ2JDLFNBQVM7SUFDWCxPQUFPLElBQUkxRCxLQUFLVSxRQUFRLENBQUMsWUFBWSxrQkFBa0JpRCxJQUFJLENBQUMzRCxPQUFPO1FBQ2pFeUQsYUFBYTtRQUNiQyxTQUFTO0lBQ1gsT0FBTyxJQUFJMUQsS0FBS1UsUUFBUSxDQUFDLFVBQVU7UUFDakMrQyxhQUFhO1FBQ2JDLFNBQVM7SUFDWCxPQUFPLElBQUksY0FBY0MsSUFBSSxDQUFDM0QsT0FBTztRQUNuQ3lELGFBQWE7UUFDYkMsU0FBUztJQUNYO0lBRUEsT0FBTztRQUNMakI7UUFDQWE7UUFDQUc7UUFDQUM7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvbGliL3V0aWxzL2NvZGVEdXJhdGlvbkV4dHJhY3Rvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEV4dHJhY3RzIHRoZSBhY3R1YWwgZHVyYXRpb24gZnJvbSBnZW5lcmF0ZWQgUmVtb3Rpb24gY29kZSBieSBhbmFseXppbmdcbiAqIGludGVycG9sYXRlKCkgY2FsbHMsIGFuaW1hdGlvbiB0aW1pbmdzLCBhbmQgZnJhbWUtYmFzZWQgbG9naWMuXG4gKiBcbiAqIFRoaXMgZml4ZXMgdGhlIGlzc3VlIHdoZXJlIHNjZW5lcyBhbHdheXMgc2hvdyA2IHNlY29uZHMgKDE4MCBmcmFtZXMpIGluc3RlYWRcbiAqIG9mIHRoZSBhY3R1YWwgYW5pbWF0aW9uIGR1cmF0aW9uIHNwZWNpZmllZCBpbiB0aGUgZ2VuZXJhdGVkIGNvZGUuXG4gKi9cblxuaW50ZXJmYWNlIEFuaW1hdGlvblJhbmdlIHtcbiAgc3RhcnRGcmFtZTogbnVtYmVyO1xuICBlbmRGcmFtZTogbnVtYmVyO1xuICBwdXJwb3NlOiBzdHJpbmc7IC8vIGZhZGVJbiwgc2xpZGVVcCwgZXRjLlxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBpbnRlbGxpZ2VudCBzY2VuZSBkdXJhdGlvbiBieSBhZGRpbmcgYnVmZmVycyBiYXNlZCBvbiBhbmltYXRpb24gY29tcGxleGl0eVxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVTbWFydER1cmF0aW9uKHJhd0FuaW1hdGlvbkR1cmF0aW9uOiBudW1iZXIsIGNvZGU6IHN0cmluZywgcmFuZ2VzOiBBbmltYXRpb25SYW5nZVtdKTogbnVtYmVyIHtcbiAgY29uc3QgTUlOX1BSQUNUSUNBTF9EVVJBVElPTiA9IDYwOyAvLyAyIHNlY29uZHMgbWluaW11bSBmb3IgYW55IHNjZW5lXG4gIGNvbnN0IEJVRkZFUl9GUkFNRVMgPSAzMDsgLy8gMSBzZWNvbmQgYnVmZmVyIGZvciBicmVhdGhpbmcgcm9vbVxuICBcbiAgLy8gU3RhcnQgd2l0aCB0aGUgcmF3IGFuaW1hdGlvbiBkdXJhdGlvblxuICBsZXQgc21hcnREdXJhdGlvbiA9IHJhd0FuaW1hdGlvbkR1cmF0aW9uO1xuICBcbiAgLy8gQWx3YXlzIGFkZCBhIGJhc2ljIGJ1ZmZlciBmb3IgYnJlYXRoaW5nIHJvb21cbiAgc21hcnREdXJhdGlvbiArPSBCVUZGRVJfRlJBTUVTO1xuICBcbiAgLy8gQWRkIGNvbXBsZXhpdHktYmFzZWQgYWRqdXN0bWVudHNcbiAgY29uc3QgY29kZUxlbmd0aCA9IGNvZGUubGVuZ3RoO1xuICBjb25zdCBhbmltYXRpb25Db3VudCA9IHJhbmdlcy5sZW5ndGg7XG4gIGNvbnN0IGhhc011bHRpcGxlQW5pbWF0aW9ucyA9IGFuaW1hdGlvbkNvdW50ID4gMTtcbiAgY29uc3QgaGFzQ29tcGxleExvZ2ljID0gY29kZS5pbmNsdWRlcygnaWYnKSB8fCBjb2RlLmluY2x1ZGVzKCdzd2l0Y2gnKSB8fCBjb2RlLmluY2x1ZGVzKCdtYXAnKTtcbiAgXG4gIC8vIEV4dHJhIGJ1ZmZlciBmb3IgY29tcGxleCBzY2VuZXNcbiAgaWYgKGNvZGVMZW5ndGggPiAyMDAwIHx8IGhhc011bHRpcGxlQW5pbWF0aW9ucyB8fCBoYXNDb21wbGV4TG9naWMpIHtcbiAgICBzbWFydER1cmF0aW9uICs9IDE1OyAvLyBFeHRyYSAwLjUgc2Vjb25kcyBmb3IgY29tcGxleCBzY2VuZXNcbiAgfVxuICBcbiAgLy8gRW5zdXJlIG1pbmltdW0gcHJhY3RpY2FsIGR1cmF0aW9uXG4gIHNtYXJ0RHVyYXRpb24gPSBNYXRoLm1heChzbWFydER1cmF0aW9uLCBNSU5fUFJBQ1RJQ0FMX0RVUkFUSU9OKTtcbiAgXG4gIHJldHVybiBzbWFydER1cmF0aW9uO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdER1cmF0aW9uRnJvbUNvZGUoY29kZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgREVGQVVMVF9EVVJBVElPTiA9IDE4MDsgLy8gNiBzZWNvbmRzIGF0IDMwZnBzIC0gZmFsbGJhY2sgb25seVxuICBjb25zdCBNSU5fQU5JTUFUSU9OX0RVUkFUSU9OID0gMzA7IC8vIDEgc2Vjb25kIG1pbmltdW0gZm9yIHZhbGlkIGFuaW1hdGlvbiBkZXRlY3Rpb25cbiAgY29uc3QgTUlOX1BSQUNUSUNBTF9EVVJBVElPTiA9IDYwOyAvLyAyIHNlY29uZHMgbWluaW11bSBmb3IgYSBwcmFjdGljYWwgc2NlbmVcbiAgY29uc3QgTUFYX0RVUkFUSU9OID0gOTAwOyAvLyAzMCBzZWNvbmRzIG1heGltdW1cbiAgXG4gIHRyeSB7XG4gICAgLy8gUmVtb3ZlIGNvbW1lbnRzIGFuZCBjbGVhbiB0aGUgY29kZSBmb3IgcGFyc2luZ1xuICAgIGNvbnN0IGNsZWFuQ29kZSA9IGNvZGUucmVwbGFjZSgvXFwvXFwqW1xcc1xcU10qP1xcKlxcLy9nLCAnJykucmVwbGFjZSgvXFwvXFwvLiokL2dtLCAnJyk7XG4gICAgXG4gICAgY29uc3QgcmFuZ2VzOiBBbmltYXRpb25SYW5nZVtdID0gW107XG4gICAgXG4gICAgLy8gUGF0dGVybiAxOiBEaXJlY3QgaW50ZXJwb2xhdGUgY2FsbHMgd2l0aCBmcmFtZSByYW5nZXNcbiAgICAvLyBFeGFtcGxlOiBpbnRlcnBvbGF0ZShmcmFtZSwgWzAsIDkwXSwgWzAsIDFdKVxuICAgIGNvbnN0IGludGVycG9sYXRlUmVnZXggPSAvaW50ZXJwb2xhdGVcXHMqXFwoXFxzKlxcdytcXHMqLFxccypcXFtcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKlxcXS9nO1xuICAgIGxldCBtYXRjaDtcbiAgICBcbiAgICB3aGlsZSAoKG1hdGNoID0gaW50ZXJwb2xhdGVSZWdleC5leGVjKGNsZWFuQ29kZSkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBzdGFydEZyYW1lID0gbWF0Y2hbMV0gPyBwYXJzZUludChtYXRjaFsxXSwgMTApIDogTmFOO1xuICAgICAgY29uc3QgZW5kRnJhbWUgPSBtYXRjaFsyXSA/IHBhcnNlSW50KG1hdGNoWzJdLCAxMCkgOiBOYU47XG4gICAgICBcbiAgICAgIGlmICghaXNOYU4oc3RhcnRGcmFtZSkgJiYgIWlzTmFOKGVuZEZyYW1lKSAmJiBlbmRGcmFtZSA+IHN0YXJ0RnJhbWUpIHtcbiAgICAgICAgcmFuZ2VzLnB1c2goe1xuICAgICAgICAgIHN0YXJ0RnJhbWUsXG4gICAgICAgICAgZW5kRnJhbWUsXG4gICAgICAgICAgcHVycG9zZTogJ2ludGVycG9sYXRlJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gUGF0dGVybiAyOiBTcHJpbmcgYW5pbWF0aW9ucyB3aXRoIGR1cmF0aW9uSW5GcmFtZXNcbiAgICAvLyBFeGFtcGxlOiBzcHJpbmcoe2ZyYW1lLCBmcHMsIGZyb206IDAsIHRvOiAxLCBkdXJhdGlvbkluRnJhbWVzOiBmcHMgKiAwLjh9KVxuICAgIGNvbnN0IHNwcmluZ1JlZ2V4ID0gL3NwcmluZ1xccypcXChcXHMqXFx7W159XSpkdXJhdGlvbkluRnJhbWVzOlxccypmcHNcXHMqXFwqXFxzKihbXFxkLl0rKVtefV0qXFx9L2c7XG4gICAgd2hpbGUgKChtYXRjaCA9IHNwcmluZ1JlZ2V4LmV4ZWMoY2xlYW5Db2RlKSkgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBtYXRjaFsxXSA/IHBhcnNlRmxvYXQobWF0Y2hbMV0pIDogTmFOO1xuICAgICAgaWYgKCFpc05hTihtdWx0aXBsaWVyKSAmJiBtdWx0aXBsaWVyID4gMCkge1xuICAgICAgICBjb25zdCBkdXJhdGlvbkZyYW1lcyA9IE1hdGgucm91bmQoMzAgKiBtdWx0aXBsaWVyKTsgLy8gQXNzdW1lIDMwZnBzXG4gICAgICAgIHJhbmdlcy5wdXNoKHtcbiAgICAgICAgICBzdGFydEZyYW1lOiAwLFxuICAgICAgICAgIGVuZEZyYW1lOiBkdXJhdGlvbkZyYW1lcyxcbiAgICAgICAgICBwdXJwb3NlOiAnc3ByaW5nLWFuaW1hdGlvbidcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFBhdHRlcm4gMzogRnJhbWUgb2Zmc2V0IHBhdHRlcm5zIChmb3Igc3RhZ2dlcmVkIGFuaW1hdGlvbnMpXG4gICAgLy8gRXhhbXBsZTogZnJhbWUgLSAzOCwgZnJhbWUgLSAxNlxuICAgIGNvbnN0IGZyYW1lT2Zmc2V0UmVnZXggPSAvZnJhbWVcXHMqLVxccyooXFxkKykvZztcbiAgICB3aGlsZSAoKG1hdGNoID0gZnJhbWVPZmZzZXRSZWdleC5leGVjKGNsZWFuQ29kZSkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBvZmZzZXQgPSBtYXRjaFsxXSA/IHBhcnNlSW50KG1hdGNoWzFdLCAxMCkgOiBOYU47XG4gICAgICBpZiAoIWlzTmFOKG9mZnNldCkgJiYgb2Zmc2V0ID4gMCkge1xuICAgICAgICByYW5nZXMucHVzaCh7XG4gICAgICAgICAgc3RhcnRGcmFtZTogb2Zmc2V0LFxuICAgICAgICAgIGVuZEZyYW1lOiBvZmZzZXQgKyAzMCwgLy8gQXNzdW1lIGF0IGxlYXN0IDEgc2Vjb25kIG9mIGFuaW1hdGlvbiBhZnRlciBvZmZzZXRcbiAgICAgICAgICBwdXJwb3NlOiAnZnJhbWUtb2Zmc2V0J1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gUGF0dGVybiA0OiBGUFMtYmFzZWQgZHVyYXRpb24gcGF0dGVybnNcbiAgICAvLyBFeGFtcGxlOiBmcHMgKiAwLjgsIGZwcyAqIDEuNVxuICAgIGNvbnN0IGZwc0R1cmF0aW9uUmVnZXggPSAvZnBzXFxzKlxcKlxccyooW1xcZC5dKykvZztcbiAgICB3aGlsZSAoKG1hdGNoID0gZnBzRHVyYXRpb25SZWdleC5leGVjKGNsZWFuQ29kZSkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBtdWx0aXBsaWVyID0gbWF0Y2hbMV0gPyBwYXJzZUZsb2F0KG1hdGNoWzFdKSA6IE5hTjtcbiAgICAgIGlmICghaXNOYU4obXVsdGlwbGllcikgJiYgbXVsdGlwbGllciA+IDApIHtcbiAgICAgICAgY29uc3QgZHVyYXRpb25GcmFtZXMgPSBNYXRoLnJvdW5kKDMwICogbXVsdGlwbGllcik7IC8vIEFzc3VtZSAzMGZwc1xuICAgICAgICByYW5nZXMucHVzaCh7XG4gICAgICAgICAgc3RhcnRGcmFtZTogMCxcbiAgICAgICAgICBlbmRGcmFtZTogZHVyYXRpb25GcmFtZXMsXG4gICAgICAgICAgcHVycG9zZTogJ2Zwcy1kdXJhdGlvbidcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUGF0dGVybiA1OiB1c2VDdXJyZW50RnJhbWUgd2l0aCBleHBsaWNpdCBmcmFtZSBjaGVja3NcbiAgICAvLyBFeGFtcGxlOiBmcmFtZSA8IDYwLCBmcmFtZSA+IDEyMFxuICAgIGNvbnN0IGZyYW1lQ29tcGFyaXNvblJlZ2V4ID0gL2ZyYW1lXFxzKls8Pl09P1xccyooXFxkKykvZztcbiAgICB3aGlsZSAoKG1hdGNoID0gZnJhbWVDb21wYXJpc29uUmVnZXguZXhlYyhjbGVhbkNvZGUpKSAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgZnJhbWVWYWx1ZSA9IG1hdGNoWzFdID8gcGFyc2VJbnQobWF0Y2hbMV0sIDEwKSA6IE5hTjtcbiAgICAgIGlmICghaXNOYU4oZnJhbWVWYWx1ZSkgJiYgZnJhbWVWYWx1ZSA+IDApIHtcbiAgICAgICAgcmFuZ2VzLnB1c2goe1xuICAgICAgICAgIHN0YXJ0RnJhbWU6IDAsXG4gICAgICAgICAgZW5kRnJhbWU6IGZyYW1lVmFsdWUsXG4gICAgICAgICAgcHVycG9zZTogJ2ZyYW1lLWNvbXBhcmlzb24nXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBQYXR0ZXJuIDY6IEFuaW1hdGlvbiBkdXJhdGlvbiBjb21tZW50cyBvciBjb25zdGFudHNcbiAgICAvLyBFeGFtcGxlOiAvLyBEdXJhdGlvbjogMyBzZWNvbmRzLCBjb25zdCBEVVJBVElPTiA9IDkwXG4gICAgY29uc3QgZHVyYXRpb25Db21tZW50UmVnZXggPSAvKD86ZHVyYXRpb258RFVSQVRJT04pLio/KFxcZCspLio/KD86c2Vjb25kfGZyYW1lKS9naTtcbiAgICB3aGlsZSAoKG1hdGNoID0gZHVyYXRpb25Db21tZW50UmVnZXguZXhlYyhjbGVhbkNvZGUpKSAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgdmFsdWUgPSBtYXRjaFsxXSA/IHBhcnNlSW50KG1hdGNoWzFdLCAxMCkgOiBOYU47XG4gICAgICBpZiAoIWlzTmFOKHZhbHVlKSkge1xuICAgICAgICAvLyBJZiBpdCdzIHNlY29uZHMsIGNvbnZlcnQgdG8gZnJhbWVzIChhc3N1bWluZyAzMGZwcylcbiAgICAgICAgY29uc3QgZnJhbWVzID0gbWF0Y2hbMF0gJiYgbWF0Y2hbMF0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc2Vjb25kJykgPyB2YWx1ZSAqIDMwIDogdmFsdWU7XG4gICAgICAgIGlmIChmcmFtZXMgPiAwKSB7XG4gICAgICAgICAgcmFuZ2VzLnB1c2goe1xuICAgICAgICAgICAgc3RhcnRGcmFtZTogMCxcbiAgICAgICAgICAgIGVuZEZyYW1lOiBmcmFtZXMsXG4gICAgICAgICAgICBwdXJwb3NlOiAnZHVyYXRpb24tY29tbWVudCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBQYXR0ZXJuIDc6IFNlcXVlbmNlLWJhc2VkIGFuaW1hdGlvbnMgd2l0aCBkZWxheXNcbiAgICAvLyBFeGFtcGxlOiBkZWxheSArIGR1cmF0aW9uIHBhdHRlcm5zXG4gICAgY29uc3Qgc2VxdWVuY2VSZWdleCA9IC8oXFx3KylcXHMqXFwrXFxzKihcXGQrKXxkZWxheS4qPyhcXGQrKS4qP2R1cmF0aW9uLio/KFxcZCspL2dpO1xuICAgIHdoaWxlICgobWF0Y2ggPSBzZXF1ZW5jZVJlZ2V4LmV4ZWMoY2xlYW5Db2RlKSkgIT09IG51bGwpIHtcbiAgICAgIC8vIExvb2sgZm9yIGRlbGF5ICsgZHVyYXRpb24gcGF0dGVybnNcbiAgICAgIGNvbnN0IGRlbGF5ID0gbWF0Y2hbM10gPyBwYXJzZUludChtYXRjaFszXSwgMTApIDogMDtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gbWF0Y2hbNF0gPyBwYXJzZUludChtYXRjaFs0XSwgMTApIDogKG1hdGNoWzJdID8gcGFyc2VJbnQobWF0Y2hbMl0sIDEwKSA6IDApO1xuICAgICAgXG4gICAgICBpZiAoIWlzTmFOKGRlbGF5KSAmJiAhaXNOYU4oZHVyYXRpb24pICYmIGR1cmF0aW9uID4gMCkge1xuICAgICAgICByYW5nZXMucHVzaCh7XG4gICAgICAgICAgc3RhcnRGcmFtZTogZGVsYXksXG4gICAgICAgICAgZW5kRnJhbWU6IGRlbGF5ICsgZHVyYXRpb24sXG4gICAgICAgICAgcHVycG9zZTogJ3NlcXVlbmNlJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gSWYgbm8gcmFuZ2VzIGZvdW5kLCBsb29rIGZvciBhbnkgbnVtZXJpYyB2YWx1ZXMgdGhhdCBtaWdodCByZXByZXNlbnQgZnJhbWVzXG4gICAgaWYgKHJhbmdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IG51bWJlclJlZ2V4ID0gL1xcYihcXGR7MiwzfSlcXGIvZztcbiAgICAgIGNvbnN0IG51bWJlcnM6IG51bWJlcltdID0gW107XG4gICAgICBcbiAgICAgIHdoaWxlICgobWF0Y2ggPSBudW1iZXJSZWdleC5leGVjKGNsZWFuQ29kZSkpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IG51bSA9IG1hdGNoWzFdID8gcGFyc2VJbnQobWF0Y2hbMV0sIDEwKSA6IE5hTjtcbiAgICAgICAgLy8gT25seSBjb25zaWRlciByZWFzb25hYmxlIGZyYW1lIG51bWJlcnMgKGJldHdlZW4gMzAgYW5kIDkwMClcbiAgICAgICAgaWYgKCFpc05hTihudW0pICYmIG51bSA+PSBNSU5fQU5JTUFUSU9OX0RVUkFUSU9OICYmIG51bSA8PSBNQVhfRFVSQVRJT04pIHtcbiAgICAgICAgICBudW1iZXJzLnB1c2gobnVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAobnVtYmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgbGFyZ2VzdCByZWFzb25hYmxlIG51bWJlciBhcyBsaWtlbHkgZHVyYXRpb25cbiAgICAgICAgY29uc3QgbWF4RnJhbWVzID0gTWF0aC5tYXgoLi4ubnVtYmVycyk7XG4gICAgICAgIHJhbmdlcy5wdXNoKHtcbiAgICAgICAgICBzdGFydEZyYW1lOiAwLFxuICAgICAgICAgIGVuZEZyYW1lOiBtYXhGcmFtZXMsXG4gICAgICAgICAgcHVycG9zZTogJ251bWVyaWMtaGV1cmlzdGljJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHRoZSBtYXhpbXVtIGVuZCBmcmFtZSBmcm9tIGFsbCByYW5nZXNcbiAgICBpZiAocmFuZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHJhd0FuaW1hdGlvbkR1cmF0aW9uID0gTWF0aC5tYXgoLi4ucmFuZ2VzLm1hcChyID0+IHIuZW5kRnJhbWUpKTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgdGhlIGV4dHJhY3RlZCBhbmltYXRpb24gZHVyYXRpb25cbiAgICAgIGlmIChyYXdBbmltYXRpb25EdXJhdGlvbiA+PSBNSU5fQU5JTUFUSU9OX0RVUkFUSU9OICYmIHJhd0FuaW1hdGlvbkR1cmF0aW9uIDw9IE1BWF9EVVJBVElPTikge1xuICAgICAgICAvLyDwn6egIFNNQVJUIERVUkFUSU9OOiBBZGQgaW50ZWxsaWdlbnQgYnVmZmVyIGJhc2VkIG9uIGFuaW1hdGlvbiBjb21wbGV4aXR5XG4gICAgICAgIGNvbnN0IHNtYXJ0RHVyYXRpb24gPSBjYWxjdWxhdGVTbWFydER1cmF0aW9uKHJhd0FuaW1hdGlvbkR1cmF0aW9uLCBjb2RlLCByYW5nZXMpO1xuICAgICAgICBcbiAgICAgICAgLy8gY29uc29sZS5sb2coYFtDb2RlRHVyYXRpb25FeHRyYWN0b3JdIFJhdyBhbmltYXRpb246ICR7cmF3QW5pbWF0aW9uRHVyYXRpb259IGZyYW1lcyDihpIgU21hcnQgZHVyYXRpb246ICR7c21hcnREdXJhdGlvbn0gZnJhbWVzIGZyb20gJHtyYW5nZXMubGVuZ3RofSByYW5nZShzKWApO1xuICAgICAgICAvL2NvbnNvbGUubG9nKGBbQ29kZUR1cmF0aW9uRXh0cmFjdG9yXSBSYW5nZXMgZm91bmQ6YCwgcmFuZ2VzKTtcbiAgICAgICAgcmV0dXJuIHNtYXJ0RHVyYXRpb247XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBjb25zb2xlLndhcm4oYFtDb2RlRHVyYXRpb25FeHRyYWN0b3JdIEV4dHJhY3RlZCBkdXJhdGlvbiAke3Jhd0FuaW1hdGlvbkR1cmF0aW9ufSBmcmFtZXMgaXMgb3V0c2lkZSB2YWxpZCByYW5nZSAoJHtNSU5fQU5JTUFUSU9OX0RVUkFUSU9OfS0ke01BWF9EVVJBVElPTn0pLCB1c2luZyBkZWZhdWx0YCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vICBjb25zb2xlLndhcm4oYFtDb2RlRHVyYXRpb25FeHRyYWN0b3JdIE5vIHZhbGlkIGFuaW1hdGlvbiByYW5nZXMgZm91bmQgaW4gY29kZSwgdXNpbmcgZGVmYXVsdCAke0RFRkFVTFRfRFVSQVRJT059IGZyYW1lc2ApO1xuICAgIHJldHVybiBERUZBVUxUX0RVUkFUSU9OO1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIGNvbnNvbGUuZXJyb3IoJ1tDb2RlRHVyYXRpb25FeHRyYWN0b3JdIEVycm9yIHBhcnNpbmcgY29kZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIERFRkFVTFRfRFVSQVRJT047XG4gIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBzZWNvbmRzIHRvIGZyYW1lcyBhdCAzMGZwc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2Vjb25kc1RvRnJhbWVzKHNlY29uZHM6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiBNYXRoLnJvdW5kKHNlY29uZHMgKiAzMCk7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgZnJhbWVzIHRvIHNlY29uZHMgYXQgMzBmcHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyYW1lc1RvU2Vjb25kcyhmcmFtZXM6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiBNYXRoLnJvdW5kKChmcmFtZXMgLyAzMCkgKiAxMCkgLyAxMDsgLy8gUm91bmQgdG8gMSBkZWNpbWFsIHBsYWNlXG59XG5cbi8qKlxuICogQW5hbHl6ZSBjb2RlIGFuZCBwcm92aWRlIGEgaHVtYW4tcmVhZGFibGUgZHVyYXRpb24gc3VtbWFyeVxuICovXG5leHBvcnQgZnVuY3Rpb24gYW5hbHl6ZUR1cmF0aW9uKGNvZGU6IHN0cmluZyk6IHtcbiAgZnJhbWVzOiBudW1iZXI7XG4gIHNlY29uZHM6IG51bWJlcjtcbiAgY29uZmlkZW5jZTogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgc291cmNlOiBzdHJpbmc7XG59IHtcbiAgY29uc3QgZnJhbWVzID0gZXh0cmFjdER1cmF0aW9uRnJvbUNvZGUoY29kZSk7XG4gIGNvbnN0IHNlY29uZHMgPSBmcmFtZXNUb1NlY29uZHMoZnJhbWVzKTtcbiAgXG4gIC8vIERldGVybWluZSBjb25maWRlbmNlIGJhc2VkIG9uIHdoYXQgd2FzIGZvdW5kIGluIHRoZSBjb2RlXG4gIGxldCBjb25maWRlbmNlOiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnID0gJ2xvdyc7XG4gIGxldCBzb3VyY2UgPSAnZGVmYXVsdCBmYWxsYmFjayc7XG4gIFxuICBpZiAoY29kZS5pbmNsdWRlcygnc3ByaW5nKCcpICYmIGNvZGUuaW5jbHVkZXMoJ2R1cmF0aW9uSW5GcmFtZXMnKSkge1xuICAgIGNvbmZpZGVuY2UgPSAnaGlnaCc7XG4gICAgc291cmNlID0gJ3NwcmluZyBhbmltYXRpb25zICsgc21hcnQgYnVmZmVyJztcbiAgfSBlbHNlIGlmIChjb2RlLmluY2x1ZGVzKCdpbnRlcnBvbGF0ZSgnKSkge1xuICAgIGNvbmZpZGVuY2UgPSAnaGlnaCc7XG4gICAgc291cmNlID0gJ2ludGVycG9sYXRlIGNhbGxzICsgc21hcnQgYnVmZmVyJztcbiAgfSBlbHNlIGlmIChjb2RlLmluY2x1ZGVzKCdmcHMgKicpIHx8IC9mcmFtZVxccyotXFxzKlxcZCsvLnRlc3QoY29kZSkpIHtcbiAgICBjb25maWRlbmNlID0gJ21lZGl1bSc7XG4gICAgc291cmNlID0gJ2ZwcyB0aW1pbmcgKyBmcmFtZSBvZmZzZXRzICsgc21hcnQgYnVmZmVyJztcbiAgfSBlbHNlIGlmIChjb2RlLmluY2x1ZGVzKCdmcmFtZScpKSB7XG4gICAgY29uZmlkZW5jZSA9ICdtZWRpdW0nO1xuICAgIHNvdXJjZSA9ICdmcmFtZSBsb2dpYyArIHNtYXJ0IGJ1ZmZlcic7XG4gIH0gZWxzZSBpZiAoL1xcYlxcZHsyLDN9XFxiLy50ZXN0KGNvZGUpKSB7XG4gICAgY29uZmlkZW5jZSA9ICdsb3cnO1xuICAgIHNvdXJjZSA9ICdudW1lcmljIGhldXJpc3RpY3MgKyBzbWFydCBidWZmZXInO1xuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIGZyYW1lcyxcbiAgICBzZWNvbmRzLFxuICAgIGNvbmZpZGVuY2UsXG4gICAgc291cmNlXG4gIH07XG59ICJdLCJuYW1lcyI6WyJjYWxjdWxhdGVTbWFydER1cmF0aW9uIiwicmF3QW5pbWF0aW9uRHVyYXRpb24iLCJjb2RlIiwicmFuZ2VzIiwiTUlOX1BSQUNUSUNBTF9EVVJBVElPTiIsIkJVRkZFUl9GUkFNRVMiLCJzbWFydER1cmF0aW9uIiwiY29kZUxlbmd0aCIsImxlbmd0aCIsImFuaW1hdGlvbkNvdW50IiwiaGFzTXVsdGlwbGVBbmltYXRpb25zIiwiaGFzQ29tcGxleExvZ2ljIiwiaW5jbHVkZXMiLCJNYXRoIiwibWF4IiwiZXh0cmFjdER1cmF0aW9uRnJvbUNvZGUiLCJERUZBVUxUX0RVUkFUSU9OIiwiTUlOX0FOSU1BVElPTl9EVVJBVElPTiIsIk1BWF9EVVJBVElPTiIsImNsZWFuQ29kZSIsInJlcGxhY2UiLCJpbnRlcnBvbGF0ZVJlZ2V4IiwibWF0Y2giLCJleGVjIiwic3RhcnRGcmFtZSIsInBhcnNlSW50IiwiTmFOIiwiZW5kRnJhbWUiLCJpc05hTiIsInB1c2giLCJwdXJwb3NlIiwic3ByaW5nUmVnZXgiLCJtdWx0aXBsaWVyIiwicGFyc2VGbG9hdCIsImR1cmF0aW9uRnJhbWVzIiwicm91bmQiLCJmcmFtZU9mZnNldFJlZ2V4Iiwib2Zmc2V0IiwiZnBzRHVyYXRpb25SZWdleCIsImZyYW1lQ29tcGFyaXNvblJlZ2V4IiwiZnJhbWVWYWx1ZSIsImR1cmF0aW9uQ29tbWVudFJlZ2V4IiwidmFsdWUiLCJmcmFtZXMiLCJ0b0xvd2VyQ2FzZSIsInNlcXVlbmNlUmVnZXgiLCJkZWxheSIsImR1cmF0aW9uIiwibnVtYmVyUmVnZXgiLCJudW1iZXJzIiwibnVtIiwibWF4RnJhbWVzIiwibWFwIiwiciIsImVycm9yIiwic2Vjb25kc1RvRnJhbWVzIiwic2Vjb25kcyIsImZyYW1lc1RvU2Vjb25kcyIsImFuYWx5emVEdXJhdGlvbiIsImNvbmZpZGVuY2UiLCJzb3VyY2UiLCJ0ZXN0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/codeDurationExtractor.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/logger.ts":
/*!*********************************!*\
  !*** ./src/lib/utils/logger.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   agentLogger: () => (/* binding */ agentLogger),\n/* harmony export */   animationDesignerLogger: () => (/* binding */ animationDesignerLogger),\n/* harmony export */   apiLogger: () => (/* binding */ apiLogger),\n/* harmony export */   authLogger: () => (/* binding */ authLogger),\n/* harmony export */   buildLogger: () => (/* binding */ buildLogger),\n/* harmony export */   chatLogger: () => (/* binding */ chatLogger),\n/* harmony export */   componentLogger: () => (/* binding */ componentLogger),\n/* harmony export */   cronLogger: () => (/* binding */ cronLogger),\n/* harmony export */   dbLogger: () => (/* binding */ dbLogger),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   initializeSystemFileTransport: () => (/* binding */ initializeSystemFileTransport),\n/* harmony export */   isSystemFileTransportInitialized: () => (/* binding */ isSystemFileTransportInitialized),\n/* harmony export */   logAgentProcess: () => (/* binding */ logAgentProcess),\n/* harmony export */   logAgentSend: () => (/* binding */ logAgentSend),\n/* harmony export */   logAnimationComplete: () => (/* binding */ logAnimationComplete),\n/* harmony export */   logAnimationStart: () => (/* binding */ logAnimationStart),\n/* harmony export */   logAnimationValidation: () => (/* binding */ logAnimationValidation),\n/* harmony export */   logBuildCompile: () => (/* binding */ logBuildCompile),\n/* harmony export */   logBuildComplete: () => (/* binding */ logBuildComplete),\n/* harmony export */   logBuildDebug: () => (/* binding */ logBuildDebug),\n/* harmony export */   logBuildStart: () => (/* binding */ logBuildStart),\n/* harmony export */   logBuildUpload: () => (/* binding */ logBuildUpload),\n/* harmony export */   logBuildWarn: () => (/* binding */ logBuildWarn),\n/* harmony export */   logChatComplete: () => (/* binding */ logChatComplete),\n/* harmony export */   logChatStream: () => (/* binding */ logChatStream),\n/* harmony export */   logChatTool: () => (/* binding */ logChatTool),\n/* harmony export */   logScenePlannerAdb: () => (/* binding */ logScenePlannerAdb),\n/* harmony export */   logScenePlannerComplete: () => (/* binding */ logScenePlannerComplete),\n/* harmony export */   logScenePlannerComponent: () => (/* binding */ logScenePlannerComponent),\n/* harmony export */   logScenePlannerDb: () => (/* binding */ logScenePlannerDb),\n/* harmony export */   logScenePlannerDebug: () => (/* binding */ logScenePlannerDebug),\n/* harmony export */   logSystemEvent: () => (/* binding */ logSystemEvent),\n/* harmony export */   logSystemProcess: () => (/* binding */ logSystemProcess),\n/* harmony export */   logger: () => (/* binding */ logger),\n/* harmony export */   modelsLogger: () => (/* binding */ modelsLogger),\n/* harmony export */   pageLogger: () => (/* binding */ pageLogger),\n/* harmony export */   scenePlannerLogger: () => (/* binding */ scenePlannerLogger),\n/* harmony export */   systemLogger: () => (/* binding */ systemLogger),\n/* harmony export */   toolsLogger: () => (/* binding */ toolsLogger),\n/* harmony export */   workerLogger: () => (/* binding */ workerLogger)\n/* harmony export */ });\n/* harmony import */ var winston__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! winston */ \"(rsc)/../../node_modules/winston/lib/winston.js\");\n/* harmony import */ var winston__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(winston__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var winston_daily_rotate_file__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! winston-daily-rotate-file */ \"(rsc)/../../node_modules/winston-daily-rotate-file/index.js\");\n/* harmony import */ var winston_daily_rotate_file__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(winston_daily_rotate_file__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\n// src/lib/logger.ts\n\n\n\n\n// Check if we're running on the server or in the browser\nconst isServer = \"undefined\" === 'undefined';\n// Check if we're in a production serverless environment\nconst isServerlessProduction = process.env.VERCEL || process.env.AWS_LAMBDA_FUNCTION_NAME || process.env.NETLIFY;\n// Create formatters\nconst consoleFormat = winston__WEBPACK_IMPORTED_MODULE_0__.format.combine(winston__WEBPACK_IMPORTED_MODULE_0__.format.colorize(), winston__WEBPACK_IMPORTED_MODULE_0__.format.timestamp(), winston__WEBPACK_IMPORTED_MODULE_0__.format.printf(({ timestamp, level, message, ...meta })=>{\n    const metaStr = Object.keys(meta).length ? JSON.stringify(meta, null, 2) : '';\n    return `${timestamp} [${level}]: ${message} ${metaStr}`;\n}));\nconst fileFormat = winston__WEBPACK_IMPORTED_MODULE_0__.format.combine(winston__WEBPACK_IMPORTED_MODULE_0__.format.timestamp(), winston__WEBPACK_IMPORTED_MODULE_0__.format.json());\n// Track if system file transport has been initialized to prevent duplicates\nlet systemFileTransportInitialized = false;\n// Create either a server logger or a console logger\nlet logger;\n// Safe directory creation function\nconst safeCreateDir = (dir)=>{\n    if (isServerlessProduction) {\n        // console.log(`[LOGGER] Skipping directory creation in serverless environment: ${dir}`);\n        return false;\n    }\n    try {\n        if (!fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(dir)) {\n            fs__WEBPACK_IMPORTED_MODULE_3___default().mkdirSync(dir, {\n                recursive: true\n            });\n        // console.log(`Created log directory: ${dir}`);\n        }\n        return true;\n    } catch (error) {\n        // console.warn(`[LOGGER] Could not create directory ${dir}: ${error}. Continuing without file logging.`);\n        return false;\n    }\n};\n// Initialize both server-side and client-side loggers\nif (isServer) {\n    // Get log directories from environment variables or use defaults\n    const logsDir = process.env.LOG_DIR || path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), 'logs');\n    const errorLogsDir = process.env.ERROR_LOG_DIR || logsDir;\n    const combinedLogsDir = process.env.COMBINED_LOG_DIR || logsDir;\n    const componentsLogsDir = process.env.COMPONENTS_LOG_DIR || logsDir;\n    // Log the directories being used\n    // console.log(`Logger initialization with: LOG_DIR=${logsDir}, ERROR_DIR=${errorLogsDir}`);\n    // Create base transports (always include console)\n    const baseTransports = [\n        new winston__WEBPACK_IMPORTED_MODULE_0__.transports.Console({\n            format: consoleFormat,\n            level: process.env.LOG_LEVEL || 'info'\n        })\n    ];\n    // Only add file transports if we can create directories\n    if (!isServerlessProduction) {\n        // Ensure logs directories exist\n        const dirsCreated = [\n            logsDir,\n            errorLogsDir,\n            combinedLogsDir,\n            componentsLogsDir\n        ].map(safeCreateDir);\n        // Only add file transports if directories were created successfully\n        if (dirsCreated.some((created)=>created)) {\n            if (safeCreateDir(logsDir)) {\n                baseTransports.push(new winston__WEBPACK_IMPORTED_MODULE_0__.transports.DailyRotateFile({\n                    dirname: logsDir,\n                    filename: 'components-%DATE%.log',\n                    datePattern: 'YYYY-MM-DD',\n                    maxSize: '20m',\n                    maxFiles: '14d',\n                    format: fileFormat\n                }));\n            }\n            if (safeCreateDir(errorLogsDir)) {\n                baseTransports.push(new winston__WEBPACK_IMPORTED_MODULE_0__.transports.DailyRotateFile({\n                    dirname: errorLogsDir,\n                    filename: 'error-%DATE%.log',\n                    datePattern: 'YYYY-MM-DD',\n                    maxSize: '20m',\n                    maxFiles: '14d',\n                    level: 'error',\n                    format: fileFormat\n                }));\n            }\n            if (safeCreateDir(combinedLogsDir)) {\n                baseTransports.push(new winston__WEBPACK_IMPORTED_MODULE_0__.transports.DailyRotateFile({\n                    dirname: combinedLogsDir,\n                    filename: 'combined-%DATE%.log',\n                    datePattern: 'YYYY-MM-DD',\n                    maxSize: '20m',\n                    maxFiles: '14d',\n                    format: fileFormat\n                }));\n            }\n        }\n    }\n    // Create the main logger with safe transports\n    logger = (0,winston__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        level: 'debug',\n        format: fileFormat,\n        defaultMeta: {},\n        transports: baseTransports\n    });\n    // Set up components logger with safe transports\n    const componentsTransports = [\n        new winston__WEBPACK_IMPORTED_MODULE_0__.transports.Console({\n            format: consoleFormat,\n            level: process.env.LOG_LEVEL || 'info'\n        })\n    ];\n    if (!isServerlessProduction && safeCreateDir(componentsLogsDir)) {\n        componentsTransports.push(new winston__WEBPACK_IMPORTED_MODULE_0__.transports.DailyRotateFile({\n            dirname: componentsLogsDir,\n            filename: 'components-%DATE%.log',\n            datePattern: 'YYYY-MM-DD',\n            maxSize: '20m',\n            maxFiles: '14d',\n            format: fileFormat\n        }));\n    }\n    const componentsLogger = (0,winston__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        level: 'debug',\n        format: fileFormat,\n        defaultMeta: {},\n        transports: componentsTransports\n    });\n// Log the environment variables affecting logger console level\n// console.log(`[DEBUG_LOGGER] LOGGING_MODE: ${process.env.LOGGING_MODE}, LOG_LEVEL: ${process.env.LOG_LEVEL}`)\n// console.log(`Logger initialized with log directories: main=${logsDir}, error=${errorLogsDir}, combined=${combinedLogsDir}`);\n} else {\n    // Simple console logger for client-side\n    logger = (0,winston__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        level: 'info',\n        format: fileFormat,\n        transports: [\n            new winston__WEBPACK_IMPORTED_MODULE_0__.transports.Console({\n                format: consoleFormat\n            })\n        ]\n    });\n    // Create a separate system logger\n    const systemLogger = (0,winston__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        level: 'info',\n        format: fileFormat,\n        defaultMeta: {\n            system: true\n        },\n        transports: [\n            new winston__WEBPACK_IMPORTED_MODULE_0__.transports.Console({\n                format: consoleFormat\n            })\n        ]\n    });\n    // Create a separate components logger\n    const componentsLogger = (0,winston__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        level: 'info',\n        format: fileFormat,\n        defaultMeta: {},\n        transports: [\n            new winston__WEBPACK_IMPORTED_MODULE_0__.transports.Console({\n                format: consoleFormat\n            })\n        ]\n    });\n}\n// Function to initialize system file transport if requested\nconst initializeSystemFileTransport = ()=>{\n    // Skip file transport initialization in serverless production environments\n    if (isServerlessProduction) {\n        // console.log('[LOGGER] Skipping system file transport initialization in serverless environment');\n        systemFileTransportInitialized = true;\n        return;\n    }\n    if (systemFileTransportInitialized) {\n        // console.log('[LOGGER] System file transport already initialized, skipping...');\n        return;\n    }\n    const isTestMode = \"development\" === 'test';\n    const systemLogsDir = isTestMode ? path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), 'tmp', 'system-test-logs') : path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), 'logs', 'system');\n    // Ensure directory exists - but only in non-serverless environments\n    try {\n        if (!fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(systemLogsDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_3___default().mkdirSync(systemLogsDir, {\n                recursive: true\n            });\n        // console.log(`Created system log directory: ${systemLogsDir}`);\n        }\n    } catch (error) {\n        // console.warn(`[LOGGER] Could not create system log directory: ${error}. Continuing without file logging.`);\n        systemFileTransportInitialized = true;\n        return;\n    }\n    // Add file transport to the logger\n    systemLogger.add(new winston__WEBPACK_IMPORTED_MODULE_0__.transports.DailyRotateFile({\n        level: process.env.LOG_LEVEL || 'debug',\n        dirname: systemLogsDir,\n        filename: 'system-%DATE%.log',\n        datePattern: 'YYYY-MM-DD',\n        maxSize: '20m',\n        maxFiles: '14d',\n        format: fileFormat\n    }));\n    systemFileTransportInitialized = true;\n    systemLogger.info(`System file transport initialized in ${isTestMode ? 'TEST' : 'NORMAL'} mode`);\n    systemLogger.info(`System file transport initialized with logs at: ${systemLogsDir}`);\n};\n// Allow processes to explicitly check if the file transport is initialized\nfunction isSystemFileTransportInitialized() {\n    return systemFileTransportInitialized;\n}\nconst chatLogger = logger.child({\n    module: 'chat'\n});\nconst origChatInfo = chatLogger.info.bind(chatLogger);\nconst origChatError = chatLogger.error.bind(chatLogger);\nchatLogger.error = (messageOrInfo, ...args)=>{\n    let msg;\n    let meta = {};\n    if (typeof messageOrInfo === 'string') {\n        msg = messageOrInfo;\n        if (args.length > 0 && typeof args[0] === 'object' && args[0] !== null) {\n            meta = args[0];\n        } else if (args.length > 0) {\n            meta = {\n                splat: args\n            };\n        }\n    } else {\n        const infoObj = messageOrInfo;\n        msg = infoObj.message || '';\n        const { message: _msg, level: _lvl, timestamp: _ts, ...restInfo } = infoObj;\n        meta = restInfo;\n    }\n    const messageId = meta?.messageId || 'unknown-message';\n    const fullMessage = `[CHAT:ERROR][MSG:${messageId}] ${msg}`;\n    const { messageId: _mId, ...metaForOrigCall } = meta;\n    const finalMetaForOrigCall = {\n        ...metaForOrigCall,\n        taskId: messageId,\n        chat: true\n    };\n    origChatError(fullMessage, finalMetaForOrigCall);\n    return chatLogger;\n};\nchatLogger.info = (messageOrInfo, ...args)=>{\n    let msg;\n    let meta = {};\n    if (typeof messageOrInfo === 'string') {\n        msg = messageOrInfo;\n        if (args.length > 0 && typeof args[0] === 'object' && args[0] !== null) {\n            meta = args[0];\n        } else if (args.length > 0) {\n            meta = {\n                splat: args\n            };\n        }\n    } else {\n        const infoObj = messageOrInfo;\n        msg = infoObj.message || '';\n        const { message: _msg, level: _lvl, timestamp: _ts, ...restInfo } = infoObj;\n        meta = restInfo;\n    }\n    const messageId = meta?.messageId || 'unknown-message';\n    const fullMessage = `[CHAT:INFO][MSG:${messageId}] ${msg}`;\n    const { messageId: _mId, ...metaForOrigCall } = meta;\n    const finalMetaForOrigCall = {\n        ...metaForOrigCall,\n        taskId: messageId,\n        chat: true\n    };\n    origChatInfo(fullMessage, finalMetaForOrigCall);\n    return chatLogger;\n};\nconst buildLogger = logger.child({\n    module: 'build'\n});\nconst origBuildInfo = buildLogger.info.bind(buildLogger);\nconst origBuildError = buildLogger.error.bind(buildLogger);\nbuildLogger.error = (messageOrInfo, ...args)=>{\n    let msg;\n    let meta = {};\n    if (typeof messageOrInfo === 'string') {\n        msg = messageOrInfo;\n        if (args.length > 0 && typeof args[0] === 'object' && args[0] !== null) {\n            meta = args[0];\n        } else if (args.length > 0) {\n            meta = {\n                splat: args\n            };\n        }\n    } else {\n        const infoObj = messageOrInfo;\n        msg = infoObj.message || '';\n        const { message: _msg, level: _lvl, timestamp: _ts, ...restInfo } = infoObj;\n        meta = restInfo;\n    }\n    const jobId = meta?.jobId || 'unknown-job';\n    const fullMessage = `[BUILD:ERROR][JOB:${jobId}] ${msg}`;\n    const { jobId: _jId, ...metaForOrigCall } = meta;\n    const finalMetaForOrigCall = {\n        ...metaForOrigCall,\n        taskId: jobId,\n        build: true\n    };\n    origBuildError(fullMessage, finalMetaForOrigCall);\n    return buildLogger;\n};\nbuildLogger.info = (messageOrInfo, ...args)=>{\n    let msg;\n    let meta = {};\n    if (typeof messageOrInfo === 'string') {\n        msg = messageOrInfo;\n        if (args.length > 0 && typeof args[0] === 'object' && args[0] !== null) {\n            meta = args[0];\n        } else if (args.length > 0) {\n            meta = {\n                splat: args\n            };\n        }\n    } else {\n        const infoObj = messageOrInfo;\n        msg = infoObj.message || '';\n        const { message: _msg, level: _lvl, timestamp: _ts, ...restInfo } = infoObj;\n        meta = restInfo;\n    }\n    const jobId = meta?.jobId || 'unknown-job';\n    const fullMessage = `[BUILD:INFO][JOB:${jobId}] ${msg}`;\n    const { jobId: _jId, ...metaForOrigCall } = meta;\n    const finalMetaForOrigCall = {\n        ...metaForOrigCall,\n        taskId: jobId,\n        build: true\n    };\n    origBuildInfo(fullMessage, finalMetaForOrigCall);\n    return buildLogger;\n};\n// Add buildLogger.start method\nbuildLogger.start = (jobId, message, meta = {})=>{\n    const fullMessage = `[BUILD:START][JOB:${jobId}] ${message}`;\n    const finalMetaForOrigCall = {\n        ...meta,\n        taskId: jobId,\n        build: true\n    };\n    origBuildInfo(fullMessage, finalMetaForOrigCall);\n    return buildLogger;\n};\n// Add buildLogger.compile method\nbuildLogger.compile = (jobId, message, meta = {})=>{\n    const fullMessage = `[BUILD:COMPILE][JOB:${jobId}] ${message}`;\n    const finalMetaForOrigCall = {\n        ...meta,\n        taskId: jobId,\n        build: true\n    };\n    origBuildInfo(fullMessage, finalMetaForOrigCall);\n    return buildLogger;\n};\n// Add buildLogger.upload method\nbuildLogger.upload = (jobId, message, meta = {})=>{\n    const fullMessage = `[BUILD:UPLOAD][JOB:${jobId}] ${message}`;\n    const finalMetaForOrigCall = {\n        ...meta,\n        taskId: jobId,\n        build: true\n    };\n    origBuildInfo(fullMessage, finalMetaForOrigCall);\n    return buildLogger;\n};\n// Add buildLogger.complete method\nbuildLogger.complete = (jobId, message, meta = {})=>{\n    const fullMessage = `[BUILD:COMPLETE][JOB:${jobId}] ${message}`;\n    const finalMetaForOrigCall = {\n        ...meta,\n        taskId: jobId,\n        build: true\n    };\n    origBuildInfo(fullMessage, finalMetaForOrigCall);\n    return buildLogger;\n};\nconst scenePlannerLogger = logger.child({\n    module: 'scenePlanner'\n});\nconst origScenePlannerInfo = scenePlannerLogger.info.bind(scenePlannerLogger);\nconst origScenePlannerError = scenePlannerLogger.error.bind(scenePlannerLogger);\nscenePlannerLogger.error = (messageOrInfo, ...args)=>{\n    let msg;\n    let meta = {};\n    if (typeof messageOrInfo === 'string') {\n        msg = messageOrInfo;\n        if (args.length > 0 && typeof args[0] === 'object' && args[0] !== null) {\n            meta = args[0];\n        } else if (args.length > 0) {\n            meta = {\n                splat: args\n            };\n        }\n    } else {\n        const infoObj = messageOrInfo;\n        msg = infoObj.message || '';\n        const { message: _msg, level: _lvl, timestamp: _ts, ...restInfo } = infoObj;\n        meta = restInfo;\n    }\n    const planId = meta?.planId || 'unknown-plan';\n    const fullMessage = `[PIPELINE:ERROR][PLAN:${planId}] ${msg}`;\n    const { planId: _pId, ...metaForOrigCall } = meta;\n    const finalMetaForOrigCall = {\n        ...metaForOrigCall,\n        taskId: planId,\n        scenePlanner: true\n    };\n    origScenePlannerError(fullMessage, finalMetaForOrigCall);\n    return scenePlannerLogger;\n};\nscenePlannerLogger.info = (messageOrInfo, ...args)=>{\n    let msg;\n    let meta = {};\n    if (typeof messageOrInfo === 'string') {\n        msg = messageOrInfo;\n        if (args.length > 0 && typeof args[0] === 'object' && args[0] !== null) {\n            meta = args[0];\n        } else if (args.length > 0) {\n            meta = {\n                splat: args\n            };\n        }\n    } else {\n        const infoObj = messageOrInfo;\n        msg = infoObj.message || '';\n        const { message: _msg, level: _lvl, timestamp: _ts, ...restInfo } = infoObj;\n        meta = restInfo;\n    }\n    const planId = meta?.planId || 'unknown-plan';\n    const fullMessage = `[PIPELINE:INFO][PLAN:${planId}] ${msg}`;\n    const { planId: _pId, ...metaForOrigCall } = meta;\n    const finalMetaForOrigCall = {\n        ...metaForOrigCall,\n        taskId: planId,\n        scenePlanner: true\n    };\n    origScenePlannerInfo(fullMessage, finalMetaForOrigCall);\n    return scenePlannerLogger;\n};\n// Create general system logger as a child logger\nconst systemLogger = logger.child({\n    module: 'system'\n});\n// Configure console transport level specifically\n// console.log(`[DEBUG_LOGGER] Configuring system logger console level. LOGGING_MODE: ${process.env.LOGGING_MODE}`);\nconst systemConsoleTransport = systemLogger.transports.find((t)=>t instanceof winston__WEBPACK_IMPORTED_MODULE_0__.transports.Console);\nif (systemConsoleTransport) {\n    systemConsoleTransport.level = process.env.LOG_LEVEL || 'info';\n// console.log(`[DEBUG_LOGGER] System logger console level set to: ${systemConsoleTransport.level}`);\n} else {\n// console.log('[DEBUG_LOGGER] Could not find system logger console transport to configure!');\n}\n// Other child loggers\nconst authLogger = logger.child({\n    module: 'auth'\n});\nconst pageLogger = logger.child({\n    module: 'page'\n});\nconst apiLogger = logger.child({\n    module: 'api'\n});\nconst cronLogger = logger.child({\n    module: 'cron'\n});\nconst workerLogger = logger.child({\n    module: 'worker'\n});\nconst dbLogger = logger.child({\n    module: 'db'\n});\nconst toolsLogger = logger.child({\n    module: 'tools'\n});\nconst agentLogger = logger.child({\n    module: 'agent'\n});\nconst modelsLogger = logger.child({\n    module: 'models'\n});\nconst componentLogger = logger.child({\n    module: 'component'\n});\nconst animationDesignerLogger = logger.child({\n    module: 'animationDesigner'\n});\n// System Logger standalone functions\nconst origSystemDebug = systemLogger.debug.bind(systemLogger);\nconst origSystemInfo = systemLogger.info.bind(systemLogger);\nconst logSystemProcess = (loggerInstance, processId, message, meta = {})=>{\n    const normalizedProcessId = processId || 'unknown-process';\n    loggerInstance.info(`[SYSTEM:PROCESS][ID:${normalizedProcessId}] ${message}`, {\n        ...meta,\n        processId: normalizedProcessId,\n        system: true\n    });\n};\nconst logSystemEvent = (loggerInstance, eventType, eventData, meta = {})=>{\n    loggerInstance.debug(`[SYSTEM:EVENT] ${eventType}`, {\n        ...meta,\n        eventType,\n        eventPayload: eventData,\n        system: true\n    });\n};\n// Initialize ChatLogger specific methods\nconst logChatStream = (loggerInstance, messageId, message, meta = {})=>{\n    const normalizedMessageId = messageId || 'unknown-message';\n    loggerInstance.debug(`[CHAT:STREAM][MSG:${normalizedMessageId}] ${message}`, {\n        ...meta,\n        taskId: normalizedMessageId,\n        chat: true\n    });\n};\nconst logChatTool = (loggerInstance, messageId, toolName, message, meta = {})=>{\n    const normalizedMessageId = messageId || 'unknown-message';\n    loggerInstance.debug(`[CHAT:TOOL:${toolName}][MSG:${normalizedMessageId}] ${message}`, {\n        ...meta,\n        taskId: normalizedMessageId,\n        chat: true,\n        tool: toolName\n    });\n};\nconst logChatComplete = (loggerInstance, messageId, message, meta = {})=>{\n    const normalizedMessageId = messageId || 'unknown-message';\n    loggerInstance.info(`[CHAT:COMPLETE][MSG:${normalizedMessageId}] ${message}`, {\n        ...meta,\n        taskId: normalizedMessageId,\n        chat: true\n    });\n};\n// Initialize BuildLogger specific methods\nconst logBuildStart = (loggerInstance, jobId, message, meta = {})=>{\n    const normalizedJobId = jobId || 'unknown-job';\n    loggerInstance.info(`[BUILD:START][JOB:${normalizedJobId}] ${message}`, {\n        ...meta,\n        taskId: normalizedJobId,\n        build: true\n    });\n};\nconst logBuildCompile = (loggerInstance, jobId, message, meta = {})=>{\n    const normalizedJobId = jobId || 'unknown-job';\n    loggerInstance.debug(`[BUILD:COMPILE][JOB:${normalizedJobId}] ${message}`, {\n        ...meta,\n        taskId: normalizedJobId,\n        build: true\n    });\n};\nconst logBuildUpload = (loggerInstance, jobId, message, meta = {})=>{\n    const normalizedJobId = jobId || 'unknown-job';\n    loggerInstance.debug(`[BUILD:UPLOAD][JOB:${normalizedJobId}] ${message}`, {\n        ...meta,\n        taskId: normalizedJobId,\n        build: true\n    });\n};\nconst logBuildWarn = (loggerInstance, jobId, message, meta = {})=>{\n    const normalizedJobId = jobId || 'unknown-job';\n    loggerInstance.warn(`[BUILD:WARN][JOB:${normalizedJobId}] ${message}`, {\n        ...meta,\n        taskId: normalizedJobId,\n        build: true\n    });\n};\nconst logBuildComplete = (loggerInstance, jobId, message, meta = {})=>{\n    const normalizedJobId = jobId || 'unknown-job';\n    loggerInstance.info(`[BUILD:COMPLETE][JOB:${normalizedJobId}] ${message}`, {\n        ...meta,\n        taskId: normalizedJobId,\n        build: true\n    });\n};\nconst logBuildDebug = (loggerInstance, jobId, message, meta = {})=>{\n    const normalizedJobId = jobId || 'unknown-job';\n    loggerInstance.debug(`[BUILD:DEBUG][JOB:${normalizedJobId}] ${message}`, {\n        ...meta,\n        taskId: normalizedJobId,\n        build: true\n    });\n};\n// Initialize ScenePlannerLogger specific methods\nconst logScenePlannerDb = (loggerInstance, planId, message, meta = {})=>{\n    const normalizedPlanId = planId || 'unknown-plan';\n    loggerInstance.debug(`[PIPELINE:DB][PLAN:${normalizedPlanId}] ${message}`, {\n        ...meta,\n        taskId: normalizedPlanId,\n        scenePlanner: true\n    });\n};\nconst logScenePlannerAdb = (loggerInstance, planId, sceneId, message, meta = {})=>{\n    const normalizedPlanId = planId || 'unknown-plan';\n    const normalizedSceneId = sceneId || 'unknown-scene';\n    loggerInstance.debug(`[PIPELINE:ADB][PLAN:${normalizedPlanId}][SCENE:${normalizedSceneId}] ${message}`, {\n        ...meta,\n        taskId: normalizedPlanId,\n        sceneId: normalizedSceneId,\n        scenePlanner: true\n    });\n};\nconst logScenePlannerComponent = (loggerInstance, planId, sceneId, message, meta = {})=>{\n    const normalizedPlanId = planId || 'unknown-plan';\n    const normalizedSceneId = sceneId || 'unknown-scene';\n    loggerInstance.debug(`[PIPELINE:COMPONENT][PLAN:${normalizedPlanId}][SCENE:${normalizedSceneId}] ${message}`, {\n        ...meta,\n        taskId: normalizedPlanId,\n        sceneId: normalizedSceneId,\n        scenePlanner: true\n    });\n};\nconst logScenePlannerComplete = (loggerInstance, planId, message, meta = {})=>{\n    const normalizedPlanId = planId || 'unknown-plan';\n    loggerInstance.info(`[PIPELINE:COMPLETE][PLAN:${normalizedPlanId}] ${message}`, {\n        ...meta,\n        taskId: normalizedPlanId,\n        scenePlanner: true\n    });\n};\nconst logScenePlannerDebug = (loggerInstance, planId, message, meta = {})=>{\n    const normalizedPlanId = planId || 'unknown-plan';\n    loggerInstance.debug(`[PIPELINE:DEBUG][PLAN:${normalizedPlanId}] ${message}`, {\n        ...meta,\n        taskId: normalizedPlanId,\n        scenePlanner: true\n    });\n};\n// Fallback logger - if a specific logger doesn't have a method, it will use the base logger's methods\n// However, this might not be desired if we want strict method availability per logger.\n\n// Make `logger` the default export\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (logger);\n/**\n * Agent Send Logging - Standalone function to handle agent send logging\n */ function logAgentSend(loggerInstance, agentName, taskId, recipient, messageType, meta) {\n    const formattedMessage = `AGENT[${agentName}] -> ${recipient}: ${messageType}`;\n    return loggerInstance.info(formattedMessage, {\n        ...meta,\n        agent: agentName,\n        taskId,\n        recipient,\n        messageType,\n        action: 'agent_send'\n    });\n}\n/**\n * Agent Process Logging - Standalone function to handle agent process logging\n */ function logAgentProcess(loggerInstance, agentName, taskId, processName, message, meta) {\n    const formattedMessage = `AGENT[${agentName}] PROCESS[${processName}]: ${message}`;\n    return loggerInstance.info(formattedMessage, {\n        ...meta,\n        agent: agentName,\n        taskId,\n        processName,\n        action: 'agent_process'\n    });\n}\n/**\n * Animation Designer Start Logging - Standalone function for tracking animation generation starts\n */ function logAnimationStart(loggerInstance, sceneId, message, meta) {\n    const formattedMessage = `[ANIMATION:START][SCENE:${sceneId}] ${message}`;\n    return loggerInstance.info(formattedMessage, {\n        ...meta,\n        sceneId,\n        animation: true,\n        stage: 'start'\n    });\n}\n/**\n * Animation Designer Validation Logging - Standalone function for animation validation logs\n */ function logAnimationValidation(loggerInstance, sceneId, message, meta) {\n    const formattedMessage = `[ANIMATION:VALIDATION][SCENE:${sceneId}] ${message}`;\n    return loggerInstance.info(formattedMessage, {\n        ...meta,\n        sceneId,\n        animation: true,\n        stage: 'validation'\n    });\n}\n/**\n * Animation Designer Complete Logging - Standalone function for marking completion of animation tasks\n */ function logAnimationComplete(loggerInstance, sceneId, message, meta) {\n    const formattedMessage = `[ANIMATION:COMPLETE][SCENE:${sceneId}] ${message}`;\n    return loggerInstance.info(formattedMessage, {\n        ...meta,\n        sceneId,\n        animation: true,\n        stage: 'complete'\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUUsRUFBRXJJLFNBQVM7SUFDekUsT0FBTzZHLGVBQWUxRCxJQUFJLENBQUMyRixrQkFBa0I7UUFDM0MsR0FBRzdJLElBQUk7UUFDUG9JO1FBQ0FlLFdBQVc7UUFDWEMsT0FBTztJQUNUO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLFNBQVNDLHVCQUNkekMsY0FBc0IsRUFDdEJ3QixPQUFlLEVBQ2ZySSxPQUFlLEVBQ2ZDLElBQTBCO0lBRTFCLE1BQU02SSxtQkFBbUIsQ0FBQyw2QkFBNkIsRUFBRVQsUUFBUSxFQUFFLEVBQUVySSxTQUFTO0lBQzlFLE9BQU82RyxlQUFlMUQsSUFBSSxDQUFDMkYsa0JBQWtCO1FBQzNDLEdBQUc3SSxJQUFJO1FBQ1BvSTtRQUNBZSxXQUFXO1FBQ1hDLE9BQU87SUFDVDtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTRSxxQkFDZDFDLGNBQXNCLEVBQ3RCd0IsT0FBZSxFQUNmckksT0FBZSxFQUNmQyxJQUEwQjtJQUUxQixNQUFNNkksbUJBQW1CLENBQUMsMkJBQTJCLEVBQUVULFFBQVEsRUFBRSxFQUFFckksU0FBUztJQUM1RSxPQUFPNkcsZUFBZTFELElBQUksQ0FBQzJGLGtCQUFrQjtRQUMzQyxHQUFHN0ksSUFBSTtRQUNQb0k7UUFDQWUsV0FBVztRQUNYQyxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2xpYi91dGlscy9sb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2xpYi9sb2dnZXIudHNcbmltcG9ydCB7IGNyZWF0ZUxvZ2dlciwgZm9ybWF0LCB0cmFuc3BvcnRzLCB0eXBlIExvZ2dlciB9IGZyb20gJ3dpbnN0b24nO1xuaW1wb3J0ICd3aW5zdG9uLWRhaWx5LXJvdGF0ZS1maWxlJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IGVudiB9IGZyb20gJ34vZW52JztcblxuLy8gRml4IGZvciBmdW5jdGlvbiBwYXJhbWV0ZXJzIHRoYXQgYWxsb3cgbnVsbCB0YXNrSWRcbnR5cGUgU3RyaW5nT3JOdWxsID0gc3RyaW5nIHwgbnVsbDtcblxuLy8gRXh0ZW5kIHRoZSBXaW5zdG9uIExvZ2dlciB0eXBlIHdpdGggY3VzdG9tIEEyQSBtZXRob2RzXG5kZWNsYXJlIG1vZHVsZSAnd2luc3Rvbicge1xuICBpbnRlcmZhY2UgTG9nZ2VyIHtcbiAgICAvLyBBZGQgYnVpbGRMb2dnZXIgbWV0aG9kIHNpZ25hdHVyZXNcbiAgICBzdGFydChqb2JJZDogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogTG9nZ2VyO1xuICAgIGNvbXBpbGUoam9iSWQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IExvZ2dlcjtcbiAgICB1cGxvYWQoam9iSWQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IExvZ2dlcjtcbiAgICBjb21wbGV0ZShqb2JJZDogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogTG9nZ2VyO1xuICB9XG59XG5cbi8vIENoZWNrIGlmIHdlJ3JlIHJ1bm5pbmcgb24gdGhlIHNlcnZlciBvciBpbiB0aGUgYnJvd3NlclxuY29uc3QgaXNTZXJ2ZXIgPSB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJztcblxuLy8gQ2hlY2sgaWYgd2UncmUgaW4gYSBwcm9kdWN0aW9uIHNlcnZlcmxlc3MgZW52aXJvbm1lbnRcbmNvbnN0IGlzU2VydmVybGVzc1Byb2R1Y3Rpb24gPSBwcm9jZXNzLmVudi5WRVJDRUwgfHwgcHJvY2Vzcy5lbnYuQVdTX0xBTUJEQV9GVU5DVElPTl9OQU1FIHx8IHByb2Nlc3MuZW52Lk5FVExJRlk7XG5cbi8vIENyZWF0ZSBmb3JtYXR0ZXJzXG5jb25zdCBjb25zb2xlRm9ybWF0ID0gZm9ybWF0LmNvbWJpbmUoXG4gIGZvcm1hdC5jb2xvcml6ZSgpLFxuICBmb3JtYXQudGltZXN0YW1wKCksXG4gIGZvcm1hdC5wcmludGYoKHsgdGltZXN0YW1wLCBsZXZlbCwgbWVzc2FnZSwgLi4ubWV0YSB9KSA9PiB7XG4gICAgY29uc3QgbWV0YVN0ciA9IE9iamVjdC5rZXlzKG1ldGEpLmxlbmd0aCA/IEpTT04uc3RyaW5naWZ5KG1ldGEsIG51bGwsIDIpIDogJyc7XG4gICAgcmV0dXJuIGAke3RpbWVzdGFtcH0gWyR7bGV2ZWx9XTogJHttZXNzYWdlfSAke21ldGFTdHJ9YDtcbiAgfSlcbik7XG5cbmNvbnN0IGZpbGVGb3JtYXQgPSBmb3JtYXQuY29tYmluZShcbiAgZm9ybWF0LnRpbWVzdGFtcCgpLFxuICBmb3JtYXQuanNvbigpXG4pO1xuXG4vLyBUcmFjayBpZiBzeXN0ZW0gZmlsZSB0cmFuc3BvcnQgaGFzIGJlZW4gaW5pdGlhbGl6ZWQgdG8gcHJldmVudCBkdXBsaWNhdGVzXG5sZXQgc3lzdGVtRmlsZVRyYW5zcG9ydEluaXRpYWxpemVkID0gZmFsc2U7XG5cbi8vIENyZWF0ZSBlaXRoZXIgYSBzZXJ2ZXIgbG9nZ2VyIG9yIGEgY29uc29sZSBsb2dnZXJcbmxldCBsb2dnZXI6IExvZ2dlcjtcblxuLy8gU2FmZSBkaXJlY3RvcnkgY3JlYXRpb24gZnVuY3Rpb25cbmNvbnN0IHNhZmVDcmVhdGVEaXIgPSAoZGlyOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgaWYgKGlzU2VydmVybGVzc1Byb2R1Y3Rpb24pIHtcbiAgICAvLyBjb25zb2xlLmxvZyhgW0xPR0dFUl0gU2tpcHBpbmcgZGlyZWN0b3J5IGNyZWF0aW9uIGluIHNlcnZlcmxlc3MgZW52aXJvbm1lbnQ6ICR7ZGlyfWApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgdHJ5IHtcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgZnMubWtkaXJTeW5jKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhgQ3JlYXRlZCBsb2cgZGlyZWN0b3J5OiAke2Rpcn1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgLy8gY29uc29sZS53YXJuKGBbTE9HR0VSXSBDb3VsZCBub3QgY3JlYXRlIGRpcmVjdG9yeSAke2Rpcn06ICR7ZXJyb3J9LiBDb250aW51aW5nIHdpdGhvdXQgZmlsZSBsb2dnaW5nLmApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuLy8gSW5pdGlhbGl6ZSBib3RoIHNlcnZlci1zaWRlIGFuZCBjbGllbnQtc2lkZSBsb2dnZXJzXG5pZiAoaXNTZXJ2ZXIpIHtcbiAgLy8gR2V0IGxvZyBkaXJlY3RvcmllcyBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlcyBvciB1c2UgZGVmYXVsdHNcbiAgY29uc3QgbG9nc0RpciA9IHByb2Nlc3MuZW52LkxPR19ESVIgfHwgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdsb2dzJyk7XG4gIGNvbnN0IGVycm9yTG9nc0RpciA9IHByb2Nlc3MuZW52LkVSUk9SX0xPR19ESVIgfHwgbG9nc0RpcjtcbiAgY29uc3QgY29tYmluZWRMb2dzRGlyID0gcHJvY2Vzcy5lbnYuQ09NQklORURfTE9HX0RJUiB8fCBsb2dzRGlyO1xuICBjb25zdCBjb21wb25lbnRzTG9nc0RpciA9IHByb2Nlc3MuZW52LkNPTVBPTkVOVFNfTE9HX0RJUiB8fCBsb2dzRGlyO1xuXG4gIC8vIExvZyB0aGUgZGlyZWN0b3JpZXMgYmVpbmcgdXNlZFxuICAvLyBjb25zb2xlLmxvZyhgTG9nZ2VyIGluaXRpYWxpemF0aW9uIHdpdGg6IExPR19ESVI9JHtsb2dzRGlyfSwgRVJST1JfRElSPSR7ZXJyb3JMb2dzRGlyfWApO1xuXG4gIC8vIENyZWF0ZSBiYXNlIHRyYW5zcG9ydHMgKGFsd2F5cyBpbmNsdWRlIGNvbnNvbGUpXG4gIGNvbnN0IGJhc2VUcmFuc3BvcnRzOiBhbnlbXSA9IFtcbiAgICBuZXcgdHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgIGZvcm1hdDogY29uc29sZUZvcm1hdCxcbiAgICAgIGxldmVsOiBwcm9jZXNzLmVudi5MT0dfTEVWRUwgfHwgJ2luZm8nXG4gICAgfSlcbiAgXTtcblxuICAvLyBPbmx5IGFkZCBmaWxlIHRyYW5zcG9ydHMgaWYgd2UgY2FuIGNyZWF0ZSBkaXJlY3Rvcmllc1xuICBpZiAoIWlzU2VydmVybGVzc1Byb2R1Y3Rpb24pIHtcbiAgICAvLyBFbnN1cmUgbG9ncyBkaXJlY3RvcmllcyBleGlzdFxuICAgIGNvbnN0IGRpcnNDcmVhdGVkID0gW2xvZ3NEaXIsIGVycm9yTG9nc0RpciwgY29tYmluZWRMb2dzRGlyLCBjb21wb25lbnRzTG9nc0Rpcl0ubWFwKHNhZmVDcmVhdGVEaXIpO1xuICAgIFxuICAgIC8vIE9ubHkgYWRkIGZpbGUgdHJhbnNwb3J0cyBpZiBkaXJlY3RvcmllcyB3ZXJlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAgaWYgKGRpcnNDcmVhdGVkLnNvbWUoY3JlYXRlZCA9PiBjcmVhdGVkKSkge1xuICAgICAgaWYgKHNhZmVDcmVhdGVEaXIobG9nc0RpcikpIHtcbiAgICAgICAgYmFzZVRyYW5zcG9ydHMucHVzaChcbiAgICAgICAgICBuZXcgdHJhbnNwb3J0cy5EYWlseVJvdGF0ZUZpbGUoe1xuICAgICAgICAgICAgZGlybmFtZTogbG9nc0RpcixcbiAgICAgICAgICAgIGZpbGVuYW1lOiAnY29tcG9uZW50cy0lREFURSUubG9nJyxcbiAgICAgICAgICAgIGRhdGVQYXR0ZXJuOiAnWVlZWS1NTS1ERCcsXG4gICAgICAgICAgICBtYXhTaXplOiAnMjBtJyxcbiAgICAgICAgICAgIG1heEZpbGVzOiAnMTRkJyxcbiAgICAgICAgICAgIGZvcm1hdDogZmlsZUZvcm1hdFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChzYWZlQ3JlYXRlRGlyKGVycm9yTG9nc0RpcikpIHtcbiAgICAgICAgYmFzZVRyYW5zcG9ydHMucHVzaChcbiAgICAgICAgICBuZXcgdHJhbnNwb3J0cy5EYWlseVJvdGF0ZUZpbGUoe1xuICAgICAgICAgICAgZGlybmFtZTogZXJyb3JMb2dzRGlyLFxuICAgICAgICAgICAgZmlsZW5hbWU6ICdlcnJvci0lREFURSUubG9nJyxcbiAgICAgICAgICAgIGRhdGVQYXR0ZXJuOiAnWVlZWS1NTS1ERCcsXG4gICAgICAgICAgICBtYXhTaXplOiAnMjBtJyxcbiAgICAgICAgICAgIG1heEZpbGVzOiAnMTRkJyxcbiAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxuICAgICAgICAgICAgZm9ybWF0OiBmaWxlRm9ybWF0XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHNhZmVDcmVhdGVEaXIoY29tYmluZWRMb2dzRGlyKSkge1xuICAgICAgICBiYXNlVHJhbnNwb3J0cy5wdXNoKFxuICAgICAgICAgIG5ldyB0cmFuc3BvcnRzLkRhaWx5Um90YXRlRmlsZSh7XG4gICAgICAgICAgICBkaXJuYW1lOiBjb21iaW5lZExvZ3NEaXIsXG4gICAgICAgICAgICBmaWxlbmFtZTogJ2NvbWJpbmVkLSVEQVRFJS5sb2cnLFxuICAgICAgICAgICAgZGF0ZVBhdHRlcm46ICdZWVlZLU1NLUREJyxcbiAgICAgICAgICAgIG1heFNpemU6ICcyMG0nLFxuICAgICAgICAgICAgbWF4RmlsZXM6ICcxNGQnLFxuICAgICAgICAgICAgZm9ybWF0OiBmaWxlRm9ybWF0XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDcmVhdGUgdGhlIG1haW4gbG9nZ2VyIHdpdGggc2FmZSB0cmFuc3BvcnRzXG4gIGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcih7XG4gICAgbGV2ZWw6ICdkZWJ1ZycsXG4gICAgZm9ybWF0OiBmaWxlRm9ybWF0LFxuICAgIGRlZmF1bHRNZXRhOiB7fSxcbiAgICB0cmFuc3BvcnRzOiBiYXNlVHJhbnNwb3J0c1xuICB9KTtcblxuICAvLyBTZXQgdXAgY29tcG9uZW50cyBsb2dnZXIgd2l0aCBzYWZlIHRyYW5zcG9ydHNcbiAgY29uc3QgY29tcG9uZW50c1RyYW5zcG9ydHM6IGFueVtdID0gW1xuICAgIG5ldyB0cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgICAgZm9ybWF0OiBjb25zb2xlRm9ybWF0LFxuICAgICAgbGV2ZWw6IHByb2Nlc3MuZW52LkxPR19MRVZFTCB8fCAnaW5mbydcbiAgICB9KVxuICBdO1xuXG4gIGlmICghaXNTZXJ2ZXJsZXNzUHJvZHVjdGlvbiAmJiBzYWZlQ3JlYXRlRGlyKGNvbXBvbmVudHNMb2dzRGlyKSkge1xuICAgIGNvbXBvbmVudHNUcmFuc3BvcnRzLnB1c2goXG4gICAgICBuZXcgdHJhbnNwb3J0cy5EYWlseVJvdGF0ZUZpbGUoe1xuICAgICAgICBkaXJuYW1lOiBjb21wb25lbnRzTG9nc0RpcixcbiAgICAgICAgZmlsZW5hbWU6ICdjb21wb25lbnRzLSVEQVRFJS5sb2cnLFxuICAgICAgICBkYXRlUGF0dGVybjogJ1lZWVktTU0tREQnLFxuICAgICAgICBtYXhTaXplOiAnMjBtJyxcbiAgICAgICAgbWF4RmlsZXM6ICcxNGQnLFxuICAgICAgICBmb3JtYXQ6IGZpbGVGb3JtYXRcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0IGNvbXBvbmVudHNMb2dnZXIgPSBjcmVhdGVMb2dnZXIoe1xuICAgIGxldmVsOiAnZGVidWcnLFxuICAgIGZvcm1hdDogZmlsZUZvcm1hdCxcbiAgICBkZWZhdWx0TWV0YToge30sXG4gICAgdHJhbnNwb3J0czogY29tcG9uZW50c1RyYW5zcG9ydHNcbiAgfSk7XG5cbiAgLy8gTG9nIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYWZmZWN0aW5nIGxvZ2dlciBjb25zb2xlIGxldmVsXG4gIC8vIGNvbnNvbGUubG9nKGBbREVCVUdfTE9HR0VSXSBMT0dHSU5HX01PREU6ICR7cHJvY2Vzcy5lbnYuTE9HR0lOR19NT0RFfSwgTE9HX0xFVkVMOiAke3Byb2Nlc3MuZW52LkxPR19MRVZFTH1gKVxuICBcbiAgLy8gY29uc29sZS5sb2coYExvZ2dlciBpbml0aWFsaXplZCB3aXRoIGxvZyBkaXJlY3RvcmllczogbWFpbj0ke2xvZ3NEaXJ9LCBlcnJvcj0ke2Vycm9yTG9nc0Rpcn0sIGNvbWJpbmVkPSR7Y29tYmluZWRMb2dzRGlyfWApO1xuXG59IGVsc2Uge1xuICAvLyBTaW1wbGUgY29uc29sZSBsb2dnZXIgZm9yIGNsaWVudC1zaWRlXG4gIGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcih7XG4gICAgbGV2ZWw6ICdpbmZvJyxcbiAgICBmb3JtYXQ6IGZpbGVGb3JtYXQsXG4gICAgdHJhbnNwb3J0czogW1xuICAgICAgbmV3IHRyYW5zcG9ydHMuQ29uc29sZSh7XG4gICAgICAgIGZvcm1hdDogY29uc29sZUZvcm1hdCxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIC8vIENyZWF0ZSBhIHNlcGFyYXRlIHN5c3RlbSBsb2dnZXJcbiAgY29uc3Qgc3lzdGVtTG9nZ2VyID0gY3JlYXRlTG9nZ2VyKHtcbiAgICBsZXZlbDogJ2luZm8nLFxuICAgIGZvcm1hdDogZmlsZUZvcm1hdCxcbiAgICBkZWZhdWx0TWV0YTogeyBzeXN0ZW06IHRydWUgfSxcbiAgICB0cmFuc3BvcnRzOiBbXG4gICAgICBuZXcgdHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgICAgZm9ybWF0OiBjb25zb2xlRm9ybWF0LFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIGEgc2VwYXJhdGUgY29tcG9uZW50cyBsb2dnZXJcbiAgY29uc3QgY29tcG9uZW50c0xvZ2dlciA9IGNyZWF0ZUxvZ2dlcih7XG4gICAgbGV2ZWw6ICdpbmZvJyxcbiAgICBmb3JtYXQ6IGZpbGVGb3JtYXQsXG4gICAgZGVmYXVsdE1ldGE6IHt9LFxuICAgIHRyYW5zcG9ydHM6IFtcbiAgICAgIG5ldyB0cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgICAgICBmb3JtYXQ6IGNvbnNvbGVGb3JtYXQsXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcblxufVxuXG4vLyBGdW5jdGlvbiB0byBpbml0aWFsaXplIHN5c3RlbSBmaWxlIHRyYW5zcG9ydCBpZiByZXF1ZXN0ZWRcbmV4cG9ydCBjb25zdCBpbml0aWFsaXplU3lzdGVtRmlsZVRyYW5zcG9ydCA9ICgpOiB2b2lkID0+IHtcbiAgLy8gU2tpcCBmaWxlIHRyYW5zcG9ydCBpbml0aWFsaXphdGlvbiBpbiBzZXJ2ZXJsZXNzIHByb2R1Y3Rpb24gZW52aXJvbm1lbnRzXG4gIGlmIChpc1NlcnZlcmxlc3NQcm9kdWN0aW9uKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ1tMT0dHRVJdIFNraXBwaW5nIHN5c3RlbSBmaWxlIHRyYW5zcG9ydCBpbml0aWFsaXphdGlvbiBpbiBzZXJ2ZXJsZXNzIGVudmlyb25tZW50Jyk7XG4gICAgc3lzdGVtRmlsZVRyYW5zcG9ydEluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoc3lzdGVtRmlsZVRyYW5zcG9ydEluaXRpYWxpemVkKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ1tMT0dHRVJdIFN5c3RlbSBmaWxlIHRyYW5zcG9ydCBhbHJlYWR5IGluaXRpYWxpemVkLCBza2lwcGluZy4uLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlzVGVzdE1vZGUgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnO1xuICBjb25zdCBzeXN0ZW1Mb2dzRGlyID0gaXNUZXN0TW9kZSBcbiAgICA/IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wJywgJ3N5c3RlbS10ZXN0LWxvZ3MnKVxuICAgIDogcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdsb2dzJywgJ3N5c3RlbScpO1xuICBcbiAgLy8gRW5zdXJlIGRpcmVjdG9yeSBleGlzdHMgLSBidXQgb25seSBpbiBub24tc2VydmVybGVzcyBlbnZpcm9ubWVudHNcbiAgdHJ5IHtcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoc3lzdGVtTG9nc0RpcikpIHtcbiAgICAgIGZzLm1rZGlyU3luYyhzeXN0ZW1Mb2dzRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGBDcmVhdGVkIHN5c3RlbSBsb2cgZGlyZWN0b3J5OiAke3N5c3RlbUxvZ3NEaXJ9YCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIGNvbnNvbGUud2FybihgW0xPR0dFUl0gQ291bGQgbm90IGNyZWF0ZSBzeXN0ZW0gbG9nIGRpcmVjdG9yeTogJHtlcnJvcn0uIENvbnRpbnVpbmcgd2l0aG91dCBmaWxlIGxvZ2dpbmcuYCk7XG4gICAgc3lzdGVtRmlsZVRyYW5zcG9ydEluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICByZXR1cm47XG4gIH1cbiAgXG4gIC8vIEFkZCBmaWxlIHRyYW5zcG9ydCB0byB0aGUgbG9nZ2VyXG4gIHN5c3RlbUxvZ2dlci5hZGQoXG4gICAgbmV3IHRyYW5zcG9ydHMuRGFpbHlSb3RhdGVGaWxlKHtcbiAgICAgIGxldmVsOiBwcm9jZXNzLmVudi5MT0dfTEVWRUwgfHwgJ2RlYnVnJyxcbiAgICAgIGRpcm5hbWU6IHN5c3RlbUxvZ3NEaXIsXG4gICAgICBmaWxlbmFtZTogJ3N5c3RlbS0lREFURSUubG9nJyxcbiAgICAgIGRhdGVQYXR0ZXJuOiAnWVlZWS1NTS1ERCcsXG4gICAgICBtYXhTaXplOiAnMjBtJyxcbiAgICAgIG1heEZpbGVzOiAnMTRkJyxcbiAgICAgIGZvcm1hdDogZmlsZUZvcm1hdFxuICAgIH0pXG4gICk7XG4gIFxuICBzeXN0ZW1GaWxlVHJhbnNwb3J0SW5pdGlhbGl6ZWQgPSB0cnVlO1xuICBcbiAgc3lzdGVtTG9nZ2VyLmluZm8oYFN5c3RlbSBmaWxlIHRyYW5zcG9ydCBpbml0aWFsaXplZCBpbiAke2lzVGVzdE1vZGUgPyAnVEVTVCcgOiAnTk9STUFMJ30gbW9kZWApO1xuICBzeXN0ZW1Mb2dnZXIuaW5mbyhgU3lzdGVtIGZpbGUgdHJhbnNwb3J0IGluaXRpYWxpemVkIHdpdGggbG9ncyBhdDogJHtzeXN0ZW1Mb2dzRGlyfWApO1xufTtcblxuLy8gQWxsb3cgcHJvY2Vzc2VzIHRvIGV4cGxpY2l0bHkgY2hlY2sgaWYgdGhlIGZpbGUgdHJhbnNwb3J0IGlzIGluaXRpYWxpemVkXG5leHBvcnQgZnVuY3Rpb24gaXNTeXN0ZW1GaWxlVHJhbnNwb3J0SW5pdGlhbGl6ZWQoKTogYm9vbGVhbiB7XG4gIHJldHVybiBzeXN0ZW1GaWxlVHJhbnNwb3J0SW5pdGlhbGl6ZWQ7XG59XG5cbmNvbnN0IGNoYXRMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICdjaGF0JyB9KTtcbmNvbnN0IG9yaWdDaGF0SW5mbyA9IGNoYXRMb2dnZXIuaW5mby5iaW5kKGNoYXRMb2dnZXIpO1xuY29uc3Qgb3JpZ0NoYXRFcnJvciA9IGNoYXRMb2dnZXIuZXJyb3IuYmluZChjaGF0TG9nZ2VyKTtcblxuY2hhdExvZ2dlci5lcnJvciA9IChtZXNzYWdlT3JJbmZvOiBzdHJpbmcgfCBvYmplY3QsIC4uLmFyZ3M6IGFueVtdKTogTG9nZ2VyID0+IHtcbiAgbGV0IG1zZzogc3RyaW5nO1xuICBsZXQgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICBpZiAodHlwZW9mIG1lc3NhZ2VPckluZm8gPT09ICdzdHJpbmcnKSB7XG4gICAgbXNnID0gbWVzc2FnZU9ySW5mbztcbiAgICBpZiAoYXJncy5sZW5ndGggPiAwICYmIHR5cGVvZiBhcmdzWzBdID09PSAnb2JqZWN0JyAmJiBhcmdzWzBdICE9PSBudWxsKSB7XG4gICAgICBtZXRhID0gYXJnc1swXTtcbiAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID4gMCkge1xuICAgICAgbWV0YSA9IHsgc3BsYXQ6IGFyZ3MgfTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgaW5mb09iaiA9IG1lc3NhZ2VPckluZm8gYXMgUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICBtc2cgPSBpbmZvT2JqLm1lc3NhZ2UgfHwgJyc7XG4gICAgY29uc3QgeyBtZXNzYWdlOiBfbXNnLCBsZXZlbDogX2x2bCwgdGltZXN0YW1wOiBfdHMsIC4uLnJlc3RJbmZvIH0gPSBpbmZvT2JqO1xuICAgIG1ldGEgPSByZXN0SW5mbztcbiAgfVxuICBjb25zdCBtZXNzYWdlSWQgPSBtZXRhPy5tZXNzYWdlSWQgfHwgJ3Vua25vd24tbWVzc2FnZSc7XG4gIGNvbnN0IGZ1bGxNZXNzYWdlID0gYFtDSEFUOkVSUk9SXVtNU0c6JHttZXNzYWdlSWR9XSAke21zZ31gO1xuICBjb25zdCB7IG1lc3NhZ2VJZDogX21JZCwgLi4ubWV0YUZvck9yaWdDYWxsIH0gPSBtZXRhO1xuICBjb25zdCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCA9IHsgLi4ubWV0YUZvck9yaWdDYWxsLCB0YXNrSWQ6IG1lc3NhZ2VJZCwgY2hhdDogdHJ1ZSB9O1xuICBvcmlnQ2hhdEVycm9yKGZ1bGxNZXNzYWdlLCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCk7XG4gIHJldHVybiBjaGF0TG9nZ2VyO1xufTtcblxuY2hhdExvZ2dlci5pbmZvID0gKG1lc3NhZ2VPckluZm86IHN0cmluZyB8IG9iamVjdCwgLi4uYXJnczogYW55W10pOiBMb2dnZXIgPT4ge1xuICBsZXQgbXNnOiBzdHJpbmc7XG4gIGxldCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gIGlmICh0eXBlb2YgbWVzc2FnZU9ySW5mbyA9PT0gJ3N0cmluZycpIHtcbiAgICBtc2cgPSBtZXNzYWdlT3JJbmZvO1xuICAgIGlmIChhcmdzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnICYmIGFyZ3NbMF0gIT09IG51bGwpIHtcbiAgICAgIG1ldGEgPSBhcmdzWzBdO1xuICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBtZXRhID0geyBzcGxhdDogYXJncyB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpbmZvT2JqID0gbWVzc2FnZU9ySW5mbyBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIG1zZyA9IGluZm9PYmoubWVzc2FnZSB8fCAnJztcbiAgICBjb25zdCB7IG1lc3NhZ2U6IF9tc2csIGxldmVsOiBfbHZsLCB0aW1lc3RhbXA6IF90cywgLi4ucmVzdEluZm8gfSA9IGluZm9PYmo7XG4gICAgbWV0YSA9IHJlc3RJbmZvO1xuICB9XG4gIGNvbnN0IG1lc3NhZ2VJZCA9IG1ldGE/Lm1lc3NhZ2VJZCB8fCAndW5rbm93bi1tZXNzYWdlJztcbiAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgW0NIQVQ6SU5GT11bTVNHOiR7bWVzc2FnZUlkfV0gJHttc2d9YDtcbiAgY29uc3QgeyBtZXNzYWdlSWQ6IF9tSWQsIC4uLm1ldGFGb3JPcmlnQ2FsbCB9ID0gbWV0YTtcbiAgY29uc3QgZmluYWxNZXRhRm9yT3JpZ0NhbGwgPSB7IC4uLm1ldGFGb3JPcmlnQ2FsbCwgdGFza0lkOiBtZXNzYWdlSWQsIGNoYXQ6IHRydWUgfTtcbiAgb3JpZ0NoYXRJbmZvKGZ1bGxNZXNzYWdlLCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCk7XG4gIHJldHVybiBjaGF0TG9nZ2VyO1xufTtcblxuY29uc3QgYnVpbGRMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICdidWlsZCcgfSk7XG5jb25zdCBvcmlnQnVpbGRJbmZvID0gYnVpbGRMb2dnZXIuaW5mby5iaW5kKGJ1aWxkTG9nZ2VyKTtcbmNvbnN0IG9yaWdCdWlsZEVycm9yID0gYnVpbGRMb2dnZXIuZXJyb3IuYmluZChidWlsZExvZ2dlcik7XG5cbmJ1aWxkTG9nZ2VyLmVycm9yID0gKG1lc3NhZ2VPckluZm86IHN0cmluZyB8IG9iamVjdCwgLi4uYXJnczogYW55W10pOiBMb2dnZXIgPT4ge1xuICBsZXQgbXNnOiBzdHJpbmc7XG4gIGxldCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gIGlmICh0eXBlb2YgbWVzc2FnZU9ySW5mbyA9PT0gJ3N0cmluZycpIHtcbiAgICBtc2cgPSBtZXNzYWdlT3JJbmZvO1xuICAgIGlmIChhcmdzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnICYmIGFyZ3NbMF0gIT09IG51bGwpIHtcbiAgICAgIG1ldGEgPSBhcmdzWzBdO1xuICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBtZXRhID0geyBzcGxhdDogYXJncyB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpbmZvT2JqID0gbWVzc2FnZU9ySW5mbyBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIG1zZyA9IGluZm9PYmoubWVzc2FnZSB8fCAnJztcbiAgICBjb25zdCB7IG1lc3NhZ2U6IF9tc2csIGxldmVsOiBfbHZsLCB0aW1lc3RhbXA6IF90cywgLi4ucmVzdEluZm8gfSA9IGluZm9PYmo7XG4gICAgbWV0YSA9IHJlc3RJbmZvO1xuICB9XG4gIGNvbnN0IGpvYklkID0gbWV0YT8uam9iSWQgfHwgJ3Vua25vd24tam9iJztcbiAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgW0JVSUxEOkVSUk9SXVtKT0I6JHtqb2JJZH1dICR7bXNnfWA7XG4gIGNvbnN0IHsgam9iSWQ6IF9qSWQsIC4uLm1ldGFGb3JPcmlnQ2FsbCB9ID0gbWV0YTtcbiAgY29uc3QgZmluYWxNZXRhRm9yT3JpZ0NhbGwgPSB7IC4uLm1ldGFGb3JPcmlnQ2FsbCwgdGFza0lkOiBqb2JJZCwgYnVpbGQ6IHRydWUgfTtcbiAgb3JpZ0J1aWxkRXJyb3IoZnVsbE1lc3NhZ2UsIGZpbmFsTWV0YUZvck9yaWdDYWxsKTtcbiAgcmV0dXJuIGJ1aWxkTG9nZ2VyO1xufTtcblxuYnVpbGRMb2dnZXIuaW5mbyA9IChtZXNzYWdlT3JJbmZvOiBzdHJpbmcgfCBvYmplY3QsIC4uLmFyZ3M6IGFueVtdKTogTG9nZ2VyID0+IHtcbiAgbGV0IG1zZzogc3RyaW5nO1xuICBsZXQgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICBpZiAodHlwZW9mIG1lc3NhZ2VPckluZm8gPT09ICdzdHJpbmcnKSB7XG4gICAgbXNnID0gbWVzc2FnZU9ySW5mbztcbiAgICBpZiAoYXJncy5sZW5ndGggPiAwICYmIHR5cGVvZiBhcmdzWzBdID09PSAnb2JqZWN0JyAmJiBhcmdzWzBdICE9PSBudWxsKSB7XG4gICAgICBtZXRhID0gYXJnc1swXTtcbiAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID4gMCkge1xuICAgICAgbWV0YSA9IHsgc3BsYXQ6IGFyZ3MgfTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgaW5mb09iaiA9IG1lc3NhZ2VPckluZm8gYXMgUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICBtc2cgPSBpbmZvT2JqLm1lc3NhZ2UgfHwgJyc7XG4gICAgY29uc3QgeyBtZXNzYWdlOiBfbXNnLCBsZXZlbDogX2x2bCwgdGltZXN0YW1wOiBfdHMsIC4uLnJlc3RJbmZvIH0gPSBpbmZvT2JqO1xuICAgIG1ldGEgPSByZXN0SW5mbztcbiAgfVxuICBjb25zdCBqb2JJZCA9IG1ldGE/LmpvYklkIHx8ICd1bmtub3duLWpvYic7XG4gIGNvbnN0IGZ1bGxNZXNzYWdlID0gYFtCVUlMRDpJTkZPXVtKT0I6JHtqb2JJZH1dICR7bXNnfWA7XG4gIGNvbnN0IHsgam9iSWQ6IF9qSWQsIC4uLm1ldGFGb3JPcmlnQ2FsbCB9ID0gbWV0YTtcbiAgY29uc3QgZmluYWxNZXRhRm9yT3JpZ0NhbGwgPSB7IC4uLm1ldGFGb3JPcmlnQ2FsbCwgdGFza0lkOiBqb2JJZCwgYnVpbGQ6IHRydWUgfTtcbiAgb3JpZ0J1aWxkSW5mbyhmdWxsTWVzc2FnZSwgZmluYWxNZXRhRm9yT3JpZ0NhbGwpO1xuICByZXR1cm4gYnVpbGRMb2dnZXI7XG59O1xuXG4vLyBBZGQgYnVpbGRMb2dnZXIuc3RhcnQgbWV0aG9kXG5idWlsZExvZ2dlci5zdGFydCA9IChqb2JJZDogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSk6IExvZ2dlciA9PiB7XG4gIGNvbnN0IGZ1bGxNZXNzYWdlID0gYFtCVUlMRDpTVEFSVF1bSk9COiR7am9iSWR9XSAke21lc3NhZ2V9YDtcbiAgY29uc3QgZmluYWxNZXRhRm9yT3JpZ0NhbGwgPSB7IC4uLm1ldGEsIHRhc2tJZDogam9iSWQsIGJ1aWxkOiB0cnVlIH07XG4gIG9yaWdCdWlsZEluZm8oZnVsbE1lc3NhZ2UsIGZpbmFsTWV0YUZvck9yaWdDYWxsKTtcbiAgcmV0dXJuIGJ1aWxkTG9nZ2VyO1xufTtcblxuLy8gQWRkIGJ1aWxkTG9nZ2VyLmNvbXBpbGUgbWV0aG9kXG5idWlsZExvZ2dlci5jb21waWxlID0gKGpvYklkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KTogTG9nZ2VyID0+IHtcbiAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgW0JVSUxEOkNPTVBJTEVdW0pPQjoke2pvYklkfV0gJHttZXNzYWdlfWA7XG4gIGNvbnN0IGZpbmFsTWV0YUZvck9yaWdDYWxsID0geyAuLi5tZXRhLCB0YXNrSWQ6IGpvYklkLCBidWlsZDogdHJ1ZSB9O1xuICBvcmlnQnVpbGRJbmZvKGZ1bGxNZXNzYWdlLCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCk7XG4gIHJldHVybiBidWlsZExvZ2dlcjtcbn07XG5cbi8vIEFkZCBidWlsZExvZ2dlci51cGxvYWQgbWV0aG9kXG5idWlsZExvZ2dlci51cGxvYWQgPSAoam9iSWQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pOiBMb2dnZXIgPT4ge1xuICBjb25zdCBmdWxsTWVzc2FnZSA9IGBbQlVJTEQ6VVBMT0FEXVtKT0I6JHtqb2JJZH1dICR7bWVzc2FnZX1gO1xuICBjb25zdCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCA9IHsgLi4ubWV0YSwgdGFza0lkOiBqb2JJZCwgYnVpbGQ6IHRydWUgfTtcbiAgb3JpZ0J1aWxkSW5mbyhmdWxsTWVzc2FnZSwgZmluYWxNZXRhRm9yT3JpZ0NhbGwpO1xuICByZXR1cm4gYnVpbGRMb2dnZXI7XG59O1xuXG4vLyBBZGQgYnVpbGRMb2dnZXIuY29tcGxldGUgbWV0aG9kXG5idWlsZExvZ2dlci5jb21wbGV0ZSA9IChqb2JJZDogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSk6IExvZ2dlciA9PiB7XG4gIGNvbnN0IGZ1bGxNZXNzYWdlID0gYFtCVUlMRDpDT01QTEVURV1bSk9COiR7am9iSWR9XSAke21lc3NhZ2V9YDtcbiAgY29uc3QgZmluYWxNZXRhRm9yT3JpZ0NhbGwgPSB7IC4uLm1ldGEsIHRhc2tJZDogam9iSWQsIGJ1aWxkOiB0cnVlIH07XG4gIG9yaWdCdWlsZEluZm8oZnVsbE1lc3NhZ2UsIGZpbmFsTWV0YUZvck9yaWdDYWxsKTtcbiAgcmV0dXJuIGJ1aWxkTG9nZ2VyO1xufTtcblxuY29uc3Qgc2NlbmVQbGFubmVyTG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHsgbW9kdWxlOiAnc2NlbmVQbGFubmVyJyB9KTtcbmNvbnN0IG9yaWdTY2VuZVBsYW5uZXJJbmZvID0gc2NlbmVQbGFubmVyTG9nZ2VyLmluZm8uYmluZChzY2VuZVBsYW5uZXJMb2dnZXIpO1xuY29uc3Qgb3JpZ1NjZW5lUGxhbm5lckVycm9yID0gc2NlbmVQbGFubmVyTG9nZ2VyLmVycm9yLmJpbmQoc2NlbmVQbGFubmVyTG9nZ2VyKTtcblxuc2NlbmVQbGFubmVyTG9nZ2VyLmVycm9yID0gKG1lc3NhZ2VPckluZm86IHN0cmluZyB8IG9iamVjdCwgLi4uYXJnczogYW55W10pOiBMb2dnZXIgPT4ge1xuICBsZXQgbXNnOiBzdHJpbmc7XG4gIGxldCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gIGlmICh0eXBlb2YgbWVzc2FnZU9ySW5mbyA9PT0gJ3N0cmluZycpIHtcbiAgICBtc2cgPSBtZXNzYWdlT3JJbmZvO1xuICAgIGlmIChhcmdzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnICYmIGFyZ3NbMF0gIT09IG51bGwpIHtcbiAgICAgIG1ldGEgPSBhcmdzWzBdO1xuICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBtZXRhID0geyBzcGxhdDogYXJncyB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpbmZvT2JqID0gbWVzc2FnZU9ySW5mbyBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIG1zZyA9IGluZm9PYmoubWVzc2FnZSB8fCAnJztcbiAgICBjb25zdCB7IG1lc3NhZ2U6IF9tc2csIGxldmVsOiBfbHZsLCB0aW1lc3RhbXA6IF90cywgLi4ucmVzdEluZm8gfSA9IGluZm9PYmo7XG4gICAgbWV0YSA9IHJlc3RJbmZvO1xuICB9XG4gIGNvbnN0IHBsYW5JZCA9IG1ldGE/LnBsYW5JZCB8fCAndW5rbm93bi1wbGFuJztcbiAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgW1BJUEVMSU5FOkVSUk9SXVtQTEFOOiR7cGxhbklkfV0gJHttc2d9YDtcbiAgY29uc3QgeyBwbGFuSWQ6IF9wSWQsIC4uLm1ldGFGb3JPcmlnQ2FsbCB9ID0gbWV0YTtcbiAgY29uc3QgZmluYWxNZXRhRm9yT3JpZ0NhbGwgPSB7IC4uLm1ldGFGb3JPcmlnQ2FsbCwgdGFza0lkOiBwbGFuSWQsIHNjZW5lUGxhbm5lcjogdHJ1ZSB9O1xuICBvcmlnU2NlbmVQbGFubmVyRXJyb3IoZnVsbE1lc3NhZ2UsIGZpbmFsTWV0YUZvck9yaWdDYWxsKTtcbiAgcmV0dXJuIHNjZW5lUGxhbm5lckxvZ2dlcjtcbn07XG5cbnNjZW5lUGxhbm5lckxvZ2dlci5pbmZvID0gKG1lc3NhZ2VPckluZm86IHN0cmluZyB8IG9iamVjdCwgLi4uYXJnczogYW55W10pOiBMb2dnZXIgPT4ge1xuICBsZXQgbXNnOiBzdHJpbmc7XG4gIGxldCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gIGlmICh0eXBlb2YgbWVzc2FnZU9ySW5mbyA9PT0gJ3N0cmluZycpIHtcbiAgICBtc2cgPSBtZXNzYWdlT3JJbmZvO1xuICAgIGlmIChhcmdzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnICYmIGFyZ3NbMF0gIT09IG51bGwpIHtcbiAgICAgIG1ldGEgPSBhcmdzWzBdO1xuICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBtZXRhID0geyBzcGxhdDogYXJncyB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpbmZvT2JqID0gbWVzc2FnZU9ySW5mbyBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIG1zZyA9IGluZm9PYmoubWVzc2FnZSB8fCAnJztcbiAgICBjb25zdCB7IG1lc3NhZ2U6IF9tc2csIGxldmVsOiBfbHZsLCB0aW1lc3RhbXA6IF90cywgLi4ucmVzdEluZm8gfSA9IGluZm9PYmo7XG4gICAgbWV0YSA9IHJlc3RJbmZvO1xuICB9XG4gIGNvbnN0IHBsYW5JZCA9IG1ldGE/LnBsYW5JZCB8fCAndW5rbm93bi1wbGFuJztcbiAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgW1BJUEVMSU5FOklORk9dW1BMQU46JHtwbGFuSWR9XSAke21zZ31gO1xuICBjb25zdCB7IHBsYW5JZDogX3BJZCwgLi4ubWV0YUZvck9yaWdDYWxsIH0gPSBtZXRhO1xuICBjb25zdCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCA9IHsgLi4ubWV0YUZvck9yaWdDYWxsLCB0YXNrSWQ6IHBsYW5JZCwgc2NlbmVQbGFubmVyOiB0cnVlIH07XG4gIG9yaWdTY2VuZVBsYW5uZXJJbmZvKGZ1bGxNZXNzYWdlLCBmaW5hbE1ldGFGb3JPcmlnQ2FsbCk7XG4gIHJldHVybiBzY2VuZVBsYW5uZXJMb2dnZXI7XG59O1xuXG4vLyBDcmVhdGUgZ2VuZXJhbCBzeXN0ZW0gbG9nZ2VyIGFzIGEgY2hpbGQgbG9nZ2VyXG5jb25zdCBzeXN0ZW1Mb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICdzeXN0ZW0nIH0pO1xuXG4vLyBDb25maWd1cmUgY29uc29sZSB0cmFuc3BvcnQgbGV2ZWwgc3BlY2lmaWNhbGx5XG4vLyBjb25zb2xlLmxvZyhgW0RFQlVHX0xPR0dFUl0gQ29uZmlndXJpbmcgc3lzdGVtIGxvZ2dlciBjb25zb2xlIGxldmVsLiBMT0dHSU5HX01PREU6ICR7cHJvY2Vzcy5lbnYuTE9HR0lOR19NT0RFfWApO1xuY29uc3Qgc3lzdGVtQ29uc29sZVRyYW5zcG9ydCA9IHN5c3RlbUxvZ2dlci50cmFuc3BvcnRzLmZpbmQoXG4gICh0KSA9PiB0IGluc3RhbmNlb2YgdHJhbnNwb3J0cy5Db25zb2xlXG4pO1xuaWYgKHN5c3RlbUNvbnNvbGVUcmFuc3BvcnQpIHtcbiAgc3lzdGVtQ29uc29sZVRyYW5zcG9ydC5sZXZlbCA9IHByb2Nlc3MuZW52LkxPR19MRVZFTCB8fCAnaW5mbyc7XG4gIC8vIGNvbnNvbGUubG9nKGBbREVCVUdfTE9HR0VSXSBTeXN0ZW0gbG9nZ2VyIGNvbnNvbGUgbGV2ZWwgc2V0IHRvOiAke3N5c3RlbUNvbnNvbGVUcmFuc3BvcnQubGV2ZWx9YCk7XG59IGVsc2Uge1xuICAvLyBjb25zb2xlLmxvZygnW0RFQlVHX0xPR0dFUl0gQ291bGQgbm90IGZpbmQgc3lzdGVtIGxvZ2dlciBjb25zb2xlIHRyYW5zcG9ydCB0byBjb25maWd1cmUhJyk7XG59XG5cbi8vIE90aGVyIGNoaWxkIGxvZ2dlcnNcbmNvbnN0IGF1dGhMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICdhdXRoJyB9KTtcbmNvbnN0IHBhZ2VMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICdwYWdlJyB9KTtcbmNvbnN0IGFwaUxvZ2dlciA9IGxvZ2dlci5jaGlsZCh7IG1vZHVsZTogJ2FwaScgfSk7XG5jb25zdCBjcm9uTG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHsgbW9kdWxlOiAnY3JvbicgfSk7XG5jb25zdCB3b3JrZXJMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICd3b3JrZXInIH0pO1xuY29uc3QgZGJMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBtb2R1bGU6ICdkYicgfSk7XG5jb25zdCB0b29sc0xvZ2dlciA9IGxvZ2dlci5jaGlsZCh7IG1vZHVsZTogJ3Rvb2xzJyB9KTtcbmNvbnN0IGFnZW50TG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHsgbW9kdWxlOiAnYWdlbnQnIH0pO1xuY29uc3QgbW9kZWxzTG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHsgbW9kdWxlOiAnbW9kZWxzJyB9KTtcbmNvbnN0IGNvbXBvbmVudExvZ2dlciA9IGxvZ2dlci5jaGlsZCh7IG1vZHVsZTogJ2NvbXBvbmVudCcgfSk7XG5jb25zdCBhbmltYXRpb25EZXNpZ25lckxvZ2dlciA9IGxvZ2dlci5jaGlsZCh7IG1vZHVsZTogJ2FuaW1hdGlvbkRlc2lnbmVyJyB9KTtcblxuLy8gU3lzdGVtIExvZ2dlciBzdGFuZGFsb25lIGZ1bmN0aW9uc1xuY29uc3Qgb3JpZ1N5c3RlbURlYnVnID0gc3lzdGVtTG9nZ2VyLmRlYnVnLmJpbmQoc3lzdGVtTG9nZ2VyKTtcbmNvbnN0IG9yaWdTeXN0ZW1JbmZvID0gc3lzdGVtTG9nZ2VyLmluZm8uYmluZChzeXN0ZW1Mb2dnZXIpO1xuXG5leHBvcnQgY29uc3QgbG9nU3lzdGVtUHJvY2VzcyA9IChsb2dnZXJJbnN0YW5jZTogTG9nZ2VyLCBwcm9jZXNzSWQ6IFN0cmluZ09yTnVsbCwgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgY29uc3Qgbm9ybWFsaXplZFByb2Nlc3NJZCA9IHByb2Nlc3NJZCB8fCAndW5rbm93bi1wcm9jZXNzJztcbiAgbG9nZ2VySW5zdGFuY2UuaW5mbyhgW1NZU1RFTTpQUk9DRVNTXVtJRDoke25vcm1hbGl6ZWRQcm9jZXNzSWR9XSAke21lc3NhZ2V9YCwgeyAuLi5tZXRhLCBwcm9jZXNzSWQ6IG5vcm1hbGl6ZWRQcm9jZXNzSWQsIHN5c3RlbTogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBsb2dTeXN0ZW1FdmVudCA9IChsb2dnZXJJbnN0YW5jZTogTG9nZ2VyLCBldmVudFR5cGU6IHN0cmluZywgZXZlbnREYXRhOiBhbnksIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICBsb2dnZXJJbnN0YW5jZS5kZWJ1ZyhgW1NZU1RFTTpFVkVOVF0gJHtldmVudFR5cGV9YCwgeyAuLi5tZXRhLCBldmVudFR5cGUsIGV2ZW50UGF5bG9hZDogZXZlbnREYXRhLCBzeXN0ZW06IHRydWUgfSk7XG59O1xuXG4vLyBJbml0aWFsaXplIENoYXRMb2dnZXIgc3BlY2lmaWMgbWV0aG9kc1xuZXhwb3J0IGNvbnN0IGxvZ0NoYXRTdHJlYW0gPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgbWVzc2FnZUlkOiBTdHJpbmdPck51bGwsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRNZXNzYWdlSWQgPSBtZXNzYWdlSWQgfHwgJ3Vua25vd24tbWVzc2FnZSc7XG4gIGxvZ2dlckluc3RhbmNlLmRlYnVnKGBbQ0hBVDpTVFJFQU1dW01TRzoke25vcm1hbGl6ZWRNZXNzYWdlSWR9XSAke21lc3NhZ2V9YCwgeyAuLi5tZXRhLCB0YXNrSWQ6IG5vcm1hbGl6ZWRNZXNzYWdlSWQsIGNoYXQ6IHRydWUgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgbG9nQ2hhdFRvb2wgPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgbWVzc2FnZUlkOiBTdHJpbmdPck51bGwsIHRvb2xOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRNZXNzYWdlSWQgPSBtZXNzYWdlSWQgfHwgJ3Vua25vd24tbWVzc2FnZSc7XG4gIGxvZ2dlckluc3RhbmNlLmRlYnVnKGBbQ0hBVDpUT09MOiR7dG9vbE5hbWV9XVtNU0c6JHtub3JtYWxpemVkTWVzc2FnZUlkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkTWVzc2FnZUlkLCBjaGF0OiB0cnVlLCB0b29sOiB0b29sTmFtZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBsb2dDaGF0Q29tcGxldGUgPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgbWVzc2FnZUlkOiBTdHJpbmdPck51bGwsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRNZXNzYWdlSWQgPSBtZXNzYWdlSWQgfHwgJ3Vua25vd24tbWVzc2FnZSc7XG4gIGxvZ2dlckluc3RhbmNlLmluZm8oYFtDSEFUOkNPTVBMRVRFXVtNU0c6JHtub3JtYWxpemVkTWVzc2FnZUlkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkTWVzc2FnZUlkLCBjaGF0OiB0cnVlIH0pO1xufTtcblxuLy8gSW5pdGlhbGl6ZSBCdWlsZExvZ2dlciBzcGVjaWZpYyBtZXRob2RzXG5leHBvcnQgY29uc3QgbG9nQnVpbGRTdGFydCA9IChsb2dnZXJJbnN0YW5jZTogTG9nZ2VyLCBqb2JJZDogU3RyaW5nT3JOdWxsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICBjb25zdCBub3JtYWxpemVkSm9iSWQgPSBqb2JJZCB8fCAndW5rbm93bi1qb2InO1xuICBsb2dnZXJJbnN0YW5jZS5pbmZvKGBbQlVJTEQ6U1RBUlRdW0pPQjoke25vcm1hbGl6ZWRKb2JJZH1dICR7bWVzc2FnZX1gLCB7IC4uLm1ldGEsIHRhc2tJZDogbm9ybWFsaXplZEpvYklkLCBidWlsZDogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBsb2dCdWlsZENvbXBpbGUgPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgam9iSWQ6IFN0cmluZ09yTnVsbCwgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgY29uc3Qgbm9ybWFsaXplZEpvYklkID0gam9iSWQgfHwgJ3Vua25vd24tam9iJztcbiAgbG9nZ2VySW5zdGFuY2UuZGVidWcoYFtCVUlMRDpDT01QSUxFXVtKT0I6JHtub3JtYWxpemVkSm9iSWR9XSAke21lc3NhZ2V9YCwgeyAuLi5tZXRhLCB0YXNrSWQ6IG5vcm1hbGl6ZWRKb2JJZCwgYnVpbGQ6IHRydWUgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgbG9nQnVpbGRVcGxvYWQgPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgam9iSWQ6IFN0cmluZ09yTnVsbCwgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgY29uc3Qgbm9ybWFsaXplZEpvYklkID0gam9iSWQgfHwgJ3Vua25vd24tam9iJztcbiAgbG9nZ2VySW5zdGFuY2UuZGVidWcoYFtCVUlMRDpVUExPQURdW0pPQjoke25vcm1hbGl6ZWRKb2JJZH1dICR7bWVzc2FnZX1gLCB7IC4uLm1ldGEsIHRhc2tJZDogbm9ybWFsaXplZEpvYklkLCBidWlsZDogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBsb2dCdWlsZFdhcm4gPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgam9iSWQ6IFN0cmluZ09yTnVsbCwgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgY29uc3Qgbm9ybWFsaXplZEpvYklkID0gam9iSWQgfHwgJ3Vua25vd24tam9iJztcbiAgbG9nZ2VySW5zdGFuY2Uud2FybihgW0JVSUxEOldBUk5dW0pPQjoke25vcm1hbGl6ZWRKb2JJZH1dICR7bWVzc2FnZX1gLCB7IC4uLm1ldGEsIHRhc2tJZDogbm9ybWFsaXplZEpvYklkLCBidWlsZDogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBsb2dCdWlsZENvbXBsZXRlID0gKGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsIGpvYklkOiBTdHJpbmdPck51bGwsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRKb2JJZCA9IGpvYklkIHx8ICd1bmtub3duLWpvYic7XG4gIGxvZ2dlckluc3RhbmNlLmluZm8oYFtCVUlMRDpDT01QTEVURV1bSk9COiR7bm9ybWFsaXplZEpvYklkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkSm9iSWQsIGJ1aWxkOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGxvZ0J1aWxkRGVidWcgPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgam9iSWQ6IFN0cmluZ09yTnVsbCwgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgY29uc3Qgbm9ybWFsaXplZEpvYklkID0gam9iSWQgfHwgJ3Vua25vd24tam9iJztcbiAgbG9nZ2VySW5zdGFuY2UuZGVidWcoYFtCVUlMRDpERUJVR11bSk9COiR7bm9ybWFsaXplZEpvYklkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkSm9iSWQsIGJ1aWxkOiB0cnVlIH0pO1xufTtcblxuLy8gSW5pdGlhbGl6ZSBTY2VuZVBsYW5uZXJMb2dnZXIgc3BlY2lmaWMgbWV0aG9kc1xuZXhwb3J0IGNvbnN0IGxvZ1NjZW5lUGxhbm5lckRiID0gKGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsIHBsYW5JZDogU3RyaW5nT3JOdWxsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICBjb25zdCBub3JtYWxpemVkUGxhbklkID0gcGxhbklkIHx8ICd1bmtub3duLXBsYW4nO1xuICBsb2dnZXJJbnN0YW5jZS5kZWJ1ZyhgW1BJUEVMSU5FOkRCXVtQTEFOOiR7bm9ybWFsaXplZFBsYW5JZH1dICR7bWVzc2FnZX1gLCB7IC4uLm1ldGEsIHRhc2tJZDogbm9ybWFsaXplZFBsYW5JZCwgc2NlbmVQbGFubmVyOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGxvZ1NjZW5lUGxhbm5lckFkYiA9IChsb2dnZXJJbnN0YW5jZTogTG9nZ2VyLCBwbGFuSWQ6IFN0cmluZ09yTnVsbCwgc2NlbmVJZDogU3RyaW5nT3JOdWxsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICBjb25zdCBub3JtYWxpemVkUGxhbklkID0gcGxhbklkIHx8ICd1bmtub3duLXBsYW4nO1xuICBjb25zdCBub3JtYWxpemVkU2NlbmVJZCA9IHNjZW5lSWQgfHwgJ3Vua25vd24tc2NlbmUnO1xuICBsb2dnZXJJbnN0YW5jZS5kZWJ1ZyhgW1BJUEVMSU5FOkFEQl1bUExBTjoke25vcm1hbGl6ZWRQbGFuSWR9XVtTQ0VORToke25vcm1hbGl6ZWRTY2VuZUlkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkUGxhbklkLCBzY2VuZUlkOiBub3JtYWxpemVkU2NlbmVJZCwgc2NlbmVQbGFubmVyOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGxvZ1NjZW5lUGxhbm5lckNvbXBvbmVudCA9IChsb2dnZXJJbnN0YW5jZTogTG9nZ2VyLCBwbGFuSWQ6IFN0cmluZ09yTnVsbCwgc2NlbmVJZDogU3RyaW5nT3JOdWxsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICBjb25zdCBub3JtYWxpemVkUGxhbklkID0gcGxhbklkIHx8ICd1bmtub3duLXBsYW4nO1xuICBjb25zdCBub3JtYWxpemVkU2NlbmVJZCA9IHNjZW5lSWQgfHwgJ3Vua25vd24tc2NlbmUnO1xuICBsb2dnZXJJbnN0YW5jZS5kZWJ1ZyhgW1BJUEVMSU5FOkNPTVBPTkVOVF1bUExBTjoke25vcm1hbGl6ZWRQbGFuSWR9XVtTQ0VORToke25vcm1hbGl6ZWRTY2VuZUlkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkUGxhbklkLCBzY2VuZUlkOiBub3JtYWxpemVkU2NlbmVJZCwgc2NlbmVQbGFubmVyOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGxvZ1NjZW5lUGxhbm5lckNvbXBsZXRlID0gKGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsIHBsYW5JZDogU3RyaW5nT3JOdWxsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICBjb25zdCBub3JtYWxpemVkUGxhbklkID0gcGxhbklkIHx8ICd1bmtub3duLXBsYW4nO1xuICBsb2dnZXJJbnN0YW5jZS5pbmZvKGBbUElQRUxJTkU6Q09NUExFVEVdW1BMQU46JHtub3JtYWxpemVkUGxhbklkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkUGxhbklkLCBzY2VuZVBsYW5uZXI6IHRydWUgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgbG9nU2NlbmVQbGFubmVyRGVidWcgPSAobG9nZ2VySW5zdGFuY2U6IExvZ2dlciwgcGxhbklkOiBTdHJpbmdPck51bGwsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRQbGFuSWQgPSBwbGFuSWQgfHwgJ3Vua25vd24tcGxhbic7XG4gIGxvZ2dlckluc3RhbmNlLmRlYnVnKGBbUElQRUxJTkU6REVCVUddW1BMQU46JHtub3JtYWxpemVkUGxhbklkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGFza0lkOiBub3JtYWxpemVkUGxhbklkLCBzY2VuZVBsYW5uZXI6IHRydWUgfSk7XG59O1xuXG4vLyBGYWxsYmFjayBsb2dnZXIgLSBpZiBhIHNwZWNpZmljIGxvZ2dlciBkb2Vzbid0IGhhdmUgYSBtZXRob2QsIGl0IHdpbGwgdXNlIHRoZSBiYXNlIGxvZ2dlcidzIG1ldGhvZHNcbi8vIEhvd2V2ZXIsIHRoaXMgbWlnaHQgbm90IGJlIGRlc2lyZWQgaWYgd2Ugd2FudCBzdHJpY3QgbWV0aG9kIGF2YWlsYWJpbGl0eSBwZXIgbG9nZ2VyLlxuXG5leHBvcnQge1xuICBsb2dnZXIsXG4gIGJ1aWxkTG9nZ2VyLFxuICBzY2VuZVBsYW5uZXJMb2dnZXIsXG4gIGNoYXRMb2dnZXIsXG4gIHN5c3RlbUxvZ2dlcixcbiAgYXV0aExvZ2dlcixcbiAgcGFnZUxvZ2dlcixcbiAgYXBpTG9nZ2VyLFxuICBjcm9uTG9nZ2VyLFxuICB3b3JrZXJMb2dnZXIsXG4gIGRiTG9nZ2VyLFxuICB0b29sc0xvZ2dlcixcbiAgYWdlbnRMb2dnZXIsXG4gIG1vZGVsc0xvZ2dlcixcbiAgY29tcG9uZW50TG9nZ2VyLFxuICBhbmltYXRpb25EZXNpZ25lckxvZ2dlcixcbn07XG5cbi8vIE1ha2UgYGxvZ2dlcmAgdGhlIGRlZmF1bHQgZXhwb3J0XG5leHBvcnQgZGVmYXVsdCBsb2dnZXI7XG5cbi8qKlxuICogQWdlbnQgU2VuZCBMb2dnaW5nIC0gU3RhbmRhbG9uZSBmdW5jdGlvbiB0byBoYW5kbGUgYWdlbnQgc2VuZCBsb2dnaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2dBZ2VudFNlbmQoXG4gIGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsXG4gIGFnZW50TmFtZTogc3RyaW5nLFxuICB0YXNrSWQ6IHN0cmluZyxcbiAgcmVjaXBpZW50OiBzdHJpbmcsXG4gIG1lc3NhZ2VUeXBlOiBzdHJpbmcsXG4gIG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pOiBMb2dnZXIge1xuICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gYEFHRU5UWyR7YWdlbnROYW1lfV0gLT4gJHtyZWNpcGllbnR9OiAke21lc3NhZ2VUeXBlfWA7XG4gIHJldHVybiBsb2dnZXJJbnN0YW5jZS5pbmZvKGZvcm1hdHRlZE1lc3NhZ2UsIHtcbiAgICAuLi5tZXRhLFxuICAgIGFnZW50OiBhZ2VudE5hbWUsXG4gICAgdGFza0lkLFxuICAgIHJlY2lwaWVudCxcbiAgICBtZXNzYWdlVHlwZSxcbiAgICBhY3Rpb246ICdhZ2VudF9zZW5kJ1xuICB9KTtcbn1cblxuLyoqXG4gKiBBZ2VudCBQcm9jZXNzIExvZ2dpbmcgLSBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGhhbmRsZSBhZ2VudCBwcm9jZXNzIGxvZ2dpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvZ0FnZW50UHJvY2VzcyhcbiAgbG9nZ2VySW5zdGFuY2U6IExvZ2dlcixcbiAgYWdlbnROYW1lOiBzdHJpbmcsXG4gIHRhc2tJZDogc3RyaW5nLFxuICBwcm9jZXNzTmFtZTogc3RyaW5nLFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pOiBMb2dnZXIge1xuICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gYEFHRU5UWyR7YWdlbnROYW1lfV0gUFJPQ0VTU1ske3Byb2Nlc3NOYW1lfV06ICR7bWVzc2FnZX1gO1xuICByZXR1cm4gbG9nZ2VySW5zdGFuY2UuaW5mbyhmb3JtYXR0ZWRNZXNzYWdlLCB7XG4gICAgLi4ubWV0YSxcbiAgICBhZ2VudDogYWdlbnROYW1lLFxuICAgIHRhc2tJZCxcbiAgICBwcm9jZXNzTmFtZSxcbiAgICBhY3Rpb246ICdhZ2VudF9wcm9jZXNzJ1xuICB9KTtcbn1cblxuLyoqXG4gKiBBbmltYXRpb24gRGVzaWduZXIgU3RhcnQgTG9nZ2luZyAtIFN0YW5kYWxvbmUgZnVuY3Rpb24gZm9yIHRyYWNraW5nIGFuaW1hdGlvbiBnZW5lcmF0aW9uIHN0YXJ0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gbG9nQW5pbWF0aW9uU3RhcnQoXG4gIGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsXG4gIHNjZW5lSWQ6IHN0cmluZyxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKTogTG9nZ2VyIHtcbiAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IGBbQU5JTUFUSU9OOlNUQVJUXVtTQ0VORToke3NjZW5lSWR9XSAke21lc3NhZ2V9YDtcbiAgcmV0dXJuIGxvZ2dlckluc3RhbmNlLmluZm8oZm9ybWF0dGVkTWVzc2FnZSwge1xuICAgIC4uLm1ldGEsXG4gICAgc2NlbmVJZCxcbiAgICBhbmltYXRpb246IHRydWUsXG4gICAgc3RhZ2U6ICdzdGFydCdcbiAgfSk7XG59XG5cbi8qKlxuICogQW5pbWF0aW9uIERlc2lnbmVyIFZhbGlkYXRpb24gTG9nZ2luZyAtIFN0YW5kYWxvbmUgZnVuY3Rpb24gZm9yIGFuaW1hdGlvbiB2YWxpZGF0aW9uIGxvZ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvZ0FuaW1hdGlvblZhbGlkYXRpb24oXG4gIGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsXG4gIHNjZW5lSWQ6IHN0cmluZyxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKTogTG9nZ2VyIHtcbiAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IGBbQU5JTUFUSU9OOlZBTElEQVRJT05dW1NDRU5FOiR7c2NlbmVJZH1dICR7bWVzc2FnZX1gO1xuICByZXR1cm4gbG9nZ2VySW5zdGFuY2UuaW5mbyhmb3JtYXR0ZWRNZXNzYWdlLCB7XG4gICAgLi4ubWV0YSxcbiAgICBzY2VuZUlkLFxuICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICBzdGFnZTogJ3ZhbGlkYXRpb24nXG4gIH0pO1xufVxuXG4vKipcbiAqIEFuaW1hdGlvbiBEZXNpZ25lciBDb21wbGV0ZSBMb2dnaW5nIC0gU3RhbmRhbG9uZSBmdW5jdGlvbiBmb3IgbWFya2luZyBjb21wbGV0aW9uIG9mIGFuaW1hdGlvbiB0YXNrc1xuICovXG5leHBvcnQgZnVuY3Rpb24gbG9nQW5pbWF0aW9uQ29tcGxldGUoXG4gIGxvZ2dlckluc3RhbmNlOiBMb2dnZXIsXG4gIHNjZW5lSWQ6IHN0cmluZyxcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKTogTG9nZ2VyIHtcbiAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IGBbQU5JTUFUSU9OOkNPTVBMRVRFXVtTQ0VORToke3NjZW5lSWR9XSAke21lc3NhZ2V9YDtcbiAgcmV0dXJuIGxvZ2dlckluc3RhbmNlLmluZm8oZm9ybWF0dGVkTWVzc2FnZSwge1xuICAgIC4uLm1ldGEsXG4gICAgc2NlbmVJZCxcbiAgICBhbmltYXRpb246IHRydWUsXG4gICAgc3RhZ2U6ICdjb21wbGV0ZSdcbiAgfSk7XG59Il0sIm5hbWVzIjpbImNyZWF0ZUxvZ2dlciIsImZvcm1hdCIsInRyYW5zcG9ydHMiLCJwYXRoIiwiZnMiLCJpc1NlcnZlciIsImlzU2VydmVybGVzc1Byb2R1Y3Rpb24iLCJwcm9jZXNzIiwiZW52IiwiVkVSQ0VMIiwiQVdTX0xBTUJEQV9GVU5DVElPTl9OQU1FIiwiTkVUTElGWSIsImNvbnNvbGVGb3JtYXQiLCJjb21iaW5lIiwiY29sb3JpemUiLCJ0aW1lc3RhbXAiLCJwcmludGYiLCJsZXZlbCIsIm1lc3NhZ2UiLCJtZXRhIiwibWV0YVN0ciIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwiZmlsZUZvcm1hdCIsImpzb24iLCJzeXN0ZW1GaWxlVHJhbnNwb3J0SW5pdGlhbGl6ZWQiLCJsb2dnZXIiLCJzYWZlQ3JlYXRlRGlyIiwiZGlyIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsImVycm9yIiwibG9nc0RpciIsIkxPR19ESVIiLCJqb2luIiwiY3dkIiwiZXJyb3JMb2dzRGlyIiwiRVJST1JfTE9HX0RJUiIsImNvbWJpbmVkTG9nc0RpciIsIkNPTUJJTkVEX0xPR19ESVIiLCJjb21wb25lbnRzTG9nc0RpciIsIkNPTVBPTkVOVFNfTE9HX0RJUiIsImJhc2VUcmFuc3BvcnRzIiwiQ29uc29sZSIsIkxPR19MRVZFTCIsImRpcnNDcmVhdGVkIiwibWFwIiwic29tZSIsImNyZWF0ZWQiLCJwdXNoIiwiRGFpbHlSb3RhdGVGaWxlIiwiZGlybmFtZSIsImZpbGVuYW1lIiwiZGF0ZVBhdHRlcm4iLCJtYXhTaXplIiwibWF4RmlsZXMiLCJkZWZhdWx0TWV0YSIsImNvbXBvbmVudHNUcmFuc3BvcnRzIiwiY29tcG9uZW50c0xvZ2dlciIsInN5c3RlbUxvZ2dlciIsInN5c3RlbSIsImluaXRpYWxpemVTeXN0ZW1GaWxlVHJhbnNwb3J0IiwiaXNUZXN0TW9kZSIsInN5c3RlbUxvZ3NEaXIiLCJhZGQiLCJpbmZvIiwiaXNTeXN0ZW1GaWxlVHJhbnNwb3J0SW5pdGlhbGl6ZWQiLCJjaGF0TG9nZ2VyIiwiY2hpbGQiLCJtb2R1bGUiLCJvcmlnQ2hhdEluZm8iLCJiaW5kIiwib3JpZ0NoYXRFcnJvciIsIm1lc3NhZ2VPckluZm8iLCJhcmdzIiwibXNnIiwic3BsYXQiLCJpbmZvT2JqIiwiX21zZyIsIl9sdmwiLCJfdHMiLCJyZXN0SW5mbyIsIm1lc3NhZ2VJZCIsImZ1bGxNZXNzYWdlIiwiX21JZCIsIm1ldGFGb3JPcmlnQ2FsbCIsImZpbmFsTWV0YUZvck9yaWdDYWxsIiwidGFza0lkIiwiY2hhdCIsImJ1aWxkTG9nZ2VyIiwib3JpZ0J1aWxkSW5mbyIsIm9yaWdCdWlsZEVycm9yIiwiam9iSWQiLCJfaklkIiwiYnVpbGQiLCJzdGFydCIsImNvbXBpbGUiLCJ1cGxvYWQiLCJjb21wbGV0ZSIsInNjZW5lUGxhbm5lckxvZ2dlciIsIm9yaWdTY2VuZVBsYW5uZXJJbmZvIiwib3JpZ1NjZW5lUGxhbm5lckVycm9yIiwicGxhbklkIiwiX3BJZCIsInNjZW5lUGxhbm5lciIsInN5c3RlbUNvbnNvbGVUcmFuc3BvcnQiLCJmaW5kIiwidCIsImF1dGhMb2dnZXIiLCJwYWdlTG9nZ2VyIiwiYXBpTG9nZ2VyIiwiY3JvbkxvZ2dlciIsIndvcmtlckxvZ2dlciIsImRiTG9nZ2VyIiwidG9vbHNMb2dnZXIiLCJhZ2VudExvZ2dlciIsIm1vZGVsc0xvZ2dlciIsImNvbXBvbmVudExvZ2dlciIsImFuaW1hdGlvbkRlc2lnbmVyTG9nZ2VyIiwib3JpZ1N5c3RlbURlYnVnIiwiZGVidWciLCJvcmlnU3lzdGVtSW5mbyIsImxvZ1N5c3RlbVByb2Nlc3MiLCJsb2dnZXJJbnN0YW5jZSIsInByb2Nlc3NJZCIsIm5vcm1hbGl6ZWRQcm9jZXNzSWQiLCJsb2dTeXN0ZW1FdmVudCIsImV2ZW50VHlwZSIsImV2ZW50RGF0YSIsImV2ZW50UGF5bG9hZCIsImxvZ0NoYXRTdHJlYW0iLCJub3JtYWxpemVkTWVzc2FnZUlkIiwibG9nQ2hhdFRvb2wiLCJ0b29sTmFtZSIsInRvb2wiLCJsb2dDaGF0Q29tcGxldGUiLCJsb2dCdWlsZFN0YXJ0Iiwibm9ybWFsaXplZEpvYklkIiwibG9nQnVpbGRDb21waWxlIiwibG9nQnVpbGRVcGxvYWQiLCJsb2dCdWlsZFdhcm4iLCJ3YXJuIiwibG9nQnVpbGRDb21wbGV0ZSIsImxvZ0J1aWxkRGVidWciLCJsb2dTY2VuZVBsYW5uZXJEYiIsIm5vcm1hbGl6ZWRQbGFuSWQiLCJsb2dTY2VuZVBsYW5uZXJBZGIiLCJzY2VuZUlkIiwibm9ybWFsaXplZFNjZW5lSWQiLCJsb2dTY2VuZVBsYW5uZXJDb21wb25lbnQiLCJsb2dTY2VuZVBsYW5uZXJDb21wbGV0ZSIsImxvZ1NjZW5lUGxhbm5lckRlYnVnIiwibG9nQWdlbnRTZW5kIiwiYWdlbnROYW1lIiwicmVjaXBpZW50IiwibWVzc2FnZVR5cGUiLCJmb3JtYXR0ZWRNZXNzYWdlIiwiYWdlbnQiLCJhY3Rpb24iLCJsb2dBZ2VudFByb2Nlc3MiLCJwcm9jZXNzTmFtZSIsImxvZ0FuaW1hdGlvblN0YXJ0IiwiYW5pbWF0aW9uIiwic3RhZ2UiLCJsb2dBbmltYXRpb25WYWxpZGF0aW9uIiwibG9nQW5pbWF0aW9uQ29tcGxldGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/logger.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/nameGenerator.ts":
/*!****************************************!*\
  !*** ./src/lib/utils/nameGenerator.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateNameFromPrompt: () => (/* binding */ generateNameFromPrompt)\n/* harmony export */ });\n// src/lib/nameGenerator.ts\n/**\n * Utility functions for generating project names from user prompts\n */ /**\n * Cleans and formats a user prompt into a concise title\n * @param prompt The user's chat message\n * @returns A cleaned up title derived from the prompt\n */ function generateNameFromPrompt(prompt) {\n    if (!prompt) return \"New Project\";\n    // Remove common phrases that don't add value to the title\n    const cleaned = prompt.replace(/^(create|make|generate|build|develop|design|implement|add|show me|can you|please)/i, \"\").replace(/^(a|an|the)\\s+/i, \"\").replace(/\\s+(for me|for us|for our team|for our company|for my project)$/i, \"\").trim();\n    // Limit length and capitalize first letter of each word\n    const words = cleaned.split(\" \");\n    const limitedWords = words.slice(0, 7); // Take first 7 words max\n    const titled = limitedWords.map((word)=>word.charAt(0).toUpperCase() + word.slice(1)).join(\" \");\n    return titled || \"New Project\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3V0aWxzL25hbWVHZW5lcmF0b3IudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLDJCQUEyQjtBQUMzQjs7Q0FFQyxHQUVEOzs7O0NBSUMsR0FDTSxTQUFTQSx1QkFBdUJDLE1BQWM7SUFDbkQsSUFBSSxDQUFDQSxRQUFRLE9BQU87SUFFcEIsMERBQTBEO0lBQzFELE1BQU1DLFVBQVVELE9BQ2JFLE9BQU8sQ0FBQyxzRkFBc0YsSUFDOUZBLE9BQU8sQ0FBQyxtQkFBbUIsSUFDM0JBLE9BQU8sQ0FBQyxvRUFBb0UsSUFDNUVDLElBQUk7SUFFUCx3REFBd0Q7SUFDeEQsTUFBTUMsUUFBUUgsUUFBUUksS0FBSyxDQUFDO0lBQzVCLE1BQU1DLGVBQWVGLE1BQU1HLEtBQUssQ0FBQyxHQUFHLElBQUkseUJBQXlCO0lBRWpFLE1BQU1DLFNBQVNGLGFBQ1pHLEdBQUcsQ0FBQ0MsQ0FBQUEsT0FBUUEsS0FBS0MsTUFBTSxDQUFDLEdBQUdDLFdBQVcsS0FBS0YsS0FBS0gsS0FBSyxDQUFDLElBQ3RETSxJQUFJLENBQUM7SUFFUixPQUFPTCxVQUFVO0FBQ25CIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvbGliL3V0aWxzL25hbWVHZW5lcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2xpYi9uYW1lR2VuZXJhdG9yLnRzXG4vKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBnZW5lcmF0aW5nIHByb2plY3QgbmFtZXMgZnJvbSB1c2VyIHByb21wdHNcbiAqL1xuXG4vKipcbiAqIENsZWFucyBhbmQgZm9ybWF0cyBhIHVzZXIgcHJvbXB0IGludG8gYSBjb25jaXNlIHRpdGxlXG4gKiBAcGFyYW0gcHJvbXB0IFRoZSB1c2VyJ3MgY2hhdCBtZXNzYWdlXG4gKiBAcmV0dXJucyBBIGNsZWFuZWQgdXAgdGl0bGUgZGVyaXZlZCBmcm9tIHRoZSBwcm9tcHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlTmFtZUZyb21Qcm9tcHQocHJvbXB0OiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoIXByb21wdCkgcmV0dXJuIFwiTmV3IFByb2plY3RcIjtcbiAgXG4gIC8vIFJlbW92ZSBjb21tb24gcGhyYXNlcyB0aGF0IGRvbid0IGFkZCB2YWx1ZSB0byB0aGUgdGl0bGVcbiAgY29uc3QgY2xlYW5lZCA9IHByb21wdFxuICAgIC5yZXBsYWNlKC9eKGNyZWF0ZXxtYWtlfGdlbmVyYXRlfGJ1aWxkfGRldmVsb3B8ZGVzaWdufGltcGxlbWVudHxhZGR8c2hvdyBtZXxjYW4geW91fHBsZWFzZSkvaSwgXCJcIilcbiAgICAucmVwbGFjZSgvXihhfGFufHRoZSlcXHMrL2ksIFwiXCIpXG4gICAgLnJlcGxhY2UoL1xccysoZm9yIG1lfGZvciB1c3xmb3Igb3VyIHRlYW18Zm9yIG91ciBjb21wYW55fGZvciBteSBwcm9qZWN0KSQvaSwgXCJcIilcbiAgICAudHJpbSgpO1xuICBcbiAgLy8gTGltaXQgbGVuZ3RoIGFuZCBjYXBpdGFsaXplIGZpcnN0IGxldHRlciBvZiBlYWNoIHdvcmRcbiAgY29uc3Qgd29yZHMgPSBjbGVhbmVkLnNwbGl0KFwiIFwiKTtcbiAgY29uc3QgbGltaXRlZFdvcmRzID0gd29yZHMuc2xpY2UoMCwgNyk7IC8vIFRha2UgZmlyc3QgNyB3b3JkcyBtYXhcbiAgXG4gIGNvbnN0IHRpdGxlZCA9IGxpbWl0ZWRXb3Jkc1xuICAgIC5tYXAod29yZCA9PiB3b3JkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKSlcbiAgICAuam9pbihcIiBcIik7XG4gIFxuICByZXR1cm4gdGl0bGVkIHx8IFwiTmV3IFByb2plY3RcIjtcbn1cbiJdLCJuYW1lcyI6WyJnZW5lcmF0ZU5hbWVGcm9tUHJvbXB0IiwicHJvbXB0IiwiY2xlYW5lZCIsInJlcGxhY2UiLCJ0cmltIiwid29yZHMiLCJzcGxpdCIsImxpbWl0ZWRXb3JkcyIsInNsaWNlIiwidGl0bGVkIiwibWFwIiwid29yZCIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwiam9pbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/nameGenerator.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/r2-upload.ts":
/*!************************************!*\
  !*** ./src/lib/utils/r2-upload.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   uploadScreenshotToR2: () => (/* binding */ uploadScreenshotToR2),\n/* harmony export */   uploadWebAnalysisScreenshots: () => (/* binding */ uploadWebAnalysisScreenshots)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @aws-sdk/client-s3 */ \"@aws-sdk/client-s3\");\n/* harmony import */ var _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * Upload screenshot buffer to Cloudflare R2 storage\n */ async function uploadScreenshotToR2(buffer, fileName, projectId, userId) {\n    // Configure S3 client for Cloudflare R2\n    const s3Client = new _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__.S3Client({\n        region: 'auto',\n        endpoint: process.env.CLOUDFLARE_R2_ENDPOINT,\n        credentials: {\n            accessKeyId: process.env.CLOUDFLARE_R2_ACCESS_KEY_ID,\n            secretAccessKey: process.env.CLOUDFLARE_R2_SECRET_ACCESS_KEY\n        }\n    });\n    // Generate unique key for web analysis screenshots\n    const timestamp = Date.now();\n    const randomId = crypto.randomUUID().slice(0, 8);\n    const uniqueKey = `web-analysis/${projectId}/${timestamp}-${randomId}-${fileName}`;\n    // Upload screenshot to R2\n    const command = new _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__.PutObjectCommand({\n        Bucket: process.env.CLOUDFLARE_R2_BUCKET_NAME,\n        Key: uniqueKey,\n        Body: buffer,\n        ContentType: 'image/png',\n        Metadata: {\n            'type': 'web-analysis-screenshot',\n            'project-id': projectId,\n            'uploaded-by': userId || 'system',\n            'created-at': new Date().toISOString()\n        }\n    });\n    await s3Client.send(command);\n    // Construct public URL\n    const publicUrl = `${process.env.CLOUDFLARE_R2_PUBLIC_URL}/${uniqueKey}`;\n    console.log(` Screenshot uploaded to R2: ${fileName} (${buffer.length} bytes)`);\n    return publicUrl;\n}\n/**\n * Upload multiple screenshots from web analysis\n */ async function uploadWebAnalysisScreenshots(screenshots, projectId, userId) {\n    console.log(' Uploading web analysis screenshots to R2...');\n    const [desktopUrl, mobileUrl] = await Promise.all([\n        uploadScreenshotToR2(screenshots.desktop, 'desktop.png', projectId, userId),\n        uploadScreenshotToR2(screenshots.mobile, 'mobile.png', projectId, userId)\n    ]);\n    console.log(' All screenshots uploaded successfully');\n    return {\n        desktop: desktopUrl,\n        mobile: mobileUrl\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3V0aWxzL3IyLXVwbG9hZC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQWdFO0FBRWhFOztDQUVDLEdBQ00sZUFBZUUscUJBQ3BCQyxNQUFjLEVBQ2RDLFFBQWdCLEVBQ2hCQyxTQUFpQixFQUNqQkMsTUFBZTtJQUVmLHdDQUF3QztJQUN4QyxNQUFNQyxXQUFXLElBQUlQLHdEQUFRQSxDQUFDO1FBQzVCUSxRQUFRO1FBQ1JDLFVBQVVDLFFBQVFDLEdBQUcsQ0FBQ0Msc0JBQXNCO1FBQzVDQyxhQUFhO1lBQ1hDLGFBQWFKLFFBQVFDLEdBQUcsQ0FBQ0ksMkJBQTJCO1lBQ3BEQyxpQkFBaUJOLFFBQVFDLEdBQUcsQ0FBQ00sK0JBQStCO1FBQzlEO0lBQ0Y7SUFFQSxtREFBbUQ7SUFDbkQsTUFBTUMsWUFBWUMsS0FBS0MsR0FBRztJQUMxQixNQUFNQyxXQUFXQyxPQUFPQyxVQUFVLEdBQUdDLEtBQUssQ0FBQyxHQUFHO0lBQzlDLE1BQU1DLFlBQVksQ0FBQyxhQUFhLEVBQUVwQixVQUFVLENBQUMsRUFBRWEsVUFBVSxDQUFDLEVBQUVHLFNBQVMsQ0FBQyxFQUFFakIsVUFBVTtJQUVsRiwwQkFBMEI7SUFDMUIsTUFBTXNCLFVBQVUsSUFBSXpCLGdFQUFnQkEsQ0FBQztRQUNuQzBCLFFBQVFqQixRQUFRQyxHQUFHLENBQUNpQix5QkFBeUI7UUFDN0NDLEtBQUtKO1FBQ0xLLE1BQU0zQjtRQUNONEIsYUFBYTtRQUNiQyxVQUFVO1lBQ1IsUUFBUTtZQUNSLGNBQWMzQjtZQUNkLGVBQWVDLFVBQVU7WUFDekIsY0FBYyxJQUFJYSxPQUFPYyxXQUFXO1FBQ3RDO0lBQ0Y7SUFFQSxNQUFNMUIsU0FBUzJCLElBQUksQ0FBQ1I7SUFFcEIsdUJBQXVCO0lBQ3ZCLE1BQU1TLFlBQVksR0FBR3pCLFFBQVFDLEdBQUcsQ0FBQ3lCLHdCQUF3QixDQUFDLENBQUMsRUFBRVgsV0FBVztJQUV4RVksUUFBUUMsR0FBRyxDQUFDLENBQUMsOEJBQThCLEVBQUVsQyxTQUFTLEVBQUUsRUFBRUQsT0FBT29DLE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFFaEYsT0FBT0o7QUFDVDtBQUVBOztDQUVDLEdBQ00sZUFBZUssNkJBQ3BCQyxXQUFnRCxFQUNoRHBDLFNBQWlCLEVBQ2pCQyxNQUFlO0lBRWYrQixRQUFRQyxHQUFHLENBQUM7SUFFWixNQUFNLENBQUNJLFlBQVlDLFVBQVUsR0FBRyxNQUFNQyxRQUFRQyxHQUFHLENBQUM7UUFDaEQzQyxxQkFBcUJ1QyxZQUFZSyxPQUFPLEVBQUUsZUFBZXpDLFdBQVdDO1FBQ3BFSixxQkFBcUJ1QyxZQUFZTSxNQUFNLEVBQUUsY0FBYzFDLFdBQVdDO0tBQ25FO0lBRUQrQixRQUFRQyxHQUFHLENBQUM7SUFFWixPQUFPO1FBQ0xRLFNBQVNKO1FBQ1RLLFFBQVFKO0lBQ1Y7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL2xpYi91dGlscy9yMi11cGxvYWQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUzNDbGllbnQsIFB1dE9iamVjdENvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xuXG4vKipcbiAqIFVwbG9hZCBzY3JlZW5zaG90IGJ1ZmZlciB0byBDbG91ZGZsYXJlIFIyIHN0b3JhZ2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwbG9hZFNjcmVlbnNob3RUb1IyKFxuICBidWZmZXI6IEJ1ZmZlcixcbiAgZmlsZU5hbWU6IHN0cmluZyxcbiAgcHJvamVjdElkOiBzdHJpbmcsXG4gIHVzZXJJZD86IHN0cmluZ1xuKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgLy8gQ29uZmlndXJlIFMzIGNsaWVudCBmb3IgQ2xvdWRmbGFyZSBSMlxuICBjb25zdCBzM0NsaWVudCA9IG5ldyBTM0NsaWVudCh7XG4gICAgcmVnaW9uOiAnYXV0bycsXG4gICAgZW5kcG9pbnQ6IHByb2Nlc3MuZW52LkNMT1VERkxBUkVfUjJfRU5EUE9JTlQsXG4gICAgY3JlZGVudGlhbHM6IHtcbiAgICAgIGFjY2Vzc0tleUlkOiBwcm9jZXNzLmVudi5DTE9VREZMQVJFX1IyX0FDQ0VTU19LRVlfSUQhLFxuICAgICAgc2VjcmV0QWNjZXNzS2V5OiBwcm9jZXNzLmVudi5DTE9VREZMQVJFX1IyX1NFQ1JFVF9BQ0NFU1NfS0VZISxcbiAgICB9LFxuICB9KTtcblxuICAvLyBHZW5lcmF0ZSB1bmlxdWUga2V5IGZvciB3ZWIgYW5hbHlzaXMgc2NyZWVuc2hvdHNcbiAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgY29uc3QgcmFuZG9tSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpLnNsaWNlKDAsIDgpO1xuICBjb25zdCB1bmlxdWVLZXkgPSBgd2ViLWFuYWx5c2lzLyR7cHJvamVjdElkfS8ke3RpbWVzdGFtcH0tJHtyYW5kb21JZH0tJHtmaWxlTmFtZX1gO1xuXG4gIC8vIFVwbG9hZCBzY3JlZW5zaG90IHRvIFIyXG4gIGNvbnN0IGNvbW1hbmQgPSBuZXcgUHV0T2JqZWN0Q29tbWFuZCh7XG4gICAgQnVja2V0OiBwcm9jZXNzLmVudi5DTE9VREZMQVJFX1IyX0JVQ0tFVF9OQU1FISxcbiAgICBLZXk6IHVuaXF1ZUtleSxcbiAgICBCb2R5OiBidWZmZXIsXG4gICAgQ29udGVudFR5cGU6ICdpbWFnZS9wbmcnLFxuICAgIE1ldGFkYXRhOiB7XG4gICAgICAndHlwZSc6ICd3ZWItYW5hbHlzaXMtc2NyZWVuc2hvdCcsXG4gICAgICAncHJvamVjdC1pZCc6IHByb2plY3RJZCxcbiAgICAgICd1cGxvYWRlZC1ieSc6IHVzZXJJZCB8fCAnc3lzdGVtJyxcbiAgICAgICdjcmVhdGVkLWF0JzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3YWl0IHMzQ2xpZW50LnNlbmQoY29tbWFuZCk7XG5cbiAgLy8gQ29uc3RydWN0IHB1YmxpYyBVUkxcbiAgY29uc3QgcHVibGljVXJsID0gYCR7cHJvY2Vzcy5lbnYuQ0xPVURGTEFSRV9SMl9QVUJMSUNfVVJMfS8ke3VuaXF1ZUtleX1gO1xuXG4gIGNvbnNvbGUubG9nKGDwn5O4IFNjcmVlbnNob3QgdXBsb2FkZWQgdG8gUjI6ICR7ZmlsZU5hbWV9ICgke2J1ZmZlci5sZW5ndGh9IGJ5dGVzKWApO1xuICBcbiAgcmV0dXJuIHB1YmxpY1VybDtcbn1cblxuLyoqXG4gKiBVcGxvYWQgbXVsdGlwbGUgc2NyZWVuc2hvdHMgZnJvbSB3ZWIgYW5hbHlzaXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwbG9hZFdlYkFuYWx5c2lzU2NyZWVuc2hvdHMoXG4gIHNjcmVlbnNob3RzOiB7IGRlc2t0b3A6IEJ1ZmZlcjsgbW9iaWxlOiBCdWZmZXIgfSxcbiAgcHJvamVjdElkOiBzdHJpbmcsXG4gIHVzZXJJZD86IHN0cmluZ1xuKTogUHJvbWlzZTx7IGRlc2t0b3A6IHN0cmluZzsgbW9iaWxlOiBzdHJpbmcgfT4ge1xuICBjb25zb2xlLmxvZygn8J+TpCBVcGxvYWRpbmcgd2ViIGFuYWx5c2lzIHNjcmVlbnNob3RzIHRvIFIyLi4uJyk7XG4gIFxuICBjb25zdCBbZGVza3RvcFVybCwgbW9iaWxlVXJsXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICB1cGxvYWRTY3JlZW5zaG90VG9SMihzY3JlZW5zaG90cy5kZXNrdG9wLCAnZGVza3RvcC5wbmcnLCBwcm9qZWN0SWQsIHVzZXJJZCksXG4gICAgdXBsb2FkU2NyZWVuc2hvdFRvUjIoc2NyZWVuc2hvdHMubW9iaWxlLCAnbW9iaWxlLnBuZycsIHByb2plY3RJZCwgdXNlcklkKVxuICBdKTtcblxuICBjb25zb2xlLmxvZygn4pyFIEFsbCBzY3JlZW5zaG90cyB1cGxvYWRlZCBzdWNjZXNzZnVsbHknKTtcbiAgXG4gIHJldHVybiB7XG4gICAgZGVza3RvcDogZGVza3RvcFVybCxcbiAgICBtb2JpbGU6IG1vYmlsZVVybFxuICB9O1xufSJdLCJuYW1lcyI6WyJTM0NsaWVudCIsIlB1dE9iamVjdENvbW1hbmQiLCJ1cGxvYWRTY3JlZW5zaG90VG9SMiIsImJ1ZmZlciIsImZpbGVOYW1lIiwicHJvamVjdElkIiwidXNlcklkIiwiczNDbGllbnQiLCJyZWdpb24iLCJlbmRwb2ludCIsInByb2Nlc3MiLCJlbnYiLCJDTE9VREZMQVJFX1IyX0VORFBPSU5UIiwiY3JlZGVudGlhbHMiLCJhY2Nlc3NLZXlJZCIsIkNMT1VERkxBUkVfUjJfQUNDRVNTX0tFWV9JRCIsInNlY3JldEFjY2Vzc0tleSIsIkNMT1VERkxBUkVfUjJfU0VDUkVUX0FDQ0VTU19LRVkiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwicmFuZG9tSWQiLCJjcnlwdG8iLCJyYW5kb21VVUlEIiwic2xpY2UiLCJ1bmlxdWVLZXkiLCJjb21tYW5kIiwiQnVja2V0IiwiQ0xPVURGTEFSRV9SMl9CVUNLRVRfTkFNRSIsIktleSIsIkJvZHkiLCJDb250ZW50VHlwZSIsIk1ldGFkYXRhIiwidG9JU09TdHJpbmciLCJzZW5kIiwicHVibGljVXJsIiwiQ0xPVURGTEFSRV9SMl9QVUJMSUNfVVJMIiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsInVwbG9hZFdlYkFuYWx5c2lzU2NyZWVuc2hvdHMiLCJzY3JlZW5zaG90cyIsImRlc2t0b3BVcmwiLCJtb2JpbGVVcmwiLCJQcm9taXNlIiwiYWxsIiwiZGVza3RvcCIsIm1vYmlsZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/r2-upload.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/url-detection.ts":
/*!****************************************!*\
  !*** ./src/lib/utils/url-detection.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   containsUrl: () => (/* binding */ containsUrl),\n/* harmony export */   extractFirstValidUrl: () => (/* binding */ extractFirstValidUrl),\n/* harmony export */   extractUrls: () => (/* binding */ extractUrls),\n/* harmony export */   getDomain: () => (/* binding */ getDomain),\n/* harmony export */   isValidWebUrl: () => (/* binding */ isValidWebUrl),\n/* harmony export */   normalizeUrl: () => (/* binding */ normalizeUrl),\n/* harmony export */   testUrlDetection: () => (/* binding */ testUrlDetection)\n/* harmony export */ });\n/**\n * Utility functions for detecting and validating URLs in text\n */ /**\n * Extract URLs from text using regex\n */ function extractUrls(text) {\n    const urlRegex = /https?:\\/\\/[^\\s<>\"{}|\\\\^`[\\]]+/gi;\n    const matches = text.match(urlRegex) || [];\n    // Clean up URLs (remove trailing punctuation)\n    return matches.map((url)=>{\n        return url.replace(/[.,;!?)+]+$/, '');\n    });\n}\n/**\n * Check if a URL is valid and web-accessible\n */ function isValidWebUrl(url) {\n    try {\n        const parsed = new URL(url);\n        return [\n            'http:',\n            'https:'\n        ].includes(parsed.protocol);\n    } catch  {\n        return false;\n    }\n}\n/**\n * Extract the first valid URL from text\n */ function extractFirstValidUrl(text) {\n    const urls = extractUrls(text);\n    const validUrls = urls.filter(isValidWebUrl);\n    return validUrls.length > 0 ? validUrls[0] : null;\n}\n/**\n * Check if text contains any URLs\n */ function containsUrl(text) {\n    return extractUrls(text).length > 0;\n}\n/**\n * Get domain from URL\n */ function getDomain(url) {\n    try {\n        const parsed = new URL(url);\n        return parsed.hostname;\n    } catch  {\n        return null;\n    }\n}\n/**\n * Normalize URL (add https if missing)\n */ function normalizeUrl(url) {\n    if (!url.startsWith('http://') && !url.startsWith('https://')) {\n        return `https://${url}`;\n    }\n    return url;\n}\n/**\n * Test function to verify URL detection works correctly\n */ function testUrlDetection() {\n    const testCases = [\n        \"Check out https://stripe.com for payments\",\n        \"Our site is https://figma.com.\",\n        \"Visit http://example.com and https://google.com\",\n        \"No URLs here!\",\n        \"Multiple: https://a.com, https://b.com, and https://c.com\",\n        \"Create a video for our company: https://notion.so/about\",\n        \"Check this out: https://github.com/microsoft/playwright!\",\n        \"Pricing at https://vercel.com/pricing?utm_source=example\",\n        \"Mixed: Visit our site www.example.com or https://example.com/contact\"\n    ];\n    console.log(' Testing URL Detection:');\n    testCases.forEach((text, index)=>{\n        const urls = extractUrls(text);\n        const validUrls = urls.filter(isValidWebUrl);\n        const firstValid = extractFirstValidUrl(text);\n        console.log(`\\n${index + 1}. \"${text}\"`);\n        console.log(`   Found URLs: ${JSON.stringify(urls)}`);\n        console.log(`   Valid URLs: ${JSON.stringify(validUrls)}`);\n        console.log(`   First Valid: ${firstValid}`);\n        console.log(`   Contains URL: ${containsUrl(text)}`);\n    });\n    // Test domain extraction\n    console.log('\\n Testing Domain Extraction:');\n    const domainTests = [\n        'https://stripe.com/pricing',\n        'http://www.example.com',\n        'https://subdomain.example.co.uk/path',\n        'invalid-url'\n    ];\n    domainTests.forEach((url)=>{\n        const domain = getDomain(url);\n        console.log(`   ${url}  ${domain}`);\n    });\n    // Test URL normalization\n    console.log('\\n Testing URL Normalization:');\n    const normalizeTests = [\n        'stripe.com',\n        'https://figma.com',\n        'http://example.com',\n        'www.github.com'\n    ];\n    normalizeTests.forEach((url)=>{\n        const normalized = normalizeUrl(url);\n        console.log(`   ${url}  ${normalized}`);\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDckIsQ0FBQUE7UUFDckIsTUFBTTZCLGFBQWFkLGFBQWFmO1FBQ2hDbUIsUUFBUUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFcEIsSUFBSSxHQUFHLEVBQUU2QixZQUFZO0lBQ3pDO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9saWIvdXRpbHMvdXJsLWRldGVjdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBkZXRlY3RpbmcgYW5kIHZhbGlkYXRpbmcgVVJMcyBpbiB0ZXh0XG4gKi9cblxuLyoqXG4gKiBFeHRyYWN0IFVSTHMgZnJvbSB0ZXh0IHVzaW5nIHJlZ2V4XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0VXJscyh0ZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHVybFJlZ2V4ID0gL2h0dHBzPzpcXC9cXC9bXlxcczw+XCJ7fXxcXFxcXmBbXFxdXSsvZ2k7XG4gIGNvbnN0IG1hdGNoZXMgPSB0ZXh0Lm1hdGNoKHVybFJlZ2V4KSB8fCBbXTtcbiAgXG4gIC8vIENsZWFuIHVwIFVSTHMgKHJlbW92ZSB0cmFpbGluZyBwdW5jdHVhdGlvbilcbiAgcmV0dXJuIG1hdGNoZXMubWFwKHVybCA9PiB7XG4gICAgcmV0dXJuIHVybC5yZXBsYWNlKC9bLiw7IT8pK10rJC8sICcnKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBVUkwgaXMgdmFsaWQgYW5kIHdlYi1hY2Nlc3NpYmxlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkV2ViVXJsKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBbJ2h0dHA6JywgJ2h0dHBzOiddLmluY2x1ZGVzKHBhcnNlZC5wcm90b2NvbCk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIEV4dHJhY3QgdGhlIGZpcnN0IHZhbGlkIFVSTCBmcm9tIHRleHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RGaXJzdFZhbGlkVXJsKHRleHQ6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCB1cmxzID0gZXh0cmFjdFVybHModGV4dCk7XG4gIGNvbnN0IHZhbGlkVXJscyA9IHVybHMuZmlsdGVyKGlzVmFsaWRXZWJVcmwpO1xuICByZXR1cm4gdmFsaWRVcmxzLmxlbmd0aCA+IDAgPyB2YWxpZFVybHNbMF0gOiBudWxsO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHRleHQgY29udGFpbnMgYW55IFVSTHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnRhaW5zVXJsKHRleHQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gZXh0cmFjdFVybHModGV4dCkubGVuZ3RoID4gMDtcbn1cblxuLyoqXG4gKiBHZXQgZG9tYWluIGZyb20gVVJMXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREb21haW4odXJsOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWQgPSBuZXcgVVJMKHVybCk7XG4gICAgcmV0dXJuIHBhcnNlZC5ob3N0bmFtZTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgVVJMIChhZGQgaHR0cHMgaWYgbWlzc2luZylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVVybCh1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghdXJsLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSAmJiAhdXJsLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcbiAgICByZXR1cm4gYGh0dHBzOi8vJHt1cmx9YDtcbiAgfVxuICByZXR1cm4gdXJsO1xufVxuXG4vKipcbiAqIFRlc3QgZnVuY3Rpb24gdG8gdmVyaWZ5IFVSTCBkZXRlY3Rpb24gd29ya3MgY29ycmVjdGx5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0ZXN0VXJsRGV0ZWN0aW9uKCk6IHZvaWQge1xuICBjb25zdCB0ZXN0Q2FzZXMgPSBbXG4gICAgXCJDaGVjayBvdXQgaHR0cHM6Ly9zdHJpcGUuY29tIGZvciBwYXltZW50c1wiLFxuICAgIFwiT3VyIHNpdGUgaXMgaHR0cHM6Ly9maWdtYS5jb20uXCIsXG4gICAgXCJWaXNpdCBodHRwOi8vZXhhbXBsZS5jb20gYW5kIGh0dHBzOi8vZ29vZ2xlLmNvbVwiLFxuICAgIFwiTm8gVVJMcyBoZXJlIVwiLFxuICAgIFwiTXVsdGlwbGU6IGh0dHBzOi8vYS5jb20sIGh0dHBzOi8vYi5jb20sIGFuZCBodHRwczovL2MuY29tXCIsXG4gICAgXCJDcmVhdGUgYSB2aWRlbyBmb3Igb3VyIGNvbXBhbnk6IGh0dHBzOi8vbm90aW9uLnNvL2Fib3V0XCIsXG4gICAgXCJDaGVjayB0aGlzIG91dDogaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9wbGF5d3JpZ2h0IVwiLFxuICAgIFwiUHJpY2luZyBhdCBodHRwczovL3ZlcmNlbC5jb20vcHJpY2luZz91dG1fc291cmNlPWV4YW1wbGVcIixcbiAgICBcIk1peGVkOiBWaXNpdCBvdXIgc2l0ZSB3d3cuZXhhbXBsZS5jb20gb3IgaHR0cHM6Ly9leGFtcGxlLmNvbS9jb250YWN0XCJcbiAgXTtcbiAgXG4gIGNvbnNvbGUubG9nKCfwn6eqIFRlc3RpbmcgVVJMIERldGVjdGlvbjonKTtcbiAgdGVzdENhc2VzLmZvckVhY2goKHRleHQsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgdXJscyA9IGV4dHJhY3RVcmxzKHRleHQpO1xuICAgIGNvbnN0IHZhbGlkVXJscyA9IHVybHMuZmlsdGVyKGlzVmFsaWRXZWJVcmwpO1xuICAgIGNvbnN0IGZpcnN0VmFsaWQgPSBleHRyYWN0Rmlyc3RWYWxpZFVybCh0ZXh0KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgXFxuJHtpbmRleCArIDF9LiBcIiR7dGV4dH1cImApO1xuICAgIGNvbnNvbGUubG9nKGAgICBGb3VuZCBVUkxzOiAke0pTT04uc3RyaW5naWZ5KHVybHMpfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICBWYWxpZCBVUkxzOiAke0pTT04uc3RyaW5naWZ5KHZhbGlkVXJscyl9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIEZpcnN0IFZhbGlkOiAke2ZpcnN0VmFsaWR9YCk7XG4gICAgY29uc29sZS5sb2coYCAgIENvbnRhaW5zIFVSTDogJHtjb250YWluc1VybCh0ZXh0KX1gKTtcbiAgfSk7XG4gIFxuICAvLyBUZXN0IGRvbWFpbiBleHRyYWN0aW9uXG4gIGNvbnNvbGUubG9nKCdcXG7wn4yQIFRlc3RpbmcgRG9tYWluIEV4dHJhY3Rpb246Jyk7XG4gIGNvbnN0IGRvbWFpblRlc3RzID0gW1xuICAgICdodHRwczovL3N0cmlwZS5jb20vcHJpY2luZycsXG4gICAgJ2h0dHA6Ly93d3cuZXhhbXBsZS5jb20nLFxuICAgICdodHRwczovL3N1YmRvbWFpbi5leGFtcGxlLmNvLnVrL3BhdGgnLFxuICAgICdpbnZhbGlkLXVybCdcbiAgXTtcbiAgXG4gIGRvbWFpblRlc3RzLmZvckVhY2godXJsID0+IHtcbiAgICBjb25zdCBkb21haW4gPSBnZXREb21haW4odXJsKTtcbiAgICBjb25zb2xlLmxvZyhgICAgJHt1cmx9IOKGkiAke2RvbWFpbn1gKTtcbiAgfSk7XG4gIFxuICAvLyBUZXN0IFVSTCBub3JtYWxpemF0aW9uXG4gIGNvbnNvbGUubG9nKCdcXG7wn5SnIFRlc3RpbmcgVVJMIE5vcm1hbGl6YXRpb246Jyk7XG4gIGNvbnN0IG5vcm1hbGl6ZVRlc3RzID0gW1xuICAgICdzdHJpcGUuY29tJyxcbiAgICAnaHR0cHM6Ly9maWdtYS5jb20nLFxuICAgICdodHRwOi8vZXhhbXBsZS5jb20nLFxuICAgICd3d3cuZ2l0aHViLmNvbSdcbiAgXTtcbiAgXG4gIG5vcm1hbGl6ZVRlc3RzLmZvckVhY2godXJsID0+IHtcbiAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplVXJsKHVybCk7XG4gICAgY29uc29sZS5sb2coYCAgICR7dXJsfSDihpIgJHtub3JtYWxpemVkfWApO1xuICB9KTtcbn0iXSwibmFtZXMiOlsiZXh0cmFjdFVybHMiLCJ0ZXh0IiwidXJsUmVnZXgiLCJtYXRjaGVzIiwibWF0Y2giLCJtYXAiLCJ1cmwiLCJyZXBsYWNlIiwiaXNWYWxpZFdlYlVybCIsInBhcnNlZCIsIlVSTCIsImluY2x1ZGVzIiwicHJvdG9jb2wiLCJleHRyYWN0Rmlyc3RWYWxpZFVybCIsInVybHMiLCJ2YWxpZFVybHMiLCJmaWx0ZXIiLCJsZW5ndGgiLCJjb250YWluc1VybCIsImdldERvbWFpbiIsImhvc3RuYW1lIiwibm9ybWFsaXplVXJsIiwic3RhcnRzV2l0aCIsInRlc3RVcmxEZXRlY3Rpb24iLCJ0ZXN0Q2FzZXMiLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsImluZGV4IiwiZmlyc3RWYWxpZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJkb21haW5UZXN0cyIsImRvbWFpbiIsIm5vcm1hbGl6ZVRlc3RzIiwibm9ybWFsaXplZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/url-detection.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils/url.ts":
/*!******************************!*\
  !*** ./src/lib/utils/url.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getApiUrl: () => (/* binding */ getApiUrl),\n/* harmony export */   getAppUrl: () => (/* binding */ getAppUrl),\n/* harmony export */   getBazaarUrl: () => (/* binding */ getBazaarUrl),\n/* harmony export */   getShareUrl: () => (/* binding */ getShareUrl)\n/* harmony export */ });\n/* harmony import */ var _config_site__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/config/site */ \"(rsc)/./src/config/site.ts\");\n\n/**\n * Environment-aware URL utility functions\n */ function getAppUrl() {\n    return (0,_config_site__WEBPACK_IMPORTED_MODULE_0__.getBaseUrl)();\n}\nfunction getShareUrl(shareId) {\n    return `${getAppUrl()}/share/${shareId}`;\n}\nfunction getApiUrl() {\n    const appUrl = getAppUrl();\n    return `${appUrl}/api`;\n}\nfunction getBazaarUrl(path = '') {\n    return `${getAppUrl()}${path}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3V0aWxzL3VybC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEwQztBQUUxQzs7Q0FFQyxHQUNNLFNBQVNDO0lBQ2QsT0FBT0Qsd0RBQVVBO0FBQ25CO0FBRU8sU0FBU0UsWUFBWUMsT0FBZTtJQUN6QyxPQUFPLEdBQUdGLFlBQVksT0FBTyxFQUFFRSxTQUFTO0FBQzFDO0FBRU8sU0FBU0M7SUFDZCxNQUFNQyxTQUFTSjtJQUNmLE9BQU8sR0FBR0ksT0FBTyxJQUFJLENBQUM7QUFDeEI7QUFFTyxTQUFTQyxhQUFhQyxPQUFPLEVBQUU7SUFDcEMsT0FBTyxHQUFHTixjQUFjTSxNQUFNO0FBQ2hDIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvbGliL3V0aWxzL3VybC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRCYXNlVXJsIH0gZnJvbSBcIn4vY29uZmlnL3NpdGVcIlxuXG4vKipcbiAqIEVudmlyb25tZW50LWF3YXJlIFVSTCB1dGlsaXR5IGZ1bmN0aW9uc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBwVXJsKCk6IHN0cmluZyB7XG4gIHJldHVybiBnZXRCYXNlVXJsKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTaGFyZVVybChzaGFyZUlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7Z2V0QXBwVXJsKCl9L3NoYXJlLyR7c2hhcmVJZH1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBpVXJsKCk6IHN0cmluZyB7XG4gIGNvbnN0IGFwcFVybCA9IGdldEFwcFVybCgpO1xuICByZXR1cm4gYCR7YXBwVXJsfS9hcGlgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QmF6YWFyVXJsKHBhdGggPSAnJyk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtnZXRBcHBVcmwoKX0ke3BhdGh9YDtcbn0iXSwibmFtZXMiOlsiZ2V0QmFzZVVybCIsImdldEFwcFVybCIsImdldFNoYXJlVXJsIiwic2hhcmVJZCIsImdldEFwaVVybCIsImFwcFVybCIsImdldEJhemFhclVybCIsInBhdGgiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils/url.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/root.ts":
/*!********************************!*\
  !*** ./src/server/api/root.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   appRouter: () => (/* binding */ appRouter),\n/* harmony export */   createCaller: () => (/* binding */ createCaller)\n/* harmony export */ });\n/* harmony import */ var _server_api_routers_project__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/routers/project */ \"(rsc)/./src/server/api/routers/project.ts\");\n/* harmony import */ var _server_api_routers_chat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/server/api/routers/chat */ \"(rsc)/./src/server/api/routers/chat.ts\");\n/* harmony import */ var _server_api_routers_render__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/server/api/routers/render */ \"(rsc)/./src/server/api/routers/render.ts\");\n/* harmony import */ var _server_api_routers_generation_universal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/server/api/routers/generation.universal */ \"(rsc)/./src/server/api/routers/generation.universal.ts\");\n/* harmony import */ var _server_api_routers_voice__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/server/api/routers/voice */ \"(rsc)/./src/server/api/routers/voice.ts\");\n/* harmony import */ var _server_api_routers_feedback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ~/server/api/routers/feedback */ \"(rsc)/./src/server/api/routers/feedback.ts\");\n/* harmony import */ var _server_api_routers_emailSubscriber__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ~/server/api/routers/emailSubscriber */ \"(rsc)/./src/server/api/routers/emailSubscriber.ts\");\n/* harmony import */ var _server_api_routers_scenes__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ~/server/api/routers/scenes */ \"(rsc)/./src/server/api/routers/scenes.ts\");\n/* harmony import */ var _server_api_routers_share__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ~/server/api/routers/share */ \"(rsc)/./src/server/api/routers/share.ts\");\n/* harmony import */ var _server_api_routers_admin__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ~/server/api/routers/admin */ \"(rsc)/./src/server/api/routers/admin.ts\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _server_init__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ~/server/init */ \"(rsc)/./src/server/init.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_routers_project__WEBPACK_IMPORTED_MODULE_0__, _server_api_routers_chat__WEBPACK_IMPORTED_MODULE_1__, _server_api_routers_render__WEBPACK_IMPORTED_MODULE_2__, _server_api_routers_generation_universal__WEBPACK_IMPORTED_MODULE_3__, _server_api_routers_voice__WEBPACK_IMPORTED_MODULE_4__, _server_api_routers_feedback__WEBPACK_IMPORTED_MODULE_5__, _server_api_routers_emailSubscriber__WEBPACK_IMPORTED_MODULE_6__, _server_api_routers_scenes__WEBPACK_IMPORTED_MODULE_7__, _server_api_routers_share__WEBPACK_IMPORTED_MODULE_8__, _server_api_routers_admin__WEBPACK_IMPORTED_MODULE_9__, _server_api_trpc__WEBPACK_IMPORTED_MODULE_10__, _server_init__WEBPACK_IMPORTED_MODULE_11__]);\n([_server_api_routers_project__WEBPACK_IMPORTED_MODULE_0__, _server_api_routers_chat__WEBPACK_IMPORTED_MODULE_1__, _server_api_routers_render__WEBPACK_IMPORTED_MODULE_2__, _server_api_routers_generation_universal__WEBPACK_IMPORTED_MODULE_3__, _server_api_routers_voice__WEBPACK_IMPORTED_MODULE_4__, _server_api_routers_feedback__WEBPACK_IMPORTED_MODULE_5__, _server_api_routers_emailSubscriber__WEBPACK_IMPORTED_MODULE_6__, _server_api_routers_scenes__WEBPACK_IMPORTED_MODULE_7__, _server_api_routers_share__WEBPACK_IMPORTED_MODULE_8__, _server_api_routers_admin__WEBPACK_IMPORTED_MODULE_9__, _server_api_trpc__WEBPACK_IMPORTED_MODULE_10__, _server_init__WEBPACK_IMPORTED_MODULE_11__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/api/root.ts\n\n\n\n\n\n\n\n\n\n\n\n// Import server initialization to start background processes\n\n/**\n * This is the primary router for your server.\n *\n * All routers added in /api/routers should be manually added here.\n */ const appRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_10__.createTRPCRouter)({\n    project: _server_api_routers_project__WEBPACK_IMPORTED_MODULE_0__.projectRouter,\n    chat: _server_api_routers_chat__WEBPACK_IMPORTED_MODULE_1__.chatRouter,\n    render: _server_api_routers_render__WEBPACK_IMPORTED_MODULE_2__.renderRouter,\n    generation: _server_api_routers_generation_universal__WEBPACK_IMPORTED_MODULE_3__.generationUniversalRouter,\n    voice: _server_api_routers_voice__WEBPACK_IMPORTED_MODULE_4__.voiceRouter,\n    feedback: _server_api_routers_feedback__WEBPACK_IMPORTED_MODULE_5__.feedbackRouter,\n    emailSubscriber: _server_api_routers_emailSubscriber__WEBPACK_IMPORTED_MODULE_6__.emailSubscriberRouter,\n    scenes: _server_api_routers_scenes__WEBPACK_IMPORTED_MODULE_7__.scenesRouter,\n    share: _server_api_routers_share__WEBPACK_IMPORTED_MODULE_8__.shareRouter,\n    admin: _server_api_routers_admin__WEBPACK_IMPORTED_MODULE_9__.adminRouter\n});\n/**\n * Create a server-side caller for the tRPC API.\n * @example\n * const trpc = createCaller(createContext);\n * const res = await trpc.post.all();\n *       ^? Post[]\n */ const createCaller = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_10__.createCallerFactory)(appRouter);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb290LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEseUJBQXlCO0FBQ29DO0FBQ047QUFDSTtBQUMyQjtBQUM3QjtBQUNNO0FBQ2M7QUFDbEI7QUFDRjtBQUNBO0FBQ2lCO0FBQzFFLDZEQUE2RDtBQUN0QztBQUV2Qjs7OztDQUlDLEdBQ00sTUFBTVksWUFBWUQsbUVBQWdCQSxDQUFDO0lBQ3hDRSxTQUFTYixzRUFBYUE7SUFDdEJjLE1BQU1iLGdFQUFVQTtJQUNoQmMsUUFBUWIsb0VBQVlBO0lBQ3BCYyxZQUFZYiwrRkFBeUJBO0lBQ3JDYyxPQUFPYixrRUFBV0E7SUFDbEJjLFVBQVViLHdFQUFjQTtJQUN4QmMsaUJBQWlCYixzRkFBcUJBO0lBQ3RDYyxRQUFRYixvRUFBWUE7SUFDcEJjLE9BQU9iLGtFQUFXQTtJQUNsQmMsT0FBT2Isa0VBQVdBO0FBQ3BCLEdBQUc7QUFLSDs7Ozs7O0NBTUMsR0FDTSxNQUFNYyxlQUFlYixzRUFBbUJBLENBQUNFLFdBQVciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3Jvb3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9hcGkvcm9vdC50c1xuaW1wb3J0IHsgcHJvamVjdFJvdXRlciB9IGZyb20gXCJ+L3NlcnZlci9hcGkvcm91dGVycy9wcm9qZWN0XCI7XG5pbXBvcnQgeyBjaGF0Um91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS9yb3V0ZXJzL2NoYXRcIjtcbmltcG9ydCB7IHJlbmRlclJvdXRlciB9IGZyb20gXCJ+L3NlcnZlci9hcGkvcm91dGVycy9yZW5kZXJcIjtcbmltcG9ydCB7IGdlbmVyYXRpb25Vbml2ZXJzYWxSb3V0ZXIgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3JvdXRlcnMvZ2VuZXJhdGlvbi51bml2ZXJzYWxcIjtcbmltcG9ydCB7IHZvaWNlUm91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS9yb3V0ZXJzL3ZvaWNlXCI7XG5pbXBvcnQgeyBmZWVkYmFja1JvdXRlciB9IGZyb20gXCJ+L3NlcnZlci9hcGkvcm91dGVycy9mZWVkYmFja1wiO1xuaW1wb3J0IHsgZW1haWxTdWJzY3JpYmVyUm91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS9yb3V0ZXJzL2VtYWlsU3Vic2NyaWJlclwiO1xuaW1wb3J0IHsgc2NlbmVzUm91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS9yb3V0ZXJzL3NjZW5lc1wiO1xuaW1wb3J0IHsgc2hhcmVSb3V0ZXIgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3JvdXRlcnMvc2hhcmVcIjtcbmltcG9ydCB7IGFkbWluUm91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS9yb3V0ZXJzL2FkbWluXCI7XG5pbXBvcnQgeyBjcmVhdGVDYWxsZXJGYWN0b3J5LCBjcmVhdGVUUlBDUm91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS90cnBjXCI7XG4vLyBJbXBvcnQgc2VydmVyIGluaXRpYWxpemF0aW9uIHRvIHN0YXJ0IGJhY2tncm91bmQgcHJvY2Vzc2VzXG5pbXBvcnQgXCJ+L3NlcnZlci9pbml0XCI7XG5cbi8qKlxuICogVGhpcyBpcyB0aGUgcHJpbWFyeSByb3V0ZXIgZm9yIHlvdXIgc2VydmVyLlxuICpcbiAqIEFsbCByb3V0ZXJzIGFkZGVkIGluIC9hcGkvcm91dGVycyBzaG91bGQgYmUgbWFudWFsbHkgYWRkZWQgaGVyZS5cbiAqL1xuZXhwb3J0IGNvbnN0IGFwcFJvdXRlciA9IGNyZWF0ZVRSUENSb3V0ZXIoe1xuICBwcm9qZWN0OiBwcm9qZWN0Um91dGVyLFxuICBjaGF0OiBjaGF0Um91dGVyLFxuICByZW5kZXI6IHJlbmRlclJvdXRlcixcbiAgZ2VuZXJhdGlvbjogZ2VuZXJhdGlvblVuaXZlcnNhbFJvdXRlcixcbiAgdm9pY2U6IHZvaWNlUm91dGVyLFxuICBmZWVkYmFjazogZmVlZGJhY2tSb3V0ZXIsXG4gIGVtYWlsU3Vic2NyaWJlcjogZW1haWxTdWJzY3JpYmVyUm91dGVyLFxuICBzY2VuZXM6IHNjZW5lc1JvdXRlcixcbiAgc2hhcmU6IHNoYXJlUm91dGVyLFxuICBhZG1pbjogYWRtaW5Sb3V0ZXIsXG59KTtcblxuLy8gZXhwb3J0IHR5cGUgZGVmaW5pdGlvbiBvZiBBUElcbmV4cG9ydCB0eXBlIEFwcFJvdXRlciA9IHR5cGVvZiBhcHBSb3V0ZXI7XG5cbi8qKlxuICogQ3JlYXRlIGEgc2VydmVyLXNpZGUgY2FsbGVyIGZvciB0aGUgdFJQQyBBUEkuXG4gKiBAZXhhbXBsZVxuICogY29uc3QgdHJwYyA9IGNyZWF0ZUNhbGxlcihjcmVhdGVDb250ZXh0KTtcbiAqIGNvbnN0IHJlcyA9IGF3YWl0IHRycGMucG9zdC5hbGwoKTtcbiAqICAgICAgIF4/IFBvc3RbXVxuICovXG5leHBvcnQgY29uc3QgY3JlYXRlQ2FsbGVyID0gY3JlYXRlQ2FsbGVyRmFjdG9yeShhcHBSb3V0ZXIpO1xuIl0sIm5hbWVzIjpbInByb2plY3RSb3V0ZXIiLCJjaGF0Um91dGVyIiwicmVuZGVyUm91dGVyIiwiZ2VuZXJhdGlvblVuaXZlcnNhbFJvdXRlciIsInZvaWNlUm91dGVyIiwiZmVlZGJhY2tSb3V0ZXIiLCJlbWFpbFN1YnNjcmliZXJSb3V0ZXIiLCJzY2VuZXNSb3V0ZXIiLCJzaGFyZVJvdXRlciIsImFkbWluUm91dGVyIiwiY3JlYXRlQ2FsbGVyRmFjdG9yeSIsImNyZWF0ZVRSUENSb3V0ZXIiLCJhcHBSb3V0ZXIiLCJwcm9qZWN0IiwiY2hhdCIsInJlbmRlciIsImdlbmVyYXRpb24iLCJ2b2ljZSIsImZlZWRiYWNrIiwiZW1haWxTdWJzY3JpYmVyIiwic2NlbmVzIiwic2hhcmUiLCJhZG1pbiIsImNyZWF0ZUNhbGxlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/root.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/admin.ts":
/*!*****************************************!*\
  !*** ./src/server/api/routers/admin.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   adminRouter: () => (/* binding */ adminRouter)\n/* harmony export */ });\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _trpc_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @trpc/server */ \"(rsc)/../../node_modules/@trpc/server/dist/index.mjs\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/api/routers/admin.ts\n\n\n\n\n\n\n// Input schema for timeframe filtering\nconst timeframeSchema = zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n    'all',\n    '30d',\n    '24h'\n]).default('all');\n// User update schema - now includes isAdmin\nconst userUpdateSchema = zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n    name: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional(),\n    email: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().email().optional(),\n    image: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().url().optional().nullable(),\n    isAdmin: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional()\n});\n// Admin-only procedure that checks if user is admin\nconst adminOnlyProcedure = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.use({\n    \"use[adminOnlyProcedure]\": async ({ ctx, next })=>{\n        // Check if user is admin\n        const user = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, ctx.session.user.id)).limit(1);\n        if (!user[0]?.isAdmin) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"FORBIDDEN\",\n                message: \"Admin access required\"\n            });\n        }\n        return next();\n    }\n}[\"use[adminOnlyProcedure]\"]);\nconst adminRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    // Check if current user is admin\n    checkAdminAccess: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.query(async ({ ctx })=>{\n        const user = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, ctx.session.user.id)).limit(1);\n        return {\n            isAdmin: user[0]?.isAdmin || false\n        };\n    }),\n    // Toggle user admin status - admin only\n    toggleUserAdmin: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        isAdmin: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean()\n    })).mutation(async ({ input })=>{\n        const updatedUser = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).set({\n            isAdmin: input.isAdmin\n        }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, input.userId)).returning({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email,\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin\n        });\n        if (!updatedUser[0]) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"User not found\"\n            });\n        }\n        return updatedUser[0];\n    }),\n    // Get total users count with timeframe filtering - admin only\n    getTotalUsers: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        timeframe: timeframeSchema\n    })).query(async ({ input })=>{\n        let whereCondition;\n        if (input.timeframe === '24h') {\n            // Use createdAt for user creation time tracking\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000));\n        } else if (input.timeframe === '30d') {\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000));\n        }\n        const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where(whereCondition);\n        return {\n            total: result[0]?.count || 0,\n            timeframe: input.timeframe\n        };\n    }),\n    // Get unique projects created in timeframe - admin only\n    getProjectsCreated: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        timeframe: timeframeSchema\n    })).query(async ({ input })=>{\n        let whereCondition;\n        if (input.timeframe === '24h') {\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000));\n        } else if (input.timeframe === '30d') {\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000));\n        }\n        const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where(whereCondition);\n        return {\n            total: result[0]?.count || 0,\n            timeframe: input.timeframe\n        };\n    }),\n    // Get scenes created in timeframe - admin only\n    getScenesCreated: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        timeframe: timeframeSchema\n    })).query(async ({ input })=>{\n        let whereCondition;\n        if (input.timeframe === '24h') {\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000));\n        } else if (input.timeframe === '30d') {\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000));\n        }\n        const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where(whereCondition);\n        return {\n            total: result[0]?.count || 0,\n            timeframe: input.timeframe\n        };\n    }),\n    // Get recent feedback entries - admin only\n    getRecentFeedback: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        limit: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().default(10)\n    })).query(async ({ input })=>{\n        const feedbackEntries = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.id,\n            content: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.content,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.name,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.email,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.createdAt,\n            status: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.status,\n            prioritizedFeatures: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.prioritizedFeatures\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.createdAt)).limit(input.limit);\n        return feedbackEntries;\n    }),\n    // Get comprehensive dashboard metrics - admin only\n    getDashboardMetrics: adminOnlyProcedure.query(async ()=>{\n        // Get all timeframes for each metric in parallel\n        const [totalUsersAll, totalUsers30d, totalUsers7d, totalUsers24h, projectsAll, projects30d, projects7d, projects24h, scenesAll, scenes30d, scenes7d, scenes24h, recentFeedback] = await Promise.all([\n            // Users - using createdAt for user registration tracking\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt} IS NOT NULL`)),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt} IS NOT NULL`)),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000)), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt} IS NOT NULL`)),\n            // Projects\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000))),\n            // Scenes\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000))),\n            // Recent feedback\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.id,\n                content: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.content,\n                name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.name,\n                email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.email,\n                createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.createdAt,\n                status: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.status\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.createdAt)).limit(5)\n        ]);\n        return {\n            users: {\n                all: totalUsersAll[0]?.count || 0,\n                last30Days: totalUsers30d[0]?.count || 0,\n                last7Days: totalUsers7d[0]?.count || 0,\n                last24Hours: totalUsers24h[0]?.count || 0\n            },\n            projects: {\n                all: projectsAll[0]?.count || 0,\n                last30Days: projects30d[0]?.count || 0,\n                last7Days: projects7d[0]?.count || 0,\n                last24Hours: projects24h[0]?.count || 0\n            },\n            scenes: {\n                all: scenesAll[0]?.count || 0,\n                last30Days: scenes30d[0]?.count || 0,\n                last7Days: scenes7d[0]?.count || 0,\n                last24Hours: scenes24h[0]?.count || 0\n            },\n            recentFeedback\n        };\n    }),\n    // USER MANAGEMENT ENDPOINTS - admin only\n    // Get all users with pagination and search - admin only\n    getUsers: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        page: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().default(1),\n        limit: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().default(20),\n        search: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional()\n    })).query(async ({ input })=>{\n        const offset = (input.page - 1) * input.limit;\n        let whereCondition;\n        if (input.search) {\n            whereCondition = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.like)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name, `%${input.search}%`), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.like)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email, `%${input.search}%`));\n        }\n        const [usersList, totalCount] = await Promise.all([\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n                name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name,\n                email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email,\n                emailVerified: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.emailVerified,\n                image: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image,\n                isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin,\n                createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where(whereCondition).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt)) // Order by creation time instead\n            .limit(input.limit).offset(offset),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where(whereCondition)\n        ]);\n        // Get prompt counts for each user\n        const userIds = usersList.map((user)=>user.id);\n        const promptCounts = userIds.length > 0 ? await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            userId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId,\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id)\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.inArray)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userIds), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role, 'user'))).groupBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId) : [];\n        // Create a map of userId to prompt count for easy lookup\n        const promptCountMap = new Map();\n        promptCounts.forEach((pc)=>{\n            promptCountMap.set(pc.userId, pc.count);\n        });\n        // Add prompt counts to users\n        const usersWithPrompts = usersList.map((user)=>({\n                ...user,\n                totalPrompts: promptCountMap.get(user.id) || 0\n            }));\n        return {\n            users: usersWithPrompts,\n            total: totalCount[0]?.count || 0,\n            page: input.page,\n            limit: input.limit,\n            totalPages: Math.ceil((totalCount[0]?.count || 0) / input.limit)\n        };\n    }),\n    // Get single user by ID - admin only\n    getUser: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).query(async ({ input })=>{\n        const user = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email,\n            emailVerified: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.emailVerified,\n            image: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image,\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, input.userId)).limit(1);\n        if (!user[0]) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"User not found\"\n            });\n        }\n        // Get user's project count, latest activity, and prompt count\n        const [projectCount, latestProject, promptCount] = await Promise.all([\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, input.userId)),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id,\n                title: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title,\n                createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt,\n                updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, input.userId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt)).limit(1),\n            // Count total user messages/prompts by joining through projects\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, input.userId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role, 'user') // Only count user messages, not assistant responses\n            ))\n        ]);\n        return {\n            ...user[0],\n            projectCount: projectCount[0]?.count || 0,\n            latestProject: latestProject[0] || null,\n            promptCount: promptCount[0]?.count || 0\n        };\n    }),\n    // Update user data - admin only\n    updateUser: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        data: userUpdateSchema\n    })).mutation(async ({ input })=>{\n        const updateData = {};\n        if (input.data.name !== undefined) updateData.name = input.data.name;\n        if (input.data.email !== undefined) updateData.email = input.data.email;\n        if (input.data.image !== undefined) updateData.image = input.data.image;\n        if (input.data.isAdmin !== undefined) updateData.isAdmin = input.data.isAdmin;\n        if (Object.keys(updateData).length === 0) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"BAD_REQUEST\",\n                message: \"No data provided for update\"\n            });\n        }\n        const updatedUser = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).set(updateData).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, input.userId)).returning({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email,\n            emailVerified: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.emailVerified,\n            image: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image,\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt\n        });\n        if (!updatedUser[0]) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"User not found or update failed\"\n            });\n        }\n        return updatedUser[0];\n    }),\n    // Delete user - admin only\n    deleteUser: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).mutation(async ({ input })=>{\n        // Prevent deletion of admin users for safety\n        const userToDelete = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, input.userId)).limit(1);\n        if (!userToDelete[0]) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"User not found\"\n            });\n        }\n        if (userToDelete[0].isAdmin) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"FORBIDDEN\",\n                message: \"Cannot delete admin users\"\n            });\n        }\n        // Delete user and all associated data\n        // Note: This will cascade delete related data due to foreign key constraints\n        const deletedUser = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, input.userId)).returning({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email\n        });\n        if (!deletedUser[0]) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: \"Failed to delete user\"\n            });\n        }\n        return {\n            success: true,\n            deletedUser: deletedUser[0]\n        };\n    }),\n    // Get user activity summary - admin only\n    getUserActivity: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).query(async ({ input })=>{\n        const [userProjects, userScenes, userFeedback] = await Promise.all([\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id,\n                title: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title,\n                createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt,\n                updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, input.userId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt)).limit(10),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id,\n                name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name,\n                createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt,\n                projectId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, input.userId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt)).limit(10),\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.id,\n                content: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.content,\n                createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.createdAt,\n                status: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.status\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.userId, input.userId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback.createdAt)).limit(5)\n        ]);\n        return {\n            projects: userProjects,\n            scenes: userScenes,\n            feedback: userFeedback\n        };\n    }),\n    // ANALYTICS ENDPOINTS - admin only\n    // Get time-series analytics data\n    getAnalyticsData: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        timeframe: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            '24h',\n            '7d',\n            '30d'\n        ]),\n        metric: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'users',\n            'projects',\n            'scenes',\n            'prompts'\n        ])\n    })).query(async ({ input })=>{\n        const { timeframe, metric } = input;\n        // Calculate intervals and date ranges\n        let intervalHours;\n        let totalPeriodHours;\n        switch(timeframe){\n            case '24h':\n                intervalHours = 1; // 1-hour intervals\n                totalPeriodHours = 24;\n                break;\n            case '7d':\n                intervalHours = 24; // 24-hour (daily) intervals\n                totalPeriodHours = 7 * 24;\n                break;\n            case '30d':\n                intervalHours = 24; // 24-hour (daily) intervals\n                totalPeriodHours = 30 * 24;\n                break;\n        }\n        const startDate = new Date(Date.now() - totalPeriodHours * 60 * 60 * 1000);\n        // Generate time slots\n        const timeSlots = [];\n        for(let i = 0; i < Math.ceil(totalPeriodHours / intervalHours); i++){\n            const slotStart = new Date(startDate.getTime() + i * intervalHours * 60 * 60 * 1000);\n            const slotEnd = new Date(slotStart.getTime() + intervalHours * 60 * 60 * 1000);\n            timeSlots.push({\n                start: slotStart,\n                end: slotEnd,\n                label: timeframe === '24h' ? slotStart.toLocaleTimeString([], {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                }) : slotStart.toLocaleDateString([], {\n                    month: 'short',\n                    day: 'numeric'\n                })\n            });\n        }\n        // Get data based on metric type\n        let data = [];\n        switch(metric){\n            case 'users':\n                // Get new users by createdAt timestamp\n                const userCounts = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                    timestamp: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt\n                }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, startDate), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt} IS NOT NULL`)).orderBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt);\n                data = userCounts.map((row)=>({\n                        timestamp: row.timestamp,\n                        count: 1\n                    }));\n                break;\n            case 'projects':\n                const projectCounts = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                    timestamp: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt\n                }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, startDate)).orderBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt);\n                data = projectCounts.map((row)=>({\n                        timestamp: row.timestamp,\n                        count: 1\n                    }));\n                break;\n            case 'scenes':\n                const sceneCounts = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                    timestamp: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt\n                }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, startDate)).orderBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt);\n                data = sceneCounts.map((row)=>({\n                        timestamp: row.timestamp,\n                        count: 1\n                    }));\n                break;\n            case 'prompts':\n                // Get user messages (prompts) by joining through projects\n                const promptCounts = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                    timestamp: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt\n                }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt, startDate), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role, 'user') // Only count user messages\n                )).orderBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt);\n                data = promptCounts.map((row)=>({\n                        timestamp: row.timestamp,\n                        count: 1\n                    }));\n                break;\n        }\n        // Aggregate data into time slots\n        const chartData = timeSlots.map((slot)=>{\n            const slotData = data.filter((item)=>item.timestamp >= slot.start && item.timestamp < slot.end);\n            return {\n                label: slot.label,\n                timestamp: slot.start.toISOString(),\n                count: slotData.length,\n                cumulative: 0\n            };\n        });\n        // Calculate cumulative values\n        let cumulative = 0;\n        chartData.forEach((point)=>{\n            cumulative += point.count;\n            point.cumulative = cumulative;\n        });\n        return {\n            timeframe,\n            metric,\n            data: chartData,\n            totalCount: cumulative,\n            periodStart: startDate.toISOString(),\n            periodEnd: new Date().toISOString()\n        };\n    }),\n    // Get overview analytics for all metrics\n    getAnalyticsOverview: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        timeframe: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            '24h',\n            '7d',\n            '30d'\n        ])\n    })).query(async ({ input })=>{\n        const { timeframe } = input;\n        let periodHours;\n        switch(timeframe){\n            case '24h':\n                periodHours = 24;\n                break;\n            case '7d':\n                periodHours = 7 * 24;\n                break;\n            case '30d':\n                periodHours = 30 * 24;\n                break;\n        }\n        const startDate = new Date(Date.now() - periodHours * 60 * 60 * 1000);\n        // Get all metrics in parallel\n        const [newUsers, newProjects, newScenes, newPrompts] = await Promise.all([\n            // New users\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, startDate), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt} IS NOT NULL`)),\n            // New projects\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, startDate)),\n            // New scenes\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, startDate)),\n            // New prompts (user messages)\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n                count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n            }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt, startDate), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role, 'user')))\n        ]);\n        return {\n            timeframe,\n            metrics: {\n                users: newUsers[0]?.count || 0,\n                projects: newProjects[0]?.count || 0,\n                scenes: newScenes[0]?.count || 0,\n                prompts: newPrompts[0]?.count || 0\n            },\n            periodStart: startDate.toISOString(),\n            periodEnd: new Date().toISOString()\n        };\n    }),\n    // EVALUATION ENDPOINTS - admin only\n    // Run evaluation suite\n    runEvaluation: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        suiteId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        modelPacks: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.string()),\n        maxPrompts: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().optional(),\n        showOutputs: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional(),\n        comparison: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional(),\n        verbose: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional()\n    })).mutation(async ({ input })=>{\n        // Import the evaluation runner\n        const { EvaluationRunner } = await __webpack_require__.e(/*! import() */ \"_rsc_src_lib_evals_runner_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ~/lib/evals/runner */ \"(rsc)/./src/lib/evals/runner.ts\"));\n        const runner = new EvaluationRunner();\n        try {\n            const result = await runner.runSuite({\n                suiteId: input.suiteId,\n                modelPacks: input.modelPacks,\n                maxPrompts: input.maxPrompts,\n                showOutputs: input.showOutputs,\n                comparison: input.comparison,\n                verbose: input.verbose\n            });\n            return result;\n        } catch (error) {\n            console.error('Evaluation failed:', error);\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: `Evaluation failed: ${error instanceof Error ? error.message : String(error)}`\n            });\n        }\n    }),\n    // Create custom evaluation suite\n    createCustomSuite: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        name: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        description: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        prompts: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n            id: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n            name: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n            type: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n                'text',\n                'image',\n                'code',\n                'scene'\n            ]),\n            input: zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n                text: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional(),\n                image: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional(),\n                context: zod__WEBPACK_IMPORTED_MODULE_4__.z.record(zod__WEBPACK_IMPORTED_MODULE_4__.z.any()).optional()\n            }),\n            expectedOutput: zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n                type: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n                    'exact',\n                    'contains',\n                    'pattern',\n                    'quality_score'\n                ]),\n                value: zod__WEBPACK_IMPORTED_MODULE_4__.z.union([\n                    zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n                    zod__WEBPACK_IMPORTED_MODULE_4__.z.number()\n                ])\n            }).optional(),\n            expectedBehavior: zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n                toolCalled: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional(),\n                editType: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n                    'surgical',\n                    'creative',\n                    'structural'\n                ]).optional(),\n                shouldMention: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.string()).optional(),\n                shouldModify: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.string()).optional(),\n                shouldAnalyzeImage: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional(),\n                shouldUseContext: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional(),\n                shouldConfirm: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional(),\n                shouldAsk: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.string()).optional(),\n                needsClarification: zod__WEBPACK_IMPORTED_MODULE_4__.z.boolean().optional(),\n                expectedDuration: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().optional(),\n                complexity: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n                    'low',\n                    'medium',\n                    'high',\n                    'very-high'\n                ])\n            }).optional()\n        })),\n        modelPacks: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.string()),\n        services: zod__WEBPACK_IMPORTED_MODULE_4__.z.array(zod__WEBPACK_IMPORTED_MODULE_4__.z.string())\n    })).mutation(async ({ input })=>{\n        // For now, just return the created suite structure\n        // In the future, this could be stored in a database\n        const customSuite = {\n            id: `custom-${Date.now()}`,\n            name: input.name,\n            description: input.description,\n            prompts: input.prompts,\n            modelPacks: input.modelPacks,\n            services: input.services\n        };\n        return customSuite;\n    }),\n    // Get available evaluation suites\n    getEvaluationSuites: adminOnlyProcedure.query(async ()=>{\n        // Import suites dynamically\n        const { allEvalSuites } = await __webpack_require__.e(/*! import() */ \"_rsc_src_lib_evals_suites_basic-prompts_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ~/lib/evals/suites/basic-prompts */ \"(rsc)/./src/lib/evals/suites/basic-prompts.ts\"));\n        return allEvalSuites.map((suite)=>({\n                id: suite.id,\n                name: suite.name,\n                description: suite.description,\n                promptCount: suite.prompts.length,\n                services: suite.services,\n                modelPacks: suite.modelPacks\n            }));\n    }),\n    // Get available model packs\n    getModelPacks: adminOnlyProcedure.query(async ()=>{\n        const { MODEL_PACKS } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ~/config/models.config */ \"(rsc)/./src/config/models.config.ts\"));\n        return Object.entries(MODEL_PACKS).map(([id, pack])=>({\n                id,\n                name: pack.name,\n                description: pack.description,\n                models: {\n                    brain: `${pack.models.brain.provider}/${pack.models.brain.model}`,\n                    codeGenerator: `${pack.models.codeGenerator.provider}/${pack.models.codeGenerator.model}`,\n                    visionAnalysis: `${pack.models.visionAnalysis.provider}/${pack.models.visionAnalysis.model}`\n                }\n            }));\n    }),\n    // Create custom prompt - admin only\n    createCustomPrompt: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        name: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        type: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'text',\n            'code',\n            'image',\n            'scene'\n        ]),\n        text: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        expectedOutput: zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n            type: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n            value: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional()\n        }).optional(),\n        context: zod__WEBPACK_IMPORTED_MODULE_4__.z.any().optional()\n    })).mutation(async ({ input })=>{\n        // TODO: Store in database for persistence\n        const customPrompt = {\n            id: `prompt-${Date.now()}`,\n            name: input.name,\n            type: input.type,\n            input: {\n                text: input.text,\n                context: input.context\n            },\n            expectedOutput: input.expectedOutput,\n            createdAt: new Date().toISOString()\n        };\n        console.log('Creating custom prompt:', customPrompt);\n        return {\n            success: true,\n            promptId: customPrompt.id,\n            prompt: customPrompt\n        };\n    }),\n    // Create custom model pack - admin only\n    createCustomModelPack: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        name: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        description: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        brainModel: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        codeModel: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        visionModel: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).mutation(async ({ input })=>{\n        // Parse provider/model format\n        const parseModel = (modelString)=>{\n            const [provider, model] = modelString.split('/');\n            return {\n                provider: provider,\n                model: model\n            };\n        };\n        const customPack = {\n            id: `custom-${Date.now()}`,\n            name: input.name,\n            description: input.description,\n            models: {\n                brain: parseModel(input.brainModel),\n                codeGenerator: parseModel(input.codeModel),\n                visionAnalysis: parseModel(input.visionModel)\n            },\n            createdAt: new Date().toISOString()\n        };\n        // TODO: Store in database for persistence\n        console.log('Creating custom model pack:', customPack);\n        return {\n            success: true,\n            packId: customPack.id,\n            pack: customPack\n        };\n    }),\n    // Analyze uploaded image - admin only\n    analyzeUploadedImage: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        imageData: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        prompt: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional()\n    })).mutation(async ({ input })=>{\n        try {\n            // TODO: Integrate with actual image analysis service from ~/lib/services/analyzeImage.ts\n            const analysisResult = {\n                success: true,\n                analysis: {\n                    description: \"A user interface mockup showing a modern web application with clean design elements, including navigation, content areas, and interactive components.\",\n                    colors: [\n                        \"#3B82F6\",\n                        \"#1F2937\",\n                        \"#F9FAFB\",\n                        \"#EF4444\"\n                    ],\n                    elements: [\n                        \"Navigation bar\",\n                        \"Content cards\",\n                        \"Buttons\",\n                        \"Text elements\"\n                    ],\n                    mood: \"Professional and modern\",\n                    suggestions: [\n                        \"This design could be implemented using React components\",\n                        \"The color scheme suggests a professional application\",\n                        \"Layout appears to be responsive-friendly\"\n                    ],\n                    palette: {\n                        primary: \"#3B82F6\",\n                        secondary: \"#1F2937\",\n                        accent: \"#EF4444\",\n                        background: \"#F9FAFB\"\n                    },\n                    typography: {\n                        headers: \"Bold, sans-serif typography\",\n                        body: \"Clean, readable text\"\n                    }\n                },\n                timestamp: new Date().toISOString()\n            };\n            return analysisResult;\n        } catch (error) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: `Image analysis failed: ${error instanceof Error ? error.message : String(error)}`\n            });\n        }\n    }),\n    // Generate scene from image - admin only\n    generateSceneFromImage: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        imageData: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        analysisData: zod__WEBPACK_IMPORTED_MODULE_4__.z.any().optional()\n    })).mutation(async ({ input })=>{\n        try {\n            // TODO: Integrate with actual scene generation service\n            const sceneCode = `const { AbsoluteFill, useCurrentFrame, useVideoConfig, interpolate } = window.Remotion;\n\nexport default function GeneratedScene() {\n  const frame = useCurrentFrame();\n  const { fps } = useVideoConfig();\n  \n  const opacity = interpolate(frame, [0, fps * 0.5], [0, 1], {\n    extrapolateLeft: \"clamp\",\n    extrapolateRight: \"clamp\"\n  });\n  \n  const scale = interpolate(frame, [0, fps], [0.8, 1], {\n    extrapolateLeft: \"clamp\", \n    extrapolateRight: \"clamp\"\n  });\n  \n  return (\n    <AbsoluteFill style={{ \n      backgroundColor: \"#3B82F6\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      backgroundImage: \"linear-gradient(135deg, #3B82F6 0%, #1F2937 100%)\"\n    }}>\n      <div style={{\n        opacity,\n        transform: \\`scale(\\${scale})\\`,\n        textAlign: \"center\",\n        color: \"white\",\n        padding: \"2rem\"\n      }}>\n        <h1 style={{\n          fontSize: \"4rem\",\n          fontWeight: \"700\",\n          margin: \"0 0 1rem 0\",\n          textShadow: \"0 4px 8px rgba(0,0,0,0.3)\"\n        }}>\n          Generated from Image\n        </h1>\n        <p style={{\n          fontSize: \"1.5rem\",\n          opacity: 0.9,\n          maxWidth: \"600px\"\n        }}>\n          Professional UI Design with Modern Elements\n        </p>\n        <div style={{\n          marginTop: \"2rem\",\n          padding: \"1rem 2rem\",\n          backgroundColor: \"rgba(255,255,255,0.1)\",\n          borderRadius: \"10px\",\n          backdropFilter: \"blur(10px)\"\n        }}>\n          <span style={{ fontSize: \"1.2rem\" }}>\n            Auto-generated from uploaded reference\n          </span>\n        </div>\n      </div>\n    </AbsoluteFill>\n  );\n}`;\n            return {\n                success: true,\n                sceneCode,\n                sceneId: `scene-${Date.now()}`,\n                sceneName: \"Generated Scene\",\n                timestamp: new Date().toISOString()\n            };\n        } catch (error) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: `Scene generation failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n            });\n        }\n    }),\n    //  NEW: Comprehensive user analytics endpoint\n    getUserAnalytics: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        limit: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(1).max(100).default(20),\n        offset: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(0).default(0),\n        sortBy: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'signup_date',\n            'last_activity',\n            'total_projects',\n            'total_prompts'\n        ]).default('signup_date'),\n        sortOrder: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'asc',\n            'desc'\n        ]).default('desc'),\n        searchTerm: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional(),\n        authProvider: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'all',\n            'google',\n            'github',\n            'unknown'\n        ]).default('all'),\n        activityFilter: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'all',\n            'today',\n            'week',\n            'month',\n            'never'\n        ]).default('all'),\n        signupDateFilter: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'all',\n            'today',\n            'week',\n            'month',\n            'older'\n        ]).default('all'),\n        projectsFilter: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'all',\n            'none',\n            'low',\n            'medium',\n            'high'\n        ]).default('all'),\n        adminFilter: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'all',\n            'admin',\n            'user'\n        ]).default('all')\n    })).query(async ({ input, ctx })=>{\n        console.log(' getUserAnalytics called with:', {\n            input,\n            hasCtx: !!ctx\n        });\n        const { limit, offset, sortBy, sortOrder, searchTerm, authProvider, activityFilter, signupDateFilter, projectsFilter, adminFilter } = input;\n        // Build WHERE conditions for filtering\n        const whereConditions = [];\n        // Search filter\n        if (searchTerm && searchTerm.trim()) {\n            whereConditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.like)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name, `%${searchTerm}%`), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.like)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email, `%${searchTerm}%`)));\n        }\n        // Admin status filter\n        if (adminFilter !== 'all') {\n            whereConditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin, adminFilter === 'admin'));\n        }\n        // Signup date filter\n        if (signupDateFilter !== 'all') {\n            const now = new Date();\n            let signupThreshold;\n            switch(signupDateFilter){\n                case 'today':\n                    signupThreshold = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n                    whereConditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, signupThreshold));\n                    break;\n                case 'week':\n                    signupThreshold = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n                    whereConditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, signupThreshold));\n                    break;\n                case 'month':\n                    signupThreshold = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n                    whereConditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, signupThreshold));\n                    break;\n                case 'older':\n                    signupThreshold = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n                    whereConditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt} < ${signupThreshold}`);\n                    break;\n            }\n        }\n        //  COMPREHENSIVE USER ANALYTICS QUERY WITH ENHANCED FILTERING\n        const baseQuery = _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            // Basic user info\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email,\n            image: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image,\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin,\n            signupDate: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt,\n            // OAuth provider info\n            oauthProvider: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts.provider,\n            // Project metrics\n            totalProjects: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id})`.as('total_projects'),\n            // Scene metrics  \n            totalScenes: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id})`.as('total_scenes'),\n            // Chat/prompt metrics\n            totalMessages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id})`.as('total_messages'),\n            totalUserPrompts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'user' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('total_user_prompts'),\n            // Error message tracking\n            totalErrorMessages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.status} = 'error' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('total_error_messages'),\n            // Image usage metrics - simplified to avoid double-counting\n            promptsWithImages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls} IS NOT NULL AND jsonb_array_length(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls}) > 0 THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('prompts_with_images'),\n            totalImagesUploaded: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COALESCE(SUM(CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls} IS NOT NULL THEN jsonb_array_length(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls}) ELSE 0 END), 0)`.as('total_images_uploaded'),\n            // Activity metrics\n            firstActivity: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MIN(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('first_activity'),\n            lastActivity: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('last_activity'),\n            // Engagement metrics\n            totalSceneIterations: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id})`.as('total_scene_iterations'),\n            // Advanced behavior metrics\n            complexEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'structural' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('complex_edits'),\n            creativeEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'creative' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('creative_edits'),\n            surgicalEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'surgical' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('surgical_edits'),\n            // Project memory insights\n            userPreferences: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.memoryType} = 'user_preference' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.id} END)`.as('user_preferences')\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts.userId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.projectId)).$dynamic();\n        // Execute the query with conditional WHERE clause, groupBy and ordering\n        let userAnalytics = await (whereConditions.length > 0 ? baseQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)(...whereConditions)) : baseQuery).groupBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts.provider).orderBy(sortOrder === 'desc' ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(sortBy === 'signup_date' ? _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt : sortBy === 'last_activity' ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})` : sortBy === 'total_projects' ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id})` : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'user' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(sortBy === 'signup_date' ? _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt : sortBy === 'last_activity' ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})` : sortBy === 'total_projects' ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id})` : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'user' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`));\n        // Apply post-query filtering (since Drizzle doesn't support complex HAVING clauses well)\n        if (authProvider !== 'all') {\n            userAnalytics = userAnalytics.filter((user)=>{\n                if (authProvider === 'unknown') {\n                    return !user.oauthProvider;\n                }\n                return user.oauthProvider === authProvider;\n            });\n        }\n        if (projectsFilter !== 'all') {\n            userAnalytics = userAnalytics.filter((user)=>{\n                const projectCount = user.totalProjects;\n                switch(projectsFilter){\n                    case 'none':\n                        return projectCount === 0;\n                    case 'low':\n                        return projectCount >= 1 && projectCount <= 2;\n                    case 'medium':\n                        return projectCount >= 3 && projectCount <= 10;\n                    case 'high':\n                        return projectCount > 10;\n                    default:\n                        return true;\n                }\n            });\n        }\n        if (activityFilter !== 'all') {\n            const now = new Date();\n            userAnalytics = userAnalytics.filter((user)=>{\n                if (activityFilter === 'never') {\n                    return !user.lastActivity;\n                }\n                if (!user.lastActivity) return false;\n                const lastActivity = new Date(user.lastActivity);\n                let threshold;\n                switch(activityFilter){\n                    case 'today':\n                        threshold = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n                        return lastActivity >= threshold;\n                    case 'week':\n                        threshold = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n                        return lastActivity >= threshold;\n                    case 'month':\n                        threshold = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n                        return lastActivity >= threshold;\n                    default:\n                        return true;\n                }\n            });\n        }\n        // Apply pagination after filtering\n        const totalCount = userAnalytics.length;\n        const paginatedUsers = userAnalytics.slice(offset, offset + limit);\n        return {\n            users: paginatedUsers,\n            totalCount,\n            hasMore: offset + limit < totalCount,\n            appliedFilters: {\n                searchTerm,\n                authProvider,\n                activityFilter,\n                signupDateFilter,\n                projectsFilter,\n                adminFilter\n            }\n        };\n    }),\n    //  NEW: Get detailed user activity timeline\n    getUserActivityTimeline: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        days: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(1).max(90).default(30)\n    })).query(async ({ input })=>{\n        const { userId, days } = input;\n        //  FIXED: Calculate date threshold explicitly to avoid SQL parameter binding issues\n        const startDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000);\n        const activityTimeline = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            date: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`DATE(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('date'),\n            totalMessages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(*)`.as('total_messages'),\n            userPrompts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'user' THEN 1 END)`.as('user_prompts'),\n            assistantResponses: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'assistant' THEN 1 END)`.as('assistant_responses'),\n            imagesUploaded: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls} IS NOT NULL AND jsonb_array_length(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls}) > 0 THEN 1 END)`.as('images_uploaded'),\n            scenesCreated: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id})`.as('scenes_created'),\n            projectsWorkedOn: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id})`.as('projects_worked_on'),\n            avgSessionTime: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`EXTRACT(EPOCH FROM (MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt}) - MIN(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})))/60`.as('avg_session_minutes')\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`DATE(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt}) = DATE(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.gte)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt, startDate))).groupBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`DATE(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`DATE(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt}) DESC`);\n        return activityTimeline;\n    }),\n    //  NEW: Get individual user details\n    getUserDetails: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).query(async ({ input })=>{\n        const { userId } = input;\n        const userDetails = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            // Basic user info\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name,\n            email: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email,\n            image: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image,\n            isAdmin: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin,\n            signupDate: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt,\n            // OAuth provider info\n            oauthProvider: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts.provider,\n            // Project metrics\n            totalProjects: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id})`.as('total_projects'),\n            // Scene metrics  \n            totalScenes: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id})`.as('total_scenes'),\n            // Chat/prompt metrics\n            totalMessages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id})`.as('total_messages'),\n            totalUserPrompts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'user' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('total_user_prompts'),\n            // Error message tracking\n            totalErrorMessages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.status} = 'error' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('total_error_messages'),\n            // Image usage metrics - simplified to avoid double-counting\n            promptsWithImages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls} IS NOT NULL AND jsonb_array_length(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls}) > 0 THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('prompts_with_images'),\n            totalImagesUploaded: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COALESCE(SUM(CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls} IS NOT NULL THEN jsonb_array_length(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls}) ELSE 0 END), 0)`.as('total_images_uploaded'),\n            // Activity metrics\n            firstActivity: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MIN(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('first_activity'),\n            lastActivity: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('last_activity'),\n            // Engagement metrics\n            totalSceneIterations: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id})`.as('total_scene_iterations'),\n            // Advanced behavior metrics\n            complexEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'structural' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('complex_edits'),\n            creativeEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'creative' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('creative_edits'),\n            surgicalEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'surgical' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('surgical_edits'),\n            // Project memory insights\n            userPreferences: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.memoryType} = 'user_preference' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.id} END)`.as('user_preferences')\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts.userId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.projectId)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, userId)).groupBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.name, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.email, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.image, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.isAdmin, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.users.createdAt, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.accounts.provider).limit(1);\n        return userDetails[0] || null;\n    }),\n    //  NEW: Get detailed user projects with scenes and activity\n    getUserProjects: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        limit: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(1).max(50).default(20),\n        offset: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(0).default(0)\n    })).query(async ({ input })=>{\n        const { userId, limit, offset } = input;\n        const userProjects = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            // Project details\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id,\n            title: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title,\n            props: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.props,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt,\n            updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt,\n            // Scene metrics for this project\n            totalScenes: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id})`.as('total_scenes'),\n            // Message metrics for this project\n            totalMessages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id})`.as('total_messages'),\n            totalUserPrompts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role} = 'user' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('total_user_prompts'),\n            // Image usage in this project\n            promptsWithImages: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls} IS NOT NULL AND jsonb_array_length(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls}) > 0 THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id} END)`.as('prompts_with_images'),\n            // Activity metrics\n            firstActivity: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MIN(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('first_activity'),\n            lastActivity: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt})`.as('last_activity'),\n            // Scene iterations for this project\n            totalIterations: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id})`.as('total_iterations')\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.projectId)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId)).groupBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.props, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt)).limit(limit).offset(offset);\n        // Get total count for pagination\n        const totalCountResult = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId));\n        return {\n            projects: userProjects,\n            totalCount: totalCountResult[0]?.count || 0,\n            hasMore: offset + limit < (totalCountResult[0]?.count || 0)\n        };\n    }),\n    //  NEW: Get full project details including scenes and complete chat history\n    getUserProjectDetails: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).query(async ({ input })=>{\n        const { projectId, userId } = input;\n        // Verify project belongs to user\n        const projectOwnership = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            userId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId)).limit(1);\n        if (!projectOwnership[0] || projectOwnership[0].userId !== userId) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Project not found or doesn't belong to user\"\n            });\n        }\n        // Get project details\n        const projectDetails = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id,\n            title: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title,\n            props: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.props,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt,\n            updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId)).limit(1);\n        // Get all scenes for this project\n        const projectScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name,\n            tsxCode: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.tsxCode,\n            duration: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.duration,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt,\n            updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.updatedAt,\n            // Iteration count for each scene\n            iterationCount: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id})`.as('iteration_count')\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.sceneId)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, projectId)).groupBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.tsxCode, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.duration, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.updatedAt).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt));\n        // Get complete chat history for this project\n        const chatHistory = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id,\n            role: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role,\n            content: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.content,\n            imageUrls: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls,\n            status: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.status,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt,\n            // Additional metadata\n            originalTsxCode: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.originalTsxCode\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, projectId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt));\n        // Get scene iterations for detailed editing history (renamed variable)\n        const projectSceneIterations = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id,\n            sceneId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.sceneId,\n            editComplexity: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity,\n            userPrompt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.userPrompt,\n            brainReasoning: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.brainReasoning,\n            toolReasoning: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.toolReasoning,\n            codeBefore: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.codeBefore,\n            codeAfter: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.codeAfter,\n            changesApplied: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.changesApplied,\n            changesPreserved: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.changesPreserved,\n            generationTimeMs: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.generationTimeMs,\n            modelUsed: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.modelUsed,\n            operationType: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.operationType,\n            temperature: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.temperature,\n            tokensUsed: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.tokensUsed,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.projectId, projectId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt));\n        // Get project memory for context\n        const projectMemoryEntries = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.id,\n            memoryType: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.memoryType,\n            memoryValue: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.memoryValue,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.createdAt\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.projectId, projectId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projectMemory.createdAt));\n        return {\n            project: projectDetails[0],\n            scenes: projectScenes,\n            chatHistory,\n            sceneIterations: projectSceneIterations,\n            projectMemory: projectMemoryEntries,\n            summary: {\n                totalScenes: projectScenes.length,\n                totalMessages: chatHistory.length,\n                totalUserPrompts: chatHistory.filter((msg)=>msg.role === 'user').length,\n                totalAssistantResponses: chatHistory.filter((msg)=>msg.role === 'assistant').length,\n                totalIterations: projectSceneIterations.length,\n                imagesUploaded: chatHistory.filter((msg)=>msg.imageUrls && Array.isArray(msg.imageUrls) && msg.imageUrls.length > 0).length,\n                firstActivity: chatHistory[0]?.createdAt || null,\n                lastActivity: chatHistory[chatHistory.length - 1]?.createdAt || null\n            }\n        };\n    }),\n    //  NEW: Get all scenes created by a user across all projects\n    getUserScenes: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        limit: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(1).max(100).default(50),\n        offset: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().min(0).default(0),\n        sortBy: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'created_date',\n            'updated_date',\n            'project_name',\n            'scene_name',\n            'duration'\n        ]).default('created_date'),\n        sortOrder: zod__WEBPACK_IMPORTED_MODULE_4__.z.enum([\n            'asc',\n            'desc'\n        ]).default('desc')\n    })).query(async ({ input })=>{\n        const { userId, limit, offset, sortBy, sortOrder } = input;\n        const sortColumn = sortBy === 'created_date' ? _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt : sortBy === 'updated_date' ? _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.updatedAt : sortBy === 'project_name' ? _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title : sortBy === 'scene_name' ? _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name : _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.duration;\n        const userScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            // Scene details\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name,\n            tsxCode: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.tsxCode,\n            duration: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.duration,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt,\n            updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.updatedAt,\n            // Project context\n            projectId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id,\n            projectTitle: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title,\n            projectCreatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt,\n            // Scene activity metrics\n            iterationCount: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id})`.as('iteration_count'),\n            lastIterationDate: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt})`.as('last_iteration_date'),\n            // Complexity breakdown\n            complexEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'structural' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('complex_edits'),\n            creativeEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'creative' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('creative_edits'),\n            surgicalEdits: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.sql)`COUNT(DISTINCT CASE WHEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity} = 'surgical' THEN ${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id} END)`.as('surgical_edits')\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).leftJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.sceneId)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId)).groupBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.tsxCode, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.duration, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.updatedAt, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.createdAt).orderBy(sortOrder === 'desc' ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(sortColumn) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(sortColumn)).limit(limit).offset(offset);\n        // Get total count for pagination\n        const totalCountResult = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.count)()\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId));\n        return {\n            scenes: userScenes,\n            totalCount: totalCountResult[0]?.count || 0,\n            hasMore: offset + limit < (totalCountResult[0]?.count || 0),\n            appliedSort: {\n                sortBy,\n                sortOrder\n            }\n        };\n    }),\n    //  NEW: Get detailed scene information including iteration history\n    getSceneDetails: adminOnlyProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        sceneId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        userId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string()\n    })).query(async ({ input })=>{\n        const { sceneId, userId } = input;\n        // Verify scene belongs to user's project\n        const sceneOwnership = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            userId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId,\n            projectId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, sceneId)).limit(1);\n        if (!sceneOwnership[0] || sceneOwnership[0].userId !== userId) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Scene not found or doesn't belong to user\"\n            });\n        }\n        // Get scene details\n        const sceneDetails = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id,\n            name: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.name,\n            tsxCode: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.tsxCode,\n            duration: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.duration,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.createdAt,\n            updatedAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.updatedAt,\n            // Project context\n            projectId: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id,\n            projectTitle: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).innerJoin(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, sceneId)).limit(1);\n        // Get all iterations for this scene\n        const iterations = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id,\n            editComplexity: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.editComplexity,\n            userPrompt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.userPrompt,\n            generationTimeMs: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.generationTimeMs,\n            modelUsed: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.modelUsed,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.sceneId, sceneId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt));\n        // Get related messages from the project (context around scene creation)\n        const relatedMessages = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id,\n            role: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.role,\n            content: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.content,\n            imageUrls: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.imageUrls,\n            createdAt: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, sceneOwnership[0].projectId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.asc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.createdAt));\n        return {\n            scene: sceneDetails[0],\n            iterations,\n            relatedMessages,\n            summary: {\n                totalIterations: iterations.length,\n                complexityBreakdown: {\n                    structural: iterations.filter((i)=>i.editComplexity === 'structural').length,\n                    creative: iterations.filter((i)=>i.editComplexity === 'creative').length,\n                    surgical: iterations.filter((i)=>i.editComplexity === 'surgical').length\n                },\n                averageGenerationTime: iterations.length > 0 ? Math.round(iterations.reduce((sum, i)=>sum + (i.generationTimeMs || 0), 0) / iterations.length) : 0,\n                firstIteration: iterations[0]?.createdAt || null,\n                lastIteration: iterations[iterations.length - 1]?.createdAt || null\n            }\n        };\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVc1USxNQUFNO2dCQUNsQytRLHFCQUFxQjtvQkFDbkJDLFlBQVlKLFdBQVc1TSxNQUFNLENBQUN0QixDQUFBQSxJQUFLQSxFQUFFOEosY0FBYyxLQUFLLGNBQWN4TSxNQUFNO29CQUM1RWlSLFVBQVVMLFdBQVc1TSxNQUFNLENBQUN0QixDQUFBQSxJQUFLQSxFQUFFOEosY0FBYyxLQUFLLFlBQVl4TSxNQUFNO29CQUN4RWtSLFVBQVVOLFdBQVc1TSxNQUFNLENBQUN0QixDQUFBQSxJQUFLQSxFQUFFOEosY0FBYyxLQUFLLFlBQVl4TSxNQUFNO2dCQUMxRTtnQkFDQW1SLHVCQUF1QlAsV0FBVzVRLE1BQU0sR0FBRyxJQUN2Q2EsS0FBS3VRLEtBQUssQ0FBQ1IsV0FBV1MsTUFBTSxDQUFDLENBQUNDLEtBQUs1TyxJQUFNNE8sTUFBTzVPLENBQUFBLEVBQUU0TSxnQkFBZ0IsSUFBSSxJQUFJLEtBQUtzQixXQUFXNVEsTUFBTSxJQUNoRztnQkFDSnVSLGdCQUFnQlgsVUFBVSxDQUFDLEVBQUUsRUFBRXZULGFBQWE7Z0JBQzVDbVUsZUFBZVosVUFBVSxDQUFDQSxXQUFXNVEsTUFBTSxHQUFHLEVBQUUsRUFBRTNDLGFBQWE7WUFDakU7UUFDRjtJQUNGO0FBQ0osR0FBRyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3NlcnZlci9hcGkvcm91dGVycy9hZG1pbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2FkbWluLnRzXG5pbXBvcnQgeyBjcmVhdGVUUlBDUm91dGVyLCBwcm90ZWN0ZWRQcm9jZWR1cmUgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3RycGNcIjtcbmltcG9ydCB7IGRiIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IHVzZXJzLCBwcm9qZWN0cywgc2NlbmVzLCBmZWVkYmFjaywgbWVzc2FnZXMsIGFjY291bnRzLCBpbWFnZUFuYWx5c2lzLCBzY2VuZUl0ZXJhdGlvbnMsIHByb2plY3RNZW1vcnkgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgc3FsLCBhbmQsIGd0ZSwgZGVzYywgY291bnQsIGVxLCBsaWtlLCBvciwgaW5BcnJheSwgYXNjIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBUUlBDRXJyb3IgfSBmcm9tIFwiQHRycGMvc2VydmVyXCI7XG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuXG4vLyBJbnB1dCBzY2hlbWEgZm9yIHRpbWVmcmFtZSBmaWx0ZXJpbmdcbmNvbnN0IHRpbWVmcmFtZVNjaGVtYSA9IHouZW51bShbJ2FsbCcsICczMGQnLCAnMjRoJ10pLmRlZmF1bHQoJ2FsbCcpO1xuXG4vLyBVc2VyIHVwZGF0ZSBzY2hlbWEgLSBub3cgaW5jbHVkZXMgaXNBZG1pblxuY29uc3QgdXNlclVwZGF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgbmFtZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLm9wdGlvbmFsKCksXG4gIGltYWdlOiB6LnN0cmluZygpLnVybCgpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgaXNBZG1pbjogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcbn0pO1xuXG4vLyBBZG1pbi1vbmx5IHByb2NlZHVyZSB0aGF0IGNoZWNrcyBpZiB1c2VyIGlzIGFkbWluXG5jb25zdCBhZG1pbk9ubHlQcm9jZWR1cmUgPSBwcm90ZWN0ZWRQcm9jZWR1cmUudXNlKGFzeW5jICh7IGN0eCwgbmV4dCB9KSA9PiB7XG4gIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbiAgY29uc3QgdXNlciA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGlzQWRtaW46IHVzZXJzLmlzQWRtaW4gfSlcbiAgICAuZnJvbSh1c2VycylcbiAgICAud2hlcmUoZXEodXNlcnMuaWQsIGN0eC5zZXNzaW9uLnVzZXIuaWQpKVxuICAgIC5saW1pdCgxKTtcblxuICBpZiAoIXVzZXJbMF0/LmlzQWRtaW4pIHtcbiAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgIGNvZGU6IFwiRk9SQklEREVOXCIsXG4gICAgICBtZXNzYWdlOiBcIkFkbWluIGFjY2VzcyByZXF1aXJlZFwiLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIG5leHQoKTtcbn0pO1xuXG5leHBvcnQgY29uc3QgYWRtaW5Sb3V0ZXIgPSBjcmVhdGVUUlBDUm91dGVyKHtcbiAgLy8gQ2hlY2sgaWYgY3VycmVudCB1c2VyIGlzIGFkbWluXG4gIGNoZWNrQWRtaW5BY2Nlc3M6IHByb3RlY3RlZFByb2NlZHVyZVxuICAgIC5xdWVyeShhc3luYyAoeyBjdHggfSkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBpc0FkbWluOiB1c2Vycy5pc0FkbWluIH0pXG4gICAgICAgIC5mcm9tKHVzZXJzKVxuICAgICAgICAud2hlcmUoZXEodXNlcnMuaWQsIGN0eC5zZXNzaW9uLnVzZXIuaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQWRtaW46IHVzZXJbMF0/LmlzQWRtaW4gfHwgZmFsc2UsXG4gICAgICB9O1xuICAgIH0pLFxuXG4gIC8vIFRvZ2dsZSB1c2VyIGFkbWluIHN0YXR1cyAtIGFkbWluIG9ubHlcbiAgdG9nZ2xlVXNlckFkbWluOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3QoeyBcbiAgICAgIHVzZXJJZDogei5zdHJpbmcoKSxcbiAgICAgIGlzQWRtaW46IHouYm9vbGVhbigpIFxuICAgIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUodXNlcnMpXG4gICAgICAgIC5zZXQoeyBpc0FkbWluOiBpbnB1dC5pc0FkbWluIH0pXG4gICAgICAgIC53aGVyZShlcSh1c2Vycy5pZCwgaW5wdXQudXNlcklkKSlcbiAgICAgICAgLnJldHVybmluZyh7XG4gICAgICAgICAgaWQ6IHVzZXJzLmlkLFxuICAgICAgICAgIG5hbWU6IHVzZXJzLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHVzZXJzLmVtYWlsLFxuICAgICAgICAgIGlzQWRtaW46IHVzZXJzLmlzQWRtaW4sXG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAoIXVwZGF0ZWRVc2VyWzBdKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJVc2VyIG5vdCBmb3VuZFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVwZGF0ZWRVc2VyWzBdO1xuICAgIH0pLFxuXG4gIC8vIEdldCB0b3RhbCB1c2VycyBjb3VudCB3aXRoIHRpbWVmcmFtZSBmaWx0ZXJpbmcgLSBhZG1pbiBvbmx5XG4gIGdldFRvdGFsVXNlcnM6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7IHRpbWVmcmFtZTogdGltZWZyYW1lU2NoZW1hIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICBsZXQgd2hlcmVDb25kaXRpb247XG5cbiAgICAgIGlmIChpbnB1dC50aW1lZnJhbWUgPT09ICcyNGgnKSB7XG4gICAgICAgIC8vIFVzZSBjcmVhdGVkQXQgZm9yIHVzZXIgY3JlYXRpb24gdGltZSB0cmFja2luZ1xuICAgICAgICB3aGVyZUNvbmRpdGlvbiA9IGd0ZSh1c2Vycy5jcmVhdGVkQXQsIG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0LnRpbWVmcmFtZSA9PT0gJzMwZCcpIHtcbiAgICAgICAgd2hlcmVDb25kaXRpb24gPSBndGUodXNlcnMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgLndoZXJlKHdoZXJlQ29uZGl0aW9uKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG90YWw6IHJlc3VsdFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgdGltZWZyYW1lOiBpbnB1dC50aW1lZnJhbWVcbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gR2V0IHVuaXF1ZSBwcm9qZWN0cyBjcmVhdGVkIGluIHRpbWVmcmFtZSAtIGFkbWluIG9ubHlcbiAgZ2V0UHJvamVjdHNDcmVhdGVkOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3QoeyB0aW1lZnJhbWU6IHRpbWVmcmFtZVNjaGVtYSB9KSlcbiAgICAucXVlcnkoYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgbGV0IHdoZXJlQ29uZGl0aW9uO1xuXG4gICAgICBpZiAoaW5wdXQudGltZWZyYW1lID09PSAnMjRoJykge1xuICAgICAgICB3aGVyZUNvbmRpdGlvbiA9IGd0ZShwcm9qZWN0cy5jcmVhdGVkQXQsIG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0LnRpbWVmcmFtZSA9PT0gJzMwZCcpIHtcbiAgICAgICAgd2hlcmVDb25kaXRpb24gPSBndGUocHJvamVjdHMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAuZnJvbShwcm9qZWN0cylcbiAgICAgICAgLndoZXJlKHdoZXJlQ29uZGl0aW9uKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG90YWw6IHJlc3VsdFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgdGltZWZyYW1lOiBpbnB1dC50aW1lZnJhbWVcbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gR2V0IHNjZW5lcyBjcmVhdGVkIGluIHRpbWVmcmFtZSAtIGFkbWluIG9ubHlcbiAgZ2V0U2NlbmVzQ3JlYXRlZDogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHsgdGltZWZyYW1lOiB0aW1lZnJhbWVTY2hlbWEgfSkpXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGxldCB3aGVyZUNvbmRpdGlvbjtcblxuICAgICAgaWYgKGlucHV0LnRpbWVmcmFtZSA9PT0gJzI0aCcpIHtcbiAgICAgICAgd2hlcmVDb25kaXRpb24gPSBndGUoc2NlbmVzLmNyZWF0ZWRBdCwgbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXQudGltZWZyYW1lID09PSAnMzBkJykge1xuICAgICAgICB3aGVyZUNvbmRpdGlvbiA9IGd0ZShzY2VuZXMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAuZnJvbShzY2VuZXMpXG4gICAgICAgIC53aGVyZSh3aGVyZUNvbmRpdGlvbik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsOiByZXN1bHRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIHRpbWVmcmFtZTogaW5wdXQudGltZWZyYW1lXG4gICAgICB9O1xuICAgIH0pLFxuXG4gIC8vIEdldCByZWNlbnQgZmVlZGJhY2sgZW50cmllcyAtIGFkbWluIG9ubHlcbiAgZ2V0UmVjZW50RmVlZGJhY2s6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7IGxpbWl0OiB6Lm51bWJlcigpLmRlZmF1bHQoMTApIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zdCBmZWVkYmFja0VudHJpZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogZmVlZGJhY2suaWQsXG4gICAgICAgICAgY29udGVudDogZmVlZGJhY2suY29udGVudCxcbiAgICAgICAgICBuYW1lOiBmZWVkYmFjay5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBmZWVkYmFjay5lbWFpbCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGZlZWRiYWNrLmNyZWF0ZWRBdCxcbiAgICAgICAgICBzdGF0dXM6IGZlZWRiYWNrLnN0YXR1cyxcbiAgICAgICAgICBwcmlvcml0aXplZEZlYXR1cmVzOiBmZWVkYmFjay5wcmlvcml0aXplZEZlYXR1cmVzLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShmZWVkYmFjaylcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhmZWVkYmFjay5jcmVhdGVkQXQpKVxuICAgICAgICAubGltaXQoaW5wdXQubGltaXQpO1xuXG4gICAgICByZXR1cm4gZmVlZGJhY2tFbnRyaWVzO1xuICAgIH0pLFxuXG4gIC8vIEdldCBjb21wcmVoZW5zaXZlIGRhc2hib2FyZCBtZXRyaWNzIC0gYWRtaW4gb25seVxuICBnZXREYXNoYm9hcmRNZXRyaWNzOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAucXVlcnkoYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2V0IGFsbCB0aW1lZnJhbWVzIGZvciBlYWNoIG1ldHJpYyBpbiBwYXJhbGxlbFxuICAgICAgY29uc3QgW1xuICAgICAgICB0b3RhbFVzZXJzQWxsLFxuICAgICAgICB0b3RhbFVzZXJzMzBkLFxuICAgICAgICB0b3RhbFVzZXJzN2QsXG4gICAgICAgIHRvdGFsVXNlcnMyNGgsXG4gICAgICAgIHByb2plY3RzQWxsLFxuICAgICAgICBwcm9qZWN0czMwZCxcbiAgICAgICAgcHJvamVjdHM3ZCxcbiAgICAgICAgcHJvamVjdHMyNGgsXG4gICAgICAgIHNjZW5lc0FsbCxcbiAgICAgICAgc2NlbmVzMzBkLFxuICAgICAgICBzY2VuZXM3ZCxcbiAgICAgICAgc2NlbmVzMjRoLFxuICAgICAgICByZWNlbnRGZWVkYmFja1xuICAgICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgLy8gVXNlcnMgLSB1c2luZyBjcmVhdGVkQXQgZm9yIHVzZXIgcmVnaXN0cmF0aW9uIHRyYWNraW5nXG4gICAgICAgIGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pLmZyb20odXNlcnMpLFxuICAgICAgICBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KS5mcm9tKHVzZXJzKVxuICAgICAgICAgIC53aGVyZShhbmQoXG4gICAgICAgICAgICBndGUodXNlcnMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSksXG4gICAgICAgICAgICBzcWxgJHt1c2Vycy5jcmVhdGVkQXR9IElTIE5PVCBOVUxMYFxuICAgICAgICAgICkpLFxuICAgICAgICBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KS5mcm9tKHVzZXJzKVxuICAgICAgICAgIC53aGVyZShhbmQoXG4gICAgICAgICAgICBndGUodXNlcnMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApKSxcbiAgICAgICAgICAgIHNxbGAke3VzZXJzLmNyZWF0ZWRBdH0gSVMgTk9UIE5VTExgXG4gICAgICAgICAgKSksXG4gICAgICAgIGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pLmZyb20odXNlcnMpXG4gICAgICAgICAgLndoZXJlKGFuZChcbiAgICAgICAgICAgIGd0ZSh1c2Vycy5jcmVhdGVkQXQsIG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKSksXG4gICAgICAgICAgICBzcWxgJHt1c2Vycy5jcmVhdGVkQXR9IElTIE5PVCBOVUxMYFxuICAgICAgICAgICkpLFxuXG4gICAgICAgIC8vIFByb2plY3RzXG4gICAgICAgIGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pLmZyb20ocHJvamVjdHMpLFxuICAgICAgICBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KS5mcm9tKHByb2plY3RzKVxuICAgICAgICAgIC53aGVyZShndGUocHJvamVjdHMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSkpLFxuICAgICAgICBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KS5mcm9tKHByb2plY3RzKVxuICAgICAgICAgIC53aGVyZShndGUocHJvamVjdHMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApKSksXG4gICAgICAgIGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pLmZyb20ocHJvamVjdHMpXG4gICAgICAgICAgLndoZXJlKGd0ZShwcm9qZWN0cy5jcmVhdGVkQXQsIG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKSkpLFxuXG4gICAgICAgIC8vIFNjZW5lc1xuICAgICAgICBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KS5mcm9tKHNjZW5lcyksXG4gICAgICAgIGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pLmZyb20oc2NlbmVzKVxuICAgICAgICAgIC53aGVyZShndGUoc2NlbmVzLmNyZWF0ZWRBdCwgbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCkpKSxcbiAgICAgICAgZGIuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSkuZnJvbShzY2VuZXMpXG4gICAgICAgICAgLndoZXJlKGd0ZShzY2VuZXMuY3JlYXRlZEF0LCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApKSksXG4gICAgICAgIGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pLmZyb20oc2NlbmVzKVxuICAgICAgICAgIC53aGVyZShndGUoc2NlbmVzLmNyZWF0ZWRBdCwgbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApKSksXG5cbiAgICAgICAgLy8gUmVjZW50IGZlZWRiYWNrXG4gICAgICAgIGRiLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGZlZWRiYWNrLmlkLFxuICAgICAgICAgIGNvbnRlbnQ6IGZlZWRiYWNrLmNvbnRlbnQsXG4gICAgICAgICAgbmFtZTogZmVlZGJhY2submFtZSxcbiAgICAgICAgICBlbWFpbDogZmVlZGJhY2suZW1haWwsXG4gICAgICAgICAgY3JlYXRlZEF0OiBmZWVkYmFjay5jcmVhdGVkQXQsXG4gICAgICAgICAgc3RhdHVzOiBmZWVkYmFjay5zdGF0dXMsXG4gICAgICAgIH0pLmZyb20oZmVlZGJhY2spXG4gICAgICAgICAgLm9yZGVyQnkoZGVzYyhmZWVkYmFjay5jcmVhdGVkQXQpKVxuICAgICAgICAgIC5saW1pdCg1KVxuICAgICAgXSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgYWxsOiB0b3RhbFVzZXJzQWxsWzBdPy5jb3VudCB8fCAwLFxuICAgICAgICAgIGxhc3QzMERheXM6IHRvdGFsVXNlcnMzMGRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgICAgbGFzdDdEYXlzOiB0b3RhbFVzZXJzN2RbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgICAgbGFzdDI0SG91cnM6IHRvdGFsVXNlcnMyNGhbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIH0sXG4gICAgICAgIHByb2plY3RzOiB7XG4gICAgICAgICAgYWxsOiBwcm9qZWN0c0FsbFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgICBsYXN0MzBEYXlzOiBwcm9qZWN0czMwZFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgICBsYXN0N0RheXM6IHByb2plY3RzN2RbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgICAgbGFzdDI0SG91cnM6IHByb2plY3RzMjRoWzBdPy5jb3VudCB8fCAwLFxuICAgICAgICB9LFxuICAgICAgICBzY2VuZXM6IHtcbiAgICAgICAgICBhbGw6IHNjZW5lc0FsbFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgICBsYXN0MzBEYXlzOiBzY2VuZXMzMGRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgICAgbGFzdDdEYXlzOiBzY2VuZXM3ZFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgICBsYXN0MjRIb3Vyczogc2NlbmVzMjRoWzBdPy5jb3VudCB8fCAwLFxuICAgICAgICB9LFxuICAgICAgICByZWNlbnRGZWVkYmFja1xuICAgICAgfTtcbiAgICB9KSxcblxuICAvLyBVU0VSIE1BTkFHRU1FTlQgRU5EUE9JTlRTIC0gYWRtaW4gb25seVxuXG4gIC8vIEdldCBhbGwgdXNlcnMgd2l0aCBwYWdpbmF0aW9uIGFuZCBzZWFyY2ggLSBhZG1pbiBvbmx5XG4gIGdldFVzZXJzOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgcGFnZTogei5udW1iZXIoKS5kZWZhdWx0KDEpLFxuICAgICAgbGltaXQ6IHoubnVtYmVyKCkuZGVmYXVsdCgyMCksXG4gICAgICBzZWFyY2g6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICB9KSlcbiAgICAucXVlcnkoYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgY29uc3Qgb2Zmc2V0ID0gKGlucHV0LnBhZ2UgLSAxKSAqIGlucHV0LmxpbWl0O1xuXG4gICAgICBsZXQgd2hlcmVDb25kaXRpb247XG4gICAgICBpZiAoaW5wdXQuc2VhcmNoKSB7XG4gICAgICAgIHdoZXJlQ29uZGl0aW9uID0gb3IoXG4gICAgICAgICAgbGlrZSh1c2Vycy5uYW1lLCBgJSR7aW5wdXQuc2VhcmNofSVgKSxcbiAgICAgICAgICBsaWtlKHVzZXJzLmVtYWlsLCBgJSR7aW5wdXQuc2VhcmNofSVgKVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbdXNlcnNMaXN0LCB0b3RhbENvdW50XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiB1c2Vycy5pZCxcbiAgICAgICAgICAgIG5hbWU6IHVzZXJzLm5hbWUsXG4gICAgICAgICAgICBlbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2Vycy5lbWFpbFZlcmlmaWVkLFxuICAgICAgICAgICAgaW1hZ2U6IHVzZXJzLmltYWdlLFxuICAgICAgICAgICAgaXNBZG1pbjogdXNlcnMuaXNBZG1pbiwgLy8gSW5jbHVkZSBhZG1pbiBzdGF0dXNcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogdXNlcnMuY3JlYXRlZEF0LCAvLyBJbmNsdWRlIGNyZWF0aW9uIHRpbWVzdGFtcFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20odXNlcnMpXG4gICAgICAgICAgLndoZXJlKHdoZXJlQ29uZGl0aW9uKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2ModXNlcnMuY3JlYXRlZEF0KSkgLy8gT3JkZXIgYnkgY3JlYXRpb24gdGltZSBpbnN0ZWFkXG4gICAgICAgICAgLmxpbWl0KGlucHV0LmxpbWl0KVxuICAgICAgICAgIC5vZmZzZXQob2Zmc2V0KSxcblxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAgIC5mcm9tKHVzZXJzKVxuICAgICAgICAgIC53aGVyZSh3aGVyZUNvbmRpdGlvbilcbiAgICAgIF0pO1xuXG4gICAgICAvLyBHZXQgcHJvbXB0IGNvdW50cyBmb3IgZWFjaCB1c2VyXG4gICAgICBjb25zdCB1c2VySWRzID0gdXNlcnNMaXN0Lm1hcCh1c2VyID0+IHVzZXIuaWQpO1xuICAgICAgY29uc3QgcHJvbXB0Q291bnRzID0gdXNlcklkcy5sZW5ndGggPiAwID8gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgdXNlcklkOiBwcm9qZWN0cy51c2VySWQsXG4gICAgICAgICAgY291bnQ6IGNvdW50KG1lc3NhZ2VzLmlkKVxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShtZXNzYWdlcylcbiAgICAgICAgLmlubmVySm9pbihwcm9qZWN0cywgZXEobWVzc2FnZXMucHJvamVjdElkLCBwcm9qZWN0cy5pZCkpXG4gICAgICAgIC53aGVyZShhbmQoXG4gICAgICAgICAgaW5BcnJheShwcm9qZWN0cy51c2VySWQsIHVzZXJJZHMpLFxuICAgICAgICAgIGVxKG1lc3NhZ2VzLnJvbGUsICd1c2VyJylcbiAgICAgICAgKSlcbiAgICAgICAgLmdyb3VwQnkocHJvamVjdHMudXNlcklkKSA6IFtdO1xuXG4gICAgICAvLyBDcmVhdGUgYSBtYXAgb2YgdXNlcklkIHRvIHByb21wdCBjb3VudCBmb3IgZWFzeSBsb29rdXBcbiAgICAgIGNvbnN0IHByb21wdENvdW50TWFwID0gbmV3IE1hcCgpO1xuICAgICAgcHJvbXB0Q291bnRzLmZvckVhY2gocGMgPT4ge1xuICAgICAgICBwcm9tcHRDb3VudE1hcC5zZXQocGMudXNlcklkLCBwYy5jb3VudCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIHByb21wdCBjb3VudHMgdG8gdXNlcnNcbiAgICAgIGNvbnN0IHVzZXJzV2l0aFByb21wdHMgPSB1c2Vyc0xpc3QubWFwKHVzZXIgPT4gKHtcbiAgICAgICAgLi4udXNlcixcbiAgICAgICAgdG90YWxQcm9tcHRzOiBwcm9tcHRDb3VudE1hcC5nZXQodXNlci5pZCkgfHwgMFxuICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyczogdXNlcnNXaXRoUHJvbXB0cyxcbiAgICAgICAgdG90YWw6IHRvdGFsQ291bnRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIHBhZ2U6IGlucHV0LnBhZ2UsXG4gICAgICAgIGxpbWl0OiBpbnB1dC5saW1pdCxcbiAgICAgICAgdG90YWxQYWdlczogTWF0aC5jZWlsKCh0b3RhbENvdW50WzBdPy5jb3VudCB8fCAwKSAvIGlucHV0LmxpbWl0KVxuICAgICAgfTtcbiAgICB9KSxcblxuICAvLyBHZXQgc2luZ2xlIHVzZXIgYnkgSUQgLSBhZG1pbiBvbmx5XG4gIGdldFVzZXI6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7IHVzZXJJZDogei5zdHJpbmcoKSB9KSlcbiAgICAucXVlcnkoYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiB1c2Vycy5pZCxcbiAgICAgICAgICBuYW1lOiB1c2Vycy5uYW1lLFxuICAgICAgICAgIGVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2Vycy5lbWFpbFZlcmlmaWVkLFxuICAgICAgICAgIGltYWdlOiB1c2Vycy5pbWFnZSxcbiAgICAgICAgICBpc0FkbWluOiB1c2Vycy5pc0FkbWluLCAvLyBJbmNsdWRlIGFkbWluIHN0YXR1c1xuICAgICAgICAgIGNyZWF0ZWRBdDogdXNlcnMuY3JlYXRlZEF0LCAvLyBJbmNsdWRlIGNyZWF0aW9uIHRpbWVzdGFtcFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgLndoZXJlKGVxKHVzZXJzLmlkLCBpbnB1dC51c2VySWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmICghdXNlclswXSkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlciBub3QgZm91bmRcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB1c2VyJ3MgcHJvamVjdCBjb3VudCwgbGF0ZXN0IGFjdGl2aXR5LCBhbmQgcHJvbXB0IGNvdW50XG4gICAgICBjb25zdCBbcHJvamVjdENvdW50LCBsYXRlc3RQcm9qZWN0LCBwcm9tcHRDb3VudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pXG4gICAgICAgICAgLmZyb20ocHJvamVjdHMpXG4gICAgICAgICAgLndoZXJlKGVxKHByb2plY3RzLnVzZXJJZCwgaW5wdXQudXNlcklkKSksXG5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBwcm9qZWN0cy5pZCxcbiAgICAgICAgICAgIHRpdGxlOiBwcm9qZWN0cy50aXRsZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogcHJvamVjdHMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBwcm9qZWN0cy51cGRhdGVkQXQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShwcm9qZWN0cylcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMudXNlcklkLCBpbnB1dC51c2VySWQpKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2MocHJvamVjdHMudXBkYXRlZEF0KSlcbiAgICAgICAgICAubGltaXQoMSksXG5cbiAgICAgICAgLy8gQ291bnQgdG90YWwgdXNlciBtZXNzYWdlcy9wcm9tcHRzIGJ5IGpvaW5pbmcgdGhyb3VnaCBwcm9qZWN0c1xuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAgIC5mcm9tKG1lc3NhZ2VzKVxuICAgICAgICAgIC5pbm5lckpvaW4ocHJvamVjdHMsIGVxKG1lc3NhZ2VzLnByb2plY3RJZCwgcHJvamVjdHMuaWQpKVxuICAgICAgICAgIC53aGVyZShhbmQoXG4gICAgICAgICAgICBlcShwcm9qZWN0cy51c2VySWQsIGlucHV0LnVzZXJJZCksXG4gICAgICAgICAgICBlcShtZXNzYWdlcy5yb2xlLCAndXNlcicpIC8vIE9ubHkgY291bnQgdXNlciBtZXNzYWdlcywgbm90IGFzc2lzdGFudCByZXNwb25zZXNcbiAgICAgICAgICApKVxuICAgICAgXSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnVzZXJbMF0sXG4gICAgICAgIHByb2plY3RDb3VudDogcHJvamVjdENvdW50WzBdPy5jb3VudCB8fCAwLFxuICAgICAgICBsYXRlc3RQcm9qZWN0OiBsYXRlc3RQcm9qZWN0WzBdIHx8IG51bGwsXG4gICAgICAgIHByb21wdENvdW50OiBwcm9tcHRDb3VudFswXT8uY291bnQgfHwgMCxcbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gVXBkYXRlIHVzZXIgZGF0YSAtIGFkbWluIG9ubHlcbiAgdXBkYXRlVXNlcjogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHVzZXJJZDogei5zdHJpbmcoKSxcbiAgICAgIGRhdGE6IHVzZXJVcGRhdGVTY2hlbWEsXG4gICAgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXG4gICAgICBpZiAoaW5wdXQuZGF0YS5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0LmRhdGEubmFtZTtcbiAgICAgIGlmIChpbnB1dC5kYXRhLmVtYWlsICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZW1haWwgPSBpbnB1dC5kYXRhLmVtYWlsO1xuICAgICAgaWYgKGlucHV0LmRhdGEuaW1hZ2UgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5pbWFnZSA9IGlucHV0LmRhdGEuaW1hZ2U7XG4gICAgICBpZiAoaW5wdXQuZGF0YS5pc0FkbWluICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuaXNBZG1pbiA9IGlucHV0LmRhdGEuaXNBZG1pbjtcblxuICAgICAgaWYgKE9iamVjdC5rZXlzKHVwZGF0ZURhdGEpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJObyBkYXRhIHByb3ZpZGVkIGZvciB1cGRhdGVcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZSh1c2VycylcbiAgICAgICAgLnNldCh1cGRhdGVEYXRhKVxuICAgICAgICAud2hlcmUoZXEodXNlcnMuaWQsIGlucHV0LnVzZXJJZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoe1xuICAgICAgICAgIGlkOiB1c2Vycy5pZCxcbiAgICAgICAgICBuYW1lOiB1c2Vycy5uYW1lLFxuICAgICAgICAgIGVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2Vycy5lbWFpbFZlcmlmaWVkLFxuICAgICAgICAgIGltYWdlOiB1c2Vycy5pbWFnZSxcbiAgICAgICAgICBpc0FkbWluOiB1c2Vycy5pc0FkbWluLFxuICAgICAgICAgIGNyZWF0ZWRBdDogdXNlcnMuY3JlYXRlZEF0LCAvLyBJbmNsdWRlIGNyZWF0aW9uIHRpbWVzdGFtcFxuICAgICAgICB9KTtcblxuICAgICAgaWYgKCF1cGRhdGVkVXNlclswXSkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlciBub3QgZm91bmQgb3IgdXBkYXRlIGZhaWxlZFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVwZGF0ZWRVc2VyWzBdO1xuICAgIH0pLFxuXG4gIC8vIERlbGV0ZSB1c2VyIC0gYWRtaW4gb25seVxuICBkZWxldGVVc2VyOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3QoeyB1c2VySWQ6IHouc3RyaW5nKCkgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIC8vIFByZXZlbnQgZGVsZXRpb24gb2YgYWRtaW4gdXNlcnMgZm9yIHNhZmV0eVxuICAgICAgY29uc3QgdXNlclRvRGVsZXRlID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGlzQWRtaW46IHVzZXJzLmlzQWRtaW4sIGVtYWlsOiB1c2Vycy5lbWFpbCB9KVxuICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgLndoZXJlKGVxKHVzZXJzLmlkLCBpbnB1dC51c2VySWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmICghdXNlclRvRGVsZXRlWzBdKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJVc2VyIG5vdCBmb3VuZFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHVzZXJUb0RlbGV0ZVswXS5pc0FkbWluKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiRk9SQklEREVOXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJDYW5ub3QgZGVsZXRlIGFkbWluIHVzZXJzXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWxldGUgdXNlciBhbmQgYWxsIGFzc29jaWF0ZWQgZGF0YVxuICAgICAgLy8gTm90ZTogVGhpcyB3aWxsIGNhc2NhZGUgZGVsZXRlIHJlbGF0ZWQgZGF0YSBkdWUgdG8gZm9yZWlnbiBrZXkgY29uc3RyYWludHNcbiAgICAgIGNvbnN0IGRlbGV0ZWRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZSh1c2VycylcbiAgICAgICAgLndoZXJlKGVxKHVzZXJzLmlkLCBpbnB1dC51c2VySWQpKVxuICAgICAgICAucmV0dXJuaW5nKHtcbiAgICAgICAgICBpZDogdXNlcnMuaWQsXG4gICAgICAgICAgZW1haWw6IHVzZXJzLmVtYWlsLFxuICAgICAgICB9KTtcblxuICAgICAgaWYgKCFkZWxldGVkVXNlclswXSkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGRlbGV0ZSB1c2VyXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgICAgIGRlbGV0ZWRVc2VyOiBkZWxldGVkVXNlclswXSBcbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gR2V0IHVzZXIgYWN0aXZpdHkgc3VtbWFyeSAtIGFkbWluIG9ubHlcbiAgZ2V0VXNlckFjdGl2aXR5OiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3QoeyB1c2VySWQ6IHouc3RyaW5nKCkgfSkpXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IFt1c2VyUHJvamVjdHMsIHVzZXJTY2VuZXMsIHVzZXJGZWVkYmFja10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogcHJvamVjdHMuaWQsXG4gICAgICAgICAgICB0aXRsZTogcHJvamVjdHMudGl0bGUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHByb2plY3RzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogcHJvamVjdHMudXBkYXRlZEF0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20ocHJvamVjdHMpXG4gICAgICAgICAgLndoZXJlKGVxKHByb2plY3RzLnVzZXJJZCwgaW5wdXQudXNlcklkKSlcbiAgICAgICAgICAub3JkZXJCeShkZXNjKHByb2plY3RzLnVwZGF0ZWRBdCkpXG4gICAgICAgICAgLmxpbWl0KDEwKSxcblxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IHNjZW5lcy5pZCxcbiAgICAgICAgICAgIG5hbWU6IHNjZW5lcy5uYW1lLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBzY2VuZXMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgcHJvamVjdElkOiBzY2VuZXMucHJvamVjdElkLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NlbmVzKVxuICAgICAgICAgIC5pbm5lckpvaW4ocHJvamVjdHMsIGVxKHNjZW5lcy5wcm9qZWN0SWQsIHByb2plY3RzLmlkKSlcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMudXNlcklkLCBpbnB1dC51c2VySWQpKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2Moc2NlbmVzLmNyZWF0ZWRBdCkpXG4gICAgICAgICAgLmxpbWl0KDEwKSxcblxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGZlZWRiYWNrLmlkLFxuICAgICAgICAgICAgY29udGVudDogZmVlZGJhY2suY29udGVudCxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogZmVlZGJhY2suY3JlYXRlZEF0LFxuICAgICAgICAgICAgc3RhdHVzOiBmZWVkYmFjay5zdGF0dXMsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShmZWVkYmFjaylcbiAgICAgICAgICAud2hlcmUoZXEoZmVlZGJhY2sudXNlcklkLCBpbnB1dC51c2VySWQpKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2MoZmVlZGJhY2suY3JlYXRlZEF0KSlcbiAgICAgICAgICAubGltaXQoNSlcbiAgICAgIF0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm9qZWN0czogdXNlclByb2plY3RzLFxuICAgICAgICBzY2VuZXM6IHVzZXJTY2VuZXMsXG4gICAgICAgIGZlZWRiYWNrOiB1c2VyRmVlZGJhY2ssXG4gICAgICB9O1xuICAgIH0pLFxuXG4gIC8vIEFOQUxZVElDUyBFTkRQT0lOVFMgLSBhZG1pbiBvbmx5XG5cbiAgLy8gR2V0IHRpbWUtc2VyaWVzIGFuYWx5dGljcyBkYXRhXG4gIGdldEFuYWx5dGljc0RhdGE6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7IFxuICAgICAgdGltZWZyYW1lOiB6LmVudW0oWycyNGgnLCAnN2QnLCAnMzBkJ10pLFxuICAgICAgbWV0cmljOiB6LmVudW0oWyd1c2VycycsICdwcm9qZWN0cycsICdzY2VuZXMnLCAncHJvbXB0cyddKVxuICAgIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zdCB7IHRpbWVmcmFtZSwgbWV0cmljIH0gPSBpbnB1dDtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGludGVydmFscyBhbmQgZGF0ZSByYW5nZXNcbiAgICAgIGxldCBpbnRlcnZhbEhvdXJzOiBudW1iZXI7XG4gICAgICBsZXQgdG90YWxQZXJpb2RIb3VyczogbnVtYmVyO1xuXG4gICAgICBzd2l0Y2ggKHRpbWVmcmFtZSkge1xuICAgICAgICBjYXNlICcyNGgnOlxuICAgICAgICAgIGludGVydmFsSG91cnMgPSAxOyAvLyAxLWhvdXIgaW50ZXJ2YWxzXG4gICAgICAgICAgdG90YWxQZXJpb2RIb3VycyA9IDI0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICc3ZCc6XG4gICAgICAgICAgaW50ZXJ2YWxIb3VycyA9IDI0OyAvLyAyNC1ob3VyIChkYWlseSkgaW50ZXJ2YWxzXG4gICAgICAgICAgdG90YWxQZXJpb2RIb3VycyA9IDcgKiAyNDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnMzBkJzpcbiAgICAgICAgICBpbnRlcnZhbEhvdXJzID0gMjQ7IC8vIDI0LWhvdXIgKGRhaWx5KSBpbnRlcnZhbHNcbiAgICAgICAgICB0b3RhbFBlcmlvZEhvdXJzID0gMzAgKiAyNDtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIHRvdGFsUGVyaW9kSG91cnMgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgICAgIC8vIEdlbmVyYXRlIHRpbWUgc2xvdHNcbiAgICAgIGNvbnN0IHRpbWVTbG90cyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLmNlaWwodG90YWxQZXJpb2RIb3VycyAvIGludGVydmFsSG91cnMpOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc2xvdFN0YXJ0ID0gbmV3IERhdGUoc3RhcnREYXRlLmdldFRpbWUoKSArIGkgKiBpbnRlcnZhbEhvdXJzICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgICBjb25zdCBzbG90RW5kID0gbmV3IERhdGUoc2xvdFN0YXJ0LmdldFRpbWUoKSArIGludGVydmFsSG91cnMgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICAgIHRpbWVTbG90cy5wdXNoKHtcbiAgICAgICAgICBzdGFydDogc2xvdFN0YXJ0LFxuICAgICAgICAgIGVuZDogc2xvdEVuZCxcbiAgICAgICAgICBsYWJlbDogdGltZWZyYW1lID09PSAnMjRoJyBcbiAgICAgICAgICAgID8gc2xvdFN0YXJ0LnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pXG4gICAgICAgICAgICA6IHNsb3RTdGFydC50b0xvY2FsZURhdGVTdHJpbmcoW10sIHsgbW9udGg6ICdzaG9ydCcsIGRheTogJ251bWVyaWMnIH0pXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgZGF0YSBiYXNlZCBvbiBtZXRyaWMgdHlwZVxuICAgICAgbGV0IGRhdGE6IHsgdGltZXN0YW1wOiBEYXRlOyBjb3VudDogbnVtYmVyIH1bXSA9IFtdO1xuXG4gICAgICBzd2l0Y2ggKG1ldHJpYykge1xuICAgICAgICBjYXNlICd1c2Vycyc6XG4gICAgICAgICAgLy8gR2V0IG5ldyB1c2VycyBieSBjcmVhdGVkQXQgdGltZXN0YW1wXG4gICAgICAgICAgY29uc3QgdXNlckNvdW50cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiB1c2Vycy5jcmVhdGVkQXQsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZyb20odXNlcnMpXG4gICAgICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgICAgICBndGUodXNlcnMuY3JlYXRlZEF0LCBzdGFydERhdGUpLFxuICAgICAgICAgICAgICBzcWxgJHt1c2Vycy5jcmVhdGVkQXR9IElTIE5PVCBOVUxMYFxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgIC5vcmRlckJ5KHVzZXJzLmNyZWF0ZWRBdCk7XG5cbiAgICAgICAgICBkYXRhID0gdXNlckNvdW50cy5tYXAocm93ID0+ICh7XG4gICAgICAgICAgICB0aW1lc3RhbXA6IHJvdy50aW1lc3RhbXAhLFxuICAgICAgICAgICAgY291bnQ6IDFcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAncHJvamVjdHMnOlxuICAgICAgICAgIGNvbnN0IHByb2plY3RDb3VudHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogcHJvamVjdHMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAgICAgLndoZXJlKGd0ZShwcm9qZWN0cy5jcmVhdGVkQXQsIHN0YXJ0RGF0ZSkpXG4gICAgICAgICAgICAub3JkZXJCeShwcm9qZWN0cy5jcmVhdGVkQXQpO1xuXG4gICAgICAgICAgZGF0YSA9IHByb2plY3RDb3VudHMubWFwKHJvdyA9PiAoe1xuICAgICAgICAgICAgdGltZXN0YW1wOiByb3cudGltZXN0YW1wLFxuICAgICAgICAgICAgY291bnQ6IDFcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnc2NlbmVzJzpcbiAgICAgICAgICBjb25zdCBzY2VuZUNvdW50cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiBzY2VuZXMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mcm9tKHNjZW5lcylcbiAgICAgICAgICAgIC53aGVyZShndGUoc2NlbmVzLmNyZWF0ZWRBdCwgc3RhcnREYXRlKSlcbiAgICAgICAgICAgIC5vcmRlckJ5KHNjZW5lcy5jcmVhdGVkQXQpO1xuXG4gICAgICAgICAgZGF0YSA9IHNjZW5lQ291bnRzLm1hcChyb3cgPT4gKHtcbiAgICAgICAgICAgIHRpbWVzdGFtcDogcm93LnRpbWVzdGFtcCxcbiAgICAgICAgICAgIGNvdW50OiAxXG4gICAgICAgICAgfSkpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ3Byb21wdHMnOlxuICAgICAgICAgIC8vIEdldCB1c2VyIG1lc3NhZ2VzIChwcm9tcHRzKSBieSBqb2luaW5nIHRocm91Z2ggcHJvamVjdHNcbiAgICAgICAgICBjb25zdCBwcm9tcHRDb3VudHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbWVzc2FnZXMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mcm9tKG1lc3NhZ2VzKVxuICAgICAgICAgICAgLmlubmVySm9pbihwcm9qZWN0cywgZXEobWVzc2FnZXMucHJvamVjdElkLCBwcm9qZWN0cy5pZCkpXG4gICAgICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgICAgICBndGUobWVzc2FnZXMuY3JlYXRlZEF0LCBzdGFydERhdGUpLFxuICAgICAgICAgICAgICBlcShtZXNzYWdlcy5yb2xlLCAndXNlcicpIC8vIE9ubHkgY291bnQgdXNlciBtZXNzYWdlc1xuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgIC5vcmRlckJ5KG1lc3NhZ2VzLmNyZWF0ZWRBdCk7XG5cbiAgICAgICAgICBkYXRhID0gcHJvbXB0Q291bnRzLm1hcChyb3cgPT4gKHtcbiAgICAgICAgICAgIHRpbWVzdGFtcDogcm93LnRpbWVzdGFtcCxcbiAgICAgICAgICAgIGNvdW50OiAxXG4gICAgICAgICAgfSkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICAvLyBBZ2dyZWdhdGUgZGF0YSBpbnRvIHRpbWUgc2xvdHNcbiAgICAgIGNvbnN0IGNoYXJ0RGF0YSA9IHRpbWVTbG90cy5tYXAoc2xvdCA9PiB7XG4gICAgICAgIGNvbnN0IHNsb3REYXRhID0gZGF0YS5maWx0ZXIoaXRlbSA9PiBcbiAgICAgICAgICBpdGVtLnRpbWVzdGFtcCA+PSBzbG90LnN0YXJ0ICYmIGl0ZW0udGltZXN0YW1wIDwgc2xvdC5lbmRcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxhYmVsOiBzbG90LmxhYmVsLFxuICAgICAgICAgIHRpbWVzdGFtcDogc2xvdC5zdGFydC50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGNvdW50OiBzbG90RGF0YS5sZW5ndGgsXG4gICAgICAgICAgY3VtdWxhdGl2ZTogMCwgLy8gV2lsbCBiZSBjYWxjdWxhdGVkIGJlbG93XG4gICAgICAgIH07XG4gICAgICB9KTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGN1bXVsYXRpdmUgdmFsdWVzXG4gICAgICBsZXQgY3VtdWxhdGl2ZSA9IDA7XG4gICAgICBjaGFydERhdGEuZm9yRWFjaChwb2ludCA9PiB7XG4gICAgICAgIGN1bXVsYXRpdmUgKz0gcG9pbnQuY291bnQ7XG4gICAgICAgIHBvaW50LmN1bXVsYXRpdmUgPSBjdW11bGF0aXZlO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpbWVmcmFtZSxcbiAgICAgICAgbWV0cmljLFxuICAgICAgICBkYXRhOiBjaGFydERhdGEsXG4gICAgICAgIHRvdGFsQ291bnQ6IGN1bXVsYXRpdmUsXG4gICAgICAgIHBlcmlvZFN0YXJ0OiBzdGFydERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcGVyaW9kRW5kOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9O1xuICAgIH0pLFxuXG4gIC8vIEdldCBvdmVydmlldyBhbmFseXRpY3MgZm9yIGFsbCBtZXRyaWNzXG4gIGdldEFuYWx5dGljc092ZXJ2aWV3OiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3QoeyB0aW1lZnJhbWU6IHouZW51bShbJzI0aCcsICc3ZCcsICczMGQnXSkgfSkpXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgdGltZWZyYW1lIH0gPSBpbnB1dDtcblxuICAgICAgbGV0IHBlcmlvZEhvdXJzOiBudW1iZXI7XG4gICAgICBzd2l0Y2ggKHRpbWVmcmFtZSkge1xuICAgICAgICBjYXNlICcyNGgnOiBwZXJpb2RIb3VycyA9IDI0OyBicmVhaztcbiAgICAgICAgY2FzZSAnN2QnOiBwZXJpb2RIb3VycyA9IDcgKiAyNDsgYnJlYWs7XG4gICAgICAgIGNhc2UgJzMwZCc6IHBlcmlvZEhvdXJzID0gMzAgKiAyNDsgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSBwZXJpb2RIb3VycyAqIDYwICogNjAgKiAxMDAwKTtcblxuICAgICAgLy8gR2V0IGFsbCBtZXRyaWNzIGluIHBhcmFsbGVsXG4gICAgICBjb25zdCBbbmV3VXNlcnMsIG5ld1Byb2plY3RzLCBuZXdTY2VuZXMsIG5ld1Byb21wdHNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAvLyBOZXcgdXNlcnNcbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgICAgZ3RlKHVzZXJzLmNyZWF0ZWRBdCwgc3RhcnREYXRlKSxcbiAgICAgICAgICAgIHNxbGAke3VzZXJzLmNyZWF0ZWRBdH0gSVMgTk9UIE5VTExgXG4gICAgICAgICAgKSksXG5cbiAgICAgICAgLy8gTmV3IHByb2plY3RzXG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pXG4gICAgICAgICAgLmZyb20ocHJvamVjdHMpXG4gICAgICAgICAgLndoZXJlKGd0ZShwcm9qZWN0cy5jcmVhdGVkQXQsIHN0YXJ0RGF0ZSkpLFxuXG4gICAgICAgIC8vIE5ldyBzY2VuZXNcbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgICAgICAuZnJvbShzY2VuZXMpXG4gICAgICAgICAgLndoZXJlKGd0ZShzY2VuZXMuY3JlYXRlZEF0LCBzdGFydERhdGUpKSxcblxuICAgICAgICAvLyBOZXcgcHJvbXB0cyAodXNlciBtZXNzYWdlcylcbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgICAgICAuZnJvbShtZXNzYWdlcylcbiAgICAgICAgICAuaW5uZXJKb2luKHByb2plY3RzLCBlcShtZXNzYWdlcy5wcm9qZWN0SWQsIHByb2plY3RzLmlkKSlcbiAgICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgICAgZ3RlKG1lc3NhZ2VzLmNyZWF0ZWRBdCwgc3RhcnREYXRlKSxcbiAgICAgICAgICAgIGVxKG1lc3NhZ2VzLnJvbGUsICd1c2VyJylcbiAgICAgICAgICApKVxuICAgICAgXSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpbWVmcmFtZSxcbiAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgIHVzZXJzOiBuZXdVc2Vyc1swXT8uY291bnQgfHwgMCxcbiAgICAgICAgICBwcm9qZWN0czogbmV3UHJvamVjdHNbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgICAgc2NlbmVzOiBuZXdTY2VuZXNbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgICAgcHJvbXB0czogbmV3UHJvbXB0c1swXT8uY291bnQgfHwgMCxcbiAgICAgICAgfSxcbiAgICAgICAgcGVyaW9kU3RhcnQ6IHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgICBwZXJpb2RFbmQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gRVZBTFVBVElPTiBFTkRQT0lOVFMgLSBhZG1pbiBvbmx5XG5cbiAgLy8gUnVuIGV2YWx1YXRpb24gc3VpdGVcbiAgcnVuRXZhbHVhdGlvbjogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHN1aXRlSWQ6IHouc3RyaW5nKCksXG4gICAgICBtb2RlbFBhY2tzOiB6LmFycmF5KHouc3RyaW5nKCkpLFxuICAgICAgbWF4UHJvbXB0czogei5udW1iZXIoKS5vcHRpb25hbCgpLFxuICAgICAgc2hvd091dHB1dHM6IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gICAgICBjb21wYXJpc29uOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICAgICAgdmVyYm9zZTogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcbiAgICB9KSlcbiAgICAubXV0YXRpb24oYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgLy8gSW1wb3J0IHRoZSBldmFsdWF0aW9uIHJ1bm5lclxuICAgICAgY29uc3QgeyBFdmFsdWF0aW9uUnVubmVyIH0gPSBhd2FpdCBpbXBvcnQoXCJ+L2xpYi9ldmFscy9ydW5uZXJcIik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJ1bm5lciA9IG5ldyBFdmFsdWF0aW9uUnVubmVyKCk7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJ1bm5lci5ydW5TdWl0ZSh7XG4gICAgICAgICAgc3VpdGVJZDogaW5wdXQuc3VpdGVJZCxcbiAgICAgICAgICBtb2RlbFBhY2tzOiBpbnB1dC5tb2RlbFBhY2tzLFxuICAgICAgICAgIG1heFByb21wdHM6IGlucHV0Lm1heFByb21wdHMsXG4gICAgICAgICAgc2hvd091dHB1dHM6IGlucHV0LnNob3dPdXRwdXRzLFxuICAgICAgICAgIGNvbXBhcmlzb246IGlucHV0LmNvbXBhcmlzb24sXG4gICAgICAgICAgdmVyYm9zZTogaW5wdXQudmVyYm9zZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0V2YWx1YXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICBtZXNzYWdlOiBgRXZhbHVhdGlvbiBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pLFxuXG4gIC8vIENyZWF0ZSBjdXN0b20gZXZhbHVhdGlvbiBzdWl0ZVxuICBjcmVhdGVDdXN0b21TdWl0ZTogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIG5hbWU6IHouc3RyaW5nKCksXG4gICAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKSxcbiAgICAgIHByb21wdHM6IHouYXJyYXkoei5vYmplY3Qoe1xuICAgICAgICBpZDogei5zdHJpbmcoKSxcbiAgICAgICAgbmFtZTogei5zdHJpbmcoKSxcbiAgICAgICAgdHlwZTogei5lbnVtKFsndGV4dCcsICdpbWFnZScsICdjb2RlJywgJ3NjZW5lJ10pLFxuICAgICAgICBpbnB1dDogei5vYmplY3Qoe1xuICAgICAgICAgIHRleHQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgICBpbWFnZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICAgIGNvbnRleHQ6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICAgIH0pLFxuICAgICAgICBleHBlY3RlZE91dHB1dDogei5vYmplY3Qoe1xuICAgICAgICAgIHR5cGU6IHouZW51bShbJ2V4YWN0JywgJ2NvbnRhaW5zJywgJ3BhdHRlcm4nLCAncXVhbGl0eV9zY29yZSddKSxcbiAgICAgICAgICB2YWx1ZTogei51bmlvbihbei5zdHJpbmcoKSwgei5udW1iZXIoKV0pLFxuICAgICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgICBleHBlY3RlZEJlaGF2aW9yOiB6Lm9iamVjdCh7XG4gICAgICAgICAgdG9vbENhbGxlZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICAgIGVkaXRUeXBlOiB6LmVudW0oWydzdXJnaWNhbCcsICdjcmVhdGl2ZScsICdzdHJ1Y3R1cmFsJ10pLm9wdGlvbmFsKCksXG4gICAgICAgICAgc2hvdWxkTWVudGlvbjogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLFxuICAgICAgICAgIHNob3VsZE1vZGlmeTogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLFxuICAgICAgICAgIHNob3VsZEFuYWx5emVJbWFnZTogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcbiAgICAgICAgICBzaG91bGRVc2VDb250ZXh0OiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICAgICAgICAgIHNob3VsZENvbmZpcm06IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gICAgICAgICAgc2hvdWxkQXNrOiB6LmFycmF5KHouc3RyaW5nKCkpLm9wdGlvbmFsKCksXG4gICAgICAgICAgbmVlZHNDbGFyaWZpY2F0aW9uOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICAgICAgICAgIGV4cGVjdGVkRHVyYXRpb246IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgICBjb21wbGV4aXR5OiB6LmVudW0oWydsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnLCAndmVyeS1oaWdoJ10pLFxuICAgICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgfSkpLFxuICAgICAgbW9kZWxQYWNrczogei5hcnJheSh6LnN0cmluZygpKSxcbiAgICAgIHNlcnZpY2VzOiB6LmFycmF5KHouc3RyaW5nKCkpLFxuICAgIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICAvLyBGb3Igbm93LCBqdXN0IHJldHVybiB0aGUgY3JlYXRlZCBzdWl0ZSBzdHJ1Y3R1cmVcbiAgICAgIC8vIEluIHRoZSBmdXR1cmUsIHRoaXMgY291bGQgYmUgc3RvcmVkIGluIGEgZGF0YWJhc2VcbiAgICAgIGNvbnN0IGN1c3RvbVN1aXRlID0ge1xuICAgICAgICBpZDogYGN1c3RvbS0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGlucHV0LmRlc2NyaXB0aW9uLFxuICAgICAgICBwcm9tcHRzOiBpbnB1dC5wcm9tcHRzLFxuICAgICAgICBtb2RlbFBhY2tzOiBpbnB1dC5tb2RlbFBhY2tzLFxuICAgICAgICBzZXJ2aWNlczogaW5wdXQuc2VydmljZXMsXG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gY3VzdG9tU3VpdGU7XG4gICAgfSksXG5cbiAgLy8gR2V0IGF2YWlsYWJsZSBldmFsdWF0aW9uIHN1aXRlc1xuICBnZXRFdmFsdWF0aW9uU3VpdGVzOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAucXVlcnkoYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gSW1wb3J0IHN1aXRlcyBkeW5hbWljYWxseVxuICAgICAgY29uc3QgeyBhbGxFdmFsU3VpdGVzIH0gPSBhd2FpdCBpbXBvcnQoXCJ+L2xpYi9ldmFscy9zdWl0ZXMvYmFzaWMtcHJvbXB0c1wiKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGFsbEV2YWxTdWl0ZXMubWFwKHN1aXRlID0+ICh7XG4gICAgICAgIGlkOiBzdWl0ZS5pZCxcbiAgICAgICAgbmFtZTogc3VpdGUubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHN1aXRlLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcm9tcHRDb3VudDogc3VpdGUucHJvbXB0cy5sZW5ndGgsXG4gICAgICAgIHNlcnZpY2VzOiBzdWl0ZS5zZXJ2aWNlcyxcbiAgICAgICAgbW9kZWxQYWNrczogc3VpdGUubW9kZWxQYWNrcyxcbiAgICAgIH0pKTtcbiAgICB9KSxcblxuICAvLyBHZXQgYXZhaWxhYmxlIG1vZGVsIHBhY2tzXG4gIGdldE1vZGVsUGFja3M6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5xdWVyeShhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IE1PREVMX1BBQ0tTIH0gPSBhd2FpdCBpbXBvcnQoXCJ+L2NvbmZpZy9tb2RlbHMuY29uZmlnXCIpO1xuICAgICAgXG4gICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoTU9ERUxfUEFDS1MpLm1hcCgoW2lkLCBwYWNrXSkgPT4gKHtcbiAgICAgICAgaWQsXG4gICAgICAgIG5hbWU6IHBhY2submFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHBhY2suZGVzY3JpcHRpb24sXG4gICAgICAgIG1vZGVsczoge1xuICAgICAgICAgIGJyYWluOiBgJHtwYWNrLm1vZGVscy5icmFpbi5wcm92aWRlcn0vJHtwYWNrLm1vZGVscy5icmFpbi5tb2RlbH1gLFxuICAgICAgICAgIGNvZGVHZW5lcmF0b3I6IGAke3BhY2subW9kZWxzLmNvZGVHZW5lcmF0b3IucHJvdmlkZXJ9LyR7cGFjay5tb2RlbHMuY29kZUdlbmVyYXRvci5tb2RlbH1gLFxuICAgICAgICAgIHZpc2lvbkFuYWx5c2lzOiBgJHtwYWNrLm1vZGVscy52aXNpb25BbmFseXNpcy5wcm92aWRlcn0vJHtwYWNrLm1vZGVscy52aXNpb25BbmFseXNpcy5tb2RlbH1gLFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuICAgIH0pLFxuXG4gIC8vIENyZWF0ZSBjdXN0b20gcHJvbXB0IC0gYWRtaW4gb25seVxuICBjcmVhdGVDdXN0b21Qcm9tcHQ6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICBuYW1lOiB6LnN0cmluZygpLFxuICAgICAgdHlwZTogei5lbnVtKFsndGV4dCcsICdjb2RlJywgJ2ltYWdlJywgJ3NjZW5lJ10pLFxuICAgICAgdGV4dDogei5zdHJpbmcoKSxcbiAgICAgIGV4cGVjdGVkT3V0cHV0OiB6Lm9iamVjdCh7XG4gICAgICAgIHR5cGU6IHouc3RyaW5nKCksXG4gICAgICAgIHZhbHVlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgY29udGV4dDogei5hbnkoKS5vcHRpb25hbCgpLFxuICAgIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICAvLyBUT0RPOiBTdG9yZSBpbiBkYXRhYmFzZSBmb3IgcGVyc2lzdGVuY2VcbiAgICAgIGNvbnN0IGN1c3RvbVByb21wdCA9IHtcbiAgICAgICAgaWQ6IGBwcm9tcHQtJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIG5hbWU6IGlucHV0Lm5hbWUsXG4gICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgdGV4dDogaW5wdXQudGV4dCxcbiAgICAgICAgICBjb250ZXh0OiBpbnB1dC5jb250ZXh0LFxuICAgICAgICB9LFxuICAgICAgICBleHBlY3RlZE91dHB1dDogaW5wdXQuZXhwZWN0ZWRPdXRwdXQsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfTtcblxuICAgICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIGN1c3RvbSBwcm9tcHQ6JywgY3VzdG9tUHJvbXB0KTtcbiAgICAgIHJldHVybiB7IFxuICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgcHJvbXB0SWQ6IGN1c3RvbVByb21wdC5pZCxcbiAgICAgICAgcHJvbXB0OiBjdXN0b21Qcm9tcHRcbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gQ3JlYXRlIGN1c3RvbSBtb2RlbCBwYWNrIC0gYWRtaW4gb25seVxuICBjcmVhdGVDdXN0b21Nb2RlbFBhY2s6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICBuYW1lOiB6LnN0cmluZygpLFxuICAgICAgZGVzY3JpcHRpb246IHouc3RyaW5nKCksXG4gICAgICBicmFpbk1vZGVsOiB6LnN0cmluZygpLFxuICAgICAgY29kZU1vZGVsOiB6LnN0cmluZygpLFxuICAgICAgdmlzaW9uTW9kZWw6IHouc3RyaW5nKCksXG4gICAgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIC8vIFBhcnNlIHByb3ZpZGVyL21vZGVsIGZvcm1hdFxuICAgICAgY29uc3QgcGFyc2VNb2RlbCA9IChtb2RlbFN0cmluZzogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IFtwcm92aWRlciwgbW9kZWxdID0gbW9kZWxTdHJpbmcuc3BsaXQoJy8nKTtcbiAgICAgICAgcmV0dXJuIHsgcHJvdmlkZXI6IHByb3ZpZGVyISwgbW9kZWw6IG1vZGVsISB9O1xuICAgICAgfTtcblxuICAgICAgY29uc3QgY3VzdG9tUGFjayA9IHtcbiAgICAgICAgaWQ6IGBjdXN0b20tJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIG5hbWU6IGlucHV0Lm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbixcbiAgICAgICAgbW9kZWxzOiB7XG4gICAgICAgICAgYnJhaW46IHBhcnNlTW9kZWwoaW5wdXQuYnJhaW5Nb2RlbCksXG4gICAgICAgICAgY29kZUdlbmVyYXRvcjogcGFyc2VNb2RlbChpbnB1dC5jb2RlTW9kZWwpLFxuICAgICAgICAgIHZpc2lvbkFuYWx5c2lzOiBwYXJzZU1vZGVsKGlucHV0LnZpc2lvbk1vZGVsKSxcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9O1xuXG4gICAgICAvLyBUT0RPOiBTdG9yZSBpbiBkYXRhYmFzZSBmb3IgcGVyc2lzdGVuY2VcbiAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGluZyBjdXN0b20gbW9kZWwgcGFjazonLCBjdXN0b21QYWNrKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHBhY2tJZDogY3VzdG9tUGFjay5pZCwgcGFjazogY3VzdG9tUGFjayB9O1xuICAgIH0pLFxuXG4gIC8vIEFuYWx5emUgdXBsb2FkZWQgaW1hZ2UgLSBhZG1pbiBvbmx5XG4gIGFuYWx5emVVcGxvYWRlZEltYWdlOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgaW1hZ2VEYXRhOiB6LnN0cmluZygpLCAvLyBiYXNlNjQgaW1hZ2UgZGF0YVxuICAgICAgcHJvbXB0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRPRE86IEludGVncmF0ZSB3aXRoIGFjdHVhbCBpbWFnZSBhbmFseXNpcyBzZXJ2aWNlIGZyb20gfi9saWIvc2VydmljZXMvYW5hbHl6ZUltYWdlLnRzXG4gICAgICAgIGNvbnN0IGFuYWx5c2lzUmVzdWx0ID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgYW5hbHlzaXM6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkEgdXNlciBpbnRlcmZhY2UgbW9ja3VwIHNob3dpbmcgYSBtb2Rlcm4gd2ViIGFwcGxpY2F0aW9uIHdpdGggY2xlYW4gZGVzaWduIGVsZW1lbnRzLCBpbmNsdWRpbmcgbmF2aWdhdGlvbiwgY29udGVudCBhcmVhcywgYW5kIGludGVyYWN0aXZlIGNvbXBvbmVudHMuXCIsXG4gICAgICAgICAgICBjb2xvcnM6IFtcIiMzQjgyRjZcIiwgXCIjMUYyOTM3XCIsIFwiI0Y5RkFGQlwiLCBcIiNFRjQ0NDRcIl0sXG4gICAgICAgICAgICBlbGVtZW50czogW1wiTmF2aWdhdGlvbiBiYXJcIiwgXCJDb250ZW50IGNhcmRzXCIsIFwiQnV0dG9uc1wiLCBcIlRleHQgZWxlbWVudHNcIl0sXG4gICAgICAgICAgICBtb29kOiBcIlByb2Zlc3Npb25hbCBhbmQgbW9kZXJuXCIsXG4gICAgICAgICAgICBzdWdnZXN0aW9uczogW1xuICAgICAgICAgICAgICBcIlRoaXMgZGVzaWduIGNvdWxkIGJlIGltcGxlbWVudGVkIHVzaW5nIFJlYWN0IGNvbXBvbmVudHNcIixcbiAgICAgICAgICAgICAgXCJUaGUgY29sb3Igc2NoZW1lIHN1Z2dlc3RzIGEgcHJvZmVzc2lvbmFsIGFwcGxpY2F0aW9uXCIsXG4gICAgICAgICAgICAgIFwiTGF5b3V0IGFwcGVhcnMgdG8gYmUgcmVzcG9uc2l2ZS1mcmllbmRseVwiXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgcGFsZXR0ZToge1xuICAgICAgICAgICAgICBwcmltYXJ5OiBcIiMzQjgyRjZcIixcbiAgICAgICAgICAgICAgc2Vjb25kYXJ5OiBcIiMxRjI5MzdcIiwgXG4gICAgICAgICAgICAgIGFjY2VudDogXCIjRUY0NDQ0XCIsXG4gICAgICAgICAgICAgIGJhY2tncm91bmQ6IFwiI0Y5RkFGQlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHlwb2dyYXBoeToge1xuICAgICAgICAgICAgICBoZWFkZXJzOiBcIkJvbGQsIHNhbnMtc2VyaWYgdHlwb2dyYXBoeVwiLFxuICAgICAgICAgICAgICBib2R5OiBcIkNsZWFuLCByZWFkYWJsZSB0ZXh0XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBhbmFseXNpc1Jlc3VsdDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgbWVzc2FnZTogYEltYWdlIGFuYWx5c2lzIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSksXG5cbiAgLy8gR2VuZXJhdGUgc2NlbmUgZnJvbSBpbWFnZSAtIGFkbWluIG9ubHlcbiAgZ2VuZXJhdGVTY2VuZUZyb21JbWFnZTogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIGltYWdlRGF0YTogei5zdHJpbmcoKSxcbiAgICAgIGFuYWx5c2lzRGF0YTogei5hbnkoKS5vcHRpb25hbCgpLFxuICAgIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBUT0RPOiBJbnRlZ3JhdGUgd2l0aCBhY3R1YWwgc2NlbmUgZ2VuZXJhdGlvbiBzZXJ2aWNlXG4gICAgICAgIGNvbnN0IHNjZW5lQ29kZSA9IGBjb25zdCB7IEFic29sdXRlRmlsbCwgdXNlQ3VycmVudEZyYW1lLCB1c2VWaWRlb0NvbmZpZywgaW50ZXJwb2xhdGUgfSA9IHdpbmRvdy5SZW1vdGlvbjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gR2VuZXJhdGVkU2NlbmUoKSB7XG4gIGNvbnN0IGZyYW1lID0gdXNlQ3VycmVudEZyYW1lKCk7XG4gIGNvbnN0IHsgZnBzIH0gPSB1c2VWaWRlb0NvbmZpZygpO1xuICBcbiAgY29uc3Qgb3BhY2l0eSA9IGludGVycG9sYXRlKGZyYW1lLCBbMCwgZnBzICogMC41XSwgWzAsIDFdLCB7XG4gICAgZXh0cmFwb2xhdGVMZWZ0OiBcImNsYW1wXCIsXG4gICAgZXh0cmFwb2xhdGVSaWdodDogXCJjbGFtcFwiXG4gIH0pO1xuICBcbiAgY29uc3Qgc2NhbGUgPSBpbnRlcnBvbGF0ZShmcmFtZSwgWzAsIGZwc10sIFswLjgsIDFdLCB7XG4gICAgZXh0cmFwb2xhdGVMZWZ0OiBcImNsYW1wXCIsIFxuICAgIGV4dHJhcG9sYXRlUmlnaHQ6IFwiY2xhbXBcIlxuICB9KTtcbiAgXG4gIHJldHVybiAoXG4gICAgPEFic29sdXRlRmlsbCBzdHlsZT17eyBcbiAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjM0I4MkY2XCIsXG4gICAgICBkaXNwbGF5OiBcImZsZXhcIixcbiAgICAgIGZsZXhEaXJlY3Rpb246IFwiY29sdW1uXCIsXG4gICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICBiYWNrZ3JvdW5kSW1hZ2U6IFwibGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzNCODJGNiAwJSwgIzFGMjkzNyAxMDAlKVwiXG4gICAgfX0+XG4gICAgICA8ZGl2IHN0eWxlPXt7XG4gICAgICAgIG9wYWNpdHksXG4gICAgICAgIHRyYW5zZm9ybTogXFxgc2NhbGUoXFwke3NjYWxlfSlcXGAsXG4gICAgICAgIHRleHRBbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgY29sb3I6IFwid2hpdGVcIixcbiAgICAgICAgcGFkZGluZzogXCIycmVtXCJcbiAgICAgIH19PlxuICAgICAgICA8aDEgc3R5bGU9e3tcbiAgICAgICAgICBmb250U2l6ZTogXCI0cmVtXCIsXG4gICAgICAgICAgZm9udFdlaWdodDogXCI3MDBcIixcbiAgICAgICAgICBtYXJnaW46IFwiMCAwIDFyZW0gMFwiLFxuICAgICAgICAgIHRleHRTaGFkb3c6IFwiMCA0cHggOHB4IHJnYmEoMCwwLDAsMC4zKVwiXG4gICAgICAgIH19PlxuICAgICAgICAgIEdlbmVyYXRlZCBmcm9tIEltYWdlXG4gICAgICAgIDwvaDE+XG4gICAgICAgIDxwIHN0eWxlPXt7XG4gICAgICAgICAgZm9udFNpemU6IFwiMS41cmVtXCIsXG4gICAgICAgICAgb3BhY2l0eTogMC45LFxuICAgICAgICAgIG1heFdpZHRoOiBcIjYwMHB4XCJcbiAgICAgICAgfX0+XG4gICAgICAgICAgUHJvZmVzc2lvbmFsIFVJIERlc2lnbiB3aXRoIE1vZGVybiBFbGVtZW50c1xuICAgICAgICA8L3A+XG4gICAgICAgIDxkaXYgc3R5bGU9e3tcbiAgICAgICAgICBtYXJnaW5Ub3A6IFwiMnJlbVwiLFxuICAgICAgICAgIHBhZGRpbmc6IFwiMXJlbSAycmVtXCIsXG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcInJnYmEoMjU1LDI1NSwyNTUsMC4xKVwiLFxuICAgICAgICAgIGJvcmRlclJhZGl1czogXCIxMHB4XCIsXG4gICAgICAgICAgYmFja2Ryb3BGaWx0ZXI6IFwiYmx1cigxMHB4KVwiXG4gICAgICAgIH19PlxuICAgICAgICAgIDxzcGFuIHN0eWxlPXt7IGZvbnRTaXplOiBcIjEuMnJlbVwiIH19PlxuICAgICAgICAgICAgQXV0by1nZW5lcmF0ZWQgZnJvbSB1cGxvYWRlZCByZWZlcmVuY2VcbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9BYnNvbHV0ZUZpbGw+XG4gICk7XG59YDtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgc2NlbmVDb2RlLFxuICAgICAgICAgIHNjZW5lSWQ6IGBzY2VuZS0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICBzY2VuZU5hbWU6IFwiR2VuZXJhdGVkIFNjZW5lXCIsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgIG1lc3NhZ2U6IGBTY2VuZSBnZW5lcmF0aW9uIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KSxcblxuICAvLyDwn4aVIE5FVzogQ29tcHJlaGVuc2l2ZSB1c2VyIGFuYWx5dGljcyBlbmRwb2ludFxuICBnZXRVc2VyQW5hbHl0aWNzOiBhZG1pbk9ubHlQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgbGltaXQ6IHoubnVtYmVyKCkubWluKDEpLm1heCgxMDApLmRlZmF1bHQoMjApLFxuICAgICAgb2Zmc2V0OiB6Lm51bWJlcigpLm1pbigwKS5kZWZhdWx0KDApLFxuICAgICAgc29ydEJ5OiB6LmVudW0oWydzaWdudXBfZGF0ZScsICdsYXN0X2FjdGl2aXR5JywgJ3RvdGFsX3Byb2plY3RzJywgJ3RvdGFsX3Byb21wdHMnXSkuZGVmYXVsdCgnc2lnbnVwX2RhdGUnKSxcbiAgICAgIHNvcnRPcmRlcjogei5lbnVtKFsnYXNjJywgJ2Rlc2MnXSkuZGVmYXVsdCgnZGVzYycpLFxuICAgICAgc2VhcmNoVGVybTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgYXV0aFByb3ZpZGVyOiB6LmVudW0oWydhbGwnLCAnZ29vZ2xlJywgJ2dpdGh1YicsICd1bmtub3duJ10pLmRlZmF1bHQoJ2FsbCcpLFxuICAgICAgYWN0aXZpdHlGaWx0ZXI6IHouZW51bShbJ2FsbCcsICd0b2RheScsICd3ZWVrJywgJ21vbnRoJywgJ25ldmVyJ10pLmRlZmF1bHQoJ2FsbCcpLFxuICAgICAgc2lnbnVwRGF0ZUZpbHRlcjogei5lbnVtKFsnYWxsJywgJ3RvZGF5JywgJ3dlZWsnLCAnbW9udGgnLCAnb2xkZXInXSkuZGVmYXVsdCgnYWxsJyksXG4gICAgICBwcm9qZWN0c0ZpbHRlcjogei5lbnVtKFsnYWxsJywgJ25vbmUnLCAnbG93JywgJ21lZGl1bScsICdoaWdoJ10pLmRlZmF1bHQoJ2FsbCcpLFxuICAgICAgYWRtaW5GaWx0ZXI6IHouZW51bShbJ2FsbCcsICdhZG1pbicsICd1c2VyJ10pLmRlZmF1bHQoJ2FsbCcpLFxuICAgIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBpbnB1dCwgY3R4IH0pID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIGdldFVzZXJBbmFseXRpY3MgY2FsbGVkIHdpdGg6JywgeyBpbnB1dCwgaGFzQ3R4OiAhIWN0eCB9KTtcbiAgICAgIGNvbnN0IHsgXG4gICAgICAgIGxpbWl0LCBcbiAgICAgICAgb2Zmc2V0LCBcbiAgICAgICAgc29ydEJ5LCBcbiAgICAgICAgc29ydE9yZGVyLCBcbiAgICAgICAgc2VhcmNoVGVybSwgXG4gICAgICAgIGF1dGhQcm92aWRlciwgXG4gICAgICAgIGFjdGl2aXR5RmlsdGVyLCBcbiAgICAgICAgc2lnbnVwRGF0ZUZpbHRlciwgXG4gICAgICAgIHByb2plY3RzRmlsdGVyLFxuICAgICAgICBhZG1pbkZpbHRlciBcbiAgICAgIH0gPSBpbnB1dDtcblxuICAgICAgLy8gQnVpbGQgV0hFUkUgY29uZGl0aW9ucyBmb3IgZmlsdGVyaW5nXG4gICAgICBjb25zdCB3aGVyZUNvbmRpdGlvbnMgPSBbXTtcblxuICAgICAgLy8gU2VhcmNoIGZpbHRlclxuICAgICAgaWYgKHNlYXJjaFRlcm0gJiYgc2VhcmNoVGVybS50cmltKCkpIHtcbiAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goXG4gICAgICAgICAgb3IoXG4gICAgICAgICAgICBsaWtlKHVzZXJzLm5hbWUsIGAlJHtzZWFyY2hUZXJtfSVgKSxcbiAgICAgICAgICAgIGxpa2UodXNlcnMuZW1haWwsIGAlJHtzZWFyY2hUZXJtfSVgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRtaW4gc3RhdHVzIGZpbHRlclxuICAgICAgaWYgKGFkbWluRmlsdGVyICE9PSAnYWxsJykge1xuICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChlcSh1c2Vycy5pc0FkbWluLCBhZG1pbkZpbHRlciA9PT0gJ2FkbWluJykpO1xuICAgICAgfVxuXG4gICAgICAvLyBTaWdudXAgZGF0ZSBmaWx0ZXJcbiAgICAgIGlmIChzaWdudXBEYXRlRmlsdGVyICE9PSAnYWxsJykge1xuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBsZXQgc2lnbnVwVGhyZXNob2xkOiBEYXRlO1xuICAgICAgICBcbiAgICAgICAgc3dpdGNoIChzaWdudXBEYXRlRmlsdGVyKSB7XG4gICAgICAgICAgY2FzZSAndG9kYXknOlxuICAgICAgICAgICAgc2lnbnVwVGhyZXNob2xkID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpLCBub3cuZ2V0RGF0ZSgpKTtcbiAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGd0ZSh1c2Vycy5jcmVhdGVkQXQsIHNpZ251cFRocmVzaG9sZCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICBzaWdudXBUaHJlc2hvbGQgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goZ3RlKHVzZXJzLmNyZWF0ZWRBdCwgc2lnbnVwVGhyZXNob2xkKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICBzaWdudXBUaHJlc2hvbGQgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGd0ZSh1c2Vycy5jcmVhdGVkQXQsIHNpZ251cFRocmVzaG9sZCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnb2xkZXInOlxuICAgICAgICAgICAgc2lnbnVwVGhyZXNob2xkID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChzcWxgJHt1c2Vycy5jcmVhdGVkQXR9IDwgJHtzaWdudXBUaHJlc2hvbGR9YCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDwn5qoIENPTVBSRUhFTlNJVkUgVVNFUiBBTkFMWVRJQ1MgUVVFUlkgV0lUSCBFTkhBTkNFRCBGSUxURVJJTkdcbiAgICAgIGNvbnN0IGJhc2VRdWVyeSA9IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIC8vIEJhc2ljIHVzZXIgaW5mb1xuICAgICAgICAgIGlkOiB1c2Vycy5pZCxcbiAgICAgICAgICBuYW1lOiB1c2Vycy5uYW1lLFxuICAgICAgICAgIGVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICBpbWFnZTogdXNlcnMuaW1hZ2UsXG4gICAgICAgICAgaXNBZG1pbjogdXNlcnMuaXNBZG1pbixcbiAgICAgICAgICBzaWdudXBEYXRlOiB1c2Vycy5jcmVhdGVkQXQsXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gT0F1dGggcHJvdmlkZXIgaW5mb1xuICAgICAgICAgIG9hdXRoUHJvdmlkZXI6IGFjY291bnRzLnByb3ZpZGVyLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFByb2plY3QgbWV0cmljc1xuICAgICAgICAgIHRvdGFsUHJvamVjdHM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUICR7cHJvamVjdHMuaWR9KWAuYXMoJ3RvdGFsX3Byb2plY3RzJyksXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU2NlbmUgbWV0cmljcyAgXG4gICAgICAgICAgdG90YWxTY2VuZXM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUICR7c2NlbmVzLmlkfSlgLmFzKCd0b3RhbF9zY2VuZXMnKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGF0L3Byb21wdCBtZXRyaWNzXG4gICAgICAgICAgdG90YWxNZXNzYWdlczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgJHttZXNzYWdlcy5pZH0pYC5hcygndG90YWxfbWVzc2FnZXMnKSxcbiAgICAgICAgICB0b3RhbFVzZXJQcm9tcHRzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHttZXNzYWdlcy5yb2xlfSA9ICd1c2VyJyBUSEVOICR7bWVzc2FnZXMuaWR9IEVORClgLmFzKCd0b3RhbF91c2VyX3Byb21wdHMnKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBFcnJvciBtZXNzYWdlIHRyYWNraW5nXG4gICAgICAgICAgdG90YWxFcnJvck1lc3NhZ2VzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHttZXNzYWdlcy5zdGF0dXN9ID0gJ2Vycm9yJyBUSEVOICR7bWVzc2FnZXMuaWR9IEVORClgLmFzKCd0b3RhbF9lcnJvcl9tZXNzYWdlcycpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEltYWdlIHVzYWdlIG1ldHJpY3MgLSBzaW1wbGlmaWVkIHRvIGF2b2lkIGRvdWJsZS1jb3VudGluZ1xuICAgICAgICAgIHByb21wdHNXaXRoSW1hZ2VzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHttZXNzYWdlcy5pbWFnZVVybHN9IElTIE5PVCBOVUxMIEFORCBqc29uYl9hcnJheV9sZW5ndGgoJHttZXNzYWdlcy5pbWFnZVVybHN9KSA+IDAgVEhFTiAke21lc3NhZ2VzLmlkfSBFTkQpYC5hcygncHJvbXB0c193aXRoX2ltYWdlcycpLFxuICAgICAgICAgIHRvdGFsSW1hZ2VzVXBsb2FkZWQ6IHNxbDxudW1iZXI+YENPQUxFU0NFKFNVTShDQVNFIFdIRU4gJHttZXNzYWdlcy5pbWFnZVVybHN9IElTIE5PVCBOVUxMIFRIRU4ganNvbmJfYXJyYXlfbGVuZ3RoKCR7bWVzc2FnZXMuaW1hZ2VVcmxzfSkgRUxTRSAwIEVORCksIDApYC5hcygndG90YWxfaW1hZ2VzX3VwbG9hZGVkJyksXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWN0aXZpdHkgbWV0cmljc1xuICAgICAgICAgIGZpcnN0QWN0aXZpdHk6IHNxbDxEYXRlPmBNSU4oJHttZXNzYWdlcy5jcmVhdGVkQXR9KWAuYXMoJ2ZpcnN0X2FjdGl2aXR5JyksXG4gICAgICAgICAgbGFzdEFjdGl2aXR5OiBzcWw8RGF0ZT5gTUFYKCR7bWVzc2FnZXMuY3JlYXRlZEF0fSlgLmFzKCdsYXN0X2FjdGl2aXR5JyksXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRW5nYWdlbWVudCBtZXRyaWNzXG4gICAgICAgICAgdG90YWxTY2VuZUl0ZXJhdGlvbnM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUICR7c2NlbmVJdGVyYXRpb25zLmlkfSlgLmFzKCd0b3RhbF9zY2VuZV9pdGVyYXRpb25zJyksXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWR2YW5jZWQgYmVoYXZpb3IgbWV0cmljc1xuICAgICAgICAgIGNvbXBsZXhFZGl0czogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7c2NlbmVJdGVyYXRpb25zLmVkaXRDb21wbGV4aXR5fSA9ICdzdHJ1Y3R1cmFsJyBUSEVOICR7c2NlbmVJdGVyYXRpb25zLmlkfSBFTkQpYC5hcygnY29tcGxleF9lZGl0cycpLFxuICAgICAgICAgIGNyZWF0aXZlRWRpdHM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUIENBU0UgV0hFTiAke3NjZW5lSXRlcmF0aW9ucy5lZGl0Q29tcGxleGl0eX0gPSAnY3JlYXRpdmUnIFRIRU4gJHtzY2VuZUl0ZXJhdGlvbnMuaWR9IEVORClgLmFzKCdjcmVhdGl2ZV9lZGl0cycpLFxuICAgICAgICAgIHN1cmdpY2FsRWRpdHM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUIENBU0UgV0hFTiAke3NjZW5lSXRlcmF0aW9ucy5lZGl0Q29tcGxleGl0eX0gPSAnc3VyZ2ljYWwnIFRIRU4gJHtzY2VuZUl0ZXJhdGlvbnMuaWR9IEVORClgLmFzKCdzdXJnaWNhbF9lZGl0cycpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFByb2plY3QgbWVtb3J5IGluc2lnaHRzXG4gICAgICAgICAgdXNlclByZWZlcmVuY2VzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHtwcm9qZWN0TWVtb3J5Lm1lbW9yeVR5cGV9ID0gJ3VzZXJfcHJlZmVyZW5jZScgVEhFTiAke3Byb2plY3RNZW1vcnkuaWR9IEVORClgLmFzKCd1c2VyX3ByZWZlcmVuY2VzJyksXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJzKVxuICAgICAgICAubGVmdEpvaW4oYWNjb3VudHMsIGVxKHVzZXJzLmlkLCBhY2NvdW50cy51c2VySWQpKVxuICAgICAgICAubGVmdEpvaW4ocHJvamVjdHMsIGVxKHVzZXJzLmlkLCBwcm9qZWN0cy51c2VySWQpKVxuICAgICAgICAubGVmdEpvaW4oc2NlbmVzLCBlcShwcm9qZWN0cy5pZCwgc2NlbmVzLnByb2plY3RJZCkpXG4gICAgICAgIC5sZWZ0Sm9pbihtZXNzYWdlcywgZXEocHJvamVjdHMuaWQsIG1lc3NhZ2VzLnByb2plY3RJZCkpXG4gICAgICAgIC5sZWZ0Sm9pbihzY2VuZUl0ZXJhdGlvbnMsIGVxKHByb2plY3RzLmlkLCBzY2VuZUl0ZXJhdGlvbnMucHJvamVjdElkKSlcbiAgICAgICAgLmxlZnRKb2luKHByb2plY3RNZW1vcnksIGVxKHByb2plY3RzLmlkLCBwcm9qZWN0TWVtb3J5LnByb2plY3RJZCkpXG4gICAgICAgIC4kZHluYW1pYygpO1xuXG4gICAgICAvLyBFeGVjdXRlIHRoZSBxdWVyeSB3aXRoIGNvbmRpdGlvbmFsIFdIRVJFIGNsYXVzZSwgZ3JvdXBCeSBhbmQgb3JkZXJpbmdcbiAgICAgIGxldCB1c2VyQW5hbHl0aWNzID0gYXdhaXQgKHdoZXJlQ29uZGl0aW9ucy5sZW5ndGggPiAwIFxuICAgICAgICA/IGJhc2VRdWVyeS53aGVyZShhbmQoLi4ud2hlcmVDb25kaXRpb25zKSlcbiAgICAgICAgOiBiYXNlUXVlcnlcbiAgICAgIClcbiAgICAgICAgLmdyb3VwQnkodXNlcnMuaWQsIHVzZXJzLm5hbWUsIHVzZXJzLmVtYWlsLCB1c2Vycy5pbWFnZSwgdXNlcnMuaXNBZG1pbiwgdXNlcnMuY3JlYXRlZEF0LCBhY2NvdW50cy5wcm92aWRlcilcbiAgICAgICAgLm9yZGVyQnkoXG4gICAgICAgICAgc29ydE9yZGVyID09PSAnZGVzYycgXG4gICAgICAgICAgICA/IGRlc2MoXG4gICAgICAgICAgICAgICAgc29ydEJ5ID09PSAnc2lnbnVwX2RhdGUnID8gdXNlcnMuY3JlYXRlZEF0IDpcbiAgICAgICAgICAgICAgICBzb3J0QnkgPT09ICdsYXN0X2FjdGl2aXR5JyA/IHNxbGBNQVgoJHttZXNzYWdlcy5jcmVhdGVkQXR9KWAgOlxuICAgICAgICAgICAgICAgIHNvcnRCeSA9PT0gJ3RvdGFsX3Byb2plY3RzJyA/IHNxbGBDT1VOVChESVNUSU5DVCAke3Byb2plY3RzLmlkfSlgIDpcbiAgICAgICAgICAgICAgICBzcWxgQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7bWVzc2FnZXMucm9sZX0gPSAndXNlcicgVEhFTiAke21lc3NhZ2VzLmlkfSBFTkQpYFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICA6IGFzYyhcbiAgICAgICAgICAgICAgICBzb3J0QnkgPT09ICdzaWdudXBfZGF0ZScgPyB1c2Vycy5jcmVhdGVkQXQgOlxuICAgICAgICAgICAgICAgIHNvcnRCeSA9PT0gJ2xhc3RfYWN0aXZpdHknID8gc3FsYE1BWCgke21lc3NhZ2VzLmNyZWF0ZWRBdH0pYCA6XG4gICAgICAgICAgICAgICAgc29ydEJ5ID09PSAndG90YWxfcHJvamVjdHMnID8gc3FsYENPVU5UKERJU1RJTkNUICR7cHJvamVjdHMuaWR9KWAgOlxuICAgICAgICAgICAgICAgIHNxbGBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHttZXNzYWdlcy5yb2xlfSA9ICd1c2VyJyBUSEVOICR7bWVzc2FnZXMuaWR9IEVORClgXG4gICAgICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgLy8gQXBwbHkgcG9zdC1xdWVyeSBmaWx0ZXJpbmcgKHNpbmNlIERyaXp6bGUgZG9lc24ndCBzdXBwb3J0IGNvbXBsZXggSEFWSU5HIGNsYXVzZXMgd2VsbClcbiAgICAgIGlmIChhdXRoUHJvdmlkZXIgIT09ICdhbGwnKSB7XG4gICAgICAgIHVzZXJBbmFseXRpY3MgPSB1c2VyQW5hbHl0aWNzLmZpbHRlcih1c2VyID0+IHtcbiAgICAgICAgICBpZiAoYXV0aFByb3ZpZGVyID09PSAndW5rbm93bicpIHtcbiAgICAgICAgICAgIHJldHVybiAhdXNlci5vYXV0aFByb3ZpZGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdXNlci5vYXV0aFByb3ZpZGVyID09PSBhdXRoUHJvdmlkZXI7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvamVjdHNGaWx0ZXIgIT09ICdhbGwnKSB7XG4gICAgICAgIHVzZXJBbmFseXRpY3MgPSB1c2VyQW5hbHl0aWNzLmZpbHRlcih1c2VyID0+IHtcbiAgICAgICAgICBjb25zdCBwcm9qZWN0Q291bnQgPSB1c2VyLnRvdGFsUHJvamVjdHM7XG4gICAgICAgICAgc3dpdGNoIChwcm9qZWN0c0ZpbHRlcikge1xuICAgICAgICAgICAgY2FzZSAnbm9uZSc6XG4gICAgICAgICAgICAgIHJldHVybiBwcm9qZWN0Q291bnQgPT09IDA7XG4gICAgICAgICAgICBjYXNlICdsb3cnOlxuICAgICAgICAgICAgICByZXR1cm4gcHJvamVjdENvdW50ID49IDEgJiYgcHJvamVjdENvdW50IDw9IDI7XG4gICAgICAgICAgICBjYXNlICdtZWRpdW0nOlxuICAgICAgICAgICAgICByZXR1cm4gcHJvamVjdENvdW50ID49IDMgJiYgcHJvamVjdENvdW50IDw9IDEwO1xuICAgICAgICAgICAgY2FzZSAnaGlnaCc6XG4gICAgICAgICAgICAgIHJldHVybiBwcm9qZWN0Q291bnQgPiAxMDtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhY3Rpdml0eUZpbHRlciAhPT0gJ2FsbCcpIHtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgdXNlckFuYWx5dGljcyA9IHVzZXJBbmFseXRpY3MuZmlsdGVyKHVzZXIgPT4ge1xuICAgICAgICAgIGlmIChhY3Rpdml0eUZpbHRlciA9PT0gJ25ldmVyJykge1xuICAgICAgICAgICAgcmV0dXJuICF1c2VyLmxhc3RBY3Rpdml0eTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCF1c2VyLmxhc3RBY3Rpdml0eSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGxhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKHVzZXIubGFzdEFjdGl2aXR5KTtcbiAgICAgICAgICBsZXQgdGhyZXNob2xkOiBEYXRlO1xuICAgICAgICAgIFxuICAgICAgICAgIHN3aXRjaCAoYWN0aXZpdHlGaWx0ZXIpIHtcbiAgICAgICAgICAgIGNhc2UgJ3RvZGF5JzpcbiAgICAgICAgICAgICAgdGhyZXNob2xkID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpLCBub3cuZ2V0RGF0ZSgpKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGxhc3RBY3Rpdml0eSA+PSB0aHJlc2hvbGQ7XG4gICAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgICAgdGhyZXNob2xkID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGxhc3RBY3Rpdml0eSA+PSB0aHJlc2hvbGQ7XG4gICAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICAgIHRocmVzaG9sZCA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgICAgICAgICByZXR1cm4gbGFzdEFjdGl2aXR5ID49IHRocmVzaG9sZDtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb24gYWZ0ZXIgZmlsdGVyaW5nXG4gICAgICBjb25zdCB0b3RhbENvdW50ID0gdXNlckFuYWx5dGljcy5sZW5ndGg7XG4gICAgICBjb25zdCBwYWdpbmF0ZWRVc2VycyA9IHVzZXJBbmFseXRpY3Muc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBsaW1pdCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXJzOiBwYWdpbmF0ZWRVc2VycyxcbiAgICAgICAgdG90YWxDb3VudCxcbiAgICAgICAgaGFzTW9yZTogb2Zmc2V0ICsgbGltaXQgPCB0b3RhbENvdW50LFxuICAgICAgICBhcHBsaWVkRmlsdGVyczoge1xuICAgICAgICAgIHNlYXJjaFRlcm0sXG4gICAgICAgICAgYXV0aFByb3ZpZGVyLFxuICAgICAgICAgIGFjdGl2aXR5RmlsdGVyLFxuICAgICAgICAgIHNpZ251cERhdGVGaWx0ZXIsXG4gICAgICAgICAgcHJvamVjdHNGaWx0ZXIsXG4gICAgICAgICAgYWRtaW5GaWx0ZXIsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0pLFxuXG4gIC8vIPCfhpUgTkVXOiBHZXQgZGV0YWlsZWQgdXNlciBhY3Rpdml0eSB0aW1lbGluZVxuICBnZXRVc2VyQWN0aXZpdHlUaW1lbGluZTogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHVzZXJJZDogei5zdHJpbmcoKSxcbiAgICAgIGRheXM6IHoubnVtYmVyKCkubWluKDEpLm1heCg5MCkuZGVmYXVsdCgzMCksXG4gICAgfSkpXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgdXNlcklkLCBkYXlzIH0gPSBpbnB1dDtcbiAgICAgIFxuICAgICAgLy8g8J+aqCBGSVhFRDogQ2FsY3VsYXRlIGRhdGUgdGhyZXNob2xkIGV4cGxpY2l0bHkgdG8gYXZvaWQgU1FMIHBhcmFtZXRlciBiaW5kaW5nIGlzc3Vlc1xuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIGRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYWN0aXZpdHlUaW1lbGluZSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGRhdGU6IHNxbDxzdHJpbmc+YERBVEUoJHttZXNzYWdlcy5jcmVhdGVkQXR9KWAuYXMoJ2RhdGUnKSxcbiAgICAgICAgICB0b3RhbE1lc3NhZ2VzOiBzcWw8bnVtYmVyPmBDT1VOVCgqKWAuYXMoJ3RvdGFsX21lc3NhZ2VzJyksXG4gICAgICAgICAgdXNlclByb21wdHM6IHNxbDxudW1iZXI+YENPVU5UKENBU0UgV0hFTiAke21lc3NhZ2VzLnJvbGV9ID0gJ3VzZXInIFRIRU4gMSBFTkQpYC5hcygndXNlcl9wcm9tcHRzJyksXG4gICAgICAgICAgYXNzaXN0YW50UmVzcG9uc2VzOiBzcWw8bnVtYmVyPmBDT1VOVChDQVNFIFdIRU4gJHttZXNzYWdlcy5yb2xlfSA9ICdhc3Npc3RhbnQnIFRIRU4gMSBFTkQpYC5hcygnYXNzaXN0YW50X3Jlc3BvbnNlcycpLFxuICAgICAgICAgIGltYWdlc1VwbG9hZGVkOiBzcWw8bnVtYmVyPmBDT1VOVChDQVNFIFdIRU4gJHttZXNzYWdlcy5pbWFnZVVybHN9IElTIE5PVCBOVUxMIEFORCBqc29uYl9hcnJheV9sZW5ndGgoJHttZXNzYWdlcy5pbWFnZVVybHN9KSA+IDAgVEhFTiAxIEVORClgLmFzKCdpbWFnZXNfdXBsb2FkZWQnKSxcbiAgICAgICAgICBzY2VuZXNDcmVhdGVkOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke3NjZW5lcy5pZH0pYC5hcygnc2NlbmVzX2NyZWF0ZWQnKSxcbiAgICAgICAgICBwcm9qZWN0c1dvcmtlZE9uOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke3Byb2plY3RzLmlkfSlgLmFzKCdwcm9qZWN0c193b3JrZWRfb24nKSxcbiAgICAgICAgICBhdmdTZXNzaW9uVGltZTogc3FsPG51bWJlcj5gRVhUUkFDVChFUE9DSCBGUk9NIChNQVgoJHttZXNzYWdlcy5jcmVhdGVkQXR9KSAtIE1JTigke21lc3NhZ2VzLmNyZWF0ZWRBdH0pKSkvNjBgLmFzKCdhdmdfc2Vzc2lvbl9taW51dGVzJyksXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKG1lc3NhZ2VzKVxuICAgICAgICAuaW5uZXJKb2luKHByb2plY3RzLCBlcShtZXNzYWdlcy5wcm9qZWN0SWQsIHByb2plY3RzLmlkKSlcbiAgICAgICAgLmxlZnRKb2luKHNjZW5lcywgYW5kKFxuICAgICAgICAgIGVxKHByb2plY3RzLmlkLCBzY2VuZXMucHJvamVjdElkKSxcbiAgICAgICAgICBzcWxgREFURSgke3NjZW5lcy5jcmVhdGVkQXR9KSA9IERBVEUoJHttZXNzYWdlcy5jcmVhdGVkQXR9KWBcbiAgICAgICAgKSlcbiAgICAgICAgLndoZXJlKGFuZChcbiAgICAgICAgICBlcShwcm9qZWN0cy51c2VySWQsIHVzZXJJZCksXG4gICAgICAgICAgZ3RlKG1lc3NhZ2VzLmNyZWF0ZWRBdCwgc3RhcnREYXRlKVxuICAgICAgICApKVxuICAgICAgICAuZ3JvdXBCeShzcWxgREFURSgke21lc3NhZ2VzLmNyZWF0ZWRBdH0pYClcbiAgICAgICAgLm9yZGVyQnkoc3FsYERBVEUoJHttZXNzYWdlcy5jcmVhdGVkQXR9KSBERVNDYCk7XG5cbiAgICAgIHJldHVybiBhY3Rpdml0eVRpbWVsaW5lO1xuICAgIH0pLFxuXG4gIC8vIPCfhpUgTkVXOiBHZXQgaW5kaXZpZHVhbCB1c2VyIGRldGFpbHNcbiAgZ2V0VXNlckRldGFpbHM6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICB1c2VySWQ6IHouc3RyaW5nKCksXG4gICAgfSkpXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgdXNlcklkIH0gPSBpbnB1dDtcbiAgICAgIFxuICAgICAgY29uc3QgdXNlckRldGFpbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAvLyBCYXNpYyB1c2VyIGluZm9cbiAgICAgICAgICBpZDogdXNlcnMuaWQsXG4gICAgICAgICAgbmFtZTogdXNlcnMubmFtZSxcbiAgICAgICAgICBlbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHVzZXJzLmltYWdlLFxuICAgICAgICAgIGlzQWRtaW46IHVzZXJzLmlzQWRtaW4sXG4gICAgICAgICAgc2lnbnVwRGF0ZTogdXNlcnMuY3JlYXRlZEF0LFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIE9BdXRoIHByb3ZpZGVyIGluZm9cbiAgICAgICAgICBvYXV0aFByb3ZpZGVyOiBhY2NvdW50cy5wcm92aWRlcixcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBQcm9qZWN0IG1ldHJpY3NcbiAgICAgICAgICB0b3RhbFByb2plY3RzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke3Byb2plY3RzLmlkfSlgLmFzKCd0b3RhbF9wcm9qZWN0cycpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNjZW5lIG1ldHJpY3MgIFxuICAgICAgICAgIHRvdGFsU2NlbmVzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke3NjZW5lcy5pZH0pYC5hcygndG90YWxfc2NlbmVzJyksXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ2hhdC9wcm9tcHQgbWV0cmljc1xuICAgICAgICAgIHRvdGFsTWVzc2FnZXM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUICR7bWVzc2FnZXMuaWR9KWAuYXMoJ3RvdGFsX21lc3NhZ2VzJyksXG4gICAgICAgICAgdG90YWxVc2VyUHJvbXB0czogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7bWVzc2FnZXMucm9sZX0gPSAndXNlcicgVEhFTiAke21lc3NhZ2VzLmlkfSBFTkQpYC5hcygndG90YWxfdXNlcl9wcm9tcHRzJyksXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRXJyb3IgbWVzc2FnZSB0cmFja2luZ1xuICAgICAgICAgIHRvdGFsRXJyb3JNZXNzYWdlczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7bWVzc2FnZXMuc3RhdHVzfSA9ICdlcnJvcicgVEhFTiAke21lc3NhZ2VzLmlkfSBFTkQpYC5hcygndG90YWxfZXJyb3JfbWVzc2FnZXMnKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJbWFnZSB1c2FnZSBtZXRyaWNzIC0gc2ltcGxpZmllZCB0byBhdm9pZCBkb3VibGUtY291bnRpbmdcbiAgICAgICAgICBwcm9tcHRzV2l0aEltYWdlczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7bWVzc2FnZXMuaW1hZ2VVcmxzfSBJUyBOT1QgTlVMTCBBTkQganNvbmJfYXJyYXlfbGVuZ3RoKCR7bWVzc2FnZXMuaW1hZ2VVcmxzfSkgPiAwIFRIRU4gJHttZXNzYWdlcy5pZH0gRU5EKWAuYXMoJ3Byb21wdHNfd2l0aF9pbWFnZXMnKSxcbiAgICAgICAgICB0b3RhbEltYWdlc1VwbG9hZGVkOiBzcWw8bnVtYmVyPmBDT0FMRVNDRShTVU0oQ0FTRSBXSEVOICR7bWVzc2FnZXMuaW1hZ2VVcmxzfSBJUyBOT1QgTlVMTCBUSEVOIGpzb25iX2FycmF5X2xlbmd0aCgke21lc3NhZ2VzLmltYWdlVXJsc30pIEVMU0UgMCBFTkQpLCAwKWAuYXMoJ3RvdGFsX2ltYWdlc191cGxvYWRlZCcpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFjdGl2aXR5IG1ldHJpY3NcbiAgICAgICAgICBmaXJzdEFjdGl2aXR5OiBzcWw8RGF0ZT5gTUlOKCR7bWVzc2FnZXMuY3JlYXRlZEF0fSlgLmFzKCdmaXJzdF9hY3Rpdml0eScpLFxuICAgICAgICAgIGxhc3RBY3Rpdml0eTogc3FsPERhdGU+YE1BWCgke21lc3NhZ2VzLmNyZWF0ZWRBdH0pYC5hcygnbGFzdF9hY3Rpdml0eScpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEVuZ2FnZW1lbnQgbWV0cmljc1xuICAgICAgICAgIHRvdGFsU2NlbmVJdGVyYXRpb25zOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke3NjZW5lSXRlcmF0aW9ucy5pZH0pYC5hcygndG90YWxfc2NlbmVfaXRlcmF0aW9ucycpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFkdmFuY2VkIGJlaGF2aW9yIG1ldHJpY3NcbiAgICAgICAgICBjb21wbGV4RWRpdHM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUIENBU0UgV0hFTiAke3NjZW5lSXRlcmF0aW9ucy5lZGl0Q29tcGxleGl0eX0gPSAnc3RydWN0dXJhbCcgVEhFTiAke3NjZW5lSXRlcmF0aW9ucy5pZH0gRU5EKWAuYXMoJ2NvbXBsZXhfZWRpdHMnKSxcbiAgICAgICAgICBjcmVhdGl2ZUVkaXRzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHtzY2VuZUl0ZXJhdGlvbnMuZWRpdENvbXBsZXhpdHl9ID0gJ2NyZWF0aXZlJyBUSEVOICR7c2NlbmVJdGVyYXRpb25zLmlkfSBFTkQpYC5hcygnY3JlYXRpdmVfZWRpdHMnKSxcbiAgICAgICAgICBzdXJnaWNhbEVkaXRzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHtzY2VuZUl0ZXJhdGlvbnMuZWRpdENvbXBsZXhpdHl9ID0gJ3N1cmdpY2FsJyBUSEVOICR7c2NlbmVJdGVyYXRpb25zLmlkfSBFTkQpYC5hcygnc3VyZ2ljYWxfZWRpdHMnKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBQcm9qZWN0IG1lbW9yeSBpbnNpZ2h0c1xuICAgICAgICAgIHVzZXJQcmVmZXJlbmNlczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7cHJvamVjdE1lbW9yeS5tZW1vcnlUeXBlfSA9ICd1c2VyX3ByZWZlcmVuY2UnIFRIRU4gJHtwcm9qZWN0TWVtb3J5LmlkfSBFTkQpYC5hcygndXNlcl9wcmVmZXJlbmNlcycpLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgLmxlZnRKb2luKGFjY291bnRzLCBlcSh1c2Vycy5pZCwgYWNjb3VudHMudXNlcklkKSlcbiAgICAgICAgLmxlZnRKb2luKHByb2plY3RzLCBlcSh1c2Vycy5pZCwgcHJvamVjdHMudXNlcklkKSlcbiAgICAgICAgLmxlZnRKb2luKHNjZW5lcywgZXEocHJvamVjdHMuaWQsIHNjZW5lcy5wcm9qZWN0SWQpKVxuICAgICAgICAubGVmdEpvaW4obWVzc2FnZXMsIGVxKHByb2plY3RzLmlkLCBtZXNzYWdlcy5wcm9qZWN0SWQpKVxuICAgICAgICAubGVmdEpvaW4oc2NlbmVJdGVyYXRpb25zLCBlcShwcm9qZWN0cy5pZCwgc2NlbmVJdGVyYXRpb25zLnByb2plY3RJZCkpXG4gICAgICAgIC5sZWZ0Sm9pbihwcm9qZWN0TWVtb3J5LCBlcShwcm9qZWN0cy5pZCwgcHJvamVjdE1lbW9yeS5wcm9qZWN0SWQpKVxuICAgICAgICAud2hlcmUoZXEodXNlcnMuaWQsIHVzZXJJZCkpXG4gICAgICAgIC5ncm91cEJ5KHVzZXJzLmlkLCB1c2Vycy5uYW1lLCB1c2Vycy5lbWFpbCwgdXNlcnMuaW1hZ2UsIHVzZXJzLmlzQWRtaW4sIHVzZXJzLmNyZWF0ZWRBdCwgYWNjb3VudHMucHJvdmlkZXIpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgcmV0dXJuIHVzZXJEZXRhaWxzWzBdIHx8IG51bGw7XG4gICAgfSksXG5cbiAgLy8g8J+GlSBORVc6IEdldCBkZXRhaWxlZCB1c2VyIHByb2plY3RzIHdpdGggc2NlbmVzIGFuZCBhY3Rpdml0eVxuICBnZXRVc2VyUHJvamVjdHM6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICB1c2VySWQ6IHouc3RyaW5nKCksXG4gICAgICBsaW1pdDogei5udW1iZXIoKS5taW4oMSkubWF4KDUwKS5kZWZhdWx0KDIwKSxcbiAgICAgIG9mZnNldDogei5udW1iZXIoKS5taW4oMCkuZGVmYXVsdCgwKSxcbiAgICB9KSlcbiAgICAucXVlcnkoYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgY29uc3QgeyB1c2VySWQsIGxpbWl0LCBvZmZzZXQgfSA9IGlucHV0O1xuICAgICAgXG4gICAgICBjb25zdCB1c2VyUHJvamVjdHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAvLyBQcm9qZWN0IGRldGFpbHNcbiAgICAgICAgICBpZDogcHJvamVjdHMuaWQsXG4gICAgICAgICAgdGl0bGU6IHByb2plY3RzLnRpdGxlLFxuICAgICAgICAgIHByb3BzOiBwcm9qZWN0cy5wcm9wcywgLy8gVXNlIHByb3BzIGluc3RlYWQgb2YgZGVzY3JpcHRpb25cbiAgICAgICAgICBjcmVhdGVkQXQ6IHByb2plY3RzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IHByb2plY3RzLnVwZGF0ZWRBdCxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTY2VuZSBtZXRyaWNzIGZvciB0aGlzIHByb2plY3RcbiAgICAgICAgICB0b3RhbFNjZW5lczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgJHtzY2VuZXMuaWR9KWAuYXMoJ3RvdGFsX3NjZW5lcycpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIE1lc3NhZ2UgbWV0cmljcyBmb3IgdGhpcyBwcm9qZWN0XG4gICAgICAgICAgdG90YWxNZXNzYWdlczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgJHttZXNzYWdlcy5pZH0pYC5hcygndG90YWxfbWVzc2FnZXMnKSxcbiAgICAgICAgICB0b3RhbFVzZXJQcm9tcHRzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHttZXNzYWdlcy5yb2xlfSA9ICd1c2VyJyBUSEVOICR7bWVzc2FnZXMuaWR9IEVORClgLmFzKCd0b3RhbF91c2VyX3Byb21wdHMnKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJbWFnZSB1c2FnZSBpbiB0aGlzIHByb2plY3RcbiAgICAgICAgICBwcm9tcHRzV2l0aEltYWdlczogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7bWVzc2FnZXMuaW1hZ2VVcmxzfSBJUyBOT1QgTlVMTCBBTkQganNvbmJfYXJyYXlfbGVuZ3RoKCR7bWVzc2FnZXMuaW1hZ2VVcmxzfSkgPiAwIFRIRU4gJHttZXNzYWdlcy5pZH0gRU5EKWAuYXMoJ3Byb21wdHNfd2l0aF9pbWFnZXMnKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBY3Rpdml0eSBtZXRyaWNzXG4gICAgICAgICAgZmlyc3RBY3Rpdml0eTogc3FsPERhdGU+YE1JTigke21lc3NhZ2VzLmNyZWF0ZWRBdH0pYC5hcygnZmlyc3RfYWN0aXZpdHknKSxcbiAgICAgICAgICBsYXN0QWN0aXZpdHk6IHNxbDxEYXRlPmBNQVgoJHttZXNzYWdlcy5jcmVhdGVkQXR9KWAuYXMoJ2xhc3RfYWN0aXZpdHknKSxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTY2VuZSBpdGVyYXRpb25zIGZvciB0aGlzIHByb2plY3RcbiAgICAgICAgICB0b3RhbEl0ZXJhdGlvbnM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUICR7c2NlbmVJdGVyYXRpb25zLmlkfSlgLmFzKCd0b3RhbF9pdGVyYXRpb25zJyksXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAubGVmdEpvaW4oc2NlbmVzLCBlcShwcm9qZWN0cy5pZCwgc2NlbmVzLnByb2plY3RJZCkpXG4gICAgICAgIC5sZWZ0Sm9pbihtZXNzYWdlcywgZXEocHJvamVjdHMuaWQsIG1lc3NhZ2VzLnByb2plY3RJZCkpXG4gICAgICAgIC5sZWZ0Sm9pbihzY2VuZUl0ZXJhdGlvbnMsIGVxKHByb2plY3RzLmlkLCBzY2VuZUl0ZXJhdGlvbnMucHJvamVjdElkKSlcbiAgICAgICAgLndoZXJlKGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKSlcbiAgICAgICAgLmdyb3VwQnkocHJvamVjdHMuaWQsIHByb2plY3RzLnRpdGxlLCBwcm9qZWN0cy5wcm9wcywgcHJvamVjdHMuY3JlYXRlZEF0LCBwcm9qZWN0cy51cGRhdGVkQXQpXG4gICAgICAgIC5vcmRlckJ5KGRlc2MocHJvamVjdHMudXBkYXRlZEF0KSlcbiAgICAgICAgLmxpbWl0KGxpbWl0KVxuICAgICAgICAub2Zmc2V0KG9mZnNldCk7XG5cbiAgICAgIC8vIEdldCB0b3RhbCBjb3VudCBmb3IgcGFnaW5hdGlvblxuICAgICAgY29uc3QgdG90YWxDb3VudFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAuZnJvbShwcm9qZWN0cylcbiAgICAgICAgLndoZXJlKGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb2plY3RzOiB1c2VyUHJvamVjdHMsXG4gICAgICAgIHRvdGFsQ291bnQ6IHRvdGFsQ291bnRSZXN1bHRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIGhhc01vcmU6IG9mZnNldCArIGxpbWl0IDwgKHRvdGFsQ291bnRSZXN1bHRbMF0/LmNvdW50IHx8IDApLFxuICAgICAgfTtcbiAgICB9KSxcblxuICAvLyDwn4aVIE5FVzogR2V0IGZ1bGwgcHJvamVjdCBkZXRhaWxzIGluY2x1ZGluZyBzY2VuZXMgYW5kIGNvbXBsZXRlIGNoYXQgaGlzdG9yeVxuICBnZXRVc2VyUHJvamVjdERldGFpbHM6IGFkbWluT25seVByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICBwcm9qZWN0SWQ6IHouc3RyaW5nKCksXG4gICAgICB1c2VySWQ6IHouc3RyaW5nKCksIC8vIEZvciBzZWN1cml0eSAtIGVuc3VyZSBwcm9qZWN0IGJlbG9uZ3MgdG8gdXNlclxuICAgIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zdCB7IHByb2plY3RJZCwgdXNlcklkIH0gPSBpbnB1dDtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IHByb2plY3QgYmVsb25ncyB0byB1c2VyXG4gICAgICBjb25zdCBwcm9qZWN0T3duZXJzaGlwID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IHVzZXJJZDogcHJvamVjdHMudXNlcklkIH0pXG4gICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIHByb2plY3RJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgXG4gICAgICBpZiAoIXByb2plY3RPd25lcnNoaXBbMF0gfHwgcHJvamVjdE93bmVyc2hpcFswXS51c2VySWQgIT09IHVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiUHJvamVjdCBub3QgZm91bmQgb3IgZG9lc24ndCBiZWxvbmcgdG8gdXNlclwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHByb2plY3QgZGV0YWlsc1xuICAgICAgY29uc3QgcHJvamVjdERldGFpbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogcHJvamVjdHMuaWQsXG4gICAgICAgICAgdGl0bGU6IHByb2plY3RzLnRpdGxlLFxuICAgICAgICAgIHByb3BzOiBwcm9qZWN0cy5wcm9wcywgLy8gVXNlIHByb3BzIGluc3RlYWQgb2YgZGVzY3JpcHRpb25cbiAgICAgICAgICBjcmVhdGVkQXQ6IHByb2plY3RzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IHByb2plY3RzLnVwZGF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20ocHJvamVjdHMpXG4gICAgICAgIC53aGVyZShlcShwcm9qZWN0cy5pZCwgcHJvamVjdElkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAvLyBHZXQgYWxsIHNjZW5lcyBmb3IgdGhpcyBwcm9qZWN0XG4gICAgICBjb25zdCBwcm9qZWN0U2NlbmVzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHNjZW5lcy5pZCxcbiAgICAgICAgICBuYW1lOiBzY2VuZXMubmFtZSxcbiAgICAgICAgICB0c3hDb2RlOiBzY2VuZXMudHN4Q29kZSwgLy8gVXNlIHRzeENvZGUgaW5zdGVhZCBvZiBjb2RlXG4gICAgICAgICAgZHVyYXRpb246IHNjZW5lcy5kdXJhdGlvbixcbiAgICAgICAgICBjcmVhdGVkQXQ6IHNjZW5lcy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBzY2VuZXMudXBkYXRlZEF0LFxuICAgICAgICAgIC8vIEl0ZXJhdGlvbiBjb3VudCBmb3IgZWFjaCBzY2VuZVxuICAgICAgICAgIGl0ZXJhdGlvbkNvdW50OiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke3NjZW5lSXRlcmF0aW9ucy5pZH0pYC5hcygnaXRlcmF0aW9uX2NvdW50JyksXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHNjZW5lcylcbiAgICAgICAgLmxlZnRKb2luKHNjZW5lSXRlcmF0aW9ucywgZXEoc2NlbmVzLmlkLCBzY2VuZUl0ZXJhdGlvbnMuc2NlbmVJZCkpXG4gICAgICAgIC53aGVyZShlcShzY2VuZXMucHJvamVjdElkLCBwcm9qZWN0SWQpKVxuICAgICAgICAuZ3JvdXBCeShzY2VuZXMuaWQsIHNjZW5lcy5uYW1lLCBzY2VuZXMudHN4Q29kZSwgc2NlbmVzLmR1cmF0aW9uLCBzY2VuZXMuY3JlYXRlZEF0LCBzY2VuZXMudXBkYXRlZEF0KVxuICAgICAgICAub3JkZXJCeShhc2Moc2NlbmVzLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAvLyBHZXQgY29tcGxldGUgY2hhdCBoaXN0b3J5IGZvciB0aGlzIHByb2plY3RcbiAgICAgIGNvbnN0IGNoYXRIaXN0b3J5ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IG1lc3NhZ2VzLmlkLFxuICAgICAgICAgIHJvbGU6IG1lc3NhZ2VzLnJvbGUsXG4gICAgICAgICAgY29udGVudDogbWVzc2FnZXMuY29udGVudCxcbiAgICAgICAgICBpbWFnZVVybHM6IG1lc3NhZ2VzLmltYWdlVXJscyxcbiAgICAgICAgICBzdGF0dXM6IG1lc3NhZ2VzLnN0YXR1cyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG1lc3NhZ2VzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAvLyBBZGRpdGlvbmFsIG1ldGFkYXRhXG4gICAgICAgICAgb3JpZ2luYWxUc3hDb2RlOiBtZXNzYWdlcy5vcmlnaW5hbFRzeENvZGUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKG1lc3NhZ2VzKVxuICAgICAgICAud2hlcmUoZXEobWVzc2FnZXMucHJvamVjdElkLCBwcm9qZWN0SWQpKVxuICAgICAgICAub3JkZXJCeShhc2MobWVzc2FnZXMuY3JlYXRlZEF0KSk7XG5cbiAgICAgIC8vIEdldCBzY2VuZSBpdGVyYXRpb25zIGZvciBkZXRhaWxlZCBlZGl0aW5nIGhpc3RvcnkgKHJlbmFtZWQgdmFyaWFibGUpXG4gICAgICBjb25zdCBwcm9qZWN0U2NlbmVJdGVyYXRpb25zID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHNjZW5lSXRlcmF0aW9ucy5pZCxcbiAgICAgICAgICBzY2VuZUlkOiBzY2VuZUl0ZXJhdGlvbnMuc2NlbmVJZCxcbiAgICAgICAgICBlZGl0Q29tcGxleGl0eTogc2NlbmVJdGVyYXRpb25zLmVkaXRDb21wbGV4aXR5LFxuICAgICAgICAgIHVzZXJQcm9tcHQ6IHNjZW5lSXRlcmF0aW9ucy51c2VyUHJvbXB0LFxuICAgICAgICAgIGJyYWluUmVhc29uaW5nOiBzY2VuZUl0ZXJhdGlvbnMuYnJhaW5SZWFzb25pbmcsXG4gICAgICAgICAgdG9vbFJlYXNvbmluZzogc2NlbmVJdGVyYXRpb25zLnRvb2xSZWFzb25pbmcsXG4gICAgICAgICAgY29kZUJlZm9yZTogc2NlbmVJdGVyYXRpb25zLmNvZGVCZWZvcmUsXG4gICAgICAgICAgY29kZUFmdGVyOiBzY2VuZUl0ZXJhdGlvbnMuY29kZUFmdGVyLFxuICAgICAgICAgIGNoYW5nZXNBcHBsaWVkOiBzY2VuZUl0ZXJhdGlvbnMuY2hhbmdlc0FwcGxpZWQsXG4gICAgICAgICAgY2hhbmdlc1ByZXNlcnZlZDogc2NlbmVJdGVyYXRpb25zLmNoYW5nZXNQcmVzZXJ2ZWQsXG4gICAgICAgICAgZ2VuZXJhdGlvblRpbWVNczogc2NlbmVJdGVyYXRpb25zLmdlbmVyYXRpb25UaW1lTXMsXG4gICAgICAgICAgbW9kZWxVc2VkOiBzY2VuZUl0ZXJhdGlvbnMubW9kZWxVc2VkLFxuICAgICAgICAgIG9wZXJhdGlvblR5cGU6IHNjZW5lSXRlcmF0aW9ucy5vcGVyYXRpb25UeXBlLFxuICAgICAgICAgIHRlbXBlcmF0dXJlOiBzY2VuZUl0ZXJhdGlvbnMudGVtcGVyYXR1cmUsXG4gICAgICAgICAgdG9rZW5zVXNlZDogc2NlbmVJdGVyYXRpb25zLnRva2Vuc1VzZWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBzY2VuZUl0ZXJhdGlvbnMuY3JlYXRlZEF0LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShzY2VuZUl0ZXJhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2VuZUl0ZXJhdGlvbnMucHJvamVjdElkLCBwcm9qZWN0SWQpKVxuICAgICAgICAub3JkZXJCeShhc2Moc2NlbmVJdGVyYXRpb25zLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAvLyBHZXQgcHJvamVjdCBtZW1vcnkgZm9yIGNvbnRleHRcbiAgICAgIGNvbnN0IHByb2plY3RNZW1vcnlFbnRyaWVzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHByb2plY3RNZW1vcnkuaWQsXG4gICAgICAgICAgbWVtb3J5VHlwZTogcHJvamVjdE1lbW9yeS5tZW1vcnlUeXBlLFxuICAgICAgICAgIG1lbW9yeVZhbHVlOiBwcm9qZWN0TWVtb3J5Lm1lbW9yeVZhbHVlLCAvLyBVc2UgbWVtb3J5VmFsdWUgaW5zdGVhZCBvZiBjb250ZW50XG4gICAgICAgICAgY3JlYXRlZEF0OiBwcm9qZWN0TWVtb3J5LmNyZWF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20ocHJvamVjdE1lbW9yeSlcbiAgICAgICAgLndoZXJlKGVxKHByb2plY3RNZW1vcnkucHJvamVjdElkLCBwcm9qZWN0SWQpKVxuICAgICAgICAub3JkZXJCeShkZXNjKHByb2plY3RNZW1vcnkuY3JlYXRlZEF0KSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb2plY3Q6IHByb2plY3REZXRhaWxzWzBdLFxuICAgICAgICBzY2VuZXM6IHByb2plY3RTY2VuZXMsXG4gICAgICAgIGNoYXRIaXN0b3J5LFxuICAgICAgICBzY2VuZUl0ZXJhdGlvbnM6IHByb2plY3RTY2VuZUl0ZXJhdGlvbnMsIC8vIFVzZSByZW5hbWVkIHZhcmlhYmxlXG4gICAgICAgIHByb2plY3RNZW1vcnk6IHByb2plY3RNZW1vcnlFbnRyaWVzLFxuICAgICAgICBzdW1tYXJ5OiB7XG4gICAgICAgICAgdG90YWxTY2VuZXM6IHByb2plY3RTY2VuZXMubGVuZ3RoLFxuICAgICAgICAgIHRvdGFsTWVzc2FnZXM6IGNoYXRIaXN0b3J5Lmxlbmd0aCxcbiAgICAgICAgICB0b3RhbFVzZXJQcm9tcHRzOiBjaGF0SGlzdG9yeS5maWx0ZXIobXNnID0+IG1zZy5yb2xlID09PSAndXNlcicpLmxlbmd0aCxcbiAgICAgICAgICB0b3RhbEFzc2lzdGFudFJlc3BvbnNlczogY2hhdEhpc3RvcnkuZmlsdGVyKG1zZyA9PiBtc2cucm9sZSA9PT0gJ2Fzc2lzdGFudCcpLmxlbmd0aCxcbiAgICAgICAgICB0b3RhbEl0ZXJhdGlvbnM6IHByb2plY3RTY2VuZUl0ZXJhdGlvbnMubGVuZ3RoLFxuICAgICAgICAgIGltYWdlc1VwbG9hZGVkOiBjaGF0SGlzdG9yeS5maWx0ZXIobXNnID0+IG1zZy5pbWFnZVVybHMgJiYgQXJyYXkuaXNBcnJheShtc2cuaW1hZ2VVcmxzKSAmJiBtc2cuaW1hZ2VVcmxzLmxlbmd0aCA+IDApLmxlbmd0aCxcbiAgICAgICAgICBmaXJzdEFjdGl2aXR5OiBjaGF0SGlzdG9yeVswXT8uY3JlYXRlZEF0IHx8IG51bGwsXG4gICAgICAgICAgbGFzdEFjdGl2aXR5OiBjaGF0SGlzdG9yeVtjaGF0SGlzdG9yeS5sZW5ndGggLSAxXT8uY3JlYXRlZEF0IHx8IG51bGwsXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8g8J+GlSBORVc6IEdldCBhbGwgc2NlbmVzIGNyZWF0ZWQgYnkgYSB1c2VyIGFjcm9zcyBhbGwgcHJvamVjdHNcbiAgZ2V0VXNlclNjZW5lczogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHVzZXJJZDogei5zdHJpbmcoKSxcbiAgICAgIGxpbWl0OiB6Lm51bWJlcigpLm1pbigxKS5tYXgoMTAwKS5kZWZhdWx0KDUwKSxcbiAgICAgIG9mZnNldDogei5udW1iZXIoKS5taW4oMCkuZGVmYXVsdCgwKSxcbiAgICAgIHNvcnRCeTogei5lbnVtKFsnY3JlYXRlZF9kYXRlJywgJ3VwZGF0ZWRfZGF0ZScsICdwcm9qZWN0X25hbWUnLCAnc2NlbmVfbmFtZScsICdkdXJhdGlvbiddKS5kZWZhdWx0KCdjcmVhdGVkX2RhdGUnKSxcbiAgICAgIHNvcnRPcmRlcjogei5lbnVtKFsnYXNjJywgJ2Rlc2MnXSkuZGVmYXVsdCgnZGVzYycpLFxuICAgIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zdCB7IHVzZXJJZCwgbGltaXQsIG9mZnNldCwgc29ydEJ5LCBzb3J0T3JkZXIgfSA9IGlucHV0O1xuICAgICAgXG4gICAgICBjb25zdCBzb3J0Q29sdW1uID0gXG4gICAgICAgIHNvcnRCeSA9PT0gJ2NyZWF0ZWRfZGF0ZScgPyBzY2VuZXMuY3JlYXRlZEF0IDpcbiAgICAgICAgc29ydEJ5ID09PSAndXBkYXRlZF9kYXRlJyA/IHNjZW5lcy51cGRhdGVkQXQgOlxuICAgICAgICBzb3J0QnkgPT09ICdwcm9qZWN0X25hbWUnID8gcHJvamVjdHMudGl0bGUgOlxuICAgICAgICBzb3J0QnkgPT09ICdzY2VuZV9uYW1lJyA/IHNjZW5lcy5uYW1lIDpcbiAgICAgICAgc2NlbmVzLmR1cmF0aW9uO1xuXG4gICAgICBjb25zdCB1c2VyU2NlbmVzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgLy8gU2NlbmUgZGV0YWlsc1xuICAgICAgICAgIGlkOiBzY2VuZXMuaWQsXG4gICAgICAgICAgbmFtZTogc2NlbmVzLm5hbWUsXG4gICAgICAgICAgdHN4Q29kZTogc2NlbmVzLnRzeENvZGUsIC8vIFVzZSB0c3hDb2RlIGluc3RlYWQgb2YgY29kZVxuICAgICAgICAgIGR1cmF0aW9uOiBzY2VuZXMuZHVyYXRpb24sXG4gICAgICAgICAgY3JlYXRlZEF0OiBzY2VuZXMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogc2NlbmVzLnVwZGF0ZWRBdCxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBQcm9qZWN0IGNvbnRleHRcbiAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RzLmlkLFxuICAgICAgICAgIHByb2plY3RUaXRsZTogcHJvamVjdHMudGl0bGUsXG4gICAgICAgICAgcHJvamVjdENyZWF0ZWRBdDogcHJvamVjdHMuY3JlYXRlZEF0LFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNjZW5lIGFjdGl2aXR5IG1ldHJpY3NcbiAgICAgICAgICBpdGVyYXRpb25Db3VudDogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgJHtzY2VuZUl0ZXJhdGlvbnMuaWR9KWAuYXMoJ2l0ZXJhdGlvbl9jb3VudCcpLFxuICAgICAgICAgIGxhc3RJdGVyYXRpb25EYXRlOiBzcWw8RGF0ZT5gTUFYKCR7c2NlbmVJdGVyYXRpb25zLmNyZWF0ZWRBdH0pYC5hcygnbGFzdF9pdGVyYXRpb25fZGF0ZScpLFxuICAgICAgICAgIFxuICAgICAgICAgIC8vIENvbXBsZXhpdHkgYnJlYWtkb3duXG4gICAgICAgICAgY29tcGxleEVkaXRzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCBDQVNFIFdIRU4gJHtzY2VuZUl0ZXJhdGlvbnMuZWRpdENvbXBsZXhpdHl9ID0gJ3N0cnVjdHVyYWwnIFRIRU4gJHtzY2VuZUl0ZXJhdGlvbnMuaWR9IEVORClgLmFzKCdjb21wbGV4X2VkaXRzJyksXG4gICAgICAgICAgY3JlYXRpdmVFZGl0czogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7c2NlbmVJdGVyYXRpb25zLmVkaXRDb21wbGV4aXR5fSA9ICdjcmVhdGl2ZScgVEhFTiAke3NjZW5lSXRlcmF0aW9ucy5pZH0gRU5EKWAuYXMoJ2NyZWF0aXZlX2VkaXRzJyksXG4gICAgICAgICAgc3VyZ2ljYWxFZGl0czogc3FsPG51bWJlcj5gQ09VTlQoRElTVElOQ1QgQ0FTRSBXSEVOICR7c2NlbmVJdGVyYXRpb25zLmVkaXRDb21wbGV4aXR5fSA9ICdzdXJnaWNhbCcgVEhFTiAke3NjZW5lSXRlcmF0aW9ucy5pZH0gRU5EKWAuYXMoJ3N1cmdpY2FsX2VkaXRzJyksXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHNjZW5lcylcbiAgICAgICAgLmlubmVySm9pbihwcm9qZWN0cywgZXEoc2NlbmVzLnByb2plY3RJZCwgcHJvamVjdHMuaWQpKVxuICAgICAgICAubGVmdEpvaW4oc2NlbmVJdGVyYXRpb25zLCBlcShzY2VuZXMuaWQsIHNjZW5lSXRlcmF0aW9ucy5zY2VuZUlkKSlcbiAgICAgICAgLndoZXJlKGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKSlcbiAgICAgICAgLmdyb3VwQnkoc2NlbmVzLmlkLCBzY2VuZXMubmFtZSwgc2NlbmVzLnRzeENvZGUsIHNjZW5lcy5kdXJhdGlvbiwgc2NlbmVzLmNyZWF0ZWRBdCwgc2NlbmVzLnVwZGF0ZWRBdCwgcHJvamVjdHMuaWQsIHByb2plY3RzLnRpdGxlLCBwcm9qZWN0cy5jcmVhdGVkQXQpXG4gICAgICAgIC5vcmRlckJ5KHNvcnRPcmRlciA9PT0gJ2Rlc2MnID8gZGVzYyhzb3J0Q29sdW1uKSA6IGFzYyhzb3J0Q29sdW1uKSlcbiAgICAgICAgLmxpbWl0KGxpbWl0KVxuICAgICAgICAub2Zmc2V0KG9mZnNldCk7XG5cbiAgICAgIC8vIEdldCB0b3RhbCBjb3VudCBmb3IgcGFnaW5hdGlvblxuICAgICAgY29uc3QgdG90YWxDb3VudFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAuZnJvbShzY2VuZXMpXG4gICAgICAgIC5pbm5lckpvaW4ocHJvamVjdHMsIGVxKHNjZW5lcy5wcm9qZWN0SWQsIHByb2plY3RzLmlkKSlcbiAgICAgICAgLndoZXJlKGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNjZW5lczogdXNlclNjZW5lcyxcbiAgICAgICAgdG90YWxDb3VudDogdG90YWxDb3VudFJlc3VsdFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgaGFzTW9yZTogb2Zmc2V0ICsgbGltaXQgPCAodG90YWxDb3VudFJlc3VsdFswXT8uY291bnQgfHwgMCksXG4gICAgICAgIGFwcGxpZWRTb3J0OiB7IHNvcnRCeSwgc29ydE9yZGVyIH0sXG4gICAgICB9O1xuICAgIH0pLFxuXG4gIC8vIPCfhpUgTkVXOiBHZXQgZGV0YWlsZWQgc2NlbmUgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGl0ZXJhdGlvbiBoaXN0b3J5XG4gIGdldFNjZW5lRGV0YWlsczogYWRtaW5Pbmx5UHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHNjZW5lSWQ6IHouc3RyaW5nKCksXG4gICAgICB1c2VySWQ6IHouc3RyaW5nKCksIC8vIEZvciBzZWN1cml0eSB2ZXJpZmljYXRpb25cbiAgICB9KSlcbiAgICAucXVlcnkoYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgY29uc3QgeyBzY2VuZUlkLCB1c2VySWQgfSA9IGlucHV0O1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgc2NlbmUgYmVsb25ncyB0byB1c2VyJ3MgcHJvamVjdFxuICAgICAgY29uc3Qgc2NlbmVPd25lcnNoaXAgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgXG4gICAgICAgICAgdXNlcklkOiBwcm9qZWN0cy51c2VySWQsXG4gICAgICAgICAgcHJvamVjdElkOiBzY2VuZXMucHJvamVjdElkIFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShzY2VuZXMpXG4gICAgICAgIC5pbm5lckpvaW4ocHJvamVjdHMsIGVxKHNjZW5lcy5wcm9qZWN0SWQsIHByb2plY3RzLmlkKSlcbiAgICAgICAgLndoZXJlKGVxKHNjZW5lcy5pZCwgc2NlbmVJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgXG4gICAgICBpZiAoIXNjZW5lT3duZXJzaGlwWzBdIHx8IHNjZW5lT3duZXJzaGlwWzBdLnVzZXJJZCAhPT0gdXNlcklkKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJTY2VuZSBub3QgZm91bmQgb3IgZG9lc24ndCBiZWxvbmcgdG8gdXNlclwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHNjZW5lIGRldGFpbHNcbiAgICAgIGNvbnN0IHNjZW5lRGV0YWlscyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBzY2VuZXMuaWQsXG4gICAgICAgICAgbmFtZTogc2NlbmVzLm5hbWUsXG4gICAgICAgICAgdHN4Q29kZTogc2NlbmVzLnRzeENvZGUsIC8vIFVzZSB0c3hDb2RlIGluc3RlYWQgb2YgY29kZVxuICAgICAgICAgIGR1cmF0aW9uOiBzY2VuZXMuZHVyYXRpb24sXG4gICAgICAgICAgY3JlYXRlZEF0OiBzY2VuZXMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogc2NlbmVzLnVwZGF0ZWRBdCxcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBQcm9qZWN0IGNvbnRleHRcbiAgICAgICAgICBwcm9qZWN0SWQ6IHByb2plY3RzLmlkLFxuICAgICAgICAgIHByb2plY3RUaXRsZTogcHJvamVjdHMudGl0bGUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHNjZW5lcylcbiAgICAgICAgLmlubmVySm9pbihwcm9qZWN0cywgZXEoc2NlbmVzLnByb2plY3RJZCwgcHJvamVjdHMuaWQpKVxuICAgICAgICAud2hlcmUoZXEoc2NlbmVzLmlkLCBzY2VuZUlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAvLyBHZXQgYWxsIGl0ZXJhdGlvbnMgZm9yIHRoaXMgc2NlbmVcbiAgICAgIGNvbnN0IGl0ZXJhdGlvbnMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogc2NlbmVJdGVyYXRpb25zLmlkLFxuICAgICAgICAgIGVkaXRDb21wbGV4aXR5OiBzY2VuZUl0ZXJhdGlvbnMuZWRpdENvbXBsZXhpdHksXG4gICAgICAgICAgdXNlclByb21wdDogc2NlbmVJdGVyYXRpb25zLnVzZXJQcm9tcHQsXG4gICAgICAgICAgZ2VuZXJhdGlvblRpbWVNczogc2NlbmVJdGVyYXRpb25zLmdlbmVyYXRpb25UaW1lTXMsXG4gICAgICAgICAgbW9kZWxVc2VkOiBzY2VuZUl0ZXJhdGlvbnMubW9kZWxVc2VkLFxuICAgICAgICAgIGNyZWF0ZWRBdDogc2NlbmVJdGVyYXRpb25zLmNyZWF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oc2NlbmVJdGVyYXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NlbmVJdGVyYXRpb25zLnNjZW5lSWQsIHNjZW5lSWQpKVxuICAgICAgICAub3JkZXJCeShhc2Moc2NlbmVJdGVyYXRpb25zLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAvLyBHZXQgcmVsYXRlZCBtZXNzYWdlcyBmcm9tIHRoZSBwcm9qZWN0IChjb250ZXh0IGFyb3VuZCBzY2VuZSBjcmVhdGlvbilcbiAgICAgIGNvbnN0IHJlbGF0ZWRNZXNzYWdlcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBtZXNzYWdlcy5pZCxcbiAgICAgICAgICByb2xlOiBtZXNzYWdlcy5yb2xlLFxuICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VzLmNvbnRlbnQsXG4gICAgICAgICAgaW1hZ2VVcmxzOiBtZXNzYWdlcy5pbWFnZVVybHMsXG4gICAgICAgICAgY3JlYXRlZEF0OiBtZXNzYWdlcy5jcmVhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKG1lc3NhZ2VzKVxuICAgICAgICAud2hlcmUoZXEobWVzc2FnZXMucHJvamVjdElkLCBzY2VuZU93bmVyc2hpcFswXS5wcm9qZWN0SWQpKVxuICAgICAgICAub3JkZXJCeShhc2MobWVzc2FnZXMuY3JlYXRlZEF0KSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNjZW5lOiBzY2VuZURldGFpbHNbMF0sXG4gICAgICAgIGl0ZXJhdGlvbnMsXG4gICAgICAgIHJlbGF0ZWRNZXNzYWdlcyxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsSXRlcmF0aW9uczogaXRlcmF0aW9ucy5sZW5ndGgsXG4gICAgICAgICAgY29tcGxleGl0eUJyZWFrZG93bjoge1xuICAgICAgICAgICAgc3RydWN0dXJhbDogaXRlcmF0aW9ucy5maWx0ZXIoaSA9PiBpLmVkaXRDb21wbGV4aXR5ID09PSAnc3RydWN0dXJhbCcpLmxlbmd0aCxcbiAgICAgICAgICAgIGNyZWF0aXZlOiBpdGVyYXRpb25zLmZpbHRlcihpID0+IGkuZWRpdENvbXBsZXhpdHkgPT09ICdjcmVhdGl2ZScpLmxlbmd0aCxcbiAgICAgICAgICAgIHN1cmdpY2FsOiBpdGVyYXRpb25zLmZpbHRlcihpID0+IGkuZWRpdENvbXBsZXhpdHkgPT09ICdzdXJnaWNhbCcpLmxlbmd0aCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGF2ZXJhZ2VHZW5lcmF0aW9uVGltZTogaXRlcmF0aW9ucy5sZW5ndGggPiAwIFxuICAgICAgICAgICAgPyBNYXRoLnJvdW5kKGl0ZXJhdGlvbnMucmVkdWNlKChzdW0sIGkpID0+IHN1bSArIChpLmdlbmVyYXRpb25UaW1lTXMgfHwgMCksIDApIC8gaXRlcmF0aW9ucy5sZW5ndGgpXG4gICAgICAgICAgICA6IDAsXG4gICAgICAgICAgZmlyc3RJdGVyYXRpb246IGl0ZXJhdGlvbnNbMF0/LmNyZWF0ZWRBdCB8fCBudWxsLFxuICAgICAgICAgIGxhc3RJdGVyYXRpb246IGl0ZXJhdGlvbnNbaXRlcmF0aW9ucy5sZW5ndGggLSAxXT8uY3JlYXRlZEF0IHx8IG51bGwsXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSksXG59KTsiXSwibmFtZXMiOlsiY3JlYXRlVFJQQ1JvdXRlciIsInByb3RlY3RlZFByb2NlZHVyZSIsImRiIiwidXNlcnMiLCJwcm9qZWN0cyIsInNjZW5lcyIsImZlZWRiYWNrIiwibWVzc2FnZXMiLCJhY2NvdW50cyIsInNjZW5lSXRlcmF0aW9ucyIsInByb2plY3RNZW1vcnkiLCJzcWwiLCJhbmQiLCJndGUiLCJkZXNjIiwiY291bnQiLCJlcSIsImxpa2UiLCJvciIsImluQXJyYXkiLCJhc2MiLCJUUlBDRXJyb3IiLCJ6IiwidGltZWZyYW1lU2NoZW1hIiwiZW51bSIsImRlZmF1bHQiLCJ1c2VyVXBkYXRlU2NoZW1hIiwib2JqZWN0IiwibmFtZSIsInN0cmluZyIsIm9wdGlvbmFsIiwiZW1haWwiLCJpbWFnZSIsInVybCIsIm51bGxhYmxlIiwiaXNBZG1pbiIsImJvb2xlYW4iLCJhZG1pbk9ubHlQcm9jZWR1cmUiLCJ1c2UiLCJjdHgiLCJuZXh0IiwidXNlciIsInNlbGVjdCIsImZyb20iLCJ3aGVyZSIsImlkIiwic2Vzc2lvbiIsImxpbWl0IiwiY29kZSIsIm1lc3NhZ2UiLCJhZG1pblJvdXRlciIsImNoZWNrQWRtaW5BY2Nlc3MiLCJxdWVyeSIsInRvZ2dsZVVzZXJBZG1pbiIsImlucHV0IiwidXNlcklkIiwibXV0YXRpb24iLCJ1cGRhdGVkVXNlciIsInVwZGF0ZSIsInNldCIsInJldHVybmluZyIsImdldFRvdGFsVXNlcnMiLCJ0aW1lZnJhbWUiLCJ3aGVyZUNvbmRpdGlvbiIsImNyZWF0ZWRBdCIsIkRhdGUiLCJub3ciLCJyZXN1bHQiLCJ0b3RhbCIsImdldFByb2plY3RzQ3JlYXRlZCIsImdldFNjZW5lc0NyZWF0ZWQiLCJnZXRSZWNlbnRGZWVkYmFjayIsIm51bWJlciIsImZlZWRiYWNrRW50cmllcyIsImNvbnRlbnQiLCJzdGF0dXMiLCJwcmlvcml0aXplZEZlYXR1cmVzIiwib3JkZXJCeSIsImdldERhc2hib2FyZE1ldHJpY3MiLCJ0b3RhbFVzZXJzQWxsIiwidG90YWxVc2VyczMwZCIsInRvdGFsVXNlcnM3ZCIsInRvdGFsVXNlcnMyNGgiLCJwcm9qZWN0c0FsbCIsInByb2plY3RzMzBkIiwicHJvamVjdHM3ZCIsInByb2plY3RzMjRoIiwic2NlbmVzQWxsIiwic2NlbmVzMzBkIiwic2NlbmVzN2QiLCJzY2VuZXMyNGgiLCJyZWNlbnRGZWVkYmFjayIsIlByb21pc2UiLCJhbGwiLCJsYXN0MzBEYXlzIiwibGFzdDdEYXlzIiwibGFzdDI0SG91cnMiLCJnZXRVc2VycyIsInBhZ2UiLCJzZWFyY2giLCJvZmZzZXQiLCJ1c2Vyc0xpc3QiLCJ0b3RhbENvdW50IiwiZW1haWxWZXJpZmllZCIsInVzZXJJZHMiLCJtYXAiLCJwcm9tcHRDb3VudHMiLCJsZW5ndGgiLCJpbm5lckpvaW4iLCJwcm9qZWN0SWQiLCJyb2xlIiwiZ3JvdXBCeSIsInByb21wdENvdW50TWFwIiwiTWFwIiwiZm9yRWFjaCIsInBjIiwidXNlcnNXaXRoUHJvbXB0cyIsInRvdGFsUHJvbXB0cyIsImdldCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsImdldFVzZXIiLCJwcm9qZWN0Q291bnQiLCJsYXRlc3RQcm9qZWN0IiwicHJvbXB0Q291bnQiLCJ0aXRsZSIsInVwZGF0ZWRBdCIsInVwZGF0ZVVzZXIiLCJkYXRhIiwidXBkYXRlRGF0YSIsInVuZGVmaW5lZCIsIk9iamVjdCIsImtleXMiLCJkZWxldGVVc2VyIiwidXNlclRvRGVsZXRlIiwiZGVsZXRlZFVzZXIiLCJkZWxldGUiLCJzdWNjZXNzIiwiZ2V0VXNlckFjdGl2aXR5IiwidXNlclByb2plY3RzIiwidXNlclNjZW5lcyIsInVzZXJGZWVkYmFjayIsImdldEFuYWx5dGljc0RhdGEiLCJtZXRyaWMiLCJpbnRlcnZhbEhvdXJzIiwidG90YWxQZXJpb2RIb3VycyIsInN0YXJ0RGF0ZSIsInRpbWVTbG90cyIsImkiLCJzbG90U3RhcnQiLCJnZXRUaW1lIiwic2xvdEVuZCIsInB1c2giLCJzdGFydCIsImVuZCIsImxhYmVsIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwiaG91ciIsIm1pbnV0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1vbnRoIiwiZGF5IiwidXNlckNvdW50cyIsInRpbWVzdGFtcCIsInJvdyIsInByb2plY3RDb3VudHMiLCJzY2VuZUNvdW50cyIsImNoYXJ0RGF0YSIsInNsb3QiLCJzbG90RGF0YSIsImZpbHRlciIsIml0ZW0iLCJ0b0lTT1N0cmluZyIsImN1bXVsYXRpdmUiLCJwb2ludCIsInBlcmlvZFN0YXJ0IiwicGVyaW9kRW5kIiwiZ2V0QW5hbHl0aWNzT3ZlcnZpZXciLCJwZXJpb2RIb3VycyIsIm5ld1VzZXJzIiwibmV3UHJvamVjdHMiLCJuZXdTY2VuZXMiLCJuZXdQcm9tcHRzIiwibWV0cmljcyIsInByb21wdHMiLCJydW5FdmFsdWF0aW9uIiwic3VpdGVJZCIsIm1vZGVsUGFja3MiLCJhcnJheSIsIm1heFByb21wdHMiLCJzaG93T3V0cHV0cyIsImNvbXBhcmlzb24iLCJ2ZXJib3NlIiwiRXZhbHVhdGlvblJ1bm5lciIsInJ1bm5lciIsInJ1blN1aXRlIiwiZXJyb3IiLCJjb25zb2xlIiwiRXJyb3IiLCJTdHJpbmciLCJjcmVhdGVDdXN0b21TdWl0ZSIsImRlc2NyaXB0aW9uIiwidHlwZSIsInRleHQiLCJjb250ZXh0IiwicmVjb3JkIiwiYW55IiwiZXhwZWN0ZWRPdXRwdXQiLCJ2YWx1ZSIsInVuaW9uIiwiZXhwZWN0ZWRCZWhhdmlvciIsInRvb2xDYWxsZWQiLCJlZGl0VHlwZSIsInNob3VsZE1lbnRpb24iLCJzaG91bGRNb2RpZnkiLCJzaG91bGRBbmFseXplSW1hZ2UiLCJzaG91bGRVc2VDb250ZXh0Iiwic2hvdWxkQ29uZmlybSIsInNob3VsZEFzayIsIm5lZWRzQ2xhcmlmaWNhdGlvbiIsImV4cGVjdGVkRHVyYXRpb24iLCJjb21wbGV4aXR5Iiwic2VydmljZXMiLCJjdXN0b21TdWl0ZSIsImdldEV2YWx1YXRpb25TdWl0ZXMiLCJhbGxFdmFsU3VpdGVzIiwic3VpdGUiLCJnZXRNb2RlbFBhY2tzIiwiTU9ERUxfUEFDS1MiLCJlbnRyaWVzIiwicGFjayIsIm1vZGVscyIsImJyYWluIiwicHJvdmlkZXIiLCJtb2RlbCIsImNvZGVHZW5lcmF0b3IiLCJ2aXNpb25BbmFseXNpcyIsImNyZWF0ZUN1c3RvbVByb21wdCIsImN1c3RvbVByb21wdCIsImxvZyIsInByb21wdElkIiwicHJvbXB0IiwiY3JlYXRlQ3VzdG9tTW9kZWxQYWNrIiwiYnJhaW5Nb2RlbCIsImNvZGVNb2RlbCIsInZpc2lvbk1vZGVsIiwicGFyc2VNb2RlbCIsIm1vZGVsU3RyaW5nIiwic3BsaXQiLCJjdXN0b21QYWNrIiwicGFja0lkIiwiYW5hbHl6ZVVwbG9hZGVkSW1hZ2UiLCJpbWFnZURhdGEiLCJhbmFseXNpc1Jlc3VsdCIsImFuYWx5c2lzIiwiY29sb3JzIiwiZWxlbWVudHMiLCJtb29kIiwic3VnZ2VzdGlvbnMiLCJwYWxldHRlIiwicHJpbWFyeSIsInNlY29uZGFyeSIsImFjY2VudCIsImJhY2tncm91bmQiLCJ0eXBvZ3JhcGh5IiwiaGVhZGVycyIsImJvZHkiLCJnZW5lcmF0ZVNjZW5lRnJvbUltYWdlIiwiYW5hbHlzaXNEYXRhIiwic2NlbmVDb2RlIiwic2NlbmVJZCIsInNjZW5lTmFtZSIsImdldFVzZXJBbmFseXRpY3MiLCJtaW4iLCJtYXgiLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJzZWFyY2hUZXJtIiwiYXV0aFByb3ZpZGVyIiwiYWN0aXZpdHlGaWx0ZXIiLCJzaWdudXBEYXRlRmlsdGVyIiwicHJvamVjdHNGaWx0ZXIiLCJhZG1pbkZpbHRlciIsImhhc0N0eCIsIndoZXJlQ29uZGl0aW9ucyIsInRyaW0iLCJzaWdudXBUaHJlc2hvbGQiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImJhc2VRdWVyeSIsInNpZ251cERhdGUiLCJvYXV0aFByb3ZpZGVyIiwidG90YWxQcm9qZWN0cyIsImFzIiwidG90YWxTY2VuZXMiLCJ0b3RhbE1lc3NhZ2VzIiwidG90YWxVc2VyUHJvbXB0cyIsInRvdGFsRXJyb3JNZXNzYWdlcyIsInByb21wdHNXaXRoSW1hZ2VzIiwiaW1hZ2VVcmxzIiwidG90YWxJbWFnZXNVcGxvYWRlZCIsImZpcnN0QWN0aXZpdHkiLCJsYXN0QWN0aXZpdHkiLCJ0b3RhbFNjZW5lSXRlcmF0aW9ucyIsImNvbXBsZXhFZGl0cyIsImVkaXRDb21wbGV4aXR5IiwiY3JlYXRpdmVFZGl0cyIsInN1cmdpY2FsRWRpdHMiLCJ1c2VyUHJlZmVyZW5jZXMiLCJtZW1vcnlUeXBlIiwibGVmdEpvaW4iLCIkZHluYW1pYyIsInVzZXJBbmFseXRpY3MiLCJ0aHJlc2hvbGQiLCJwYWdpbmF0ZWRVc2VycyIsInNsaWNlIiwiaGFzTW9yZSIsImFwcGxpZWRGaWx0ZXJzIiwiZ2V0VXNlckFjdGl2aXR5VGltZWxpbmUiLCJkYXlzIiwiYWN0aXZpdHlUaW1lbGluZSIsImRhdGUiLCJ1c2VyUHJvbXB0cyIsImFzc2lzdGFudFJlc3BvbnNlcyIsImltYWdlc1VwbG9hZGVkIiwic2NlbmVzQ3JlYXRlZCIsInByb2plY3RzV29ya2VkT24iLCJhdmdTZXNzaW9uVGltZSIsImdldFVzZXJEZXRhaWxzIiwidXNlckRldGFpbHMiLCJnZXRVc2VyUHJvamVjdHMiLCJwcm9wcyIsInRvdGFsSXRlcmF0aW9ucyIsInRvdGFsQ291bnRSZXN1bHQiLCJnZXRVc2VyUHJvamVjdERldGFpbHMiLCJwcm9qZWN0T3duZXJzaGlwIiwicHJvamVjdERldGFpbHMiLCJwcm9qZWN0U2NlbmVzIiwidHN4Q29kZSIsImR1cmF0aW9uIiwiaXRlcmF0aW9uQ291bnQiLCJjaGF0SGlzdG9yeSIsIm9yaWdpbmFsVHN4Q29kZSIsInByb2plY3RTY2VuZUl0ZXJhdGlvbnMiLCJ1c2VyUHJvbXB0IiwiYnJhaW5SZWFzb25pbmciLCJ0b29sUmVhc29uaW5nIiwiY29kZUJlZm9yZSIsImNvZGVBZnRlciIsImNoYW5nZXNBcHBsaWVkIiwiY2hhbmdlc1ByZXNlcnZlZCIsImdlbmVyYXRpb25UaW1lTXMiLCJtb2RlbFVzZWQiLCJvcGVyYXRpb25UeXBlIiwidGVtcGVyYXR1cmUiLCJ0b2tlbnNVc2VkIiwicHJvamVjdE1lbW9yeUVudHJpZXMiLCJtZW1vcnlWYWx1ZSIsInByb2plY3QiLCJzdW1tYXJ5IiwibXNnIiwidG90YWxBc3Npc3RhbnRSZXNwb25zZXMiLCJBcnJheSIsImlzQXJyYXkiLCJnZXRVc2VyU2NlbmVzIiwic29ydENvbHVtbiIsInByb2plY3RUaXRsZSIsInByb2plY3RDcmVhdGVkQXQiLCJsYXN0SXRlcmF0aW9uRGF0ZSIsImFwcGxpZWRTb3J0IiwiZ2V0U2NlbmVEZXRhaWxzIiwic2NlbmVPd25lcnNoaXAiLCJzY2VuZURldGFpbHMiLCJpdGVyYXRpb25zIiwicmVsYXRlZE1lc3NhZ2VzIiwic2NlbmUiLCJjb21wbGV4aXR5QnJlYWtkb3duIiwic3RydWN0dXJhbCIsImNyZWF0aXZlIiwic3VyZ2ljYWwiLCJhdmVyYWdlR2VuZXJhdGlvblRpbWUiLCJyb3VuZCIsInJlZHVjZSIsInN1bSIsImZpcnN0SXRlcmF0aW9uIiwibGFzdEl0ZXJhdGlvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/admin.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/chat.ts":
/*!****************************************!*\
  !*** ./src/server/api/routers/chat.ts ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chatRouter: () => (/* binding */ chatRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _trpc_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @trpc/server */ \"(rsc)/../../node_modules/@trpc/server/dist/index.mjs\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_2__, drizzle_orm__WEBPACK_IMPORTED_MODULE_3__]);\n([_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_2__, drizzle_orm__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\nconst chatRouter = (0,_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    /**\n     * Fetches recent messages for a given project.\n     * Used by ChatPanelG component for displaying chat history.\n     */ getMessages: _trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().uuid(),\n        limit: zod__WEBPACK_IMPORTED_MODULE_4__.z.number().int().min(1).max(100).optional().default(50)\n    })).query(async ({ ctx, input })=>{\n        const project = await ctx.db.query.projects.findFirst({\n            columns: {\n                id: true,\n                userId: true\n            },\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.projects.id, input.projectId)\n        });\n        if (!project || project.userId !== ctx.session.user.id) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_1__.TRPCError({\n                code: \"FORBIDDEN\",\n                message: \"Project not found or access denied.\"\n            });\n        }\n        const messageHistory = await ctx.db.query.messages.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.messages.projectId, input.projectId),\n            orderBy: [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.messages.sequence)\n            ],\n            limit: input.limit,\n            columns: {\n                id: true,\n                projectId: true,\n                content: true,\n                role: true,\n                kind: true,\n                imageUrls: true,\n                createdAt: true,\n                sequence: true\n            }\n        });\n        return messageHistory.reverse();\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2NoYXQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXdCO0FBQ3VDO0FBQ3RCO0FBQ2E7QUFDZjtBQUVoQyxNQUFNUSxhQUFhUCx1REFBZ0JBLENBQUM7SUFDdkM7OztLQUdDLEdBQ0RRLGFBQWFQLHFEQUFrQkEsQ0FDMUJRLEtBQUssQ0FBQ1Ysa0NBQUNBLENBQUNXLE1BQU0sQ0FBQztRQUNaQyxXQUFXWixrQ0FBQ0EsQ0FBQ2EsTUFBTSxHQUFHQyxJQUFJO1FBQzFCQyxPQUFPZixrQ0FBQ0EsQ0FBQ2dCLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxHQUFHLENBQUMsR0FBR0MsR0FBRyxDQUFDLEtBQUtDLFFBQVEsR0FBR0MsT0FBTyxDQUFDO0lBQy9ELElBQ0NDLEtBQUssQ0FBQyxPQUFPLEVBQUVDLEdBQUcsRUFBRWIsS0FBSyxFQUFFO1FBQ3hCLE1BQU1jLFVBQVUsTUFBTUQsSUFBSUUsRUFBRSxDQUFDSCxLQUFLLENBQUNsQixRQUFRLENBQUNzQixTQUFTLENBQUM7WUFDbERDLFNBQVM7Z0JBQUVDLElBQUk7Z0JBQU1DLFFBQVE7WUFBSztZQUNsQ0MsT0FBT3hCLCtDQUFFQSxDQUFDRixzREFBUUEsQ0FBQ3dCLEVBQUUsRUFBRWxCLE1BQU1FLFNBQVM7UUFDMUM7UUFDQSxJQUFJLENBQUNZLFdBQVdBLFFBQVFLLE1BQU0sS0FBS04sSUFBSVEsT0FBTyxDQUFDQyxJQUFJLENBQUNKLEVBQUUsRUFBRTtZQUNwRCxNQUFNLElBQUl6QixtREFBU0EsQ0FBQztnQkFBRThCLE1BQU07Z0JBQWFDLFNBQVM7WUFBc0M7UUFDNUY7UUFDQSxNQUFNQyxpQkFBaUIsTUFBTVosSUFBSUUsRUFBRSxDQUFDSCxLQUFLLENBQUNqQixRQUFRLENBQUMrQixRQUFRLENBQUM7WUFDeEROLE9BQU94QiwrQ0FBRUEsQ0FBQ0Qsc0RBQVFBLENBQUNPLFNBQVMsRUFBRUYsTUFBTUUsU0FBUztZQUM3Q3lCLFNBQVM7Z0JBQUM5QixpREFBSUEsQ0FBQ0Ysc0RBQVFBLENBQUNpQyxRQUFRO2FBQUU7WUFDbEN2QixPQUFPTCxNQUFNSyxLQUFLO1lBQ2xCWSxTQUFTO2dCQUNMQyxJQUFJO2dCQUNKaEIsV0FBVztnQkFDWDJCLFNBQVM7Z0JBQ1RDLE1BQU07Z0JBQ05DLE1BQU07Z0JBQ05DLFdBQVc7Z0JBQ1hDLFdBQVc7Z0JBQ1hMLFVBQVU7WUFDZDtRQUNKO1FBQ0EsT0FBT0gsZUFBZVMsT0FBTztJQUNqQztBQUNSLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvY2hhdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuaW1wb3J0IHsgY3JlYXRlVFJQQ1JvdXRlciwgcHJvdGVjdGVkUHJvY2VkdXJlIH0gZnJvbSBcIi4uL3RycGNcIjtcbmltcG9ydCB7IFRSUENFcnJvciB9IGZyb20gXCJAdHJwYy9zZXJ2ZXJcIjtcbmltcG9ydCB7IHByb2plY3RzLCBtZXNzYWdlcyB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBlcSwgZGVzYyB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuXG5leHBvcnQgY29uc3QgY2hhdFJvdXRlciA9IGNyZWF0ZVRSUENSb3V0ZXIoe1xuICAgIC8qKlxuICAgICAqIEZldGNoZXMgcmVjZW50IG1lc3NhZ2VzIGZvciBhIGdpdmVuIHByb2plY3QuXG4gICAgICogVXNlZCBieSBDaGF0UGFuZWxHIGNvbXBvbmVudCBmb3IgZGlzcGxheWluZyBjaGF0IGhpc3RvcnkuXG4gICAgICovXG4gICAgZ2V0TWVzc2FnZXM6IHByb3RlY3RlZFByb2NlZHVyZVxuICAgICAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgICAgICAgcHJvamVjdElkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgICAgICAgICAgIGxpbWl0OiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoMTAwKS5vcHRpb25hbCgpLmRlZmF1bHQoNTApLFxuICAgICAgICB9KSlcbiAgICAgICAgLnF1ZXJ5KGFzeW5jICh7IGN0eCwgaW5wdXQgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IGF3YWl0IGN0eC5kYi5xdWVyeS5wcm9qZWN0cy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHsgaWQ6IHRydWUsIHVzZXJJZDogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIHdoZXJlOiBlcShwcm9qZWN0cy5pZCwgaW5wdXQucHJvamVjdElkKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFwcm9qZWN0IHx8IHByb2plY3QudXNlcklkICE9PSBjdHguc2Vzc2lvbi51c2VyLmlkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7IGNvZGU6IFwiRk9SQklEREVOXCIsIG1lc3NhZ2U6IFwiUHJvamVjdCBub3QgZm91bmQgb3IgYWNjZXNzIGRlbmllZC5cIiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5ID0gYXdhaXQgY3R4LmRiLnF1ZXJ5Lm1lc3NhZ2VzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogZXEobWVzc2FnZXMucHJvamVjdElkLCBpbnB1dC5wcm9qZWN0SWQpLFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IFtkZXNjKG1lc3NhZ2VzLnNlcXVlbmNlKV0sXG4gICAgICAgICAgICAgICAgbGltaXQ6IGlucHV0LmxpbWl0LFxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2plY3RJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAga2luZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VVcmxzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeS5yZXZlcnNlKCk7XG4gICAgICAgIH0pLFxufSk7Il0sIm5hbWVzIjpbInoiLCJjcmVhdGVUUlBDUm91dGVyIiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiVFJQQ0Vycm9yIiwicHJvamVjdHMiLCJtZXNzYWdlcyIsImVxIiwiZGVzYyIsImNoYXRSb3V0ZXIiLCJnZXRNZXNzYWdlcyIsImlucHV0Iiwib2JqZWN0IiwicHJvamVjdElkIiwic3RyaW5nIiwidXVpZCIsImxpbWl0IiwibnVtYmVyIiwiaW50IiwibWluIiwibWF4Iiwib3B0aW9uYWwiLCJkZWZhdWx0IiwicXVlcnkiLCJjdHgiLCJwcm9qZWN0IiwiZGIiLCJmaW5kRmlyc3QiLCJjb2x1bW5zIiwiaWQiLCJ1c2VySWQiLCJ3aGVyZSIsInNlc3Npb24iLCJ1c2VyIiwiY29kZSIsIm1lc3NhZ2UiLCJtZXNzYWdlSGlzdG9yeSIsImZpbmRNYW55Iiwib3JkZXJCeSIsInNlcXVlbmNlIiwiY29udGVudCIsInJvbGUiLCJraW5kIiwiaW1hZ2VVcmxzIiwiY3JlYXRlZEF0IiwicmV2ZXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/chat.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/emailSubscriber.ts":
/*!***************************************************!*\
  !*** ./src/server/api/routers/emailSubscriber.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   emailSubscriberInputSchema: () => (/* binding */ emailSubscriberInputSchema),\n/* harmony export */   emailSubscriberRouter: () => (/* binding */ emailSubscriberRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/api/routers/emailSubscriber.ts\n\n\n\n\n\nconst emailSubscriberInputSchema = zod__WEBPACK_IMPORTED_MODULE_3__.z.object({\n    email: zod__WEBPACK_IMPORTED_MODULE_3__.z.string().email({\n        message: \"Please enter a valid email address\"\n    }),\n    source: zod__WEBPACK_IMPORTED_MODULE_3__.z.string().default('homepage')\n});\nconst emailSubscriberRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    subscribe: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.publicProcedure.input(emailSubscriberInputSchema).mutation(async ({ ctx, input })=>{\n        try {\n            // Check if email already exists using direct query\n            const existingSubscriber = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.emailSubscribers).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.emailSubscribers.email, input.email)).limit(1);\n            if (existingSubscriber.length > 0) {\n                // Email already exists\n                const subscriber = existingSubscriber[0];\n                if (subscriber?.status === 'active') {\n                    throw new Error('Email address already signed up for updates');\n                } else if (subscriber?.status === 'unsubscribed') {\n                    // Reactivate subscription\n                    await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.emailSubscribers).set({\n                        status: 'active',\n                        subscribedAt: new Date(),\n                        source: input.source,\n                        userId: ctx.session?.user?.id || null\n                    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.emailSubscribers.email, input.email));\n                    return {\n                        success: true,\n                        message: 'Successfully resubscribed to updates!',\n                        isResubscription: true\n                    };\n                }\n            }\n            // Create new subscription\n            const newSubscriber = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.emailSubscribers).values({\n                email: input.email,\n                source: input.source,\n                status: 'active',\n                userId: ctx.session?.user?.id || null\n            }).returning();\n            console.log('Email subscription created:', newSubscriber[0]?.id);\n            return {\n                success: true,\n                message: 'Successfully subscribed to updates!',\n                isResubscription: false\n            };\n        } catch (error) {\n            console.error('Email subscription error:', error);\n            // Handle specific error messages\n            if (error instanceof Error) {\n                if (error.message.includes('already signed up')) {\n                    throw new Error('Email address already signed up for updates');\n                }\n                if (error.message.includes('unique constraint')) {\n                    throw new Error('Email address already signed up for updates');\n                }\n            }\n            throw new Error('Failed to subscribe. Please try again later.');\n        }\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2VtYWlsU3Vic2NyaWJlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSw0Q0FBNEM7QUFDcEI7QUFDOEM7QUFDaEM7QUFDYztBQUNuQjtBQUUxQixNQUFNTSw2QkFBNkJOLGtDQUFDQSxDQUFDTyxNQUFNLENBQUM7SUFDakRDLE9BQU9SLGtDQUFDQSxDQUFDUyxNQUFNLEdBQUdELEtBQUssQ0FBQztRQUN0QkUsU0FBUztJQUNYO0lBQ0FDLFFBQVFYLGtDQUFDQSxDQUFDUyxNQUFNLEdBQUdHLE9BQU8sQ0FBQztBQUM3QixHQUFHO0FBRUksTUFBTUMsd0JBQXdCWixrRUFBZ0JBLENBQUM7SUFDcERhLFdBQVdaLDZEQUFlQSxDQUN2QmEsS0FBSyxDQUFDVCw0QkFDTlUsUUFBUSxDQUFDLE9BQU8sRUFBRUMsR0FBRyxFQUFFRixLQUFLLEVBQUU7UUFDN0IsSUFBSTtZQUNGLG1EQUFtRDtZQUNuRCxNQUFNRyxxQkFBcUIsTUFBTWYsZ0RBQUVBLENBQ2hDZ0IsTUFBTSxHQUNOQyxJQUFJLENBQUNoQiw4REFBZ0JBLEVBQ3JCaUIsS0FBSyxDQUFDaEIsK0NBQUVBLENBQUNELDhEQUFnQkEsQ0FBQ0ksS0FBSyxFQUFFTyxNQUFNUCxLQUFLLEdBQzVDYyxLQUFLLENBQUM7WUFFVCxJQUFJSixtQkFBbUJLLE1BQU0sR0FBRyxHQUFHO2dCQUNqQyx1QkFBdUI7Z0JBQ3ZCLE1BQU1DLGFBQWFOLGtCQUFrQixDQUFDLEVBQUU7Z0JBQ3hDLElBQUlNLFlBQVlDLFdBQVcsVUFBVTtvQkFDbkMsTUFBTSxJQUFJQyxNQUFNO2dCQUNsQixPQUFPLElBQUlGLFlBQVlDLFdBQVcsZ0JBQWdCO29CQUNoRCwwQkFBMEI7b0JBQzFCLE1BQU10QixnREFBRUEsQ0FDTHdCLE1BQU0sQ0FBQ3ZCLDhEQUFnQkEsRUFDdkJ3QixHQUFHLENBQUM7d0JBQ0hILFFBQVE7d0JBQ1JJLGNBQWMsSUFBSUM7d0JBQ2xCbkIsUUFBUUksTUFBTUosTUFBTTt3QkFDcEJvQixRQUFRZCxJQUFJZSxPQUFPLEVBQUVDLE1BQU1DLE1BQU07b0JBQ25DLEdBQ0NiLEtBQUssQ0FBQ2hCLCtDQUFFQSxDQUFDRCw4REFBZ0JBLENBQUNJLEtBQUssRUFBRU8sTUFBTVAsS0FBSztvQkFFL0MsT0FBTzt3QkFDTDJCLFNBQVM7d0JBQ1R6QixTQUFTO3dCQUNUMEIsa0JBQWtCO29CQUNwQjtnQkFDRjtZQUNGO1lBRUEsMEJBQTBCO1lBQzFCLE1BQU1DLGdCQUFnQixNQUFNbEMsZ0RBQUVBLENBQzNCbUMsTUFBTSxDQUFDbEMsOERBQWdCQSxFQUN2Qm1DLE1BQU0sQ0FBQztnQkFDTi9CLE9BQU9PLE1BQU1QLEtBQUs7Z0JBQ2xCRyxRQUFRSSxNQUFNSixNQUFNO2dCQUNwQmMsUUFBUTtnQkFDUk0sUUFBUWQsSUFBSWUsT0FBTyxFQUFFQyxNQUFNQyxNQUFNO1lBQ25DLEdBQ0NNLFNBQVM7WUFFWkMsUUFBUUMsR0FBRyxDQUFDLCtCQUErQkwsYUFBYSxDQUFDLEVBQUUsRUFBRUg7WUFFN0QsT0FBTztnQkFDTEMsU0FBUztnQkFDVHpCLFNBQVM7Z0JBQ1QwQixrQkFBa0I7WUFDcEI7UUFDRixFQUFFLE9BQU9PLE9BQU87WUFDZEYsUUFBUUUsS0FBSyxDQUFDLDZCQUE2QkE7WUFFM0MsaUNBQWlDO1lBQ2pDLElBQUlBLGlCQUFpQmpCLE9BQU87Z0JBQzFCLElBQUlpQixNQUFNakMsT0FBTyxDQUFDa0MsUUFBUSxDQUFDLHNCQUFzQjtvQkFDL0MsTUFBTSxJQUFJbEIsTUFBTTtnQkFDbEI7Z0JBQ0EsSUFBSWlCLE1BQU1qQyxPQUFPLENBQUNrQyxRQUFRLENBQUMsc0JBQXNCO29CQUMvQyxNQUFNLElBQUlsQixNQUFNO2dCQUNsQjtZQUNGO1lBRUEsTUFBTSxJQUFJQSxNQUFNO1FBQ2xCO0lBQ0Y7QUFDSixHQUFHIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2VtYWlsU3Vic2NyaWJlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2VtYWlsU3Vic2NyaWJlci50c1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IGNyZWF0ZVRSUENSb3V0ZXIsIHB1YmxpY1Byb2NlZHVyZSB9IGZyb20gXCJ+L3NlcnZlci9hcGkvdHJwY1wiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgZW1haWxTdWJzY3JpYmVycyB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBlcSB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuXG5leHBvcnQgY29uc3QgZW1haWxTdWJzY3JpYmVySW5wdXRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKHtcbiAgICBtZXNzYWdlOiBcIlBsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3NcIlxuICB9KSxcbiAgc291cmNlOiB6LnN0cmluZygpLmRlZmF1bHQoJ2hvbWVwYWdlJyksXG59KTtcblxuZXhwb3J0IGNvbnN0IGVtYWlsU3Vic2NyaWJlclJvdXRlciA9IGNyZWF0ZVRSUENSb3V0ZXIoe1xuICBzdWJzY3JpYmU6IHB1YmxpY1Byb2NlZHVyZVxuICAgIC5pbnB1dChlbWFpbFN1YnNjcmliZXJJbnB1dFNjaGVtYSlcbiAgICAubXV0YXRpb24oYXN5bmMgKHsgY3R4LCBpbnB1dCB9KSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBDaGVjayBpZiBlbWFpbCBhbHJlYWR5IGV4aXN0cyB1c2luZyBkaXJlY3QgcXVlcnlcbiAgICAgICAgY29uc3QgZXhpc3RpbmdTdWJzY3JpYmVyID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShlbWFpbFN1YnNjcmliZXJzKVxuICAgICAgICAgIC53aGVyZShlcShlbWFpbFN1YnNjcmliZXJzLmVtYWlsLCBpbnB1dC5lbWFpbCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1N1YnNjcmliZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIEVtYWlsIGFscmVhZHkgZXhpc3RzXG4gICAgICAgICAgY29uc3Qgc3Vic2NyaWJlciA9IGV4aXN0aW5nU3Vic2NyaWJlclswXTtcbiAgICAgICAgICBpZiAoc3Vic2NyaWJlcj8uc3RhdHVzID09PSAnYWN0aXZlJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbWFpbCBhZGRyZXNzIGFscmVhZHkgc2lnbmVkIHVwIGZvciB1cGRhdGVzJyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChzdWJzY3JpYmVyPy5zdGF0dXMgPT09ICd1bnN1YnNjcmliZWQnKSB7XG4gICAgICAgICAgICAvLyBSZWFjdGl2YXRlIHN1YnNjcmlwdGlvblxuICAgICAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnVwZGF0ZShlbWFpbFN1YnNjcmliZXJzKVxuICAgICAgICAgICAgICAuc2V0KHsgXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgc291cmNlOiBpbnB1dC5zb3VyY2UsXG4gICAgICAgICAgICAgICAgdXNlcklkOiBjdHguc2Vzc2lvbj8udXNlcj8uaWQgfHwgbnVsbFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAud2hlcmUoZXEoZW1haWxTdWJzY3JpYmVycy5lbWFpbCwgaW5wdXQuZW1haWwpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IHJlc3Vic2NyaWJlZCB0byB1cGRhdGVzIScsXG4gICAgICAgICAgICAgIGlzUmVzdWJzY3JpcHRpb246IHRydWUgXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgc3Vic2NyaXB0aW9uXG4gICAgICAgIGNvbnN0IG5ld1N1YnNjcmliZXIgPSBhd2FpdCBkYlxuICAgICAgICAgIC5pbnNlcnQoZW1haWxTdWJzY3JpYmVycylcbiAgICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICAgIGVtYWlsOiBpbnB1dC5lbWFpbCxcbiAgICAgICAgICAgIHNvdXJjZTogaW5wdXQuc291cmNlLFxuICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgICAgIHVzZXJJZDogY3R4LnNlc3Npb24/LnVzZXI/LmlkIHx8IG51bGwsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ0VtYWlsIHN1YnNjcmlwdGlvbiBjcmVhdGVkOicsIG5ld1N1YnNjcmliZXJbMF0/LmlkKTtcblxuICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IHN1YnNjcmliZWQgdG8gdXBkYXRlcyEnLFxuICAgICAgICAgIGlzUmVzdWJzY3JpcHRpb246IGZhbHNlIFxuICAgICAgICB9O1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRW1haWwgc3Vic2NyaXB0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSBzcGVjaWZpYyBlcnJvciBtZXNzYWdlc1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdhbHJlYWR5IHNpZ25lZCB1cCcpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtYWlsIGFkZHJlc3MgYWxyZWFkeSBzaWduZWQgdXAgZm9yIHVwZGF0ZXMnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3VuaXF1ZSBjb25zdHJhaW50JykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRW1haWwgYWRkcmVzcyBhbHJlYWR5IHNpZ25lZCB1cCBmb3IgdXBkYXRlcycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc3Vic2NyaWJlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicpO1xuICAgICAgfVxuICAgIH0pLFxufSk7ICJdLCJuYW1lcyI6WyJ6IiwiY3JlYXRlVFJQQ1JvdXRlciIsInB1YmxpY1Byb2NlZHVyZSIsImRiIiwiZW1haWxTdWJzY3JpYmVycyIsImVxIiwiZW1haWxTdWJzY3JpYmVySW5wdXRTY2hlbWEiLCJvYmplY3QiLCJlbWFpbCIsInN0cmluZyIsIm1lc3NhZ2UiLCJzb3VyY2UiLCJkZWZhdWx0IiwiZW1haWxTdWJzY3JpYmVyUm91dGVyIiwic3Vic2NyaWJlIiwiaW5wdXQiLCJtdXRhdGlvbiIsImN0eCIsImV4aXN0aW5nU3Vic2NyaWJlciIsInNlbGVjdCIsImZyb20iLCJ3aGVyZSIsImxpbWl0IiwibGVuZ3RoIiwic3Vic2NyaWJlciIsInN0YXR1cyIsIkVycm9yIiwidXBkYXRlIiwic2V0Iiwic3Vic2NyaWJlZEF0IiwiRGF0ZSIsInVzZXJJZCIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJzdWNjZXNzIiwiaXNSZXN1YnNjcmlwdGlvbiIsIm5ld1N1YnNjcmliZXIiLCJpbnNlcnQiLCJ2YWx1ZXMiLCJyZXR1cm5pbmciLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJpbmNsdWRlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/emailSubscriber.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/feedback.ts":
/*!********************************************!*\
  !*** ./src/server/api/routers/feedback.ts ***!
  \********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   feedbackInputSchema: () => (/* binding */ feedbackInputSchema),\n/* harmony export */   feedbackRouter: () => (/* binding */ feedbackRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/api/routers/feedback.ts\n\n\n\n\nconst feedbackInputSchema = zod__WEBPACK_IMPORTED_MODULE_2__.z.object({\n    name: zod__WEBPACK_IMPORTED_MODULE_2__.z.string().optional(),\n    email: zod__WEBPACK_IMPORTED_MODULE_2__.z.string().email({\n        message: \"Invalid email address\"\n    }).optional().or(zod__WEBPACK_IMPORTED_MODULE_2__.z.literal('')),\n    content: zod__WEBPACK_IMPORTED_MODULE_2__.z.string().optional(),\n    prioritizedFeatures: zod__WEBPACK_IMPORTED_MODULE_2__.z.array(zod__WEBPACK_IMPORTED_MODULE_2__.z.string()).optional()\n});\nconst feedbackRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    submit: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.publicProcedure.input(feedbackInputSchema).mutation(async ({ ctx, input })=>{\n        const userId = ctx.session?.user?.id;\n        try {\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.feedback).values({\n                name: input.name,\n                // Treat empty string email as null\n                email: input.email === '' ? undefined : input.email,\n                content: input.content,\n                prioritizedFeatures: input.prioritizedFeatures,\n                userId: userId ?? null,\n                status: 'new'\n            });\n            return {\n                success: true,\n                message: \"Feedback submitted successfully.\"\n            };\n        } catch (error) {\n            console.error(\"Failed to submit feedback:\", error);\n            // Consider throwing a TRPCError for client-side handling\n            // For now, returning a generic error message or rethrowing\n            throw new Error(\"Failed to submit feedback. Please try again later.\");\n        }\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2ZlZWRiYWNrLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEscUNBQXFDO0FBQ2I7QUFDOEM7QUFDaEM7QUFDdUI7QUFFdEQsTUFBTU0sc0JBQXNCTixrQ0FBQ0EsQ0FBQ08sTUFBTSxDQUFDO0lBQzFDQyxNQUFNUixrQ0FBQ0EsQ0FBQ1MsTUFBTSxHQUFHQyxRQUFRO0lBQ3pCQyxPQUFPWCxrQ0FBQ0EsQ0FBQ1MsTUFBTSxHQUFHRSxLQUFLLENBQUM7UUFDdEJDLFNBQVM7SUFDWCxHQUFHRixRQUFRLEdBQUdHLEVBQUUsQ0FBQ2Isa0NBQUNBLENBQUNjLE9BQU8sQ0FBQztJQUMzQkMsU0FBU2Ysa0NBQUNBLENBQUNTLE1BQU0sR0FBR0MsUUFBUTtJQUM1Qk0scUJBQXFCaEIsa0NBQUNBLENBQUNpQixLQUFLLENBQUNqQixrQ0FBQ0EsQ0FBQ1MsTUFBTSxJQUFJQyxRQUFRO0FBQ25ELEdBQUc7QUFFSSxNQUFNUSxpQkFBaUJqQixrRUFBZ0JBLENBQUM7SUFDN0NrQixRQUFRakIsNkRBQWVBLENBQ3BCa0IsS0FBSyxDQUFDZCxxQkFDTmUsUUFBUSxDQUFDLE9BQU8sRUFBRUMsR0FBRyxFQUFFRixLQUFLLEVBQUU7UUFDN0IsTUFBTUcsU0FBU0QsSUFBSUUsT0FBTyxFQUFFQyxNQUFNQztRQUVsQyxJQUFJO1lBQ0YsTUFBTXZCLGdEQUFFQSxDQUFDd0IsTUFBTSxDQUFDdEIsc0RBQWFBLEVBQUV1QixNQUFNLENBQUM7Z0JBQ3BDcEIsTUFBTVksTUFBTVosSUFBSTtnQkFDaEIsbUNBQW1DO2dCQUNuQ0csT0FBT1MsTUFBTVQsS0FBSyxLQUFLLEtBQUtrQixZQUFZVCxNQUFNVCxLQUFLO2dCQUNuREksU0FBU0ssTUFBTUwsT0FBTztnQkFDdEJDLHFCQUFxQkksTUFBTUosbUJBQW1CO2dCQUM5Q08sUUFBUUEsVUFBVTtnQkFDbEJPLFFBQVE7WUFDVjtZQUNBLE9BQU87Z0JBQUVDLFNBQVM7Z0JBQU1uQixTQUFTO1lBQW1DO1FBQ3RFLEVBQUUsT0FBT29CLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QkE7WUFDNUMseURBQXlEO1lBQ3pELDJEQUEyRDtZQUMzRCxNQUFNLElBQUlFLE1BQU07UUFDbEI7SUFDRjtBQUNKLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvZmVlZGJhY2sudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9hcGkvcm91dGVycy9mZWVkYmFjay50c1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IGNyZWF0ZVRSUENSb3V0ZXIsIHB1YmxpY1Byb2NlZHVyZSB9IGZyb20gXCJ+L3NlcnZlci9hcGkvdHJwY1wiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgZmVlZGJhY2sgYXMgZmVlZGJhY2tUYWJsZSB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5cbmV4cG9ydCBjb25zdCBmZWVkYmFja0lucHV0U2NoZW1hID0gei5vYmplY3Qoe1xuICBuYW1lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKHtcbiAgICBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgYWRkcmVzc1wiXG4gIH0pLm9wdGlvbmFsKCkub3Ioei5saXRlcmFsKCcnKSksIC8vIEFsbG93IGVtcHR5IHN0cmluZyBhbmQgdHJlYXQgYXMgdW5kZWZpbmVkIGxhdGVyXG4gIGNvbnRlbnQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgcHJpb3JpdGl6ZWRGZWF0dXJlczogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBmZWVkYmFja1JvdXRlciA9IGNyZWF0ZVRSUENSb3V0ZXIoe1xuICBzdWJtaXQ6IHB1YmxpY1Byb2NlZHVyZVxuICAgIC5pbnB1dChmZWVkYmFja0lucHV0U2NoZW1hKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBjdHgsIGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGN0eC5zZXNzaW9uPy51c2VyPy5pZDtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGZlZWRiYWNrVGFibGUpLnZhbHVlcyh7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICAvLyBUcmVhdCBlbXB0eSBzdHJpbmcgZW1haWwgYXMgbnVsbFxuICAgICAgICAgIGVtYWlsOiBpbnB1dC5lbWFpbCA9PT0gJycgPyB1bmRlZmluZWQgOiBpbnB1dC5lbWFpbCxcbiAgICAgICAgICBjb250ZW50OiBpbnB1dC5jb250ZW50LFxuICAgICAgICAgIHByaW9yaXRpemVkRmVhdHVyZXM6IGlucHV0LnByaW9yaXRpemVkRmVhdHVyZXMsXG4gICAgICAgICAgdXNlcklkOiB1c2VySWQgPz8gbnVsbCwgLy8gTGluayB0byB1c2VyIGlmIGxvZ2dlZCBpbiwgb3RoZXJ3aXNlIG51bGxcbiAgICAgICAgICBzdGF0dXM6ICduZXcnLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJGZWVkYmFjayBzdWJtaXR0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHN1Ym1pdCBmZWVkYmFjazpcIiwgZXJyb3IpO1xuICAgICAgICAvLyBDb25zaWRlciB0aHJvd2luZyBhIFRSUENFcnJvciBmb3IgY2xpZW50LXNpZGUgaGFuZGxpbmdcbiAgICAgICAgLy8gRm9yIG5vdywgcmV0dXJuaW5nIGEgZ2VuZXJpYyBlcnJvciBtZXNzYWdlIG9yIHJldGhyb3dpbmdcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHN1Ym1pdCBmZWVkYmFjay4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIik7XG4gICAgICB9XG4gICAgfSksXG59KTtcbiJdLCJuYW1lcyI6WyJ6IiwiY3JlYXRlVFJQQ1JvdXRlciIsInB1YmxpY1Byb2NlZHVyZSIsImRiIiwiZmVlZGJhY2siLCJmZWVkYmFja1RhYmxlIiwiZmVlZGJhY2tJbnB1dFNjaGVtYSIsIm9iamVjdCIsIm5hbWUiLCJzdHJpbmciLCJvcHRpb25hbCIsImVtYWlsIiwibWVzc2FnZSIsIm9yIiwibGl0ZXJhbCIsImNvbnRlbnQiLCJwcmlvcml0aXplZEZlYXR1cmVzIiwiYXJyYXkiLCJmZWVkYmFja1JvdXRlciIsInN1Ym1pdCIsImlucHV0IiwibXV0YXRpb24iLCJjdHgiLCJ1c2VySWQiLCJzZXNzaW9uIiwidXNlciIsImlkIiwiaW5zZXJ0IiwidmFsdWVzIiwidW5kZWZpbmVkIiwic3RhdHVzIiwic3VjY2VzcyIsImVycm9yIiwiY29uc29sZSIsIkVycm9yIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/feedback.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/generation.universal.ts":
/*!********************************************************!*\
  !*** ./src/server/api/routers/generation.universal.ts ***!
  \********************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generationUniversalRouter: () => (/* binding */ generationUniversalRouter)\n/* harmony export */ });\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _generation_scene_operations__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./generation/scene-operations */ \"(rsc)/./src/server/api/routers/generation/scene-operations.ts\");\n/* harmony import */ var _generation_project_operations__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./generation/project-operations */ \"(rsc)/./src/server/api/routers/generation/project-operations.ts\");\n/* harmony import */ var _generation_iteration_operations__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./generation/iteration-operations */ \"(rsc)/./src/server/api/routers/generation/iteration-operations.ts\");\n/* harmony import */ var _generation_template_operations__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./generation/template-operations */ \"(rsc)/./src/server/api/routers/generation/template-operations.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _generation_scene_operations__WEBPACK_IMPORTED_MODULE_1__, _generation_project_operations__WEBPACK_IMPORTED_MODULE_2__, _generation_iteration_operations__WEBPACK_IMPORTED_MODULE_3__, _generation_template_operations__WEBPACK_IMPORTED_MODULE_4__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _generation_scene_operations__WEBPACK_IMPORTED_MODULE_1__, _generation_project_operations__WEBPACK_IMPORTED_MODULE_2__, _generation_iteration_operations__WEBPACK_IMPORTED_MODULE_3__, _generation_template_operations__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * Generation Router with Universal Response Format\n * Modularized version - imports operations from subdirectory\n */ \n// Import all operations from modular files\n\n\n\n\nconst generationUniversalRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    // Scene operations\n    generateScene: _generation_scene_operations__WEBPACK_IMPORTED_MODULE_1__.generateScene,\n    removeScene: _generation_scene_operations__WEBPACK_IMPORTED_MODULE_1__.removeScene,\n    // Project operations\n    getProjectScenes: _generation_project_operations__WEBPACK_IMPORTED_MODULE_2__.getProjectScenes,\n    // Iteration operations\n    getMessageIterations: _generation_iteration_operations__WEBPACK_IMPORTED_MODULE_3__.getMessageIterations,\n    getBatchMessageIterations: _generation_iteration_operations__WEBPACK_IMPORTED_MODULE_3__.getBatchMessageIterations,\n    revertToIteration: _generation_iteration_operations__WEBPACK_IMPORTED_MODULE_3__.revertToIteration,\n    // Template operations\n    addTemplate: _generation_template_operations__WEBPACK_IMPORTED_MODULE_4__.addTemplate\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24udW5pdmVyc2FsLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBOzs7Q0FHQyxHQUVvRDtBQUVyRCwyQ0FBMkM7QUFDZ0M7QUFDUjtBQUt4QjtBQUNvQjtBQUV4RCxNQUFNUSw0QkFBNEJSLGtFQUFnQkEsQ0FBQztJQUN4RCxtQkFBbUI7SUFDbkJDLGFBQWFBLHlFQUFBQTtJQUNiQyxXQUFXQSx1RUFBQUE7SUFFWCxxQkFBcUI7SUFDckJDLGdCQUFnQkEsOEVBQUFBO0lBRWhCLHVCQUF1QjtJQUN2QkMsb0JBQW9CQSxvRkFBQUE7SUFDcEJDLHlCQUF5QkEseUZBQUFBO0lBQ3pCQyxpQkFBaUJBLGlGQUFBQTtJQUVqQixzQkFBc0I7SUFDdEJDLFdBQVdBLDBFQUFBQTtBQUNiLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvZ2VuZXJhdGlvbi51bml2ZXJzYWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBHZW5lcmF0aW9uIFJvdXRlciB3aXRoIFVuaXZlcnNhbCBSZXNwb25zZSBGb3JtYXRcbiAqIE1vZHVsYXJpemVkIHZlcnNpb24gLSBpbXBvcnRzIG9wZXJhdGlvbnMgZnJvbSBzdWJkaXJlY3RvcnlcbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVUUlBDUm91dGVyIH0gZnJvbSBcIn4vc2VydmVyL2FwaS90cnBjXCI7XG5cbi8vIEltcG9ydCBhbGwgb3BlcmF0aW9ucyBmcm9tIG1vZHVsYXIgZmlsZXNcbmltcG9ydCB7IGdlbmVyYXRlU2NlbmUsIHJlbW92ZVNjZW5lIH0gZnJvbSBcIi4vZ2VuZXJhdGlvbi9zY2VuZS1vcGVyYXRpb25zXCI7XG5pbXBvcnQgeyBnZXRQcm9qZWN0U2NlbmVzIH0gZnJvbSBcIi4vZ2VuZXJhdGlvbi9wcm9qZWN0LW9wZXJhdGlvbnNcIjtcbmltcG9ydCB7IFxuICBnZXRNZXNzYWdlSXRlcmF0aW9ucywgXG4gIGdldEJhdGNoTWVzc2FnZUl0ZXJhdGlvbnMsIFxuICByZXZlcnRUb0l0ZXJhdGlvbiBcbn0gZnJvbSBcIi4vZ2VuZXJhdGlvbi9pdGVyYXRpb24tb3BlcmF0aW9uc1wiO1xuaW1wb3J0IHsgYWRkVGVtcGxhdGUgfSBmcm9tIFwiLi9nZW5lcmF0aW9uL3RlbXBsYXRlLW9wZXJhdGlvbnNcIjtcblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRpb25Vbml2ZXJzYWxSb3V0ZXIgPSBjcmVhdGVUUlBDUm91dGVyKHtcbiAgLy8gU2NlbmUgb3BlcmF0aW9uc1xuICBnZW5lcmF0ZVNjZW5lLFxuICByZW1vdmVTY2VuZSxcbiAgXG4gIC8vIFByb2plY3Qgb3BlcmF0aW9uc1xuICBnZXRQcm9qZWN0U2NlbmVzLFxuICBcbiAgLy8gSXRlcmF0aW9uIG9wZXJhdGlvbnNcbiAgZ2V0TWVzc2FnZUl0ZXJhdGlvbnMsXG4gIGdldEJhdGNoTWVzc2FnZUl0ZXJhdGlvbnMsXG4gIHJldmVydFRvSXRlcmF0aW9uLFxuICBcbiAgLy8gVGVtcGxhdGUgb3BlcmF0aW9uc1xuICBhZGRUZW1wbGF0ZSxcbn0pOyJdLCJuYW1lcyI6WyJjcmVhdGVUUlBDUm91dGVyIiwiZ2VuZXJhdGVTY2VuZSIsInJlbW92ZVNjZW5lIiwiZ2V0UHJvamVjdFNjZW5lcyIsImdldE1lc3NhZ2VJdGVyYXRpb25zIiwiZ2V0QmF0Y2hNZXNzYWdlSXRlcmF0aW9ucyIsInJldmVydFRvSXRlcmF0aW9uIiwiYWRkVGVtcGxhdGUiLCJnZW5lcmF0aW9uVW5pdmVyc2FsUm91dGVyIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/generation.universal.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/generation/helpers.ts":
/*!******************************************************!*\
  !*** ./src/server/api/routers/generation/helpers.ts ***!
  \******************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   executeToolFromDecision: () => (/* binding */ executeToolFromDecision)\n/* harmony export */ });\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _tools_add_add__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/tools/add/add */ \"(rsc)/./src/tools/add/add.ts\");\n/* harmony import */ var _tools_edit_edit__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/tools/edit/edit */ \"(rsc)/./src/tools/edit/edit.ts\");\n/* harmony import */ var _tools_delete_delete__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/tools/delete/delete */ \"(rsc)/./src/tools/delete/delete.ts\");\n/* harmony import */ var _tools_trim_trim__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ~/tools/trim/trim */ \"(rsc)/./src/tools/trim/trim.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_bazaar_database__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__]);\n([_bazaar_database__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n// Helper function for tool execution and database save\nasync function executeToolFromDecision(decision, projectId, userId, storyboard, messageId) {\n    const startTime = Date.now(); // Track generation time\n    if (!decision.toolName || !decision.toolContext) {\n        throw new Error(\"Invalid decision - missing tool name or context\");\n    }\n    let toolInput;\n    // Prepare tool input based on tool type\n    switch(decision.toolName){\n        case 'addScene':\n            // Get reference scenes if specified by Brain for cross-scene style matching\n            let referenceScenes = [];\n            if (decision.toolContext?.referencedSceneIds?.length && decision.toolContext.referencedSceneIds.length > 0) {\n                // Safety: Only include scenes that exist in storyboard\n                referenceScenes = storyboard.filter((s)=>decision.toolContext.referencedSceneIds.includes(s.id));\n                console.log(` [ROUTER] Including ${referenceScenes.length} reference scenes for ADD operation`);\n            }\n            toolInput = {\n                userPrompt: decision.toolContext.userPrompt,\n                projectId,\n                userId,\n                sceneNumber: storyboard.length + 1,\n                storyboardSoFar: storyboard,\n                imageUrls: decision.toolContext.imageUrls,\n                visionAnalysis: decision.toolContext.visionAnalysis,\n                // Pass previous scene for style continuity\n                previousSceneContext: storyboard.length > 0 ? {\n                    tsxCode: storyboard[storyboard.length - 1].tsxCode,\n                    style: undefined\n                } : undefined,\n                // NEW: Pass reference scenes for cross-scene style matching\n                referenceScenes: referenceScenes.length > 0 ? referenceScenes.map((s)=>({\n                        id: s.id,\n                        name: s.name,\n                        tsxCode: s.tsxCode\n                    })) : undefined,\n                // NEW: Pass web context for brand-matching\n                webContext: decision.toolContext.webContext\n            };\n            const addResult = await _tools_add_add__WEBPACK_IMPORTED_MODULE_2__.addTool.run(toolInput);\n            console.log(' [ROUTER] Received from ADD tool:', {\n                success: addResult.success,\n                hasData: !!addResult.data,\n                dataKeys: addResult.data ? Object.keys(addResult.data) : [],\n                name: addResult.data?.name,\n                codeLength: addResult.data?.tsxCode?.length\n            });\n            if (!addResult.success || !addResult.data) {\n                throw new Error(addResult.error?.message || 'Add operation failed');\n            }\n            // Trust the duration from the ADD tool - it already analyzes the code\n            let addFinalDuration = addResult.data.duration || 150;\n            // Save to database\n            console.log(' [ROUTER] Saving to database:', {\n                projectId,\n                name: addResult.data.name,\n                order: storyboard.length,\n                duration: addFinalDuration\n            });\n            const [newScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes).values({\n                projectId,\n                name: addResult.data.name,\n                tsxCode: addResult.data.tsxCode,\n                duration: addFinalDuration || 150,\n                order: storyboard.length,\n                props: addResult.data.props || {},\n                layoutJson: addResult.data.layoutJson || null\n            }).returning();\n            if (!newScene) {\n                throw new Error('Failed to save scene to database');\n            }\n            console.log(' [ROUTER] Scene saved to database:', {\n                id: newScene.id,\n                name: newScene.name,\n                duration: newScene.duration,\n                order: newScene.order\n            });\n            // Track this iteration if we have a messageId\n            if (messageId) {\n                const endTime = Date.now();\n                const generationTimeMs = endTime - startTime;\n                // Create scene iteration record\n                await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations).values({\n                    sceneId: newScene.id,\n                    projectId,\n                    operationType: 'create',\n                    userPrompt: decision.toolContext.userPrompt,\n                    brainReasoning: decision.reasoning,\n                    codeAfter: newScene.tsxCode,\n                    generationTimeMs,\n                    modelUsed: null,\n                    temperature: null,\n                    userEditedAgain: false,\n                    messageId\n                });\n                console.log(' [ROUTER] Created scene iteration record:', {\n                    sceneId: newScene.id,\n                    operationType: 'create',\n                    generationTimeMs\n                });\n            }\n            return {\n                success: true,\n                scene: newScene\n            };\n        case 'editScene':\n            if (!decision.toolContext.targetSceneId) {\n                throw new Error(\"No target scene ID for edit operation\");\n            }\n            const sceneToEdit = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.query.scenes.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id, decision.toolContext.targetSceneId)\n            });\n            if (!sceneToEdit) {\n                throw new Error(\"Scene not found for editing\");\n            }\n            // Get reference scenes if specified by Brain\n            let editReferenceScenes = [];\n            if (decision.toolContext?.referencedSceneIds?.length && decision.toolContext.referencedSceneIds.length > 0) {\n                // Safety: Only include scenes that exist in storyboard\n                editReferenceScenes = storyboard.filter((s)=>decision.toolContext.referencedSceneIds.includes(s.id));\n                console.log(` [ROUTER] Including ${editReferenceScenes.length} reference scenes for edit`);\n            }\n            toolInput = {\n                userPrompt: decision.toolContext.userPrompt,\n                projectId,\n                userId,\n                sceneId: decision.toolContext.targetSceneId,\n                tsxCode: sceneToEdit.tsxCode,\n                currentDuration: sceneToEdit.duration,\n                // Include reference scenes if any\n                referenceScenes: editReferenceScenes.length > 0 ? editReferenceScenes.map((s)=>({\n                        id: s.id,\n                        name: s.name,\n                        tsxCode: s.tsxCode\n                    })) : undefined,\n                imageUrls: decision.toolContext.imageUrls,\n                visionAnalysis: decision.toolContext.visionAnalysis,\n                errorDetails: decision.toolContext.errorDetails,\n                // NEW: Pass web context for brand-matching\n                webContext: decision.toolContext.webContext\n            };\n            const editResult = await _tools_edit_edit__WEBPACK_IMPORTED_MODULE_3__.editTool.run(toolInput);\n            console.log(' [ROUTER] Received from EDIT tool:', {\n                success: editResult.success,\n                hasData: !!editResult.data,\n                dataKeys: editResult.data ? Object.keys(editResult.data) : [],\n                error: editResult.error\n            });\n            if (!editResult.success || !editResult.data || !editResult.data.tsxCode) {\n                const errorMessage = typeof editResult.error === 'string' ? editResult.error : editResult.error?.message || 'Edit operation failed - no code returned';\n                throw new Error(errorMessage);\n            }\n            // Use duration from edit result if provided, otherwise keep existing\n            let editFinalDuration = editResult.data.duration;\n            // Update database\n            console.log(' [ROUTER] Updating scene in database:', {\n                sceneId: decision.toolContext.targetSceneId,\n                codeChanged: editResult.data.tsxCode !== sceneToEdit.tsxCode,\n                durationChanged: editFinalDuration && editFinalDuration !== sceneToEdit.duration\n            });\n            const [updatedScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes).set({\n                tsxCode: editResult.data.tsxCode,\n                duration: editFinalDuration || sceneToEdit.duration,\n                props: editResult.data.props || sceneToEdit.props,\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id, decision.toolContext.targetSceneId)).returning();\n            if (!updatedScene) {\n                throw new Error('Failed to update scene in database');\n            }\n            // Track this iteration if we have a messageId\n            if (messageId) {\n                const endTime = Date.now();\n                const generationTimeMs = endTime - startTime;\n                // Create scene iteration record\n                await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations).values({\n                    sceneId: decision.toolContext.targetSceneId,\n                    projectId,\n                    operationType: 'edit',\n                    userPrompt: decision.toolContext.userPrompt,\n                    brainReasoning: decision.reasoning,\n                    codeBefore: sceneToEdit.tsxCode,\n                    codeAfter: editResult.data.tsxCode,\n                    generationTimeMs,\n                    modelUsed: null,\n                    temperature: null,\n                    userEditedAgain: false,\n                    messageId\n                });\n                console.log(' [ROUTER] Created scene iteration record:', {\n                    sceneId: decision.toolContext.targetSceneId,\n                    operationType: 'edit',\n                    generationTimeMs\n                });\n            }\n            return {\n                success: true,\n                scene: updatedScene\n            };\n        case 'trimScene':\n            if (!decision.toolContext.targetSceneId) {\n                throw new Error(\"No target scene ID for trim operation\");\n            }\n            const sceneToTrim = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.query.scenes.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id, decision.toolContext.targetSceneId)\n            });\n            if (!sceneToTrim) {\n                throw new Error(\"Scene not found for trimming\");\n            }\n            toolInput = {\n                userPrompt: decision.toolContext.userPrompt,\n                projectId,\n                userId,\n                sceneId: decision.toolContext.targetSceneId,\n                currentDuration: sceneToTrim.duration,\n                newDuration: decision.toolContext.targetDuration\n            };\n            const trimResult = await _tools_trim_trim__WEBPACK_IMPORTED_MODULE_5__.trimTool.run(toolInput);\n            console.log(' [ROUTER] Received from TRIM tool:', {\n                success: trimResult.success,\n                hasData: !!trimResult.data,\n                newDuration: trimResult.data?.duration,\n                trimmedFrames: trimResult.data?.trimmedFrames\n            });\n            if (!trimResult.success || !trimResult.data || !trimResult.data.duration) {\n                throw new Error(trimResult.error?.message || 'Trim operation failed');\n            }\n            // Update only the duration in database\n            console.log(' [ROUTER] Updating scene duration in database:', {\n                sceneId: decision.toolContext.targetSceneId,\n                oldDuration: sceneToTrim.duration,\n                newDuration: trimResult.data.duration\n            });\n            const [trimmedScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes).set({\n                duration: trimResult.data.duration,\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id, decision.toolContext.targetSceneId)).returning();\n            if (!trimmedScene) {\n                throw new Error('Failed to update scene duration in database');\n            }\n            // Track this iteration if we have a messageId\n            if (messageId) {\n                const endTime = Date.now();\n                const generationTimeMs = endTime - startTime;\n                // Create scene iteration record for trim\n                await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations).values({\n                    sceneId: decision.toolContext.targetSceneId,\n                    projectId,\n                    operationType: 'edit',\n                    userPrompt: decision.toolContext.userPrompt,\n                    brainReasoning: decision.reasoning,\n                    codeBefore: sceneToTrim.tsxCode,\n                    codeAfter: sceneToTrim.tsxCode,\n                    generationTimeMs,\n                    modelUsed: null,\n                    temperature: null,\n                    userEditedAgain: false,\n                    messageId\n                });\n                console.log(' [ROUTER] Created scene iteration record for trim:', {\n                    sceneId: decision.toolContext.targetSceneId,\n                    operationType: 'trim',\n                    oldDuration: sceneToTrim.duration,\n                    newDuration: trimResult.data.duration,\n                    generationTimeMs\n                });\n            }\n            return {\n                success: true,\n                scene: trimmedScene\n            };\n        case 'deleteScene':\n            if (!decision.toolContext.targetSceneId) {\n                throw new Error(\"No target scene ID for delete operation\");\n            }\n            toolInput = {\n                userPrompt: decision.toolContext.userPrompt,\n                projectId,\n                sceneId: decision.toolContext.targetSceneId\n            };\n            // For delete, get the scene first for the response\n            const sceneToDelete = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.query.scenes.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id, decision.toolContext.targetSceneId)\n            });\n            if (!sceneToDelete) {\n                throw new Error(\"Scene not found for deletion\");\n            }\n            const deleteResult = await _tools_delete_delete__WEBPACK_IMPORTED_MODULE_4__.deleteTool.run(toolInput);\n            if (!deleteResult.success) {\n                throw new Error(deleteResult.error?.message || 'Delete operation failed');\n            }\n            // Delete from database\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.scenes.id, decision.toolContext.targetSceneId));\n            // Track this iteration if we have a messageId\n            if (messageId) {\n                const endTime = Date.now();\n                const generationTimeMs = endTime - startTime;\n                // Create scene iteration record\n                await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations).values({\n                    sceneId: decision.toolContext.targetSceneId,\n                    projectId,\n                    operationType: 'delete',\n                    userPrompt: decision.toolContext.userPrompt,\n                    brainReasoning: decision.reasoning,\n                    codeBefore: sceneToDelete.tsxCode,\n                    generationTimeMs,\n                    modelUsed: null,\n                    temperature: null,\n                    userEditedAgain: false,\n                    messageId\n                });\n                console.log(' [ROUTER] Created scene iteration record:', {\n                    sceneId: decision.toolContext.targetSceneId,\n                    operationType: 'delete',\n                    generationTimeMs\n                });\n            }\n            return {\n                success: true,\n                scene: sceneToDelete\n            };\n        default:\n            throw new Error(`Unknown tool: ${decision.toolName}`);\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vaGVscGVycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQXNDO0FBQ3FCO0FBQzFCO0FBQ1M7QUFDRztBQUNNO0FBQ047QUFLN0MsdURBQXVEO0FBQ2hELGVBQWVRLHdCQUNwQkMsUUFBdUIsRUFDdkJDLFNBQWlCLEVBQ2pCQyxNQUFjLEVBQ2RDLFVBQWlCLEVBQ2pCQyxTQUFrQjtJQUVsQixNQUFNQyxZQUFZQyxLQUFLQyxHQUFHLElBQUksd0JBQXdCO0lBRXRELElBQUksQ0FBQ1AsU0FBU1EsUUFBUSxJQUFJLENBQUNSLFNBQVNTLFdBQVcsRUFBRTtRQUMvQyxNQUFNLElBQUlDLE1BQU07SUFDbEI7SUFFQSxJQUFJQztJQUVKLHdDQUF3QztJQUN4QyxPQUFRWCxTQUFTUSxRQUFRO1FBQ3ZCLEtBQUs7WUFDSCw0RUFBNEU7WUFDNUUsSUFBSUksa0JBQXlCLEVBQUU7WUFDL0IsSUFBSVosU0FBU1MsV0FBVyxFQUFFSSxvQkFBb0JDLFVBQVVkLFNBQVNTLFdBQVcsQ0FBQ0ksa0JBQWtCLENBQUNDLE1BQU0sR0FBRyxHQUFHO2dCQUMxRyx1REFBdUQ7Z0JBQ3ZERixrQkFBa0JULFdBQVdZLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFDbENoQixTQUFTUyxXQUFXLENBQUVJLGtCQUFrQixDQUFFSSxRQUFRLENBQUNELEVBQUVFLEVBQUU7Z0JBR3pEQyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxzQkFBc0IsRUFBRVIsZ0JBQWdCRSxNQUFNLENBQUMsbUNBQW1DLENBQUM7WUFDbEc7WUFFQUgsWUFBWTtnQkFDVlUsWUFBWXJCLFNBQVNTLFdBQVcsQ0FBQ1ksVUFBVTtnQkFDM0NwQjtnQkFDQUM7Z0JBQ0FvQixhQUFhbkIsV0FBV1csTUFBTSxHQUFHO2dCQUNqQ1MsaUJBQWlCcEI7Z0JBQ2pCcUIsV0FBV3hCLFNBQVNTLFdBQVcsQ0FBQ2UsU0FBUztnQkFDekNDLGdCQUFnQnpCLFNBQVNTLFdBQVcsQ0FBQ2dCLGNBQWM7Z0JBQ25ELDJDQUEyQztnQkFDM0NDLHNCQUFzQnZCLFdBQVdXLE1BQU0sR0FBRyxJQUFJO29CQUM1Q2EsU0FBU3hCLFVBQVUsQ0FBQ0EsV0FBV1csTUFBTSxHQUFHLEVBQUUsQ0FBQ2EsT0FBTztvQkFDbERDLE9BQU9DO2dCQUNULElBQUlBO2dCQUNKLDREQUE0RDtnQkFDNURqQixpQkFBaUJBLGdCQUFnQkUsTUFBTSxHQUFHLElBQUlGLGdCQUFnQmtCLEdBQUcsQ0FBQ2QsQ0FBQUEsSUFBTTt3QkFDdEVFLElBQUlGLEVBQUVFLEVBQUU7d0JBQ1JhLE1BQU1mLEVBQUVlLElBQUk7d0JBQ1pKLFNBQVNYLEVBQUVXLE9BQU87b0JBQ3BCLE1BQU1FO2dCQUNOLDJDQUEyQztnQkFDM0NHLFlBQVloQyxTQUFTUyxXQUFXLENBQUN1QixVQUFVO1lBQzdDO1lBRUEsTUFBTUMsWUFBWSxNQUFNdEMsbURBQU9BLENBQUN1QyxHQUFHLENBQUN2QjtZQUNwQ1EsUUFBUUMsR0FBRyxDQUFDLHVDQUF1QztnQkFDakRlLFNBQVNGLFVBQVVFLE9BQU87Z0JBQzFCQyxTQUFTLENBQUMsQ0FBQ0gsVUFBVUksSUFBSTtnQkFDekJDLFVBQVVMLFVBQVVJLElBQUksR0FBR0UsT0FBT0MsSUFBSSxDQUFDUCxVQUFVSSxJQUFJLElBQUksRUFBRTtnQkFDM0ROLE1BQU1FLFVBQVVJLElBQUksRUFBRU47Z0JBQ3RCVSxZQUFZUixVQUFVSSxJQUFJLEVBQUVWLFNBQVNiO1lBQ3ZDO1lBRUEsSUFBSSxDQUFDbUIsVUFBVUUsT0FBTyxJQUFJLENBQUNGLFVBQVVJLElBQUksRUFBRTtnQkFDekMsTUFBTSxJQUFJM0IsTUFBTXVCLFVBQVVTLEtBQUssRUFBRUMsV0FBVztZQUM5QztZQUVBLHNFQUFzRTtZQUN0RSxJQUFJQyxtQkFBbUJYLFVBQVVJLElBQUksQ0FBQ1EsUUFBUSxJQUFJO1lBRWxELG1CQUFtQjtZQUNuQjFCLFFBQVFDLEdBQUcsQ0FBQyxtQ0FBbUM7Z0JBQzdDbkI7Z0JBQ0E4QixNQUFNRSxVQUFVSSxJQUFJLENBQUNOLElBQUk7Z0JBQ3pCZSxPQUFPM0MsV0FBV1csTUFBTTtnQkFDeEIrQixVQUFVRDtZQUNaO1lBRUEsTUFBTSxDQUFDRyxTQUFTLEdBQUcsTUFBTXhELGdEQUFFQSxDQUFDeUQsTUFBTSxDQUFDeEQsb0RBQU1BLEVBQUV5RCxNQUFNLENBQUM7Z0JBQ2hEaEQ7Z0JBQ0E4QixNQUFNRSxVQUFVSSxJQUFJLENBQUNOLElBQUk7Z0JBQ3pCSixTQUFTTSxVQUFVSSxJQUFJLENBQUNWLE9BQU87Z0JBQy9Ca0IsVUFBVUQsb0JBQW9CO2dCQUM5QkUsT0FBTzNDLFdBQVdXLE1BQU07Z0JBQ3hCb0MsT0FBT2pCLFVBQVVJLElBQUksQ0FBQ2EsS0FBSyxJQUFJLENBQUM7Z0JBQ2hDQyxZQUFZbEIsVUFBVUksSUFBSSxDQUFDYyxVQUFVLElBQUk7WUFDM0MsR0FBR0MsU0FBUztZQUVaLElBQUksQ0FBQ0wsVUFBVTtnQkFDYixNQUFNLElBQUlyQyxNQUFNO1lBQ2xCO1lBRUFTLFFBQVFDLEdBQUcsQ0FBQyx1Q0FBdUM7Z0JBQ2pERixJQUFJNkIsU0FBUzdCLEVBQUU7Z0JBQ2ZhLE1BQU1nQixTQUFTaEIsSUFBSTtnQkFDbkJjLFVBQVVFLFNBQVNGLFFBQVE7Z0JBQzNCQyxPQUFPQyxTQUFTRCxLQUFLO1lBQ3ZCO1lBRUEsOENBQThDO1lBQzlDLElBQUkxQyxXQUFXO2dCQUNiLE1BQU1pRCxVQUFVL0MsS0FBS0MsR0FBRztnQkFDeEIsTUFBTStDLG1CQUFtQkQsVUFBVWhEO2dCQUVuQyxnQ0FBZ0M7Z0JBQ2hDLE1BQU1kLGdEQUFFQSxDQUFDeUQsTUFBTSxDQUFDdkQsNkRBQWVBLEVBQUV3RCxNQUFNLENBQUM7b0JBQ3RDTSxTQUFTUixTQUFTN0IsRUFBRTtvQkFDcEJqQjtvQkFDQXVELGVBQWU7b0JBQ2ZuQyxZQUFZckIsU0FBU1MsV0FBVyxDQUFDWSxVQUFVO29CQUMzQ29DLGdCQUFnQnpELFNBQVMwRCxTQUFTO29CQUNsQ0MsV0FBV1osU0FBU3BCLE9BQU87b0JBQzNCMkI7b0JBQ0FNLFdBQVc7b0JBQ1hDLGFBQWE7b0JBQ2JDLGlCQUFpQjtvQkFDakIxRDtnQkFDRjtnQkFFQWUsUUFBUUMsR0FBRyxDQUFDLCtDQUErQztvQkFDekRtQyxTQUFTUixTQUFTN0IsRUFBRTtvQkFDcEJzQyxlQUFlO29CQUNmRjtnQkFDRjtZQUNGO1lBRUEsT0FBTztnQkFDTG5CLFNBQVM7Z0JBQ1Q0QixPQUFPaEI7WUFDVDtRQUVGLEtBQUs7WUFDSCxJQUFJLENBQUMvQyxTQUFTUyxXQUFXLENBQUN1RCxhQUFhLEVBQUU7Z0JBQ3ZDLE1BQU0sSUFBSXRELE1BQU07WUFDbEI7WUFFQSxNQUFNdUQsY0FBYyxNQUFNMUUsZ0RBQUVBLENBQUMyRSxLQUFLLENBQUMxRSxNQUFNLENBQUMyRSxTQUFTLENBQUM7Z0JBQ2xEQyxPQUFPMUUsK0NBQUVBLENBQUNGLG9EQUFNQSxDQUFDMEIsRUFBRSxFQUFFbEIsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYTtZQUN6RDtZQUVBLElBQUksQ0FBQ0MsYUFBYTtnQkFDaEIsTUFBTSxJQUFJdkQsTUFBTTtZQUNsQjtZQUVBLDZDQUE2QztZQUM3QyxJQUFJMkQsc0JBQTZCLEVBQUU7WUFDbkMsSUFBSXJFLFNBQVNTLFdBQVcsRUFBRUksb0JBQW9CQyxVQUFVZCxTQUFTUyxXQUFXLENBQUNJLGtCQUFrQixDQUFDQyxNQUFNLEdBQUcsR0FBRztnQkFDMUcsdURBQXVEO2dCQUN2RHVELHNCQUFzQmxFLFdBQVdZLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFDdENoQixTQUFTUyxXQUFXLENBQUVJLGtCQUFrQixDQUFFSSxRQUFRLENBQUNELEVBQUVFLEVBQUU7Z0JBR3pEQyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxzQkFBc0IsRUFBRWlELG9CQUFvQnZELE1BQU0sQ0FBQywwQkFBMEIsQ0FBQztZQUM3RjtZQUVBSCxZQUFZO2dCQUNWVSxZQUFZckIsU0FBU1MsV0FBVyxDQUFDWSxVQUFVO2dCQUMzQ3BCO2dCQUNBQztnQkFDQXFELFNBQVN2RCxTQUFTUyxXQUFXLENBQUN1RCxhQUFhO2dCQUMzQ3JDLFNBQVNzQyxZQUFZdEMsT0FBTztnQkFDNUIyQyxpQkFBaUJMLFlBQVlwQixRQUFRO2dCQUNyQyxrQ0FBa0M7Z0JBQ2xDakMsaUJBQWlCeUQsb0JBQW9CdkQsTUFBTSxHQUFHLElBQUl1RCxvQkFBb0J2QyxHQUFHLENBQUNkLENBQUFBLElBQU07d0JBQzlFRSxJQUFJRixFQUFFRSxFQUFFO3dCQUNSYSxNQUFNZixFQUFFZSxJQUFJO3dCQUNaSixTQUFTWCxFQUFFVyxPQUFPO29CQUNwQixNQUFNRTtnQkFDTkwsV0FBV3hCLFNBQVNTLFdBQVcsQ0FBQ2UsU0FBUztnQkFDekNDLGdCQUFnQnpCLFNBQVNTLFdBQVcsQ0FBQ2dCLGNBQWM7Z0JBQ25EOEMsY0FBY3ZFLFNBQVNTLFdBQVcsQ0FBQzhELFlBQVk7Z0JBQy9DLDJDQUEyQztnQkFDM0N2QyxZQUFZaEMsU0FBU1MsV0FBVyxDQUFDdUIsVUFBVTtZQUM3QztZQUVBLE1BQU13QyxhQUFhLE1BQU01RSxzREFBUUEsQ0FBQ3NDLEdBQUcsQ0FBQ3ZCO1lBQ3RDUSxRQUFRQyxHQUFHLENBQUMsd0NBQXdDO2dCQUNsRGUsU0FBU3FDLFdBQVdyQyxPQUFPO2dCQUMzQkMsU0FBUyxDQUFDLENBQUNvQyxXQUFXbkMsSUFBSTtnQkFDMUJDLFVBQVVrQyxXQUFXbkMsSUFBSSxHQUFHRSxPQUFPQyxJQUFJLENBQUNnQyxXQUFXbkMsSUFBSSxJQUFJLEVBQUU7Z0JBQzdESyxPQUFPOEIsV0FBVzlCLEtBQUs7WUFDekI7WUFFQSxJQUFJLENBQUM4QixXQUFXckMsT0FBTyxJQUFJLENBQUNxQyxXQUFXbkMsSUFBSSxJQUFJLENBQUNtQyxXQUFXbkMsSUFBSSxDQUFDVixPQUFPLEVBQUU7Z0JBQ3ZFLE1BQU04QyxlQUFlLE9BQU9ELFdBQVc5QixLQUFLLEtBQUssV0FDN0M4QixXQUFXOUIsS0FBSyxHQUNoQjhCLFdBQVc5QixLQUFLLEVBQUVDLFdBQVc7Z0JBQ2pDLE1BQU0sSUFBSWpDLE1BQU0rRDtZQUNsQjtZQUVBLHFFQUFxRTtZQUNyRSxJQUFJQyxvQkFBb0JGLFdBQVduQyxJQUFJLENBQUNRLFFBQVE7WUFFaEQsa0JBQWtCO1lBQ2xCMUIsUUFBUUMsR0FBRyxDQUFDLDJDQUEyQztnQkFDckRtQyxTQUFTdkQsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYTtnQkFDM0NXLGFBQWFILFdBQVduQyxJQUFJLENBQUNWLE9BQU8sS0FBS3NDLFlBQVl0QyxPQUFPO2dCQUM1RGlELGlCQUFpQkYscUJBQXFCQSxzQkFBc0JULFlBQVlwQixRQUFRO1lBQ2xGO1lBRUEsTUFBTSxDQUFDZ0MsYUFBYSxHQUFHLE1BQU10RixnREFBRUEsQ0FBQ3VGLE1BQU0sQ0FBQ3RGLG9EQUFNQSxFQUMxQ3VGLEdBQUcsQ0FBQztnQkFDSHBELFNBQVM2QyxXQUFXbkMsSUFBSSxDQUFDVixPQUFPO2dCQUNoQ2tCLFVBQVU2QixxQkFBcUJULFlBQVlwQixRQUFRO2dCQUNuREssT0FBT3NCLFdBQVduQyxJQUFJLENBQUNhLEtBQUssSUFBSWUsWUFBWWYsS0FBSztnQkFDakQ4QixXQUFXLElBQUkxRTtZQUNqQixHQUNDOEQsS0FBSyxDQUFDMUUsK0NBQUVBLENBQUNGLG9EQUFNQSxDQUFDMEIsRUFBRSxFQUFFbEIsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYSxHQUN0RFosU0FBUztZQUVaLElBQUksQ0FBQ3lCLGNBQWM7Z0JBQ2pCLE1BQU0sSUFBSW5FLE1BQU07WUFDbEI7WUFFQSw4Q0FBOEM7WUFDOUMsSUFBSU4sV0FBVztnQkFDYixNQUFNaUQsVUFBVS9DLEtBQUtDLEdBQUc7Z0JBQ3hCLE1BQU0rQyxtQkFBbUJELFVBQVVoRDtnQkFFbkMsZ0NBQWdDO2dCQUNoQyxNQUFNZCxnREFBRUEsQ0FBQ3lELE1BQU0sQ0FBQ3ZELDZEQUFlQSxFQUFFd0QsTUFBTSxDQUFDO29CQUN0Q00sU0FBU3ZELFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWE7b0JBQzNDL0Q7b0JBQ0F1RCxlQUFlO29CQUNmbkMsWUFBWXJCLFNBQVNTLFdBQVcsQ0FBQ1ksVUFBVTtvQkFDM0NvQyxnQkFBZ0J6RCxTQUFTMEQsU0FBUztvQkFDbEN1QixZQUFZaEIsWUFBWXRDLE9BQU87b0JBQy9CZ0MsV0FBV2EsV0FBV25DLElBQUksQ0FBQ1YsT0FBTztvQkFDbEMyQjtvQkFDQU0sV0FBVztvQkFDWEMsYUFBYTtvQkFDYkMsaUJBQWlCO29CQUNqQjFEO2dCQUNGO2dCQUVBZSxRQUFRQyxHQUFHLENBQUMsK0NBQStDO29CQUN6RG1DLFNBQVN2RCxTQUFTUyxXQUFXLENBQUN1RCxhQUFhO29CQUMzQ1IsZUFBZTtvQkFDZkY7Z0JBQ0Y7WUFDRjtZQUVBLE9BQU87Z0JBQ0xuQixTQUFTO2dCQUNUNEIsT0FBT2M7WUFDVDtRQUVGLEtBQUs7WUFDSCxJQUFJLENBQUM3RSxTQUFTUyxXQUFXLENBQUN1RCxhQUFhLEVBQUU7Z0JBQ3ZDLE1BQU0sSUFBSXRELE1BQU07WUFDbEI7WUFFQSxNQUFNd0UsY0FBYyxNQUFNM0YsZ0RBQUVBLENBQUMyRSxLQUFLLENBQUMxRSxNQUFNLENBQUMyRSxTQUFTLENBQUM7Z0JBQ2xEQyxPQUFPMUUsK0NBQUVBLENBQUNGLG9EQUFNQSxDQUFDMEIsRUFBRSxFQUFFbEIsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYTtZQUN6RDtZQUVBLElBQUksQ0FBQ2tCLGFBQWE7Z0JBQ2hCLE1BQU0sSUFBSXhFLE1BQU07WUFDbEI7WUFFQUMsWUFBWTtnQkFDVlUsWUFBWXJCLFNBQVNTLFdBQVcsQ0FBQ1ksVUFBVTtnQkFDM0NwQjtnQkFDQUM7Z0JBQ0FxRCxTQUFTdkQsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYTtnQkFDM0NNLGlCQUFpQlksWUFBWXJDLFFBQVE7Z0JBQ3JDc0MsYUFBYW5GLFNBQVNTLFdBQVcsQ0FBQzJFLGNBQWM7WUFDbEQ7WUFFQSxNQUFNQyxhQUFhLE1BQU12RixzREFBUUEsQ0FBQ29DLEdBQUcsQ0FBQ3ZCO1lBQ3RDUSxRQUFRQyxHQUFHLENBQUMsd0NBQXdDO2dCQUNsRGUsU0FBU2tELFdBQVdsRCxPQUFPO2dCQUMzQkMsU0FBUyxDQUFDLENBQUNpRCxXQUFXaEQsSUFBSTtnQkFDMUI4QyxhQUFhRSxXQUFXaEQsSUFBSSxFQUFFUTtnQkFDOUJ5QyxlQUFlRCxXQUFXaEQsSUFBSSxFQUFFaUQ7WUFDbEM7WUFFQSxJQUFJLENBQUNELFdBQVdsRCxPQUFPLElBQUksQ0FBQ2tELFdBQVdoRCxJQUFJLElBQUksQ0FBQ2dELFdBQVdoRCxJQUFJLENBQUNRLFFBQVEsRUFBRTtnQkFDeEUsTUFBTSxJQUFJbkMsTUFBTTJFLFdBQVczQyxLQUFLLEVBQUVDLFdBQVc7WUFDL0M7WUFFQSx1Q0FBdUM7WUFDdkN4QixRQUFRQyxHQUFHLENBQUMsb0RBQW9EO2dCQUM5RG1DLFNBQVN2RCxTQUFTUyxXQUFXLENBQUN1RCxhQUFhO2dCQUMzQ3VCLGFBQWFMLFlBQVlyQyxRQUFRO2dCQUNqQ3NDLGFBQWFFLFdBQVdoRCxJQUFJLENBQUNRLFFBQVE7WUFDdkM7WUFFQSxNQUFNLENBQUMyQyxhQUFhLEdBQUcsTUFBTWpHLGdEQUFFQSxDQUFDdUYsTUFBTSxDQUFDdEYsb0RBQU1BLEVBQzFDdUYsR0FBRyxDQUFDO2dCQUNIbEMsVUFBVXdDLFdBQVdoRCxJQUFJLENBQUNRLFFBQVE7Z0JBQ2xDbUMsV0FBVyxJQUFJMUU7WUFDakIsR0FDQzhELEtBQUssQ0FBQzFFLCtDQUFFQSxDQUFDRixvREFBTUEsQ0FBQzBCLEVBQUUsRUFBRWxCLFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWEsR0FDdERaLFNBQVM7WUFFWixJQUFJLENBQUNvQyxjQUFjO2dCQUNqQixNQUFNLElBQUk5RSxNQUFNO1lBQ2xCO1lBRUEsOENBQThDO1lBQzlDLElBQUlOLFdBQVc7Z0JBQ2IsTUFBTWlELFVBQVUvQyxLQUFLQyxHQUFHO2dCQUN4QixNQUFNK0MsbUJBQW1CRCxVQUFVaEQ7Z0JBRW5DLHlDQUF5QztnQkFDekMsTUFBTWQsZ0RBQUVBLENBQUN5RCxNQUFNLENBQUN2RCw2REFBZUEsRUFBRXdELE1BQU0sQ0FBQztvQkFDdENNLFNBQVN2RCxTQUFTUyxXQUFXLENBQUN1RCxhQUFhO29CQUMzQy9EO29CQUNBdUQsZUFBZTtvQkFDZm5DLFlBQVlyQixTQUFTUyxXQUFXLENBQUNZLFVBQVU7b0JBQzNDb0MsZ0JBQWdCekQsU0FBUzBELFNBQVM7b0JBQ2xDdUIsWUFBWUMsWUFBWXZELE9BQU87b0JBQy9CZ0MsV0FBV3VCLFlBQVl2RCxPQUFPO29CQUM5QjJCO29CQUNBTSxXQUFXO29CQUNYQyxhQUFhO29CQUNiQyxpQkFBaUI7b0JBQ2pCMUQ7Z0JBQ0Y7Z0JBRUFlLFFBQVFDLEdBQUcsQ0FBQyx3REFBd0Q7b0JBQ2xFbUMsU0FBU3ZELFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWE7b0JBQzNDUixlQUFlO29CQUNmK0IsYUFBYUwsWUFBWXJDLFFBQVE7b0JBQ2pDc0MsYUFBYUUsV0FBV2hELElBQUksQ0FBQ1EsUUFBUTtvQkFDckNTO2dCQUNGO1lBQ0Y7WUFFQSxPQUFPO2dCQUNMbkIsU0FBUztnQkFDVDRCLE9BQU95QjtZQUNUO1FBRUYsS0FBSztZQUNILElBQUksQ0FBQ3hGLFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWEsRUFBRTtnQkFDdkMsTUFBTSxJQUFJdEQsTUFBTTtZQUNsQjtZQUVBQyxZQUFZO2dCQUNWVSxZQUFZckIsU0FBU1MsV0FBVyxDQUFDWSxVQUFVO2dCQUMzQ3BCO2dCQUNBc0QsU0FBU3ZELFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWE7WUFDN0M7WUFFQSxtREFBbUQ7WUFDbkQsTUFBTXlCLGdCQUFnQixNQUFNbEcsZ0RBQUVBLENBQUMyRSxLQUFLLENBQUMxRSxNQUFNLENBQUMyRSxTQUFTLENBQUM7Z0JBQ3BEQyxPQUFPMUUsK0NBQUVBLENBQUNGLG9EQUFNQSxDQUFDMEIsRUFBRSxFQUFFbEIsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYTtZQUN6RDtZQUVBLElBQUksQ0FBQ3lCLGVBQWU7Z0JBQ2xCLE1BQU0sSUFBSS9FLE1BQU07WUFDbEI7WUFFQSxNQUFNZ0YsZUFBZSxNQUFNN0YsNERBQVVBLENBQUNxQyxHQUFHLENBQUN2QjtZQUMxQyxJQUFJLENBQUMrRSxhQUFhdkQsT0FBTyxFQUFFO2dCQUN6QixNQUFNLElBQUl6QixNQUFNZ0YsYUFBYWhELEtBQUssRUFBRUMsV0FBVztZQUNqRDtZQUVBLHVCQUF1QjtZQUN2QixNQUFNcEQsZ0RBQUVBLENBQUNvRyxNQUFNLENBQUNuRyxvREFBTUEsRUFBRTRFLEtBQUssQ0FBQzFFLCtDQUFFQSxDQUFDRixvREFBTUEsQ0FBQzBCLEVBQUUsRUFBRWxCLFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWE7WUFFOUUsOENBQThDO1lBQzlDLElBQUk1RCxXQUFXO2dCQUNiLE1BQU1pRCxVQUFVL0MsS0FBS0MsR0FBRztnQkFDeEIsTUFBTStDLG1CQUFtQkQsVUFBVWhEO2dCQUVuQyxnQ0FBZ0M7Z0JBQ2hDLE1BQU1kLGdEQUFFQSxDQUFDeUQsTUFBTSxDQUFDdkQsNkRBQWVBLEVBQUV3RCxNQUFNLENBQUM7b0JBQ3RDTSxTQUFTdkQsU0FBU1MsV0FBVyxDQUFDdUQsYUFBYTtvQkFDM0MvRDtvQkFDQXVELGVBQWU7b0JBQ2ZuQyxZQUFZckIsU0FBU1MsV0FBVyxDQUFDWSxVQUFVO29CQUMzQ29DLGdCQUFnQnpELFNBQVMwRCxTQUFTO29CQUNsQ3VCLFlBQVlRLGNBQWM5RCxPQUFPO29CQUNqQzJCO29CQUNBTSxXQUFXO29CQUNYQyxhQUFhO29CQUNiQyxpQkFBaUI7b0JBQ2pCMUQ7Z0JBQ0Y7Z0JBRUFlLFFBQVFDLEdBQUcsQ0FBQywrQ0FBK0M7b0JBQ3pEbUMsU0FBU3ZELFNBQVNTLFdBQVcsQ0FBQ3VELGFBQWE7b0JBQzNDUixlQUFlO29CQUNmRjtnQkFDRjtZQUNGO1lBRUEsT0FBTztnQkFDTG5CLFNBQVM7Z0JBQ1Q0QixPQUFPMEI7WUFDVDtRQUVGO1lBQ0UsTUFBTSxJQUFJL0UsTUFBTSxDQUFDLGNBQWMsRUFBRVYsU0FBU1EsUUFBUSxFQUFFO0lBQ3hEO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvZ2VuZXJhdGlvbi9oZWxwZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRiIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IHNjZW5lcywgc2NlbmVJdGVyYXRpb25zIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IGVxIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBhZGRUb29sIH0gZnJvbSBcIn4vdG9vbHMvYWRkL2FkZFwiO1xuaW1wb3J0IHsgZWRpdFRvb2wgfSBmcm9tIFwifi90b29scy9lZGl0L2VkaXRcIjtcbmltcG9ydCB7IGRlbGV0ZVRvb2wgfSBmcm9tIFwifi90b29scy9kZWxldGUvZGVsZXRlXCI7XG5pbXBvcnQgeyB0cmltVG9vbCB9IGZyb20gXCJ+L3Rvb2xzL3RyaW0vdHJpbVwiO1xuaW1wb3J0IHR5cGUgeyBCcmFpbkRlY2lzaW9uIH0gZnJvbSBcIn4vbGliL3R5cGVzL2FpL2JyYWluLnR5cGVzXCI7XG5pbXBvcnQgdHlwZSB7IEFkZFRvb2xJbnB1dCwgRWRpdFRvb2xJbnB1dCwgRGVsZXRlVG9vbElucHV0LCBUcmltVG9vbElucHV0IH0gZnJvbSBcIn4vdG9vbHMvaGVscGVycy90eXBlc1wiO1xuaW1wb3J0IHR5cGUgeyBTY2VuZUVudGl0eSB9IGZyb20gXCJ+L2dlbmVyYXRlZC9lbnRpdGllc1wiO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gZm9yIHRvb2wgZXhlY3V0aW9uIGFuZCBkYXRhYmFzZSBzYXZlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVRvb2xGcm9tRGVjaXNpb24oXG4gIGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uLFxuICBwcm9qZWN0SWQ6IHN0cmluZyxcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHN0b3J5Ym9hcmQ6IGFueVtdLFxuICBtZXNzYWdlSWQ/OiBzdHJpbmdcbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBzY2VuZT86IFNjZW5lRW50aXR5IH0+IHtcbiAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsgLy8gVHJhY2sgZ2VuZXJhdGlvbiB0aW1lXG4gIFxuICBpZiAoIWRlY2lzaW9uLnRvb2xOYW1lIHx8ICFkZWNpc2lvbi50b29sQ29udGV4dCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZGVjaXNpb24gLSBtaXNzaW5nIHRvb2wgbmFtZSBvciBjb250ZXh0XCIpO1xuICB9XG5cbiAgbGV0IHRvb2xJbnB1dDogQWRkVG9vbElucHV0IHwgRWRpdFRvb2xJbnB1dCB8IERlbGV0ZVRvb2xJbnB1dCB8IFRyaW1Ub29sSW5wdXQ7XG5cbiAgLy8gUHJlcGFyZSB0b29sIGlucHV0IGJhc2VkIG9uIHRvb2wgdHlwZVxuICBzd2l0Y2ggKGRlY2lzaW9uLnRvb2xOYW1lKSB7XG4gICAgY2FzZSAnYWRkU2NlbmUnOlxuICAgICAgLy8gR2V0IHJlZmVyZW5jZSBzY2VuZXMgaWYgc3BlY2lmaWVkIGJ5IEJyYWluIGZvciBjcm9zcy1zY2VuZSBzdHlsZSBtYXRjaGluZ1xuICAgICAgbGV0IHJlZmVyZW5jZVNjZW5lczogYW55W10gPSBbXTtcbiAgICAgIGlmIChkZWNpc2lvbi50b29sQ29udGV4dD8ucmVmZXJlbmNlZFNjZW5lSWRzPy5sZW5ndGggJiYgZGVjaXNpb24udG9vbENvbnRleHQucmVmZXJlbmNlZFNjZW5lSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gU2FmZXR5OiBPbmx5IGluY2x1ZGUgc2NlbmVzIHRoYXQgZXhpc3QgaW4gc3Rvcnlib2FyZFxuICAgICAgICByZWZlcmVuY2VTY2VuZXMgPSBzdG9yeWJvYXJkLmZpbHRlcihzID0+IFxuICAgICAgICAgIGRlY2lzaW9uLnRvb2xDb250ZXh0IS5yZWZlcmVuY2VkU2NlbmVJZHMhLmluY2x1ZGVzKHMuaWQpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhg8J+TnSBbUk9VVEVSXSBJbmNsdWRpbmcgJHtyZWZlcmVuY2VTY2VuZXMubGVuZ3RofSByZWZlcmVuY2Ugc2NlbmVzIGZvciBBREQgb3BlcmF0aW9uYCk7XG4gICAgICB9XG5cbiAgICAgIHRvb2xJbnB1dCA9IHtcbiAgICAgICAgdXNlclByb21wdDogZGVjaXNpb24udG9vbENvbnRleHQudXNlclByb21wdCxcbiAgICAgICAgcHJvamVjdElkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHNjZW5lTnVtYmVyOiBzdG9yeWJvYXJkLmxlbmd0aCArIDEsXG4gICAgICAgIHN0b3J5Ym9hcmRTb0Zhcjogc3Rvcnlib2FyZCxcbiAgICAgICAgaW1hZ2VVcmxzOiBkZWNpc2lvbi50b29sQ29udGV4dC5pbWFnZVVybHMsXG4gICAgICAgIHZpc2lvbkFuYWx5c2lzOiBkZWNpc2lvbi50b29sQ29udGV4dC52aXNpb25BbmFseXNpcyxcbiAgICAgICAgLy8gUGFzcyBwcmV2aW91cyBzY2VuZSBmb3Igc3R5bGUgY29udGludWl0eVxuICAgICAgICBwcmV2aW91c1NjZW5lQ29udGV4dDogc3Rvcnlib2FyZC5sZW5ndGggPiAwID8ge1xuICAgICAgICAgIHRzeENvZGU6IHN0b3J5Ym9hcmRbc3Rvcnlib2FyZC5sZW5ndGggLSAxXS50c3hDb2RlLFxuICAgICAgICAgIHN0eWxlOiB1bmRlZmluZWRcbiAgICAgICAgfSA6IHVuZGVmaW5lZCxcbiAgICAgICAgLy8gTkVXOiBQYXNzIHJlZmVyZW5jZSBzY2VuZXMgZm9yIGNyb3NzLXNjZW5lIHN0eWxlIG1hdGNoaW5nXG4gICAgICAgIHJlZmVyZW5jZVNjZW5lczogcmVmZXJlbmNlU2NlbmVzLmxlbmd0aCA+IDAgPyByZWZlcmVuY2VTY2VuZXMubWFwKHMgPT4gKHtcbiAgICAgICAgICBpZDogcy5pZCxcbiAgICAgICAgICBuYW1lOiBzLm5hbWUsXG4gICAgICAgICAgdHN4Q29kZTogcy50c3hDb2RlXG4gICAgICAgIH0pKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgLy8gTkVXOiBQYXNzIHdlYiBjb250ZXh0IGZvciBicmFuZC1tYXRjaGluZ1xuICAgICAgICB3ZWJDb250ZXh0OiBkZWNpc2lvbi50b29sQ29udGV4dC53ZWJDb250ZXh0LFxuICAgICAgfSBhcyBBZGRUb29sSW5wdXQ7XG4gICAgICBcbiAgICAgIGNvbnN0IGFkZFJlc3VsdCA9IGF3YWl0IGFkZFRvb2wucnVuKHRvb2xJbnB1dCk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TpSBbUk9VVEVSXSBSZWNlaXZlZCBmcm9tIEFERCB0b29sOicsIHtcbiAgICAgICAgc3VjY2VzczogYWRkUmVzdWx0LnN1Y2Nlc3MsXG4gICAgICAgIGhhc0RhdGE6ICEhYWRkUmVzdWx0LmRhdGEsXG4gICAgICAgIGRhdGFLZXlzOiBhZGRSZXN1bHQuZGF0YSA/IE9iamVjdC5rZXlzKGFkZFJlc3VsdC5kYXRhKSA6IFtdLFxuICAgICAgICBuYW1lOiBhZGRSZXN1bHQuZGF0YT8ubmFtZSxcbiAgICAgICAgY29kZUxlbmd0aDogYWRkUmVzdWx0LmRhdGE/LnRzeENvZGU/Lmxlbmd0aCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIWFkZFJlc3VsdC5zdWNjZXNzIHx8ICFhZGRSZXN1bHQuZGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYWRkUmVzdWx0LmVycm9yPy5tZXNzYWdlIHx8ICdBZGQgb3BlcmF0aW9uIGZhaWxlZCcpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBUcnVzdCB0aGUgZHVyYXRpb24gZnJvbSB0aGUgQUREIHRvb2wgLSBpdCBhbHJlYWR5IGFuYWx5emVzIHRoZSBjb2RlXG4gICAgICBsZXQgYWRkRmluYWxEdXJhdGlvbiA9IGFkZFJlc3VsdC5kYXRhLmR1cmF0aW9uIHx8IDE1MDtcbiAgICAgIFxuICAgICAgLy8gU2F2ZSB0byBkYXRhYmFzZVxuICAgICAgY29uc29sZS5sb2coJ/Cfkr4gW1JPVVRFUl0gU2F2aW5nIHRvIGRhdGFiYXNlOicsIHtcbiAgICAgICAgcHJvamVjdElkLFxuICAgICAgICBuYW1lOiBhZGRSZXN1bHQuZGF0YS5uYW1lLFxuICAgICAgICBvcmRlcjogc3Rvcnlib2FyZC5sZW5ndGgsXG4gICAgICAgIGR1cmF0aW9uOiBhZGRGaW5hbER1cmF0aW9uLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IFtuZXdTY2VuZV0gPSBhd2FpdCBkYi5pbnNlcnQoc2NlbmVzKS52YWx1ZXMoe1xuICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgIG5hbWU6IGFkZFJlc3VsdC5kYXRhLm5hbWUsXG4gICAgICAgIHRzeENvZGU6IGFkZFJlc3VsdC5kYXRhLnRzeENvZGUsXG4gICAgICAgIGR1cmF0aW9uOiBhZGRGaW5hbER1cmF0aW9uIHx8IDE1MCxcbiAgICAgICAgb3JkZXI6IHN0b3J5Ym9hcmQubGVuZ3RoLFxuICAgICAgICBwcm9wczogYWRkUmVzdWx0LmRhdGEucHJvcHMgfHwge30sXG4gICAgICAgIGxheW91dEpzb246IGFkZFJlc3VsdC5kYXRhLmxheW91dEpzb24gfHwgbnVsbCxcbiAgICAgIH0pLnJldHVybmluZygpO1xuICAgICAgXG4gICAgICBpZiAoIW5ld1NjZW5lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNhdmUgc2NlbmUgdG8gZGF0YWJhc2UnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KchSBbUk9VVEVSXSBTY2VuZSBzYXZlZCB0byBkYXRhYmFzZTonLCB7XG4gICAgICAgIGlkOiBuZXdTY2VuZS5pZCxcbiAgICAgICAgbmFtZTogbmV3U2NlbmUubmFtZSxcbiAgICAgICAgZHVyYXRpb246IG5ld1NjZW5lLmR1cmF0aW9uLFxuICAgICAgICBvcmRlcjogbmV3U2NlbmUub3JkZXIsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gVHJhY2sgdGhpcyBpdGVyYXRpb24gaWYgd2UgaGF2ZSBhIG1lc3NhZ2VJZFxuICAgICAgaWYgKG1lc3NhZ2VJZCkge1xuICAgICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvblRpbWVNcyA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgc2NlbmUgaXRlcmF0aW9uIHJlY29yZFxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NlbmVJdGVyYXRpb25zKS52YWx1ZXMoe1xuICAgICAgICAgIHNjZW5lSWQ6IG5ld1NjZW5lLmlkLFxuICAgICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgICBvcGVyYXRpb25UeXBlOiAnY3JlYXRlJyxcbiAgICAgICAgICB1c2VyUHJvbXB0OiBkZWNpc2lvbi50b29sQ29udGV4dC51c2VyUHJvbXB0LFxuICAgICAgICAgIGJyYWluUmVhc29uaW5nOiBkZWNpc2lvbi5yZWFzb25pbmcsXG4gICAgICAgICAgY29kZUFmdGVyOiBuZXdTY2VuZS50c3hDb2RlLFxuICAgICAgICAgIGdlbmVyYXRpb25UaW1lTXMsXG4gICAgICAgICAgbW9kZWxVc2VkOiBudWxsLCAvLyBTZXQgdG8gbnVsbCBmb3Igbm93XG4gICAgICAgICAgdGVtcGVyYXR1cmU6IG51bGwsXG4gICAgICAgICAgdXNlckVkaXRlZEFnYWluOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW1JPVVRFUl0gQ3JlYXRlZCBzY2VuZSBpdGVyYXRpb24gcmVjb3JkOicsIHtcbiAgICAgICAgICBzY2VuZUlkOiBuZXdTY2VuZS5pZCxcbiAgICAgICAgICBvcGVyYXRpb25UeXBlOiAnY3JlYXRlJyxcbiAgICAgICAgICBnZW5lcmF0aW9uVGltZU1zLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc2NlbmU6IG5ld1NjZW5lIGFzIGFueSAgLy8gQ2FzdCB0byBhbnkgdG8gYXZvaWQgcHJvcHMgdHlwZSBpc3N1ZVxuICAgICAgfTtcblxuICAgIGNhc2UgJ2VkaXRTY2VuZSc6XG4gICAgICBpZiAoIWRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdGFyZ2V0IHNjZW5lIElEIGZvciBlZGl0IG9wZXJhdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3Qgc2NlbmVUb0VkaXQgPSBhd2FpdCBkYi5xdWVyeS5zY2VuZXMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGVxKHNjZW5lcy5pZCwgZGVjaXNpb24udG9vbENvbnRleHQudGFyZ2V0U2NlbmVJZCksXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKCFzY2VuZVRvRWRpdCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTY2VuZSBub3QgZm91bmQgZm9yIGVkaXRpbmdcIik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEdldCByZWZlcmVuY2Ugc2NlbmVzIGlmIHNwZWNpZmllZCBieSBCcmFpblxuICAgICAgbGV0IGVkaXRSZWZlcmVuY2VTY2VuZXM6IGFueVtdID0gW107XG4gICAgICBpZiAoZGVjaXNpb24udG9vbENvbnRleHQ/LnJlZmVyZW5jZWRTY2VuZUlkcz8ubGVuZ3RoICYmIGRlY2lzaW9uLnRvb2xDb250ZXh0LnJlZmVyZW5jZWRTY2VuZUlkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFNhZmV0eTogT25seSBpbmNsdWRlIHNjZW5lcyB0aGF0IGV4aXN0IGluIHN0b3J5Ym9hcmRcbiAgICAgICAgZWRpdFJlZmVyZW5jZVNjZW5lcyA9IHN0b3J5Ym9hcmQuZmlsdGVyKHMgPT4gXG4gICAgICAgICAgZGVjaXNpb24udG9vbENvbnRleHQhLnJlZmVyZW5jZWRTY2VuZUlkcyEuaW5jbHVkZXMocy5pZClcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OdIFtST1VURVJdIEluY2x1ZGluZyAke2VkaXRSZWZlcmVuY2VTY2VuZXMubGVuZ3RofSByZWZlcmVuY2Ugc2NlbmVzIGZvciBlZGl0YCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRvb2xJbnB1dCA9IHtcbiAgICAgICAgdXNlclByb21wdDogZGVjaXNpb24udG9vbENvbnRleHQudXNlclByb21wdCxcbiAgICAgICAgcHJvamVjdElkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHNjZW5lSWQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQsXG4gICAgICAgIHRzeENvZGU6IHNjZW5lVG9FZGl0LnRzeENvZGUsIC8vIOKckyBGaXhlZDogVXNpbmcgY29ycmVjdCBmaWVsZCBuYW1lXG4gICAgICAgIGN1cnJlbnREdXJhdGlvbjogc2NlbmVUb0VkaXQuZHVyYXRpb24sXG4gICAgICAgIC8vIEluY2x1ZGUgcmVmZXJlbmNlIHNjZW5lcyBpZiBhbnlcbiAgICAgICAgcmVmZXJlbmNlU2NlbmVzOiBlZGl0UmVmZXJlbmNlU2NlbmVzLmxlbmd0aCA+IDAgPyBlZGl0UmVmZXJlbmNlU2NlbmVzLm1hcChzID0+ICh7XG4gICAgICAgICAgaWQ6IHMuaWQsXG4gICAgICAgICAgbmFtZTogcy5uYW1lLFxuICAgICAgICAgIHRzeENvZGU6IHMudHN4Q29kZVxuICAgICAgICB9KSkgOiB1bmRlZmluZWQsXG4gICAgICAgIGltYWdlVXJsczogZGVjaXNpb24udG9vbENvbnRleHQuaW1hZ2VVcmxzLFxuICAgICAgICB2aXNpb25BbmFseXNpczogZGVjaXNpb24udG9vbENvbnRleHQudmlzaW9uQW5hbHlzaXMsXG4gICAgICAgIGVycm9yRGV0YWlsczogZGVjaXNpb24udG9vbENvbnRleHQuZXJyb3JEZXRhaWxzLFxuICAgICAgICAvLyBORVc6IFBhc3Mgd2ViIGNvbnRleHQgZm9yIGJyYW5kLW1hdGNoaW5nXG4gICAgICAgIHdlYkNvbnRleHQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LndlYkNvbnRleHQsXG4gICAgICB9IGFzIEVkaXRUb29sSW5wdXQ7XG4gICAgICBcbiAgICAgIGNvbnN0IGVkaXRSZXN1bHQgPSBhd2FpdCBlZGl0VG9vbC5ydW4odG9vbElucHV0IGFzIEVkaXRUb29sSW5wdXQpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk6UgW1JPVVRFUl0gUmVjZWl2ZWQgZnJvbSBFRElUIHRvb2w6Jywge1xuICAgICAgICBzdWNjZXNzOiBlZGl0UmVzdWx0LnN1Y2Nlc3MsXG4gICAgICAgIGhhc0RhdGE6ICEhZWRpdFJlc3VsdC5kYXRhLFxuICAgICAgICBkYXRhS2V5czogZWRpdFJlc3VsdC5kYXRhID8gT2JqZWN0LmtleXMoZWRpdFJlc3VsdC5kYXRhKSA6IFtdLFxuICAgICAgICBlcnJvcjogZWRpdFJlc3VsdC5lcnJvcixcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIWVkaXRSZXN1bHQuc3VjY2VzcyB8fCAhZWRpdFJlc3VsdC5kYXRhIHx8ICFlZGl0UmVzdWx0LmRhdGEudHN4Q29kZSkge1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0eXBlb2YgZWRpdFJlc3VsdC5lcnJvciA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgPyBlZGl0UmVzdWx0LmVycm9yIFxuICAgICAgICAgIDogZWRpdFJlc3VsdC5lcnJvcj8ubWVzc2FnZSB8fCAnRWRpdCBvcGVyYXRpb24gZmFpbGVkIC0gbm8gY29kZSByZXR1cm5lZCc7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBVc2UgZHVyYXRpb24gZnJvbSBlZGl0IHJlc3VsdCBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIGtlZXAgZXhpc3RpbmdcbiAgICAgIGxldCBlZGl0RmluYWxEdXJhdGlvbiA9IGVkaXRSZXN1bHQuZGF0YS5kdXJhdGlvbjtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIGRhdGFiYXNlXG4gICAgICBjb25zb2xlLmxvZygn8J+SviBbUk9VVEVSXSBVcGRhdGluZyBzY2VuZSBpbiBkYXRhYmFzZTonLCB7XG4gICAgICAgIHNjZW5lSWQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQsXG4gICAgICAgIGNvZGVDaGFuZ2VkOiBlZGl0UmVzdWx0LmRhdGEudHN4Q29kZSAhPT0gc2NlbmVUb0VkaXQudHN4Q29kZSxcbiAgICAgICAgZHVyYXRpb25DaGFuZ2VkOiBlZGl0RmluYWxEdXJhdGlvbiAmJiBlZGl0RmluYWxEdXJhdGlvbiAhPT0gc2NlbmVUb0VkaXQuZHVyYXRpb24sXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgW3VwZGF0ZWRTY2VuZV0gPSBhd2FpdCBkYi51cGRhdGUoc2NlbmVzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICB0c3hDb2RlOiBlZGl0UmVzdWx0LmRhdGEudHN4Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbjogZWRpdEZpbmFsRHVyYXRpb24gfHwgc2NlbmVUb0VkaXQuZHVyYXRpb24sXG4gICAgICAgICAgcHJvcHM6IGVkaXRSZXN1bHQuZGF0YS5wcm9wcyB8fCBzY2VuZVRvRWRpdC5wcm9wcyxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShzY2VuZXMuaWQsIGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICBcbiAgICAgIGlmICghdXBkYXRlZFNjZW5lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBzY2VuZSBpbiBkYXRhYmFzZScpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBUcmFjayB0aGlzIGl0ZXJhdGlvbiBpZiB3ZSBoYXZlIGEgbWVzc2FnZUlkXG4gICAgICBpZiAobWVzc2FnZUlkKSB7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCBnZW5lcmF0aW9uVGltZU1zID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBzY2VuZSBpdGVyYXRpb24gcmVjb3JkXG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY2VuZUl0ZXJhdGlvbnMpLnZhbHVlcyh7XG4gICAgICAgICAgc2NlbmVJZDogZGVjaXNpb24udG9vbENvbnRleHQudGFyZ2V0U2NlbmVJZCxcbiAgICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ2VkaXQnLFxuICAgICAgICAgIHVzZXJQcm9tcHQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnVzZXJQcm9tcHQsXG4gICAgICAgICAgYnJhaW5SZWFzb25pbmc6IGRlY2lzaW9uLnJlYXNvbmluZyxcbiAgICAgICAgICBjb2RlQmVmb3JlOiBzY2VuZVRvRWRpdC50c3hDb2RlLFxuICAgICAgICAgIGNvZGVBZnRlcjogZWRpdFJlc3VsdC5kYXRhLnRzeENvZGUsXG4gICAgICAgICAgZ2VuZXJhdGlvblRpbWVNcyxcbiAgICAgICAgICBtb2RlbFVzZWQ6IG51bGwsIC8vIFNldCB0byBudWxsIGZvciBub3dcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogbnVsbCxcbiAgICAgICAgICB1c2VyRWRpdGVkQWdhaW46IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygn8J+TiiBbUk9VVEVSXSBDcmVhdGVkIHNjZW5lIGl0ZXJhdGlvbiByZWNvcmQ6Jywge1xuICAgICAgICAgIHNjZW5lSWQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQsXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ2VkaXQnLFxuICAgICAgICAgIGdlbmVyYXRpb25UaW1lTXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzY2VuZTogdXBkYXRlZFNjZW5lIGFzIGFueSAgLy8gQ2FzdCB0byBhbnkgdG8gYXZvaWQgcHJvcHMgdHlwZSBpc3N1ZVxuICAgICAgfTtcblxuICAgIGNhc2UgJ3RyaW1TY2VuZSc6XG4gICAgICBpZiAoIWRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdGFyZ2V0IHNjZW5lIElEIGZvciB0cmltIG9wZXJhdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3Qgc2NlbmVUb1RyaW0gPSBhd2FpdCBkYi5xdWVyeS5zY2VuZXMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGVxKHNjZW5lcy5pZCwgZGVjaXNpb24udG9vbENvbnRleHQudGFyZ2V0U2NlbmVJZCksXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKCFzY2VuZVRvVHJpbSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTY2VuZSBub3QgZm91bmQgZm9yIHRyaW1taW5nXCIpO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0b29sSW5wdXQgPSB7XG4gICAgICAgIHVzZXJQcm9tcHQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnVzZXJQcm9tcHQsXG4gICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBzY2VuZUlkOiBkZWNpc2lvbi50b29sQ29udGV4dC50YXJnZXRTY2VuZUlkLFxuICAgICAgICBjdXJyZW50RHVyYXRpb246IHNjZW5lVG9UcmltLmR1cmF0aW9uLFxuICAgICAgICBuZXdEdXJhdGlvbjogZGVjaXNpb24udG9vbENvbnRleHQudGFyZ2V0RHVyYXRpb24sIC8vIFVzZSBicmFpbi1jYWxjdWxhdGVkIGR1cmF0aW9uXG4gICAgICB9IGFzIFRyaW1Ub29sSW5wdXQ7XG4gICAgICBcbiAgICAgIGNvbnN0IHRyaW1SZXN1bHQgPSBhd2FpdCB0cmltVG9vbC5ydW4odG9vbElucHV0IGFzIFRyaW1Ub29sSW5wdXQpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk6UgW1JPVVRFUl0gUmVjZWl2ZWQgZnJvbSBUUklNIHRvb2w6Jywge1xuICAgICAgICBzdWNjZXNzOiB0cmltUmVzdWx0LnN1Y2Nlc3MsXG4gICAgICAgIGhhc0RhdGE6ICEhdHJpbVJlc3VsdC5kYXRhLFxuICAgICAgICBuZXdEdXJhdGlvbjogdHJpbVJlc3VsdC5kYXRhPy5kdXJhdGlvbixcbiAgICAgICAgdHJpbW1lZEZyYW1lczogdHJpbVJlc3VsdC5kYXRhPy50cmltbWVkRnJhbWVzLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghdHJpbVJlc3VsdC5zdWNjZXNzIHx8ICF0cmltUmVzdWx0LmRhdGEgfHwgIXRyaW1SZXN1bHQuZGF0YS5kdXJhdGlvbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IodHJpbVJlc3VsdC5lcnJvcj8ubWVzc2FnZSB8fCAnVHJpbSBvcGVyYXRpb24gZmFpbGVkJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBvbmx5IHRoZSBkdXJhdGlvbiBpbiBkYXRhYmFzZVxuICAgICAgY29uc29sZS5sb2coJ/Cfkr4gW1JPVVRFUl0gVXBkYXRpbmcgc2NlbmUgZHVyYXRpb24gaW4gZGF0YWJhc2U6Jywge1xuICAgICAgICBzY2VuZUlkOiBkZWNpc2lvbi50b29sQ29udGV4dC50YXJnZXRTY2VuZUlkLFxuICAgICAgICBvbGREdXJhdGlvbjogc2NlbmVUb1RyaW0uZHVyYXRpb24sXG4gICAgICAgIG5ld0R1cmF0aW9uOiB0cmltUmVzdWx0LmRhdGEuZHVyYXRpb24sXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgW3RyaW1tZWRTY2VuZV0gPSBhd2FpdCBkYi51cGRhdGUoc2NlbmVzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBkdXJhdGlvbjogdHJpbVJlc3VsdC5kYXRhLmR1cmF0aW9uLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjZW5lcy5pZCwgZGVjaXNpb24udG9vbENvbnRleHQudGFyZ2V0U2NlbmVJZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgIFxuICAgICAgaWYgKCF0cmltbWVkU2NlbmUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIHNjZW5lIGR1cmF0aW9uIGluIGRhdGFiYXNlJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFRyYWNrIHRoaXMgaXRlcmF0aW9uIGlmIHdlIGhhdmUgYSBtZXNzYWdlSWRcbiAgICAgIGlmIChtZXNzYWdlSWQpIHtcbiAgICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IGdlbmVyYXRpb25UaW1lTXMgPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIHNjZW5lIGl0ZXJhdGlvbiByZWNvcmQgZm9yIHRyaW1cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjZW5lSXRlcmF0aW9ucykudmFsdWVzKHtcbiAgICAgICAgICBzY2VuZUlkOiBkZWNpc2lvbi50b29sQ29udGV4dC50YXJnZXRTY2VuZUlkLFxuICAgICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgICBvcGVyYXRpb25UeXBlOiAnZWRpdCcsIC8vIFRyaW0gaXMgYSB0eXBlIG9mIGVkaXRcbiAgICAgICAgICB1c2VyUHJvbXB0OiBkZWNpc2lvbi50b29sQ29udGV4dC51c2VyUHJvbXB0LFxuICAgICAgICAgIGJyYWluUmVhc29uaW5nOiBkZWNpc2lvbi5yZWFzb25pbmcsXG4gICAgICAgICAgY29kZUJlZm9yZTogc2NlbmVUb1RyaW0udHN4Q29kZSxcbiAgICAgICAgICBjb2RlQWZ0ZXI6IHNjZW5lVG9UcmltLnRzeENvZGUsIC8vIENvZGUgZG9lc24ndCBjaGFuZ2UsIG9ubHkgZHVyYXRpb25cbiAgICAgICAgICBnZW5lcmF0aW9uVGltZU1zLFxuICAgICAgICAgIG1vZGVsVXNlZDogbnVsbCxcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogbnVsbCxcbiAgICAgICAgICB1c2VyRWRpdGVkQWdhaW46IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygn8J+TiiBbUk9VVEVSXSBDcmVhdGVkIHNjZW5lIGl0ZXJhdGlvbiByZWNvcmQgZm9yIHRyaW06Jywge1xuICAgICAgICAgIHNjZW5lSWQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQsXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ3RyaW0nLFxuICAgICAgICAgIG9sZER1cmF0aW9uOiBzY2VuZVRvVHJpbS5kdXJhdGlvbixcbiAgICAgICAgICBuZXdEdXJhdGlvbjogdHJpbVJlc3VsdC5kYXRhLmR1cmF0aW9uLFxuICAgICAgICAgIGdlbmVyYXRpb25UaW1lTXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzY2VuZTogdHJpbW1lZFNjZW5lIGFzIGFueVxuICAgICAgfTtcblxuICAgIGNhc2UgJ2RlbGV0ZVNjZW5lJzpcbiAgICAgIGlmICghZGVjaXNpb24udG9vbENvbnRleHQudGFyZ2V0U2NlbmVJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB0YXJnZXQgc2NlbmUgSUQgZm9yIGRlbGV0ZSBvcGVyYXRpb25cIik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRvb2xJbnB1dCA9IHtcbiAgICAgICAgdXNlclByb21wdDogZGVjaXNpb24udG9vbENvbnRleHQudXNlclByb21wdCxcbiAgICAgICAgcHJvamVjdElkLFxuICAgICAgICBzY2VuZUlkOiBkZWNpc2lvbi50b29sQ29udGV4dC50YXJnZXRTY2VuZUlkLFxuICAgICAgfSBhcyBEZWxldGVUb29sSW5wdXQ7XG4gICAgICBcbiAgICAgIC8vIEZvciBkZWxldGUsIGdldCB0aGUgc2NlbmUgZmlyc3QgZm9yIHRoZSByZXNwb25zZVxuICAgICAgY29uc3Qgc2NlbmVUb0RlbGV0ZSA9IGF3YWl0IGRiLnF1ZXJ5LnNjZW5lcy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogZXEoc2NlbmVzLmlkLCBkZWNpc2lvbi50b29sQ29udGV4dC50YXJnZXRTY2VuZUlkKSxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIXNjZW5lVG9EZWxldGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2NlbmUgbm90IGZvdW5kIGZvciBkZWxldGlvblwiKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZGVsZXRlUmVzdWx0ID0gYXdhaXQgZGVsZXRlVG9vbC5ydW4odG9vbElucHV0IGFzIERlbGV0ZVRvb2xJbnB1dCk7XG4gICAgICBpZiAoIWRlbGV0ZVJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihkZWxldGVSZXN1bHQuZXJyb3I/Lm1lc3NhZ2UgfHwgJ0RlbGV0ZSBvcGVyYXRpb24gZmFpbGVkJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIERlbGV0ZSBmcm9tIGRhdGFiYXNlXG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NlbmVzKS53aGVyZShlcShzY2VuZXMuaWQsIGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQpKTtcbiAgICAgIFxuICAgICAgLy8gVHJhY2sgdGhpcyBpdGVyYXRpb24gaWYgd2UgaGF2ZSBhIG1lc3NhZ2VJZFxuICAgICAgaWYgKG1lc3NhZ2VJZCkge1xuICAgICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvblRpbWVNcyA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgc2NlbmUgaXRlcmF0aW9uIHJlY29yZFxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NlbmVJdGVyYXRpb25zKS52YWx1ZXMoe1xuICAgICAgICAgIHNjZW5lSWQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQsXG4gICAgICAgICAgcHJvamVjdElkLFxuICAgICAgICAgIG9wZXJhdGlvblR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgIHVzZXJQcm9tcHQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnVzZXJQcm9tcHQsXG4gICAgICAgICAgYnJhaW5SZWFzb25pbmc6IGRlY2lzaW9uLnJlYXNvbmluZyxcbiAgICAgICAgICBjb2RlQmVmb3JlOiBzY2VuZVRvRGVsZXRlLnRzeENvZGUsXG4gICAgICAgICAgZ2VuZXJhdGlvblRpbWVNcyxcbiAgICAgICAgICBtb2RlbFVzZWQ6IG51bGwsIC8vIFNldCB0byBudWxsIGZvciBub3dcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogbnVsbCxcbiAgICAgICAgICB1c2VyRWRpdGVkQWdhaW46IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygn8J+TiiBbUk9VVEVSXSBDcmVhdGVkIHNjZW5lIGl0ZXJhdGlvbiByZWNvcmQ6Jywge1xuICAgICAgICAgIHNjZW5lSWQ6IGRlY2lzaW9uLnRvb2xDb250ZXh0LnRhcmdldFNjZW5lSWQsXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ2RlbGV0ZScsXG4gICAgICAgICAgZ2VuZXJhdGlvblRpbWVNcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHNjZW5lOiBzY2VuZVRvRGVsZXRlIGFzIGFueSAvLyBDYXN0IHRvIGFueSB0byBhdm9pZCBwcm9wcyB0eXBlIGlzc3VlXG4gICAgICB9O1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biB0b29sOiAke2RlY2lzaW9uLnRvb2xOYW1lfWApO1xuICB9XG59Il0sIm5hbWVzIjpbImRiIiwic2NlbmVzIiwic2NlbmVJdGVyYXRpb25zIiwiZXEiLCJhZGRUb29sIiwiZWRpdFRvb2wiLCJkZWxldGVUb29sIiwidHJpbVRvb2wiLCJleGVjdXRlVG9vbEZyb21EZWNpc2lvbiIsImRlY2lzaW9uIiwicHJvamVjdElkIiwidXNlcklkIiwic3Rvcnlib2FyZCIsIm1lc3NhZ2VJZCIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJ0b29sTmFtZSIsInRvb2xDb250ZXh0IiwiRXJyb3IiLCJ0b29sSW5wdXQiLCJyZWZlcmVuY2VTY2VuZXMiLCJyZWZlcmVuY2VkU2NlbmVJZHMiLCJsZW5ndGgiLCJmaWx0ZXIiLCJzIiwiaW5jbHVkZXMiLCJpZCIsImNvbnNvbGUiLCJsb2ciLCJ1c2VyUHJvbXB0Iiwic2NlbmVOdW1iZXIiLCJzdG9yeWJvYXJkU29GYXIiLCJpbWFnZVVybHMiLCJ2aXNpb25BbmFseXNpcyIsInByZXZpb3VzU2NlbmVDb250ZXh0IiwidHN4Q29kZSIsInN0eWxlIiwidW5kZWZpbmVkIiwibWFwIiwibmFtZSIsIndlYkNvbnRleHQiLCJhZGRSZXN1bHQiLCJydW4iLCJzdWNjZXNzIiwiaGFzRGF0YSIsImRhdGEiLCJkYXRhS2V5cyIsIk9iamVjdCIsImtleXMiLCJjb2RlTGVuZ3RoIiwiZXJyb3IiLCJtZXNzYWdlIiwiYWRkRmluYWxEdXJhdGlvbiIsImR1cmF0aW9uIiwib3JkZXIiLCJuZXdTY2VuZSIsImluc2VydCIsInZhbHVlcyIsInByb3BzIiwibGF5b3V0SnNvbiIsInJldHVybmluZyIsImVuZFRpbWUiLCJnZW5lcmF0aW9uVGltZU1zIiwic2NlbmVJZCIsIm9wZXJhdGlvblR5cGUiLCJicmFpblJlYXNvbmluZyIsInJlYXNvbmluZyIsImNvZGVBZnRlciIsIm1vZGVsVXNlZCIsInRlbXBlcmF0dXJlIiwidXNlckVkaXRlZEFnYWluIiwic2NlbmUiLCJ0YXJnZXRTY2VuZUlkIiwic2NlbmVUb0VkaXQiLCJxdWVyeSIsImZpbmRGaXJzdCIsIndoZXJlIiwiZWRpdFJlZmVyZW5jZVNjZW5lcyIsImN1cnJlbnREdXJhdGlvbiIsImVycm9yRGV0YWlscyIsImVkaXRSZXN1bHQiLCJlcnJvck1lc3NhZ2UiLCJlZGl0RmluYWxEdXJhdGlvbiIsImNvZGVDaGFuZ2VkIiwiZHVyYXRpb25DaGFuZ2VkIiwidXBkYXRlZFNjZW5lIiwidXBkYXRlIiwic2V0IiwidXBkYXRlZEF0IiwiY29kZUJlZm9yZSIsInNjZW5lVG9UcmltIiwibmV3RHVyYXRpb24iLCJ0YXJnZXREdXJhdGlvbiIsInRyaW1SZXN1bHQiLCJ0cmltbWVkRnJhbWVzIiwib2xkRHVyYXRpb24iLCJ0cmltbWVkU2NlbmUiLCJzY2VuZVRvRGVsZXRlIiwiZGVsZXRlUmVzdWx0IiwiZGVsZXRlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/generation/helpers.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/generation/iteration-operations.ts":
/*!*******************************************************************!*\
  !*** ./src/server/api/routers/generation/iteration-operations.ts ***!
  \*******************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getBatchMessageIterations: () => (/* binding */ getBatchMessageIterations),\n/* harmony export */   getMessageIterations: () => (/* binding */ getMessageIterations),\n/* harmony export */   revertToIteration: () => (/* binding */ revertToIteration)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/server/services/data/message.service */ \"(rsc)/./src/server/services/data/message.service.ts\");\n/* harmony import */ var _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/lib/api/response-helpers */ \"(rsc)/./src/lib/api/response-helpers.ts\");\n/* harmony import */ var _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ~/lib/types/api/universal */ \"(rsc)/./src/lib/types/api/universal.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__, _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__, _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n/**\n * GET ITERATIONS BY MESSAGE - Query all scene iterations linked to a message\n */ const getMessageIterations = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_6__.z.object({\n    messageId: zod__WEBPACK_IMPORTED_MODULE_6__.z.string()\n})).query(async ({ input, ctx })=>{\n    const { messageId } = input;\n    // Get all iterations linked to this message\n    const iterations = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.sceneIterations.findMany({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.messageId, messageId),\n        orderBy: [\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt\n        ]\n    });\n    // For each iteration, get the current scene info\n    const iterationsWithScenes = await Promise.all(iterations.map(async (iteration)=>{\n        const scene = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, iteration.sceneId)\n        });\n        return {\n            ...iteration,\n            currentSceneName: scene?.name || 'Deleted Scene',\n            sceneExists: !!scene\n        };\n    }));\n    return iterationsWithScenes;\n});\n/**\n * GET BATCH MESSAGE ITERATIONS - Efficiently check multiple messages for iterations\n */ const getBatchMessageIterations = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_6__.z.object({\n    messageIds: zod__WEBPACK_IMPORTED_MODULE_6__.z.array(zod__WEBPACK_IMPORTED_MODULE_6__.z.string())\n})).query(async ({ input, ctx })=>{\n    const { messageIds } = input;\n    if (messageIds.length === 0) {\n        return {};\n    }\n    // Get all iterations for these messages in one query\n    const iterations = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.sceneIterations.findMany({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.inArray)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.messageId, messageIds),\n        orderBy: [\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.createdAt\n        ]\n    });\n    // Group by messageId for easy lookup\n    const iterationsByMessage = {};\n    for (const iteration of iterations){\n        if (iteration.messageId) {\n            if (!iterationsByMessage[iteration.messageId]) {\n                iterationsByMessage[iteration.messageId] = [];\n            }\n            iterationsByMessage[iteration.messageId].push(iteration);\n        }\n    }\n    return iterationsByMessage;\n});\n/**\n * REVERT TO ITERATION - Restore a scene to a previous version\n */ const revertToIteration = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_6__.z.object({\n    projectId: zod__WEBPACK_IMPORTED_MODULE_6__.z.string(),\n    iterationId: zod__WEBPACK_IMPORTED_MODULE_6__.z.string(),\n    messageId: zod__WEBPACK_IMPORTED_MODULE_6__.z.string()\n})).mutation(async ({ input, ctx })=>{\n    const response = new _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_4__.ResponseBuilder();\n    const { projectId, iterationId, messageId } = input;\n    const userId = ctx.session.user.id;\n    console.log(`[${response.getRequestId()}] Reverting to iteration`, {\n        iterationId,\n        messageId\n    });\n    try {\n        // 1. Verify project ownership\n        const project = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.projects.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId))\n        });\n        if (!project) {\n            return response.error(_lib_types_api_universal__WEBPACK_IMPORTED_MODULE_5__.ErrorCode.NOT_FOUND, \"Project not found or access denied\", 'scene.update', 'scene');\n        }\n        // 2. Get the iteration\n        const iteration = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.sceneIterations.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.id, iterationId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations.projectId, projectId))\n        });\n        if (!iteration) {\n            return response.error(_lib_types_api_universal__WEBPACK_IMPORTED_MODULE_5__.ErrorCode.NOT_FOUND, \"Iteration not found\", 'scene.update', 'scene');\n        }\n        // 3. Handle based on operation type\n        let revertedScene;\n        if (iteration.operationType === 'delete') {\n            // Restore deleted scene\n            if (!iteration.codeBefore) {\n                throw new Error(\"Cannot restore deleted scene - no code history\");\n            }\n            // Find the original order by looking at other scenes\n            const allScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, projectId),\n                orderBy: [\n                    _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.order\n                ]\n            });\n            // Insert at the end\n            const maxOrder = allScenes.length;\n            [revertedScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).values({\n                id: iteration.sceneId,\n                projectId,\n                name: `Restored Scene`,\n                tsxCode: iteration.codeBefore,\n                duration: 150,\n                order: maxOrder,\n                props: {}\n            }).returning();\n        } else if (iteration.operationType === 'create') {\n            // For create operations, use codeAfter (the created state)\n            const scene = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, iteration.sceneId)\n            });\n            if (!scene) {\n                throw new Error(\"Scene not found\");\n            }\n            [revertedScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).set({\n                tsxCode: iteration.codeAfter,\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, iteration.sceneId)).returning();\n        } else {\n            // For edit operations, revert to the state after this edit\n            const scene = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, iteration.sceneId)\n            });\n            if (!scene) {\n                throw new Error(\"Scene not found\");\n            }\n            const codeToRevertTo = iteration.codeAfter || iteration.codeBefore;\n            if (!codeToRevertTo) {\n                throw new Error(\"No code history available for this iteration\");\n            }\n            [revertedScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).set({\n                tsxCode: codeToRevertTo,\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, iteration.sceneId)).returning();\n        }\n        if (!revertedScene) {\n            throw new Error(\"Failed to revert scene\");\n        }\n        // 4. Create a new iteration to track the revert\n        await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.sceneIterations).values({\n            sceneId: iteration.sceneId,\n            projectId,\n            operationType: 'edit',\n            userPrompt: `Reverted to version from: \"${iteration.userPrompt}\"`,\n            codeBefore: iteration.operationType === 'delete' ? null : revertedScene.tsxCode,\n            codeAfter: iteration.codeAfter || iteration.codeBefore,\n            generationTimeMs: 0,\n            modelUsed: null,\n            userEditedAgain: false,\n            messageId: null\n        });\n        // 5. Create a message about the revert\n        await _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__.messageService.createMessage({\n            projectId,\n            content: `Reverted scene to version from: \"${iteration.userPrompt}\"`,\n            role: 'assistant',\n            kind: 'message'\n        });\n        return response.success(revertedScene, iteration.operationType === 'delete' ? 'scene.create' : 'scene.update', 'scene', [\n            revertedScene.id\n        ]);\n    } catch (error) {\n        console.error(`[${response.getRequestId()}] Revert error:`, error);\n        const errorCode = (0,_lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_4__.getErrorCode)(error);\n        const errorMessage = error instanceof Error ? error.message : 'Failed to revert';\n        return response.error(errorCode, errorMessage, 'scene.update', 'scene');\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vaXRlcmF0aW9uLW9wZXJhdGlvbnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUF3QjtBQUMrQjtBQUNqQjtBQUMrQjtBQUN0QjtBQUN5QjtBQUNHO0FBQ3JCO0FBRXREOztDQUVDLEdBQ00sTUFBTWEsdUJBQXVCWixnRUFBa0JBLENBQ25EYSxLQUFLLENBQUNkLGtDQUFDQSxDQUFDZSxNQUFNLENBQUM7SUFDZEMsV0FBV2hCLGtDQUFDQSxDQUFDaUIsTUFBTTtBQUNyQixJQUNDQyxLQUFLLENBQUMsT0FBTyxFQUFFSixLQUFLLEVBQUVLLEdBQUcsRUFBRTtJQUMxQixNQUFNLEVBQUVILFNBQVMsRUFBRSxHQUFHRjtJQUV0Qiw0Q0FBNEM7SUFDNUMsTUFBTU0sYUFBYSxNQUFNbEIsZ0RBQUVBLENBQUNnQixLQUFLLENBQUNiLGVBQWUsQ0FBQ2dCLFFBQVEsQ0FBQztRQUN6REMsT0FBT2hCLCtDQUFFQSxDQUFDRCw2REFBZUEsQ0FBQ1csU0FBUyxFQUFFQTtRQUNyQ08sU0FBUztZQUFDbEIsNkRBQWVBLENBQUNtQixTQUFTO1NBQUM7SUFDdEM7SUFFQSxpREFBaUQ7SUFDakQsTUFBTUMsdUJBQXVCLE1BQU1DLFFBQVFDLEdBQUcsQ0FDNUNQLFdBQVdRLEdBQUcsQ0FBQyxPQUFPQztRQUNwQixNQUFNQyxRQUFRLE1BQU01QixnREFBRUEsQ0FBQ2dCLEtBQUssQ0FBQ2YsTUFBTSxDQUFDNEIsU0FBUyxDQUFDO1lBQzVDVCxPQUFPaEIsK0NBQUVBLENBQUNILG9EQUFNQSxDQUFDNkIsRUFBRSxFQUFFSCxVQUFVSSxPQUFPO1FBQ3hDO1FBRUEsT0FBTztZQUNMLEdBQUdKLFNBQVM7WUFDWkssa0JBQWtCSixPQUFPSyxRQUFRO1lBQ2pDQyxhQUFhLENBQUMsQ0FBQ047UUFDakI7SUFDRjtJQUdGLE9BQU9MO0FBQ1QsR0FBRztBQUVMOztDQUVDLEdBQ00sTUFBTVksNEJBQTRCcEMs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VUFBVTZCLGFBQWEsS0FBSyxXQUFXLE9BQU9ELGNBQWNTLE9BQU87WUFDL0VNLFdBQVczQyxVQUFVMkMsU0FBUyxJQUFJM0MsVUFBVThCLFVBQVU7WUFDdERrQixrQkFBa0I7WUFDbEJDLFdBQVc7WUFDWEMsaUJBQWlCO1lBQ2pCL0QsV0FBVztRQUNiO1FBRUEsdUNBQXVDO1FBQ3ZDLE1BQU1QLGlGQUFjQSxDQUFDdUUsYUFBYSxDQUFDO1lBQ2pDcEM7WUFDQXFDLFNBQVMsQ0FBQyxpQ0FBaUMsRUFBRXBELFVBQVUrQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BFTSxNQUFNO1lBQ05DLE1BQU07UUFDUjtRQUVBLE9BQU9wQyxTQUFTcUMsT0FBTyxDQUNyQjNCLGVBQ0E1QixVQUFVNkIsYUFBYSxLQUFLLFdBQVcsaUJBQWlCLGdCQUN4RCxTQUNBO1lBQUNELGNBQWN6QixFQUFFO1NBQUM7SUFHdEIsRUFBRSxPQUFPdUIsT0FBTztRQUNkSixRQUFRSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUVSLFNBQVNNLFlBQVksR0FBRyxlQUFlLENBQUMsRUFBRUU7UUFFNUQsTUFBTThCLFlBQVkxRSx1RUFBWUEsQ0FBQzRDO1FBQy9CLE1BQU0rQixlQUFlL0IsaUJBQWlCSyxRQUFRTCxNQUFNZ0MsT0FBTyxHQUFHO1FBRTlELE9BQU94QyxTQUFTUSxLQUFLLENBQ25COEIsV0FDQUMsY0FDQSxnQkFDQTtJQUVKO0FBQ0YsR0FBRyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3NlcnZlci9hcGkvcm91dGVycy9nZW5lcmF0aW9uL2l0ZXJhdGlvbi1vcGVyYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBwcm90ZWN0ZWRQcm9jZWR1cmUgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3RycGNcIjtcbmltcG9ydCB7IGRiIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IHNjZW5lcywgcHJvamVjdHMsIHNjZW5lSXRlcmF0aW9ucyB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBlcSwgYW5kLCBpbkFycmF5IH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBtZXNzYWdlU2VydmljZSB9IGZyb20gXCJ+L3NlcnZlci9zZXJ2aWNlcy9kYXRhL21lc3NhZ2Uuc2VydmljZVwiO1xuaW1wb3J0IHsgUmVzcG9uc2VCdWlsZGVyLCBnZXRFcnJvckNvZGUgfSBmcm9tIFwifi9saWIvYXBpL3Jlc3BvbnNlLWhlbHBlcnNcIjtcbmltcG9ydCB7IEVycm9yQ29kZSB9IGZyb20gXCJ+L2xpYi90eXBlcy9hcGkvdW5pdmVyc2FsXCI7XG5cbi8qKlxuICogR0VUIElURVJBVElPTlMgQlkgTUVTU0FHRSAtIFF1ZXJ5IGFsbCBzY2VuZSBpdGVyYXRpb25zIGxpbmtlZCB0byBhIG1lc3NhZ2VcbiAqL1xuZXhwb3J0IGNvbnN0IGdldE1lc3NhZ2VJdGVyYXRpb25zID0gcHJvdGVjdGVkUHJvY2VkdXJlXG4gIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgbWVzc2FnZUlkOiB6LnN0cmluZygpLFxuICB9KSlcbiAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0LCBjdHggfSkgPT4ge1xuICAgIGNvbnN0IHsgbWVzc2FnZUlkIH0gPSBpbnB1dDtcbiAgICBcbiAgICAvLyBHZXQgYWxsIGl0ZXJhdGlvbnMgbGlua2VkIHRvIHRoaXMgbWVzc2FnZVxuICAgIGNvbnN0IGl0ZXJhdGlvbnMgPSBhd2FpdCBkYi5xdWVyeS5zY2VuZUl0ZXJhdGlvbnMuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IGVxKHNjZW5lSXRlcmF0aW9ucy5tZXNzYWdlSWQsIG1lc3NhZ2VJZCksXG4gICAgICBvcmRlckJ5OiBbc2NlbmVJdGVyYXRpb25zLmNyZWF0ZWRBdF0sXG4gICAgfSk7XG4gICAgXG4gICAgLy8gRm9yIGVhY2ggaXRlcmF0aW9uLCBnZXQgdGhlIGN1cnJlbnQgc2NlbmUgaW5mb1xuICAgIGNvbnN0IGl0ZXJhdGlvbnNXaXRoU2NlbmVzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBpdGVyYXRpb25zLm1hcChhc3luYyAoaXRlcmF0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IHNjZW5lID0gYXdhaXQgZGIucXVlcnkuc2NlbmVzLmZpbmRGaXJzdCh7XG4gICAgICAgICAgd2hlcmU6IGVxKHNjZW5lcy5pZCwgaXRlcmF0aW9uLnNjZW5lSWQpLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uaXRlcmF0aW9uLFxuICAgICAgICAgIGN1cnJlbnRTY2VuZU5hbWU6IHNjZW5lPy5uYW1lIHx8ICdEZWxldGVkIFNjZW5lJyxcbiAgICAgICAgICBzY2VuZUV4aXN0czogISFzY2VuZSxcbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgKTtcbiAgICBcbiAgICByZXR1cm4gaXRlcmF0aW9uc1dpdGhTY2VuZXM7XG4gIH0pO1xuXG4vKipcbiAqIEdFVCBCQVRDSCBNRVNTQUdFIElURVJBVElPTlMgLSBFZmZpY2llbnRseSBjaGVjayBtdWx0aXBsZSBtZXNzYWdlcyBmb3IgaXRlcmF0aW9uc1xuICovXG5leHBvcnQgY29uc3QgZ2V0QmF0Y2hNZXNzYWdlSXRlcmF0aW9ucyA9IHByb3RlY3RlZFByb2NlZHVyZVxuICAuaW5wdXQoei5vYmplY3Qoe1xuICAgIG1lc3NhZ2VJZHM6IHouYXJyYXkoei5zdHJpbmcoKSksXG4gIH0pKVxuICAucXVlcnkoYXN5bmMgKHsgaW5wdXQsIGN0eCB9KSA9PiB7XG4gICAgY29uc3QgeyBtZXNzYWdlSWRzIH0gPSBpbnB1dDtcbiAgICBcbiAgICBpZiAobWVzc2FnZUlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgXG4gICAgLy8gR2V0IGFsbCBpdGVyYXRpb25zIGZvciB0aGVzZSBtZXNzYWdlcyBpbiBvbmUgcXVlcnlcbiAgICBjb25zdCBpdGVyYXRpb25zID0gYXdhaXQgZGIucXVlcnkuc2NlbmVJdGVyYXRpb25zLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiBpbkFycmF5KHNjZW5lSXRlcmF0aW9ucy5tZXNzYWdlSWQsIG1lc3NhZ2VJZHMpLFxuICAgICAgb3JkZXJCeTogW3NjZW5lSXRlcmF0aW9ucy5jcmVhdGVkQXRdLFxuICAgIH0pO1xuICAgIFxuICAgIC8vIEdyb3VwIGJ5IG1lc3NhZ2VJZCBmb3IgZWFzeSBsb29rdXBcbiAgICBjb25zdCBpdGVyYXRpb25zQnlNZXNzYWdlOiBSZWNvcmQ8c3RyaW5nLCB0eXBlb2YgaXRlcmF0aW9ucz4gPSB7fTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IGl0ZXJhdGlvbiBvZiBpdGVyYXRpb25zKSB7XG4gICAgICBpZiAoaXRlcmF0aW9uLm1lc3NhZ2VJZCkge1xuICAgICAgICBpZiAoIWl0ZXJhdGlvbnNCeU1lc3NhZ2VbaXRlcmF0aW9uLm1lc3NhZ2VJZF0pIHtcbiAgICAgICAgICBpdGVyYXRpb25zQnlNZXNzYWdlW2l0ZXJhdGlvbi5tZXNzYWdlSWRdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgaXRlcmF0aW9uc0J5TWVzc2FnZVtpdGVyYXRpb24ubWVzc2FnZUlkXSEucHVzaChpdGVyYXRpb24pO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gaXRlcmF0aW9uc0J5TWVzc2FnZTtcbiAgfSk7XG5cbi8qKlxuICogUkVWRVJUIFRPIElURVJBVElPTiAtIFJlc3RvcmUgYSBzY2VuZSB0byBhIHByZXZpb3VzIHZlcnNpb25cbiAqL1xuZXhwb3J0IGNvbnN0IHJldmVydFRvSXRlcmF0aW9uID0gcHJvdGVjdGVkUHJvY2VkdXJlXG4gIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgcHJvamVjdElkOiB6LnN0cmluZygpLFxuICAgIGl0ZXJhdGlvbklkOiB6LnN0cmluZygpLFxuICAgIG1lc3NhZ2VJZDogei5zdHJpbmcoKSwgLy8gRm9yIGNyZWF0aW5nIGEgbmV3IG1lc3NhZ2UgYWJvdXQgdGhlIHJldmVydFxuICB9KSlcbiAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0LCBjdHggfSkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gbmV3IFJlc3BvbnNlQnVpbGRlcigpO1xuICAgIGNvbnN0IHsgcHJvamVjdElkLCBpdGVyYXRpb25JZCwgbWVzc2FnZUlkIH0gPSBpbnB1dDtcbiAgICBjb25zdCB1c2VySWQgPSBjdHguc2Vzc2lvbi51c2VyLmlkO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIFJldmVydGluZyB0byBpdGVyYXRpb25gLCB7IFxuICAgICAgaXRlcmF0aW9uSWQsIFxuICAgICAgbWVzc2FnZUlkIFxuICAgIH0pO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyAxLiBWZXJpZnkgcHJvamVjdCBvd25lcnNoaXBcbiAgICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBkYi5xdWVyeS5wcm9qZWN0cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgIGVxKHByb2plY3RzLmlkLCBwcm9qZWN0SWQpLFxuICAgICAgICAgIGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgICApLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghcHJvamVjdCkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZXJyb3IoXG4gICAgICAgICAgRXJyb3JDb2RlLk5PVF9GT1VORCxcbiAgICAgICAgICBcIlByb2plY3Qgbm90IGZvdW5kIG9yIGFjY2VzcyBkZW5pZWRcIixcbiAgICAgICAgICAnc2NlbmUudXBkYXRlJyxcbiAgICAgICAgICAnc2NlbmUnXG4gICAgICAgICkgYXMgYW55O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyAyLiBHZXQgdGhlIGl0ZXJhdGlvblxuICAgICAgY29uc3QgaXRlcmF0aW9uID0gYXdhaXQgZGIucXVlcnkuc2NlbmVJdGVyYXRpb25zLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgZXEoc2NlbmVJdGVyYXRpb25zLmlkLCBpdGVyYXRpb25JZCksXG4gICAgICAgICAgZXEoc2NlbmVJdGVyYXRpb25zLnByb2plY3RJZCwgcHJvamVjdElkKVxuICAgICAgICApLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghaXRlcmF0aW9uKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5lcnJvcihcbiAgICAgICAgICBFcnJvckNvZGUuTk9UX0ZPVU5ELFxuICAgICAgICAgIFwiSXRlcmF0aW9uIG5vdCBmb3VuZFwiLFxuICAgICAgICAgICdzY2VuZS51cGRhdGUnLFxuICAgICAgICAgICdzY2VuZSdcbiAgICAgICAgKSBhcyBhbnk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIDMuIEhhbmRsZSBiYXNlZCBvbiBvcGVyYXRpb24gdHlwZVxuICAgICAgbGV0IHJldmVydGVkU2NlbmU7XG4gICAgICBcbiAgICAgIGlmIChpdGVyYXRpb24ub3BlcmF0aW9uVHlwZSA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgLy8gUmVzdG9yZSBkZWxldGVkIHNjZW5lXG4gICAgICAgIGlmICghaXRlcmF0aW9uLmNvZGVCZWZvcmUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgcmVzdG9yZSBkZWxldGVkIHNjZW5lIC0gbm8gY29kZSBoaXN0b3J5XCIpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBGaW5kIHRoZSBvcmlnaW5hbCBvcmRlciBieSBsb29raW5nIGF0IG90aGVyIHNjZW5lc1xuICAgICAgICBjb25zdCBhbGxTY2VuZXMgPSBhd2FpdCBkYi5xdWVyeS5zY2VuZXMuZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlOiBlcShzY2VuZXMucHJvamVjdElkLCBwcm9qZWN0SWQpLFxuICAgICAgICAgIG9yZGVyQnk6IFtzY2VuZXMub3JkZXJdLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEluc2VydCBhdCB0aGUgZW5kXG4gICAgICAgIGNvbnN0IG1heE9yZGVyID0gYWxsU2NlbmVzLmxlbmd0aDtcbiAgICAgICAgXG4gICAgICAgIFtyZXZlcnRlZFNjZW5lXSA9IGF3YWl0IGRiLmluc2VydChzY2VuZXMpLnZhbHVlcyh7XG4gICAgICAgICAgaWQ6IGl0ZXJhdGlvbi5zY2VuZUlkLCAvLyBSZXN0b3JlIHdpdGggb3JpZ2luYWwgSURcbiAgICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgICAgbmFtZTogYFJlc3RvcmVkIFNjZW5lYCxcbiAgICAgICAgICB0c3hDb2RlOiBpdGVyYXRpb24uY29kZUJlZm9yZSxcbiAgICAgICAgICBkdXJhdGlvbjogMTUwLCAvLyBEZWZhdWx0IGR1cmF0aW9uXG4gICAgICAgICAgb3JkZXI6IG1heE9yZGVyLFxuICAgICAgICAgIHByb3BzOiB7fSxcbiAgICAgICAgfSkucmV0dXJuaW5nKCk7XG4gICAgICAgIFxuICAgICAgfSBlbHNlIGlmIChpdGVyYXRpb24ub3BlcmF0aW9uVHlwZSA9PT0gJ2NyZWF0ZScpIHtcbiAgICAgICAgLy8gRm9yIGNyZWF0ZSBvcGVyYXRpb25zLCB1c2UgY29kZUFmdGVyICh0aGUgY3JlYXRlZCBzdGF0ZSlcbiAgICAgICAgY29uc3Qgc2NlbmUgPSBhd2FpdCBkYi5xdWVyeS5zY2VuZXMuZmluZEZpcnN0KHtcbiAgICAgICAgICB3aGVyZTogZXEoc2NlbmVzLmlkLCBpdGVyYXRpb24uc2NlbmVJZCksXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFzY2VuZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNjZW5lIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgW3JldmVydGVkU2NlbmVdID0gYXdhaXQgZGIudXBkYXRlKHNjZW5lcylcbiAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgIHRzeENvZGU6IGl0ZXJhdGlvbi5jb2RlQWZ0ZXIhLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGVxKHNjZW5lcy5pZCwgaXRlcmF0aW9uLnNjZW5lSWQpKVxuICAgICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgICAgICBcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZvciBlZGl0IG9wZXJhdGlvbnMsIHJldmVydCB0byB0aGUgc3RhdGUgYWZ0ZXIgdGhpcyBlZGl0XG4gICAgICAgIGNvbnN0IHNjZW5lID0gYXdhaXQgZGIucXVlcnkuc2NlbmVzLmZpbmRGaXJzdCh7XG4gICAgICAgICAgd2hlcmU6IGVxKHNjZW5lcy5pZCwgaXRlcmF0aW9uLnNjZW5lSWQpLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghc2NlbmUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTY2VuZSBub3QgZm91bmRcIik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGNvZGVUb1JldmVydFRvID0gaXRlcmF0aW9uLmNvZGVBZnRlciB8fCBpdGVyYXRpb24uY29kZUJlZm9yZTtcbiAgICAgICAgaWYgKCFjb2RlVG9SZXZlcnRUbykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGNvZGUgaGlzdG9yeSBhdmFpbGFibGUgZm9yIHRoaXMgaXRlcmF0aW9uXCIpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBbcmV2ZXJ0ZWRTY2VuZV0gPSBhd2FpdCBkYi51cGRhdGUoc2NlbmVzKVxuICAgICAgICAgIC5zZXQoe1xuICAgICAgICAgICAgdHN4Q29kZTogY29kZVRvUmV2ZXJ0VG8sXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSlcbiAgICAgICAgICAud2hlcmUoZXEoc2NlbmVzLmlkLCBpdGVyYXRpb24uc2NlbmVJZCkpXG4gICAgICAgICAgLnJldHVybmluZygpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoIXJldmVydGVkU2NlbmUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHJldmVydCBzY2VuZVwiKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gNC4gQ3JlYXRlIGEgbmV3IGl0ZXJhdGlvbiB0byB0cmFjayB0aGUgcmV2ZXJ0XG4gICAgICBhd2FpdCBkYi5pbnNlcnQoc2NlbmVJdGVyYXRpb25zKS52YWx1ZXMoe1xuICAgICAgICBzY2VuZUlkOiBpdGVyYXRpb24uc2NlbmVJZCxcbiAgICAgICAgcHJvamVjdElkLFxuICAgICAgICBvcGVyYXRpb25UeXBlOiAnZWRpdCcsXG4gICAgICAgIHVzZXJQcm9tcHQ6IGBSZXZlcnRlZCB0byB2ZXJzaW9uIGZyb206IFwiJHtpdGVyYXRpb24udXNlclByb21wdH1cImAsXG4gICAgICAgIGNvZGVCZWZvcmU6IGl0ZXJhdGlvbi5vcGVyYXRpb25UeXBlID09PSAnZGVsZXRlJyA/IG51bGwgOiByZXZlcnRlZFNjZW5lLnRzeENvZGUsXG4gICAgICAgIGNvZGVBZnRlcjogaXRlcmF0aW9uLmNvZGVBZnRlciB8fCBpdGVyYXRpb24uY29kZUJlZm9yZSxcbiAgICAgICAgZ2VuZXJhdGlvblRpbWVNczogMCxcbiAgICAgICAgbW9kZWxVc2VkOiBudWxsLFxuICAgICAgICB1c2VyRWRpdGVkQWdhaW46IGZhbHNlLFxuICAgICAgICBtZXNzYWdlSWQ6IG51bGwsIC8vIFRoaXMgaXMgYSBzeXN0ZW0gb3BlcmF0aW9uLCBub3QgbGlua2VkIHRvIGEgbmV3IG1lc3NhZ2VcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyA1LiBDcmVhdGUgYSBtZXNzYWdlIGFib3V0IHRoZSByZXZlcnRcbiAgICAgIGF3YWl0IG1lc3NhZ2VTZXJ2aWNlLmNyZWF0ZU1lc3NhZ2Uoe1xuICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgIGNvbnRlbnQ6IGBSZXZlcnRlZCBzY2VuZSB0byB2ZXJzaW9uIGZyb206IFwiJHtpdGVyYXRpb24udXNlclByb21wdH1cImAsXG4gICAgICAgIHJvbGU6ICdhc3Npc3RhbnQnLFxuICAgICAgICBraW5kOiAnbWVzc2FnZScsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN1Y2Nlc3MoXG4gICAgICAgIHJldmVydGVkU2NlbmUgYXMgYW55LFxuICAgICAgICBpdGVyYXRpb24ub3BlcmF0aW9uVHlwZSA9PT0gJ2RlbGV0ZScgPyAnc2NlbmUuY3JlYXRlJyA6ICdzY2VuZS51cGRhdGUnLFxuICAgICAgICAnc2NlbmUnLFxuICAgICAgICBbcmV2ZXJ0ZWRTY2VuZS5pZF1cbiAgICAgICk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBSZXZlcnQgZXJyb3I6YCwgZXJyb3IpO1xuICAgICAgXG4gICAgICBjb25zdCBlcnJvckNvZGUgPSBnZXRFcnJvckNvZGUoZXJyb3IpO1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHJldmVydCc7XG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZS5lcnJvcihcbiAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICAgICdzY2VuZS51cGRhdGUnLFxuICAgICAgICAnc2NlbmUnXG4gICAgICApIGFzIGFueTtcbiAgICB9XG4gIH0pOyJdLCJuYW1lcyI6WyJ6IiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiZGIiLCJzY2VuZXMiLCJwcm9qZWN0cyIsInNjZW5lSXRlcmF0aW9ucyIsImVxIiwiYW5kIiwiaW5BcnJheSIsIm1lc3NhZ2VTZXJ2aWNlIiwiUmVzcG9uc2VCdWlsZGVyIiwiZ2V0RXJyb3JDb2RlIiwiRXJyb3JDb2RlIiwiZ2V0TWVzc2FnZUl0ZXJhdGlvbnMiLCJpbnB1dCIsIm9iamVjdCIsIm1lc3NhZ2VJZCIsInN0cmluZyIsInF1ZXJ5IiwiY3R4IiwiaXRlcmF0aW9ucyIsImZpbmRNYW55Iiwid2hlcmUiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwiaXRlcmF0aW9uc1dpdGhTY2VuZXMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiaXRlcmF0aW9uIiwic2NlbmUiLCJmaW5kRmlyc3QiLCJpZCIsInNjZW5lSWQiLCJjdXJyZW50U2NlbmVOYW1lIiwibmFtZSIsInNjZW5lRXhpc3RzIiwiZ2V0QmF0Y2hNZXNzYWdlSXRlcmF0aW9ucyIsIm1lc3NhZ2VJZHMiLCJhcnJheSIsImxlbmd0aCIsIml0ZXJhdGlvbnNCeU1lc3NhZ2UiLCJwdXNoIiwicmV2ZXJ0VG9JdGVyYXRpb24iLCJwcm9qZWN0SWQiLCJpdGVyYXRpb25JZCIsIm11dGF0aW9uIiwicmVzcG9uc2UiLCJ1c2VySWQiLCJzZXNzaW9uIiwidXNlciIsImNvbnNvbGUiLCJsb2ciLCJnZXRSZXF1ZXN0SWQiLCJwcm9qZWN0IiwiZXJyb3IiLCJOT1RfRk9VTkQiLCJyZXZlcnRlZFNjZW5lIiwib3BlcmF0aW9uVHlwZSIsImNvZGVCZWZvcmUiLCJFcnJvciIsImFsbFNjZW5lcyIsIm9yZGVyIiwibWF4T3JkZXIiLCJpbnNlcnQiLCJ2YWx1ZXMiLCJ0c3hDb2RlIiwiZHVyYXRpb24iLCJwcm9wcyIsInJldHVybmluZyIsInVwZGF0ZSIsInNldCIsImNvZGVBZnRlciIsInVwZGF0ZWRBdCIsIkRhdGUiLCJjb2RlVG9SZXZlcnRUbyIsInVzZXJQcm9tcHQiLCJnZW5lcmF0aW9uVGltZU1zIiwibW9kZWxVc2VkIiwidXNlckVkaXRlZEFnYWluIiwiY3JlYXRlTWVzc2FnZSIsImNvbnRlbnQiLCJyb2xlIiwia2luZCIsInN1Y2Nlc3MiLCJlcnJvckNvZGUiLCJlcnJvck1lc3NhZ2UiLCJtZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/generation/iteration-operations.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/generation/project-operations.ts":
/*!*****************************************************************!*\
  !*** ./src/server/api/routers/generation/project-operations.ts ***!
  \*****************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getProjectScenes: () => (/* binding */ getProjectScenes)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n/**\n * GET PROJECT SCENES - Query all scenes for a project\n */ const getProjectScenes = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_3__.z.object({\n    projectId: zod__WEBPACK_IMPORTED_MODULE_3__.z.string()\n})).query(async ({ input, ctx })=>{\n    const { projectId } = input;\n    const userId = ctx.session.user.id;\n    // Verify project ownership\n    const project = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.projects.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId))\n    });\n    if (!project) {\n        throw new Error(\"Project not found or access denied\");\n    }\n    // Get scenes\n    const projectScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findMany({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, projectId),\n        orderBy: [\n            _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.order\n        ]\n    });\n    return projectScenes;\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vcHJvamVjdC1vcGVyYXRpb25zLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXdCO0FBQytCO0FBQ2pCO0FBQ2M7QUFDZDtBQUV0Qzs7Q0FFQyxHQUNNLE1BQU1PLG1CQUFtQk4sZ0VBQWtCQSxDQUMvQ08sS0FBSyxDQUFDUixrQ0FBQ0EsQ0FBQ1MsTUFBTSxDQUFDO0lBQ2RDLFdBQVdWLGtDQUFDQSxDQUFDVyxNQUFNO0FBQ3JCLElBQ0NDLEtBQUssQ0FBQyxPQUFPLEVBQUVKLEtBQUssRUFBRUssR0FBRyxFQUFFO0lBQzFCLE1BQU0sRUFBRUgsU0FBUyxFQUFFLEdBQUdGO0lBQ3RCLE1BQU1NLFNBQVNELElBQUlFLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDQyxFQUFFO0lBRWxDLDJCQUEyQjtJQUMzQixNQUFNQyxVQUFVLE1BQU1oQixnREFBRUEsQ0FBQ1UsS0FBSyxDQUFDUixRQUFRLENBQUNlLFNBQVMsQ0FBQztRQUNoREMsT0FBT2QsZ0RBQUdBLENBQ1JELCtDQUFFQSxDQUFDRCxzREFBUUEsQ0FBQ2EsRUFBRSxFQUFFUCxZQUNoQkwsK0NBQUVBLENBQUNELHNEQUFRQSxDQUFDVSxNQUFNLEVBQUVBO0lBRXhCO0lBRUEsSUFBSSxDQUFDSSxTQUFTO1FBQ1osTUFBTSxJQUFJRyxNQUFNO0lBQ2xCO0lBRUEsYUFBYTtJQUNiLE1BQU1DLGdCQUFnQixNQUFNcEIsZ0RBQUVBLENBQUNVLEtBQUssQ0FBQ1QsTUFBTSxDQUFDb0IsUUFBUSxDQUFDO1FBQ25ESCxPQUFPZiwrQ0FBRUEsQ0FBQ0Ysb0RBQU1BLENBQUNPLFNBQVMsRUFBRUE7UUFDNUJjLFNBQVM7WUFBQ3JCLG9EQUFNQSxDQUFDc0IsS0FBSztTQUFDO0lBQ3pCO0lBRUEsT0FBT0g7QUFDVCxHQUFHIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vcHJvamVjdC1vcGVyYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBwcm90ZWN0ZWRQcm9jZWR1cmUgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3RycGNcIjtcbmltcG9ydCB7IGRiIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IHNjZW5lcywgcHJvamVjdHMgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgZXEsIGFuZCB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuXG4vKipcbiAqIEdFVCBQUk9KRUNUIFNDRU5FUyAtIFF1ZXJ5IGFsbCBzY2VuZXMgZm9yIGEgcHJvamVjdFxuICovXG5leHBvcnQgY29uc3QgZ2V0UHJvamVjdFNjZW5lcyA9IHByb3RlY3RlZFByb2NlZHVyZVxuICAuaW5wdXQoei5vYmplY3Qoe1xuICAgIHByb2plY3RJZDogei5zdHJpbmcoKSxcbiAgfSkpXG4gIC5xdWVyeShhc3luYyAoeyBpbnB1dCwgY3R4IH0pID0+IHtcbiAgICBjb25zdCB7IHByb2plY3RJZCB9ID0gaW5wdXQ7XG4gICAgY29uc3QgdXNlcklkID0gY3R4LnNlc3Npb24udXNlci5pZDtcblxuICAgIC8vIFZlcmlmeSBwcm9qZWN0IG93bmVyc2hpcFxuICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBkYi5xdWVyeS5wcm9qZWN0cy5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgZXEocHJvamVjdHMuaWQsIHByb2plY3RJZCksXG4gICAgICAgIGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgKSxcbiAgICB9KTtcblxuICAgIGlmICghcHJvamVjdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvamVjdCBub3QgZm91bmQgb3IgYWNjZXNzIGRlbmllZFwiKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgc2NlbmVzXG4gICAgY29uc3QgcHJvamVjdFNjZW5lcyA9IGF3YWl0IGRiLnF1ZXJ5LnNjZW5lcy5maW5kTWFueSh7XG4gICAgICB3aGVyZTogZXEoc2NlbmVzLnByb2plY3RJZCwgcHJvamVjdElkKSxcbiAgICAgIG9yZGVyQnk6IFtzY2VuZXMub3JkZXJdLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHByb2plY3RTY2VuZXM7XG4gIH0pOyJdLCJuYW1lcyI6WyJ6IiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiZGIiLCJzY2VuZXMiLCJwcm9qZWN0cyIsImVxIiwiYW5kIiwiZ2V0UHJvamVjdFNjZW5lcyIsImlucHV0Iiwib2JqZWN0IiwicHJvamVjdElkIiwic3RyaW5nIiwicXVlcnkiLCJjdHgiLCJ1c2VySWQiLCJzZXNzaW9uIiwidXNlciIsImlkIiwicHJvamVjdCIsImZpbmRGaXJzdCIsIndoZXJlIiwiRXJyb3IiLCJwcm9qZWN0U2NlbmVzIiwiZmluZE1hbnkiLCJvcmRlckJ5Iiwib3JkZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/generation/project-operations.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/generation/scene-operations.ts":
/*!***************************************************************!*\
  !*** ./src/server/api/routers/generation/scene-operations.ts ***!
  \***************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateScene: () => (/* binding */ generateScene),\n/* harmony export */   removeScene: () => (/* binding */ removeScene)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/server/services/data/message.service */ \"(rsc)/./src/server/services/data/message.service.ts\");\n/* harmony import */ var _brain_orchestratorNEW__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/brain/orchestratorNEW */ \"(rsc)/./src/brain/orchestratorNEW.ts\");\n/* harmony import */ var _lib_types_ai_brain_types__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ~/lib/types/ai/brain.types */ \"(rsc)/./src/lib/types/ai/brain.types.ts\");\n/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers */ \"(rsc)/./src/server/api/routers/generation/helpers.ts\");\n/* harmony import */ var _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ~/lib/api/response-helpers */ \"(rsc)/./src/lib/api/response-helpers.ts\");\n/* harmony import */ var _lib_types_api_universal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ~/lib/types/api/universal */ \"(rsc)/./src/lib/types/api/universal.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__, _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__, _brain_orchestratorNEW__WEBPACK_IMPORTED_MODULE_4__, _helpers__WEBPACK_IMPORTED_MODULE_6__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__, _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__, _brain_orchestratorNEW__WEBPACK_IMPORTED_MODULE_4__, _helpers__WEBPACK_IMPORTED_MODULE_6__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n// Import universal response types and helpers\n\n\n/**\n * UNIFIED SCENE GENERATION with Universal Response\n */ const generateScene = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n    projectId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string(),\n    userMessage: zod__WEBPACK_IMPORTED_MODULE_9__.z.string(),\n    userContext: zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        imageUrls: zod__WEBPACK_IMPORTED_MODULE_9__.z.array(zod__WEBPACK_IMPORTED_MODULE_9__.z.string()).optional()\n    }).optional(),\n    assistantMessageId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().optional()\n})).mutation(async ({ input, ctx })=>{\n    const response = new _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_7__.ResponseBuilder();\n    const { projectId, userMessage, userContext } = input;\n    const userId = ctx.session.user.id;\n    console.log(`[${response.getRequestId()}] Starting scene generation`, {\n        projectId,\n        userMessage\n    });\n    try {\n        // 1. Verify project ownership\n        const project = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.projects.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId))\n        });\n        if (!project) {\n            return response.error(_lib_types_api_universal__WEBPACK_IMPORTED_MODULE_8__.ErrorCode.NOT_FOUND, \"Project not found or access denied\", 'scene.create', 'scene');\n        }\n        // 2. Build storyboard context\n        let storyboardForBrain = [];\n        // Get existing scenes first\n        const existingScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, projectId),\n            orderBy: [\n                _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.order\n            ]\n        });\n        if (project.isWelcome && existingScenes.length === 0) {\n            // First real scene - clear welcome flag\n            console.log(`[${response.getRequestId()}] First real scene - clearing welcome flag`);\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).set({\n                isWelcome: false\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId));\n            storyboardForBrain = [];\n        } else if (project.isWelcome && existingScenes.length > 0) {\n            // Welcome project but has scenes already - just clear the flag\n            console.log(`[${response.getRequestId()}] Welcome project with scenes - clearing flag only`);\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).set({\n                isWelcome: false\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId));\n            storyboardForBrain = existingScenes.map((scene)=>({\n                    id: scene.id,\n                    name: scene.name,\n                    duration: scene.duration,\n                    order: scene.order,\n                    tsxCode: scene.tsxCode\n                }));\n        } else {\n            // Normal project with scenes\n            storyboardForBrain = existingScenes.map((scene)=>({\n                    id: scene.id,\n                    name: scene.name,\n                    duration: scene.duration,\n                    order: scene.order,\n                    tsxCode: scene.tsxCode\n                }));\n        }\n        // 3. Get chat history\n        const recentMessages = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.messages.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, projectId),\n            orderBy: [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.sequence)\n            ],\n            limit: 10\n        });\n        const chatHistory = recentMessages.reverse().map((msg)=>({\n                role: msg.role,\n                content: msg.content\n            }));\n        // 4. Store user message\n        await _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__.messageService.createMessage({\n            projectId,\n            content: userMessage,\n            role: \"user\",\n            imageUrls: userContext?.imageUrls || []\n        });\n        // 5. Get decision from brain\n        console.log(`[${response.getRequestId()}] Getting decision from brain...`);\n        const orchestratorResponse = await _brain_orchestratorNEW__WEBPACK_IMPORTED_MODULE_4__.orchestrator.processUserInput({\n            prompt: userMessage,\n            projectId,\n            userId,\n            storyboardSoFar: storyboardForBrain,\n            chatHistory,\n            userContext: {\n                imageUrls: userContext?.imageUrls\n            }\n        });\n        if (!orchestratorResponse.success || !orchestratorResponse.result) {\n            return response.error(_lib_types_api_universal__WEBPACK_IMPORTED_MODULE_8__.ErrorCode.AI_ERROR, orchestratorResponse.error || \"Failed to get decision from brain\", 'scene.create', 'scene');\n        }\n        const decision = {\n            success: true,\n            toolName: orchestratorResponse.result.toolName,\n            toolContext: orchestratorResponse.result.toolContext,\n            reasoning: orchestratorResponse.reasoning,\n            chatResponse: orchestratorResponse.chatResponse\n        };\n        // 6. Create assistant's response FIRST (before tool execution)\n        // This ensures proper message ordering in the database\n        let assistantMessageId;\n        if (decision.chatResponse) {\n            const newAssistantMessage = await _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__.messageService.createMessage({\n                id: input.assistantMessageId,\n                projectId,\n                content: decision.chatResponse,\n                role: \"assistant\",\n                status: \"pending\"\n            });\n            assistantMessageId = newAssistantMessage?.id;\n        }\n        // 7. Execute the tool\n        console.log(`[${response.getRequestId()}] Executing tool: ${decision.toolName}`);\n        const toolResult = await (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.executeToolFromDecision)(decision, projectId, userId, storyboardForBrain, assistantMessageId // Pass the actual message ID for iteration tracking\n        );\n        console.log(`[${response.getRequestId()}] Tool execution result:`, {\n            success: toolResult.success,\n            hasScene: !!toolResult.scene,\n            sceneId: toolResult.scene?.id,\n            sceneName: toolResult.scene?.name\n        });\n        // 8. Update assistant message status after execution\n        if (assistantMessageId && toolResult.success) {\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).set({\n                status: 'success',\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id, assistantMessageId));\n        }\n        // 9. Return universal response\n        if (!toolResult.scene) {\n            return response.error(_lib_types_api_universal__WEBPACK_IMPORTED_MODULE_8__.ErrorCode.INTERNAL_ERROR, \"Tool execution succeeded but no scene was created\", 'scene.create', 'scene');\n        }\n        // Scene is already a proper SceneEntity from the database\n        // Determine the correct operation based on the tool used\n        const operation = decision.toolName ? _lib_types_ai_brain_types__WEBPACK_IMPORTED_MODULE_5__.TOOL_OPERATION_MAP[decision.toolName] : 'scene.create';\n        const successResponse = response.success(toolResult.scene, operation, 'scene', [\n            toolResult.scene.id\n        ]);\n        // Add context to the response\n        return {\n            ...successResponse,\n            context: {\n                reasoning: decision.reasoning,\n                chatResponse: decision.chatResponse\n            }\n        };\n    } catch (error) {\n        console.error(`[${response.getRequestId()}] Scene generation error:`, error);\n        // If we have an assistant message that was pending, mark it as failed\n        if (input.assistantMessageId) {\n            try {\n                await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).set({\n                    status: 'error',\n                    updatedAt: new Date()\n                }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.id, input.assistantMessageId));\n            } catch (updateError) {\n                console.error(`[${response.getRequestId()}] Failed to update message status:`, updateError);\n            }\n        }\n        const errorCode = (0,_lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_7__.getErrorCode)(error);\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n        return response.error(errorCode, errorMessage, 'scene.create', 'scene');\n    }\n});\n/**\n * SCENE REMOVAL with Universal Response\n */ const removeScene = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n    projectId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string(),\n    sceneId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string()\n})).mutation(async ({ input, ctx })=>{\n    const response = new _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_7__.ResponseBuilder();\n    const { projectId, sceneId } = input;\n    const userId = ctx.session.user.id;\n    console.log(`[${response.getRequestId()}] Starting scene removal`, {\n        projectId,\n        sceneId\n    });\n    try {\n        // 1. Verify project ownership and scene existence\n        const scene = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, sceneId),\n            with: {\n                project: true\n            }\n        });\n        if (!scene || scene.project.userId !== userId) {\n            return response.error(_lib_types_api_universal__WEBPACK_IMPORTED_MODULE_8__.ErrorCode.NOT_FOUND, \"Scene not found or access denied\", 'scene.delete', 'scene');\n        }\n        // 2. Delete the scene\n        await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.id, sceneId));\n        console.log(`[${response.getRequestId()}] Scene deleted successfully`);\n        // 3. Return success response\n        return response.success({\n            deletedId: sceneId\n        }, 'scene.delete', 'scene', [\n            sceneId\n        ]);\n    } catch (error) {\n        console.error(`[${response.getRequestId()}] Scene removal error:`, error);\n        const errorCode = (0,_lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_7__.getErrorCode)(error);\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n        return response.error(errorCode, errorMessage, 'scene.delete', 'scene');\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vc2NlbmUtb3BlcmF0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0I7QUFDK0I7QUFDakI7QUFDd0I7QUFDbEI7QUFDNEI7QUFDakI7QUFFUztBQUNaO0FBRXBELDhDQUE4QztBQUM2QjtBQUVyQjtBQUV0RDs7Q0FFQyxHQUNNLE1BQU1nQixnQkFBZ0JmLGdFQUFrQkEsQ0FDNUNnQixLQUFLLENBQUNqQixrQ0FBQ0EsQ0FBQ2tCLE1BQU0sQ0FBQztJQUNkQyxXQUFXbkIsa0NBQUNBLENBQUNvQixNQUFNO0lBQ25CQyxhQUFhckIsa0NBQUNBLENBQUNvQixNQUFNO0lBQ3JCRSxhQUFhdEIsa0NBQUNBLENBQUNrQixNQUFNLENBQUM7UUFDcEJLLFdBQVd2QixrQ0FBQ0EsQ0FBQ3dCLEtBQUssQ0FBQ3hCLGtDQUFDQSxDQUFDb0IsTUFBTSxJQUFJSyxRQUFRO0lBQ3pDLEdBQUdBLFFBQVE7SUFDWEMsb0JBQW9CMUIsa0NBQUNBLENBQUNvQixNQUFNLEdBQUdLLFFBQVE7QUFDekMsSUFDQ0UsUUFBUSxDQUFDLE9BQU8sRUFBRVYsS0FBSyxFQUFFVyxHQUFHLEVBQUU7SUFDN0IsTUFBTUMsV0FBVyxJQUFJaEIsc0VBQWVBO0lBQ3BDLE1BQU0sRUFBRU0sU0FBUyxFQUFFRSxXQUFXLEVBQUVDLFdBQVcsRUFBRSxHQUFHTDtJQUNoRCxNQUFNYSxTQUFTRixJQUFJRyxPQUFPLENBQUNDLElBQUksQ0FBQ0MsRUFBRTtJQUVsQ0MsUUFBUUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFTixTQUFTTyxZQUFZLEdBQUcsMkJBQTJCLENBQUMsRUFBRTtRQUFFakI7UUFBV0U7SUFBWTtJQUUvRixJQUFJO1FBQ0YsOEJBQThCO1FBQzlCLE1BQU1nQixVQUFVLE1BQU1uQyxnREFBRUEsQ0FBQ29DLEtBQUssQ0FBQ2xDLFFBQVEsQ0FBQ21DLFNBQVMsQ0FBQztZQUNoREMsT0FBT2pD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QVNZLEtBQUssQ0FDbkJrRCxXQUNBQyxjQUNBLGdCQUNBO0lBRUo7QUFDRixHQUFHIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vc2NlbmUtb3BlcmF0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuaW1wb3J0IHsgcHJvdGVjdGVkUHJvY2VkdXJlIH0gZnJvbSBcIn4vc2VydmVyL2FwaS90cnBjXCI7XG5pbXBvcnQgeyBkYiB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBzY2VuZXMsIHByb2plY3RzLCBtZXNzYWdlcyB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBlcSwgYW5kLCBkZXNjIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBtZXNzYWdlU2VydmljZSB9IGZyb20gXCJ+L3NlcnZlci9zZXJ2aWNlcy9kYXRhL21lc3NhZ2Uuc2VydmljZVwiO1xuaW1wb3J0IHsgb3JjaGVzdHJhdG9yIH0gZnJvbSBcIn4vYnJhaW4vb3JjaGVzdHJhdG9yTkVXXCI7XG5pbXBvcnQgdHlwZSB7IEJyYWluRGVjaXNpb24gfSBmcm9tIFwifi9saWIvdHlwZXMvYWkvYnJhaW4udHlwZXNcIjtcbmltcG9ydCB7IFRPT0xfT1BFUkFUSU9OX01BUCB9IGZyb20gXCJ+L2xpYi90eXBlcy9haS9icmFpbi50eXBlc1wiO1xuaW1wb3J0IHsgZXhlY3V0ZVRvb2xGcm9tRGVjaXNpb24gfSBmcm9tIFwiLi9oZWxwZXJzXCI7XG5cbi8vIEltcG9ydCB1bml2ZXJzYWwgcmVzcG9uc2UgdHlwZXMgYW5kIGhlbHBlcnNcbmltcG9ydCB7IFJlc3BvbnNlQnVpbGRlciwgZ2V0RXJyb3JDb2RlIH0gZnJvbSBcIn4vbGliL2FwaS9yZXNwb25zZS1oZWxwZXJzXCI7XG5pbXBvcnQgdHlwZSB7IFNjZW5lQ3JlYXRlUmVzcG9uc2UsIFNjZW5lRGVsZXRlUmVzcG9uc2UgfSBmcm9tIFwifi9saWIvdHlwZXMvYXBpL3VuaXZlcnNhbFwiO1xuaW1wb3J0IHsgRXJyb3JDb2RlIH0gZnJvbSBcIn4vbGliL3R5cGVzL2FwaS91bml2ZXJzYWxcIjtcblxuLyoqXG4gKiBVTklGSUVEIFNDRU5FIEdFTkVSQVRJT04gd2l0aCBVbml2ZXJzYWwgUmVzcG9uc2VcbiAqL1xuZXhwb3J0IGNvbnN0IGdlbmVyYXRlU2NlbmUgPSBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgLmlucHV0KHoub2JqZWN0KHtcbiAgICBwcm9qZWN0SWQ6IHouc3RyaW5nKCksXG4gICAgdXNlck1lc3NhZ2U6IHouc3RyaW5nKCksXG4gICAgdXNlckNvbnRleHQ6IHoub2JqZWN0KHtcbiAgICAgIGltYWdlVXJsczogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLFxuICAgIH0pLm9wdGlvbmFsKCksXG4gICAgYXNzaXN0YW50TWVzc2FnZUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIEZvciB1cGRhdGluZyBleGlzdGluZyBtZXNzYWdlXG4gIH0pKVxuICAubXV0YXRpb24oYXN5bmMgKHsgaW5wdXQsIGN0eCB9KTogUHJvbWlzZTxTY2VuZUNyZWF0ZVJlc3BvbnNlPiA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgUmVzcG9uc2VCdWlsZGVyKCk7XG4gICAgY29uc3QgeyBwcm9qZWN0SWQsIHVzZXJNZXNzYWdlLCB1c2VyQ29udGV4dCB9ID0gaW5wdXQ7XG4gICAgY29uc3QgdXNlcklkID0gY3R4LnNlc3Npb24udXNlci5pZDtcblxuICAgIGNvbnNvbGUubG9nKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIFN0YXJ0aW5nIHNjZW5lIGdlbmVyYXRpb25gLCB7IHByb2plY3RJZCwgdXNlck1lc3NhZ2UgfSk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gMS4gVmVyaWZ5IHByb2plY3Qgb3duZXJzaGlwXG4gICAgICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgZGIucXVlcnkucHJvamVjdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgICBlcShwcm9qZWN0cy5pZCwgcHJvamVjdElkKSxcbiAgICAgICAgICBlcShwcm9qZWN0cy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXByb2plY3QpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmVycm9yKFxuICAgICAgICAgIEVycm9yQ29kZS5OT1RfRk9VTkQsXG4gICAgICAgICAgXCJQcm9qZWN0IG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkXCIsXG4gICAgICAgICAgJ3NjZW5lLmNyZWF0ZScsXG4gICAgICAgICAgJ3NjZW5lJ1xuICAgICAgICApIGFzIGFueSBhcyBTY2VuZUNyZWF0ZVJlc3BvbnNlO1xuICAgICAgfVxuXG4gICAgICAvLyAyLiBCdWlsZCBzdG9yeWJvYXJkIGNvbnRleHRcbiAgICAgIGxldCBzdG9yeWJvYXJkRm9yQnJhaW46IEFycmF5PHtcbiAgICAgICAgaWQ6IHN0cmluZztcbiAgICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgICBkdXJhdGlvbjogbnVtYmVyO1xuICAgICAgICBvcmRlcjogbnVtYmVyO1xuICAgICAgICB0c3hDb2RlOiBzdHJpbmc7XG4gICAgICB9PiA9IFtdO1xuICAgICAgXG4gICAgICAvLyBHZXQgZXhpc3Rpbmcgc2NlbmVzIGZpcnN0XG4gICAgICBjb25zdCBleGlzdGluZ1NjZW5lcyA9IGF3YWl0IGRiLnF1ZXJ5LnNjZW5lcy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiBlcShzY2VuZXMucHJvamVjdElkLCBwcm9qZWN0SWQpLFxuICAgICAgICBvcmRlckJ5OiBbc2NlbmVzLm9yZGVyXSxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAocHJvamVjdC5pc1dlbGNvbWUgJiYgZXhpc3RpbmdTY2VuZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIEZpcnN0IHJlYWwgc2NlbmUgLSBjbGVhciB3ZWxjb21lIGZsYWdcbiAgICAgICAgY29uc29sZS5sb2coYFske3Jlc3BvbnNlLmdldFJlcXVlc3RJZCgpfV0gRmlyc3QgcmVhbCBzY2VuZSAtIGNsZWFyaW5nIHdlbGNvbWUgZmxhZ2ApO1xuICAgICAgICBhd2FpdCBkYi51cGRhdGUocHJvamVjdHMpXG4gICAgICAgICAgLnNldCh7IGlzV2VsY29tZTogZmFsc2UgfSlcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIHByb2plY3RJZCkpO1xuICAgICAgICBcbiAgICAgICAgc3Rvcnlib2FyZEZvckJyYWluID0gW107XG4gICAgICB9IGVsc2UgaWYgKHByb2plY3QuaXNXZWxjb21lICYmIGV4aXN0aW5nU2NlbmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gV2VsY29tZSBwcm9qZWN0IGJ1dCBoYXMgc2NlbmVzIGFscmVhZHkgLSBqdXN0IGNsZWFyIHRoZSBmbGFnXG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIFdlbGNvbWUgcHJvamVjdCB3aXRoIHNjZW5lcyAtIGNsZWFyaW5nIGZsYWcgb25seWApO1xuICAgICAgICBhd2FpdCBkYi51cGRhdGUocHJvamVjdHMpXG4gICAgICAgICAgLnNldCh7IGlzV2VsY29tZTogZmFsc2UgfSlcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIHByb2plY3RJZCkpO1xuICAgICAgICBcbiAgICAgICAgc3Rvcnlib2FyZEZvckJyYWluID0gZXhpc3RpbmdTY2VuZXMubWFwKHNjZW5lID0+ICh7XG4gICAgICAgICAgaWQ6IHNjZW5lLmlkLFxuICAgICAgICAgIG5hbWU6IHNjZW5lLm5hbWUsXG4gICAgICAgICAgZHVyYXRpb246IHNjZW5lLmR1cmF0aW9uLFxuICAgICAgICAgIG9yZGVyOiBzY2VuZS5vcmRlcixcbiAgICAgICAgICB0c3hDb2RlOiBzY2VuZS50c3hDb2RlLFxuICAgICAgICB9KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOb3JtYWwgcHJvamVjdCB3aXRoIHNjZW5lc1xuICAgICAgICBzdG9yeWJvYXJkRm9yQnJhaW4gPSBleGlzdGluZ1NjZW5lcy5tYXAoc2NlbmUgPT4gKHtcbiAgICAgICAgICBpZDogc2NlbmUuaWQsXG4gICAgICAgICAgbmFtZTogc2NlbmUubmFtZSxcbiAgICAgICAgICBkdXJhdGlvbjogc2NlbmUuZHVyYXRpb24sXG4gICAgICAgICAgb3JkZXI6IHNjZW5lLm9yZGVyLFxuICAgICAgICAgIHRzeENvZGU6IHNjZW5lLnRzeENvZGUsXG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgLy8gMy4gR2V0IGNoYXQgaGlzdG9yeVxuICAgICAgY29uc3QgcmVjZW50TWVzc2FnZXMgPSBhd2FpdCBkYi5xdWVyeS5tZXNzYWdlcy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiBlcShtZXNzYWdlcy5wcm9qZWN0SWQsIHByb2plY3RJZCksXG4gICAgICAgIG9yZGVyQnk6IFtkZXNjKG1lc3NhZ2VzLnNlcXVlbmNlKV0sXG4gICAgICAgIGxpbWl0OiAxMCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjaGF0SGlzdG9yeSA9IHJlY2VudE1lc3NhZ2VzLnJldmVyc2UoKS5tYXAobXNnID0+ICh7XG4gICAgICAgIHJvbGU6IG1zZy5yb2xlLFxuICAgICAgICBjb250ZW50OiBtc2cuY29udGVudFxuICAgICAgfSkpO1xuXG4gICAgICAvLyA0LiBTdG9yZSB1c2VyIG1lc3NhZ2VcbiAgICAgIGF3YWl0IG1lc3NhZ2VTZXJ2aWNlLmNyZWF0ZU1lc3NhZ2Uoe1xuICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgIGNvbnRlbnQ6IHVzZXJNZXNzYWdlLFxuICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgaW1hZ2VVcmxzOiAodXNlckNvbnRleHQ/LmltYWdlVXJscyBhcyBzdHJpbmdbXSkgfHwgW10sXG4gICAgICB9KTtcblxuICAgICAgLy8gNS4gR2V0IGRlY2lzaW9uIGZyb20gYnJhaW5cbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIEdldHRpbmcgZGVjaXNpb24gZnJvbSBicmFpbi4uLmApO1xuICAgICAgY29uc3Qgb3JjaGVzdHJhdG9yUmVzcG9uc2UgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1VzZXJJbnB1dCh7XG4gICAgICAgIHByb21wdDogdXNlck1lc3NhZ2UsXG4gICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBzdG9yeWJvYXJkU29GYXI6IHN0b3J5Ym9hcmRGb3JCcmFpbixcbiAgICAgICAgY2hhdEhpc3RvcnksXG4gICAgICAgIHVzZXJDb250ZXh0OiB7XG4gICAgICAgICAgaW1hZ2VVcmxzOiB1c2VyQ29udGV4dD8uaW1hZ2VVcmxzLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghb3JjaGVzdHJhdG9yUmVzcG9uc2Uuc3VjY2VzcyB8fCAhb3JjaGVzdHJhdG9yUmVzcG9uc2UucmVzdWx0KSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5lcnJvcihcbiAgICAgICAgICBFcnJvckNvZGUuQUlfRVJST1IsXG4gICAgICAgICAgb3JjaGVzdHJhdG9yUmVzcG9uc2UuZXJyb3IgfHwgXCJGYWlsZWQgdG8gZ2V0IGRlY2lzaW9uIGZyb20gYnJhaW5cIixcbiAgICAgICAgICAnc2NlbmUuY3JlYXRlJyxcbiAgICAgICAgICAnc2NlbmUnXG4gICAgICAgICkgYXMgYW55IGFzIFNjZW5lQ3JlYXRlUmVzcG9uc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0b29sTmFtZTogb3JjaGVzdHJhdG9yUmVzcG9uc2UucmVzdWx0LnRvb2xOYW1lLFxuICAgICAgICB0b29sQ29udGV4dDogb3JjaGVzdHJhdG9yUmVzcG9uc2UucmVzdWx0LnRvb2xDb250ZXh0LFxuICAgICAgICByZWFzb25pbmc6IG9yY2hlc3RyYXRvclJlc3BvbnNlLnJlYXNvbmluZyxcbiAgICAgICAgY2hhdFJlc3BvbnNlOiBvcmNoZXN0cmF0b3JSZXNwb25zZS5jaGF0UmVzcG9uc2UsXG4gICAgICB9O1xuXG4gICAgICAvLyA2LiBDcmVhdGUgYXNzaXN0YW50J3MgcmVzcG9uc2UgRklSU1QgKGJlZm9yZSB0b29sIGV4ZWN1dGlvbilcbiAgICAgIC8vIFRoaXMgZW5zdXJlcyBwcm9wZXIgbWVzc2FnZSBvcmRlcmluZyBpbiB0aGUgZGF0YWJhc2VcbiAgICAgIGxldCBhc3Npc3RhbnRNZXNzYWdlSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgIGlmIChkZWNpc2lvbi5jaGF0UmVzcG9uc2UpIHtcbiAgICAgICAgY29uc3QgbmV3QXNzaXN0YW50TWVzc2FnZSA9IGF3YWl0IG1lc3NhZ2VTZXJ2aWNlLmNyZWF0ZU1lc3NhZ2Uoe1xuICAgICAgICAgIGlkOiBpbnB1dC5hc3Npc3RhbnRNZXNzYWdlSWQsIC8vIFVzZSB0aGUgSUQgZnJvbSBTU0UgaWYgcHJvdmlkZWRcbiAgICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgICAgY29udGVudDogZGVjaXNpb24uY2hhdFJlc3BvbnNlLFxuICAgICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgICAgc3RhdHVzOiBcInBlbmRpbmdcIiwgLy8gU3RhcnQgYXMgcGVuZGluZywgdXBkYXRlIHRvIHN1Y2Nlc3MgYWZ0ZXIgdG9vbCBleGVjdXRpb25cbiAgICAgICAgfSk7XG4gICAgICAgIGFzc2lzdGFudE1lc3NhZ2VJZCA9IG5ld0Fzc2lzdGFudE1lc3NhZ2U/LmlkO1xuICAgICAgfVxuXG4gICAgICAvLyA3LiBFeGVjdXRlIHRoZSB0b29sXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBFeGVjdXRpbmcgdG9vbDogJHtkZWNpc2lvbi50b29sTmFtZX1gKTtcbiAgICAgIGNvbnN0IHRvb2xSZXN1bHQgPSBhd2FpdCBleGVjdXRlVG9vbEZyb21EZWNpc2lvbihcbiAgICAgICAgZGVjaXNpb24sXG4gICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBzdG9yeWJvYXJkRm9yQnJhaW4sXG4gICAgICAgIGFzc2lzdGFudE1lc3NhZ2VJZCAvLyBQYXNzIHRoZSBhY3R1YWwgbWVzc2FnZSBJRCBmb3IgaXRlcmF0aW9uIHRyYWNraW5nXG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBUb29sIGV4ZWN1dGlvbiByZXN1bHQ6YCwge1xuICAgICAgICBzdWNjZXNzOiB0b29sUmVzdWx0LnN1Y2Nlc3MsXG4gICAgICAgIGhhc1NjZW5lOiAhIXRvb2xSZXN1bHQuc2NlbmUsXG4gICAgICAgIHNjZW5lSWQ6IHRvb2xSZXN1bHQuc2NlbmU/LmlkLFxuICAgICAgICBzY2VuZU5hbWU6IHRvb2xSZXN1bHQuc2NlbmU/Lm5hbWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gOC4gVXBkYXRlIGFzc2lzdGFudCBtZXNzYWdlIHN0YXR1cyBhZnRlciBleGVjdXRpb25cbiAgICAgIGlmIChhc3Npc3RhbnRNZXNzYWdlSWQgJiYgdG9vbFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGF3YWl0IGRiLnVwZGF0ZShtZXNzYWdlcylcbiAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGVxKG1lc3NhZ2VzLmlkLCBhc3Npc3RhbnRNZXNzYWdlSWQpKTtcbiAgICAgIH1cblxuICAgICAgLy8gOS4gUmV0dXJuIHVuaXZlcnNhbCByZXNwb25zZVxuICAgICAgaWYgKCF0b29sUmVzdWx0LnNjZW5lKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5lcnJvcihcbiAgICAgICAgICBFcnJvckNvZGUuSU5URVJOQUxfRVJST1IsXG4gICAgICAgICAgXCJUb29sIGV4ZWN1dGlvbiBzdWNjZWVkZWQgYnV0IG5vIHNjZW5lIHdhcyBjcmVhdGVkXCIsXG4gICAgICAgICAgJ3NjZW5lLmNyZWF0ZScsXG4gICAgICAgICAgJ3NjZW5lJ1xuICAgICAgICApIGFzIGFueSBhcyBTY2VuZUNyZWF0ZVJlc3BvbnNlO1xuICAgICAgfVxuXG4gICAgICAvLyBTY2VuZSBpcyBhbHJlYWR5IGEgcHJvcGVyIFNjZW5lRW50aXR5IGZyb20gdGhlIGRhdGFiYXNlXG4gICAgICAvLyBEZXRlcm1pbmUgdGhlIGNvcnJlY3Qgb3BlcmF0aW9uIGJhc2VkIG9uIHRoZSB0b29sIHVzZWRcbiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGRlY2lzaW9uLnRvb2xOYW1lID8gVE9PTF9PUEVSQVRJT05fTUFQW2RlY2lzaW9uLnRvb2xOYW1lXSA6ICdzY2VuZS5jcmVhdGUnO1xuICAgICAgXG4gICAgICBjb25zdCBzdWNjZXNzUmVzcG9uc2UgPSByZXNwb25zZS5zdWNjZXNzKFxuICAgICAgICB0b29sUmVzdWx0LnNjZW5lLCBcbiAgICAgICAgb3BlcmF0aW9uLCBcbiAgICAgICAgJ3NjZW5lJywgXG4gICAgICAgIFt0b29sUmVzdWx0LnNjZW5lLmlkXVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQWRkIGNvbnRleHQgdG8gdGhlIHJlc3BvbnNlXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zdWNjZXNzUmVzcG9uc2UsXG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICByZWFzb25pbmc6IGRlY2lzaW9uLnJlYXNvbmluZyxcbiAgICAgICAgICBjaGF0UmVzcG9uc2U6IGRlY2lzaW9uLmNoYXRSZXNwb25zZSxcbiAgICAgICAgfSxcbiAgICAgIH0gYXMgU2NlbmVDcmVhdGVSZXNwb25zZTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIFNjZW5lIGdlbmVyYXRpb24gZXJyb3I6YCwgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBJZiB3ZSBoYXZlIGFuIGFzc2lzdGFudCBtZXNzYWdlIHRoYXQgd2FzIHBlbmRpbmcsIG1hcmsgaXQgYXMgZmFpbGVkXG4gICAgICBpZiAoaW5wdXQuYXNzaXN0YW50TWVzc2FnZUlkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgZGIudXBkYXRlKG1lc3NhZ2VzKVxuICAgICAgICAgICAgLnNldCh7XG4gICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVyZShlcShtZXNzYWdlcy5pZCwgaW5wdXQuYXNzaXN0YW50TWVzc2FnZUlkKSk7XG4gICAgICAgIH0gY2F0Y2ggKHVwZGF0ZUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBGYWlsZWQgdG8gdXBkYXRlIG1lc3NhZ2Ugc3RhdHVzOmAsIHVwZGF0ZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBlcnJvckNvZGUgPSBnZXRFcnJvckNvZGUoZXJyb3IpO1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCc7XG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZS5lcnJvcihcbiAgICAgICAgZXJyb3JDb2RlLFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICAgICdzY2VuZS5jcmVhdGUnLFxuICAgICAgICAnc2NlbmUnXG4gICAgICApIGFzIGFueSBhcyBTY2VuZUNyZWF0ZVJlc3BvbnNlO1xuICAgIH1cbiAgfSk7XG5cbi8qKlxuICogU0NFTkUgUkVNT1ZBTCB3aXRoIFVuaXZlcnNhbCBSZXNwb25zZVxuICovXG5leHBvcnQgY29uc3QgcmVtb3ZlU2NlbmUgPSBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgLmlucHV0KHoub2JqZWN0KHtcbiAgICBwcm9qZWN0SWQ6IHouc3RyaW5nKCksXG4gICAgc2NlbmVJZDogei5zdHJpbmcoKSxcbiAgfSkpXG4gIC5tdXRhdGlvbihhc3luYyAoeyBpbnB1dCwgY3R4IH0pOiBQcm9taXNlPFNjZW5lRGVsZXRlUmVzcG9uc2U+ID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IG5ldyBSZXNwb25zZUJ1aWxkZXIoKTtcbiAgICBjb25zdCB7IHByb2plY3RJZCwgc2NlbmVJZCB9ID0gaW5wdXQ7XG4gICAgY29uc3QgdXNlcklkID0gY3R4LnNlc3Npb24udXNlci5pZDtcblxuICAgIGNvbnNvbGUubG9nKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIFN0YXJ0aW5nIHNjZW5lIHJlbW92YWxgLCB7IHByb2plY3RJZCwgc2NlbmVJZCB9KTtcblxuICAgIHRyeSB7XG4gICAgICAvLyAxLiBWZXJpZnkgcHJvamVjdCBvd25lcnNoaXAgYW5kIHNjZW5lIGV4aXN0ZW5jZVxuICAgICAgY29uc3Qgc2NlbmUgPSBhd2FpdCBkYi5xdWVyeS5zY2VuZXMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGVxKHNjZW5lcy5pZCwgc2NlbmVJZCksXG4gICAgICAgIHdpdGg6IHtcbiAgICAgICAgICBwcm9qZWN0OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghc2NlbmUgfHwgc2NlbmUucHJvamVjdC51c2VySWQgIT09IHVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZXJyb3IoXG4gICAgICAgICAgRXJyb3JDb2RlLk5PVF9GT1VORCxcbiAgICAgICAgICBcIlNjZW5lIG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkXCIsXG4gICAgICAgICAgJ3NjZW5lLmRlbGV0ZScsXG4gICAgICAgICAgJ3NjZW5lJ1xuICAgICAgICApIGFzIGFueSBhcyBTY2VuZURlbGV0ZVJlc3BvbnNlO1xuICAgICAgfVxuXG4gICAgICAvLyAyLiBEZWxldGUgdGhlIHNjZW5lXG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NlbmVzKS53aGVyZShlcShzY2VuZXMuaWQsIHNjZW5lSWQpKTtcblxuICAgICAgY29uc29sZS5sb2coYFske3Jlc3BvbnNlLmdldFJlcXVlc3RJZCgpfV0gU2NlbmUgZGVsZXRlZCBzdWNjZXNzZnVsbHlgKTtcblxuICAgICAgLy8gMy4gUmV0dXJuIHN1Y2Nlc3MgcmVzcG9uc2VcbiAgICAgIHJldHVybiByZXNwb25zZS5zdWNjZXNzKFxuICAgICAgICB7IGRlbGV0ZWRJZDogc2NlbmVJZCB9LFxuICAgICAgICAnc2NlbmUuZGVsZXRlJyxcbiAgICAgICAgJ3NjZW5lJyxcbiAgICAgICAgW3NjZW5lSWRdXG4gICAgICApIGFzIFNjZW5lRGVsZXRlUmVzcG9uc2U7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBTY2VuZSByZW1vdmFsIGVycm9yOmAsIGVycm9yKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXJyb3JDb2RlID0gZ2V0RXJyb3JDb2RlKGVycm9yKTtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2UuZXJyb3IoXG4gICAgICAgIGVycm9yQ29kZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgICAnc2NlbmUuZGVsZXRlJyxcbiAgICAgICAgJ3NjZW5lJ1xuICAgICAgKSBhcyBhbnkgYXMgU2NlbmVEZWxldGVSZXNwb25zZTtcbiAgICB9XG4gIH0pOyJdLCJuYW1lcyI6WyJ6IiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiZGIiLCJzY2VuZXMiLCJwcm9qZWN0cyIsIm1lc3NhZ2VzIiwiZXEiLCJhbmQiLCJkZXNjIiwibWVzc2FnZVNlcnZpY2UiLCJvcmNoZXN0cmF0b3IiLCJUT09MX09QRVJBVElPTl9NQVAiLCJleGVjdXRlVG9vbEZyb21EZWNpc2lvbiIsIlJlc3BvbnNlQnVpbGRlciIsImdldEVycm9yQ29kZSIsIkVycm9yQ29kZSIsImdlbmVyYXRlU2NlbmUiLCJpbnB1dCIsIm9iamVjdCIsInByb2plY3RJZCIsInN0cmluZyIsInVzZXJNZXNzYWdlIiwidXNlckNvbnRleHQiLCJpbWFnZVVybHMiLCJhcnJheSIsIm9wdGlvbmFsIiwiYXNzaXN0YW50TWVzc2FnZUlkIiwibXV0YXRpb24iLCJjdHgiLCJyZXNwb25zZSIsInVzZXJJZCIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJjb25zb2xlIiwibG9nIiwiZ2V0UmVxdWVzdElkIiwicHJvamVjdCIsInF1ZXJ5IiwiZmluZEZpcnN0Iiwid2hlcmUiLCJlcnJvciIsIk5PVF9GT1VORCIsInN0b3J5Ym9hcmRGb3JCcmFpbiIsImV4aXN0aW5nU2NlbmVzIiwiZmluZE1hbnkiLCJvcmRlckJ5Iiwib3JkZXIiLCJpc1dlbGNvbWUiLCJsZW5ndGgiLCJ1cGRhdGUiLCJzZXQiLCJtYXAiLCJzY2VuZSIsIm5hbWUiLCJkdXJhdGlvbiIsInRzeENvZGUiLCJyZWNlbnRNZXNzYWdlcyIsInNlcXVlbmNlIiwibGltaXQiLCJjaGF0SGlzdG9yeSIsInJldmVyc2UiLCJtc2ciLCJyb2xlIiwiY29udGVudCIsImNyZWF0ZU1lc3NhZ2UiLCJvcmNoZXN0cmF0b3JSZXNwb25zZSIsInByb2Nlc3NVc2VySW5wdXQiLCJwcm9tcHQiLCJzdG9yeWJvYXJkU29GYXIiLCJzdWNjZXNzIiwicmVzdWx0IiwiQUlfRVJST1IiLCJkZWNpc2lvbiIsInRvb2xOYW1lIiwidG9vbENvbnRleHQiLCJyZWFzb25pbmciLCJjaGF0UmVzcG9uc2UiLCJuZXdBc3Npc3RhbnRNZXNzYWdlIiwic3RhdHVzIiwidG9vbFJlc3VsdCIsImhhc1NjZW5lIiwic2NlbmVJZCIsInNjZW5lTmFtZSIsInVwZGF0ZWRBdCIsIkRhdGUiLCJJTlRFUk5BTF9FUlJPUiIsIm9wZXJhdGlvbiIsInN1Y2Nlc3NSZXNwb25zZSIsImNvbnRleHQiLCJ1cGRhdGVFcnJvciIsImVycm9yQ29kZSIsImVycm9yTWVzc2FnZSIsIkVycm9yIiwibWVzc2FnZSIsInJlbW92ZVNjZW5lIiwid2l0aCIsImRlbGV0ZSIsImRlbGV0ZWRJZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/generation/scene-operations.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/generation/template-operations.ts":
/*!******************************************************************!*\
  !*** ./src/server/api/routers/generation/template-operations.ts ***!
  \******************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addTemplate: () => (/* binding */ addTemplate)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/server/services/data/message.service */ \"(rsc)/./src/server/services/data/message.service.ts\");\n/* harmony import */ var _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/lib/api/response-helpers */ \"(rsc)/./src/lib/api/response-helpers.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__, _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__, _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n/**\n * ADD TEMPLATE - Add a pre-made template as a new scene\n */ const addTemplate = _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_5__.z.object({\n    projectId: zod__WEBPACK_IMPORTED_MODULE_5__.z.string(),\n    templateId: zod__WEBPACK_IMPORTED_MODULE_5__.z.string(),\n    templateName: zod__WEBPACK_IMPORTED_MODULE_5__.z.string(),\n    templateCode: zod__WEBPACK_IMPORTED_MODULE_5__.z.string(),\n    templateDuration: zod__WEBPACK_IMPORTED_MODULE_5__.z.number()\n})).mutation(async ({ input, ctx })=>{\n    const response = new _lib_api_response_helpers__WEBPACK_IMPORTED_MODULE_4__.ResponseBuilder();\n    const { projectId, templateId, templateName, templateCode, templateDuration } = input;\n    const userId = ctx.session.user.id;\n    console.log(`[${response.getRequestId()}] Adding template`, {\n        projectId,\n        templateId,\n        templateName\n    });\n    try {\n        // 1. Verify project ownership\n        const project = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.projects.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, userId))\n        });\n        if (!project) {\n            return {\n                success: false,\n                message: \"Project not found or access denied\"\n            };\n        }\n        // 2. Get current scene count for order\n        const existingScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.query.scenes.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes.projectId, projectId)\n        });\n        const sceneOrder = existingScenes.length;\n        // 3. Generate a unique scene name\n        const sceneName = `${templateName}-${Date.now().toString(36)}`;\n        // 4. Save template as a new scene\n        console.log(`[${response.getRequestId()}] Saving template to database`, {\n            name: sceneName,\n            order: sceneOrder,\n            duration: templateDuration\n        });\n        const [newScene] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenes).values({\n            projectId,\n            name: sceneName,\n            tsxCode: templateCode,\n            duration: templateDuration,\n            order: sceneOrder,\n            props: {},\n            layoutJson: null\n        }).returning();\n        if (!newScene) {\n            return {\n                success: false,\n                message: \"Failed to save template to database\"\n            };\n        }\n        console.log(`[${response.getRequestId()}] Template saved successfully`, {\n            sceneId: newScene.id,\n            name: newScene.name\n        });\n        // 5. Clear welcome flag if this is the first scene\n        if (project.isWelcome && existingScenes.length === 0) {\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).set({\n                isWelcome: false\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, projectId));\n        }\n        // 6. Add chat message for context\n        await _server_services_data_message_service__WEBPACK_IMPORTED_MODULE_3__.messageService.createMessage({\n            projectId,\n            content: `Added template: ${templateName}`,\n            role: \"assistant\"\n        });\n        return {\n            success: true,\n            message: `Added ${templateName} template`,\n            scene: newScene\n        };\n    } catch (error) {\n        console.error(`[${response.getRequestId()}] Template addition error:`, error);\n        return {\n            success: false,\n            message: error instanceof Error ? error.message : 'Failed to add template'\n        };\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL2dlbmVyYXRpb24vdGVtcGxhdGUtb3BlcmF0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQXdCO0FBQytCO0FBQ2pCO0FBQ2M7QUFDZDtBQUNrQztBQUNYO0FBRTdEOztDQUVDLEdBQ00sTUFBTVMsY0FBY1IsZ0VBQWtCQSxDQUMxQ1MsS0FBSyxDQUFDVixrQ0FBQ0EsQ0FBQ1csTUFBTSxDQUFDO0lBQ2RDLFdBQVdaLGtDQUFDQSxDQUFDYSxNQUFNO0lBQ25CQyxZQUFZZCxrQ0FBQ0EsQ0FBQ2EsTUFBTTtJQUNwQkUsY0FBY2Ysa0NBQUNBLENBQUNhLE1BQU07SUFDdEJHLGNBQWNoQixrQ0FBQ0EsQ0FBQ2EsTUFBTTtJQUN0Qkksa0JBQWtCakIsa0NBQUNBLENBQUNrQixNQUFNO0FBQzVCLElBQ0NDLFFBQVEsQ0FBQyxPQUFPLEVBQUVULEtBQUssRUFBRVUsR0FBRyxFQUFFO0lBQzdCLE1BQU1DLFdBQVcsSUFBSWIsc0VBQWVBO0lBQ3BDLE1BQU0sRUFBRUksU0FBUyxFQUFFRSxVQUFVLEVBQUVDLFlBQVksRUFBRUMsWUFBWSxFQUFFQyxnQkFBZ0IsRUFBRSxHQUFHUDtJQUNoRixNQUFNWSxTQUFTRixJQUFJRyxPQUFPLENBQUNDLElBQUksQ0FBQ0MsRUFBRTtJQUVsQ0MsUUFBUUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFTixTQUFTTyxZQUFZLEdBQUcsaUJBQWlCLENBQUMsRUFBRTtRQUFFaEI7UUFBV0U7UUFBWUM7SUFBYTtJQUVsRyxJQUFJO1FBQ0YsOEJBQThCO1FBQzlCLE1BQU1jLFVBQVUsTUFBTTNCLGdEQUFFQSxDQUFDNEIsS0FBSyxDQUFDMUIsUUFBUSxDQUFDMkIsU0FBUyxDQUFDO1lBQ2hEQyxPQUFPMUIsZ0RBQUdBLENBQ1JELCtDQUFFQSxDQUFDRCxzREFBUUEsQ0FBQ3FCLEVBQUUsRUFBRWIsWUFDaEJQLCtDQUFFQSxDQUFDRCxzREFBUUEsQ0FBQ2tCLE1BQU0sRUFBRUE7UUFFeEI7UUFFQSxJQUFJLENBQUNPLFNBQVM7WUFDWixPQUFPO2dCQUNMSSxTQUFTO2dCQUNUQyxTQUFTO1lBQ1g7UUFDRjtRQUVBLHVDQUF1QztRQUN2QyxNQUFNQyxpQkFBaUIsTUFBTWpDLGdEQUFFQSxDQUFDNEIsS0FBSyxDQUFDM0IsTUFBTSxDQUFDaUMsUUFBUSxDQUFDO1lBQ3BESixPQUFPM0IsK0NBQUVBLENBQUNGLG9EQUFNQSxDQUFDUyxTQUFTLEVBQUVBO1FBQzlCO1FBRUEsTUFBTXlCLGFBQWFGLGVBQWVHLE1BQU07UUFFeEMsa0NBQWtDO1FBQ2xDLE1BQU1DLFlBQVksR0FBR3hCLGFBQWEsQ0FBQyxFQUFFeUIsS0FBS0MsR0FBRyxHQUFHQyxRQUFRLENBQUMsS0FBSztRQUU5RCxrQ0FBa0M7UUFDbENoQixRQUFRQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUVOLFNBQVNPLFlBQVksR0FBRyw2QkFBNkIsQ0FBQyxFQUFFO1lBQ3RFZSxNQUFNSjtZQUNOSyxPQUFPUDtZQUNQUSxVQUFVNUI7UUFDWjtRQUVBLE1BQU0sQ0FBQzZCLFNBQVMsR0FBRyxNQUFNNUMsZ0RBQUVBLENBQUM2QyxNQUFNLENBQUM1QyxvREFBTUEsRUFBRTZDLE1BQU0sQ0FBQztZQUNoRHBDO1lBQ0ErQixNQUFNSjtZQUNOVSxTQUFTakM7WUFDVDZCLFVBQVU1QjtZQUNWMkIsT0FBT1A7WUFDUGEsT0FBTyxDQUFDO1lBQ1JDLFlBQVk7UUFDZCxHQUFHQyxTQUFTO1FBRVosSUFBSSxDQUFDTixVQUFVO1lBQ2IsT0FBTztnQkFDTGIsU0FBUztnQkFDVEMsU0FBUztZQUNYO1FBQ0Y7UUFFQVIsUUFBUUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFTixTQUFTTyxZQUFZLEdBQUcsNkJBQTZCLENBQUMsRUFBRTtZQUN0RXlCLFNBQVNQLFNBQVNyQixFQUFFO1lBQ3BCa0IsTUFBTUcsU0FBU0gsSUFBSTtRQUNyQjtRQUVBLG1EQUFtRDtRQUNuRCxJQUFJZCxRQUFReUIsU0FBUyxJQUFJbkIsZUFBZUcsTUFBTSxLQUFLLEdBQUc7WUFDcEQsTUFBTXBDLGdEQUFFQSxDQUFDcUQsTUFBTSxDQUFDbkQsc0RBQVFBLEVBQ3JCb0QsR0FBRyxDQUFDO2dCQUFFRixXQUFXO1lBQU0sR0FDdkJ0QixLQUFLLENBQUMzQiwrQ0FBRUEsQ0FBQ0Qsc0RBQVFBLENBQUNxQixFQUFFLEVBQUViO1FBQzNCO1FBRUEsa0NBQWtDO1FBQ2xDLE1BQU1MLGlGQUFjQSxDQUFDa0QsYUFBYSxDQUFDO1lBQ2pDN0M7WUFDQThDLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRTNDLGNBQWM7WUFDMUM0QyxNQUFNO1FBQ1I7UUFFQSxPQUFPO1lBQ0wxQixTQUFTO1lBQ1RDLFNBQVMsQ0FBQyxNQUFNLEVBQUVuQixhQUFhLFNBQVMsQ0FBQztZQUN6QzZDLE9BQU9kO1FBQ1Q7SUFFRixFQUFFLE9BQU9lLE9BQU87UUFDZG5DLFFBQVFtQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUV4QyxTQUFTTyxZQUFZLEdBQUcsMEJBQTBCLENBQUMsRUFBRWlDO1FBRXZFLE9BQU87WUFDTDVCLFNBQVM7WUFDVEMsU0FBUzJCLGlCQUFpQkMsUUFBUUQsTUFBTTNCLE9BQU8sR0FBRztRQUNwRDtJQUNGO0FBQ0YsR0FBRyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3NlcnZlci9hcGkvcm91dGVycy9nZW5lcmF0aW9uL3RlbXBsYXRlLW9wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHByb3RlY3RlZFByb2NlZHVyZSB9IGZyb20gXCJ+L3NlcnZlci9hcGkvdHJwY1wiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgc2NlbmVzLCBwcm9qZWN0cyB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBlcSwgYW5kIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBtZXNzYWdlU2VydmljZSB9IGZyb20gXCJ+L3NlcnZlci9zZXJ2aWNlcy9kYXRhL21lc3NhZ2Uuc2VydmljZVwiO1xuaW1wb3J0IHsgUmVzcG9uc2VCdWlsZGVyIH0gZnJvbSBcIn4vbGliL2FwaS9yZXNwb25zZS1oZWxwZXJzXCI7XG5cbi8qKlxuICogQUREIFRFTVBMQVRFIC0gQWRkIGEgcHJlLW1hZGUgdGVtcGxhdGUgYXMgYSBuZXcgc2NlbmVcbiAqL1xuZXhwb3J0IGNvbnN0IGFkZFRlbXBsYXRlID0gcHJvdGVjdGVkUHJvY2VkdXJlXG4gIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgcHJvamVjdElkOiB6LnN0cmluZygpLFxuICAgIHRlbXBsYXRlSWQ6IHouc3RyaW5nKCksXG4gICAgdGVtcGxhdGVOYW1lOiB6LnN0cmluZygpLFxuICAgIHRlbXBsYXRlQ29kZTogei5zdHJpbmcoKSxcbiAgICB0ZW1wbGF0ZUR1cmF0aW9uOiB6Lm51bWJlcigpLFxuICB9KSlcbiAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0LCBjdHggfSkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gbmV3IFJlc3BvbnNlQnVpbGRlcigpO1xuICAgIGNvbnN0IHsgcHJvamVjdElkLCB0ZW1wbGF0ZUlkLCB0ZW1wbGF0ZU5hbWUsIHRlbXBsYXRlQ29kZSwgdGVtcGxhdGVEdXJhdGlvbiB9ID0gaW5wdXQ7XG4gICAgY29uc3QgdXNlcklkID0gY3R4LnNlc3Npb24udXNlci5pZDtcblxuICAgIGNvbnNvbGUubG9nKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIEFkZGluZyB0ZW1wbGF0ZWAsIHsgcHJvamVjdElkLCB0ZW1wbGF0ZUlkLCB0ZW1wbGF0ZU5hbWUgfSk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gMS4gVmVyaWZ5IHByb2plY3Qgb3duZXJzaGlwXG4gICAgICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgZGIucXVlcnkucHJvamVjdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgICBlcShwcm9qZWN0cy5pZCwgcHJvamVjdElkKSxcbiAgICAgICAgICBlcShwcm9qZWN0cy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXByb2plY3QpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIlByb2plY3Qgbm90IGZvdW5kIG9yIGFjY2VzcyBkZW5pZWRcIixcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gMi4gR2V0IGN1cnJlbnQgc2NlbmUgY291bnQgZm9yIG9yZGVyXG4gICAgICBjb25zdCBleGlzdGluZ1NjZW5lcyA9IGF3YWl0IGRiLnF1ZXJ5LnNjZW5lcy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiBlcShzY2VuZXMucHJvamVjdElkLCBwcm9qZWN0SWQpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHNjZW5lT3JkZXIgPSBleGlzdGluZ1NjZW5lcy5sZW5ndGg7XG5cbiAgICAgIC8vIDMuIEdlbmVyYXRlIGEgdW5pcXVlIHNjZW5lIG5hbWVcbiAgICAgIGNvbnN0IHNjZW5lTmFtZSA9IGAke3RlbXBsYXRlTmFtZX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKDM2KX1gO1xuXG4gICAgICAvLyA0LiBTYXZlIHRlbXBsYXRlIGFzIGEgbmV3IHNjZW5lXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBTYXZpbmcgdGVtcGxhdGUgdG8gZGF0YWJhc2VgLCB7XG4gICAgICAgIG5hbWU6IHNjZW5lTmFtZSxcbiAgICAgICAgb3JkZXI6IHNjZW5lT3JkZXIsXG4gICAgICAgIGR1cmF0aW9uOiB0ZW1wbGF0ZUR1cmF0aW9uLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IFtuZXdTY2VuZV0gPSBhd2FpdCBkYi5pbnNlcnQoc2NlbmVzKS52YWx1ZXMoe1xuICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgIG5hbWU6IHNjZW5lTmFtZSxcbiAgICAgICAgdHN4Q29kZTogdGVtcGxhdGVDb2RlLFxuICAgICAgICBkdXJhdGlvbjogdGVtcGxhdGVEdXJhdGlvbixcbiAgICAgICAgb3JkZXI6IHNjZW5lT3JkZXIsXG4gICAgICAgIHByb3BzOiB7fSxcbiAgICAgICAgbGF5b3V0SnNvbjogbnVsbCxcbiAgICAgIH0pLnJldHVybmluZygpO1xuXG4gICAgICBpZiAoIW5ld1NjZW5lKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gc2F2ZSB0ZW1wbGF0ZSB0byBkYXRhYmFzZVwiLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVzcG9uc2UuZ2V0UmVxdWVzdElkKCl9XSBUZW1wbGF0ZSBzYXZlZCBzdWNjZXNzZnVsbHlgLCB7XG4gICAgICAgIHNjZW5lSWQ6IG5ld1NjZW5lLmlkLFxuICAgICAgICBuYW1lOiBuZXdTY2VuZS5uYW1lLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIDUuIENsZWFyIHdlbGNvbWUgZmxhZyBpZiB0aGlzIGlzIHRoZSBmaXJzdCBzY2VuZVxuICAgICAgaWYgKHByb2plY3QuaXNXZWxjb21lICYmIGV4aXN0aW5nU2NlbmVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBhd2FpdCBkYi51cGRhdGUocHJvamVjdHMpXG4gICAgICAgICAgLnNldCh7IGlzV2VsY29tZTogZmFsc2UgfSlcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIHByb2plY3RJZCkpO1xuICAgICAgfVxuXG4gICAgICAvLyA2LiBBZGQgY2hhdCBtZXNzYWdlIGZvciBjb250ZXh0XG4gICAgICBhd2FpdCBtZXNzYWdlU2VydmljZS5jcmVhdGVNZXNzYWdlKHtcbiAgICAgICAgcHJvamVjdElkLFxuICAgICAgICBjb250ZW50OiBgQWRkZWQgdGVtcGxhdGU6ICR7dGVtcGxhdGVOYW1lfWAsXG4gICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYEFkZGVkICR7dGVtcGxhdGVOYW1lfSB0ZW1wbGF0ZWAsXG4gICAgICAgIHNjZW5lOiBuZXdTY2VuZSBhcyBhbnksIC8vIENhc3QgdG8gYXZvaWQgcHJvcHMgdHlwZSBpc3N1ZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXNwb25zZS5nZXRSZXF1ZXN0SWQoKX1dIFRlbXBsYXRlIGFkZGl0aW9uIGVycm9yOmAsIGVycm9yKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBhZGQgdGVtcGxhdGUnLFxuICAgICAgfTtcbiAgICB9XG4gIH0pOyJdLCJuYW1lcyI6WyJ6IiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiZGIiLCJzY2VuZXMiLCJwcm9qZWN0cyIsImVxIiwiYW5kIiwibWVzc2FnZVNlcnZpY2UiLCJSZXNwb25zZUJ1aWxkZXIiLCJhZGRUZW1wbGF0ZSIsImlucHV0Iiwib2JqZWN0IiwicHJvamVjdElkIiwic3RyaW5nIiwidGVtcGxhdGVJZCIsInRlbXBsYXRlTmFtZSIsInRlbXBsYXRlQ29kZSIsInRlbXBsYXRlRHVyYXRpb24iLCJudW1iZXIiLCJtdXRhdGlvbiIsImN0eCIsInJlc3BvbnNlIiwidXNlcklkIiwic2Vzc2lvbiIsInVzZXIiLCJpZCIsImNvbnNvbGUiLCJsb2ciLCJnZXRSZXF1ZXN0SWQiLCJwcm9qZWN0IiwicXVlcnkiLCJmaW5kRmlyc3QiLCJ3aGVyZSIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiZXhpc3RpbmdTY2VuZXMiLCJmaW5kTWFueSIsInNjZW5lT3JkZXIiLCJsZW5ndGgiLCJzY2VuZU5hbWUiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJuYW1lIiwib3JkZXIiLCJkdXJhdGlvbiIsIm5ld1NjZW5lIiwiaW5zZXJ0IiwidmFsdWVzIiwidHN4Q29kZSIsInByb3BzIiwibGF5b3V0SnNvbiIsInJldHVybmluZyIsInNjZW5lSWQiLCJpc1dlbGNvbWUiLCJ1cGRhdGUiLCJzZXQiLCJjcmVhdGVNZXNzYWdlIiwiY29udGVudCIsInJvbGUiLCJzY2VuZSIsImVycm9yIiwiRXJyb3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/generation/template-operations.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/project.ts":
/*!*******************************************!*\
  !*** ./src/server/api/routers/project.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   projectRouter: () => (/* binding */ projectRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _trpc_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @trpc/server */ \"(rsc)/../../node_modules/@trpc/server/dist/index.mjs\");\n/* harmony import */ var _lib_types_video_remotion_constants__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/lib/types/video/remotion-constants */ \"(rsc)/./src/lib/types/video/remotion-constants.ts\");\n/* harmony import */ var _lib_types_shared_json_patch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ~/lib/types/shared/json-patch */ \"(rsc)/./src/lib/types/shared/json-patch.ts\");\n/* harmony import */ var fast_json_patch__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! fast-json-patch */ \"(rsc)/../../node_modules/fast-json-patch/lib/duplex.js\");\n/* harmony import */ var _lib_utils_nameGenerator__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ~/lib/utils/nameGenerator */ \"(rsc)/./src/lib/utils/nameGenerator.ts\");\n/* harmony import */ var _server_services_ai_titleGenerator_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ~/server/services/ai/titleGenerator.service */ \"(rsc)/./src/server/services/ai/titleGenerator.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/api/routers/project.ts\n\n\n\n\n\n\n\n\n\n\n\nconst projectRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    getById: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        id: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().uuid()\n    })).query(async ({ ctx, input })=>{\n        const [project] = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.id));\n        if (!project) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Project not found\"\n            });\n        }\n        // Ensure the user has access to this project\n        if (project.userId !== ctx.session.user.id) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"FORBIDDEN\",\n                message: \"You don't have access to this project\"\n            });\n        }\n        return project;\n    }),\n    list: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.query(async ({ ctx })=>{\n        // Fetch all projects for the current user, sorted by most recently updated\n        const userProjects = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, ctx.session.user.id)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.updatedAt));\n        return userProjects;\n    }),\n    create: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        initialMessage: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().min(1).max(2000).optional()\n    }).optional()).mutation(async ({ ctx, input })=>{\n        try {\n            // Generate title based on initialMessage if available\n            console.log('[project.create] Mutation called. Input:', JSON.stringify(input));\n            let title = \"Untitled Video\";\n            if (input?.initialMessage) {\n                try {\n                    // Use AI to generate a title from the initialMessage\n                    const result = await (0,_server_services_ai_titleGenerator_service__WEBPACK_IMPORTED_MODULE_8__.generateTitle)({\n                        prompt: input.initialMessage,\n                        contextId: \"project-create\"\n                    });\n                    title = result.title || \"Untitled Video\";\n                } catch (titleError) {\n                    console.error(\"Error generating AI title:\", titleError);\n                // Fall back to default naming scheme on error\n                }\n            }\n            // If AI title generation failed or no initialMessage was provided,\n            // use the existing incremental naming scheme\n            if (title === \"Untitled Video\" || title === \"New Project\") {\n                // Get a list of all \"Untitled Video\" projects with their numbers\n                const userProjects = await (0,_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.executeWithRetry)(()=>ctx.db.select({\n                        title: _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title\n                    }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, ctx.session?.user?.id || 'system'), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.like)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title, 'Untitled Video%'))));\n                // Find the highest number used in \"Untitled Video X\" titles\n                let highestNumber = 0;\n                for (const project of userProjects){\n                    const match = /^Untitled Video (\\d+)$/.exec(project.title);\n                    if (match?.[1]) {\n                        const num = parseInt(match[1], 10);\n                        if (!isNaN(num) && num > highestNumber) {\n                            highestNumber = num;\n                        }\n                    }\n                }\n                // Generate a unique title with the next available number\n                const nextNumber = highestNumber + 1;\n                title = userProjects.length === 0 ? \"Untitled Video\" : `Untitled Video ${nextNumber}`;\n            }\n            // Create a new project for the logged-in user with returning clause\n            // Use executeWithRetry to handle potential database connection issues\n            const inserted = await (0,_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.executeWithRetry)(()=>ctx.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).values({\n                    userId: ctx.session?.user?.id || 'system',\n                    title,\n                    props: (0,_lib_types_video_remotion_constants__WEBPACK_IMPORTED_MODULE_4__.createDefaultProjectProps)()\n                }).returning());\n            const insertResult = inserted[0];\n            if (!insertResult) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to create project\"\n                });\n            }\n            // NO WELCOME MESSAGE CREATION - Let UI show the nice default instead\n            // TODO: Initial message processing now handled via generation router\n            // Legacy processUserMessageInProject removed during cleanup\n            return {\n                projectId: insertResult.id\n            };\n        } catch (error) {\n            console.error(\"Error creating project:\", error);\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: \"Failed to create project\",\n                cause: error\n            });\n        }\n    }),\n    rename: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        id: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().uuid(),\n        title: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().min(1).max(255)\n    })).mutation(async ({ ctx, input })=>{\n        try {\n            // First check if the project exists and belongs to the user\n            const [project] = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.id));\n            if (!project) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"NOT_FOUND\",\n                    message: \"Project not found\"\n                });\n            }\n            // Ensure the user has access to this project\n            if (project.userId !== ctx.session.user.id) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"FORBIDDEN\",\n                    message: \"You don't have access to this project\"\n                });\n            }\n            // Check if another project with this title already exists for this user\n            const [existingProject] = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.userId, ctx.session.user.id), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.title, input.title), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.ne)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.id) // Not the current project\n            ));\n            if (existingProject) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"CONFLICT\",\n                    message: \"A project with this title already exists\"\n                });\n            }\n            // Update the project title\n            const updated = await ctx.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).set({\n                title: input.title,\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.id)).returning();\n            return updated[0];\n        } catch (error) {\n            console.error(\"Error renaming project:\", error);\n            if (error instanceof _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError) {\n                throw error; // Re-throw TRPC errors\n            }\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: \"Failed to rename project\"\n            });\n        }\n    }),\n    patch: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().uuid(),\n        patch: _lib_types_shared_json_patch__WEBPACK_IMPORTED_MODULE_5__.jsonPatchSchema\n    })).mutation(async ({ ctx, input })=>{\n        try {\n            // First check if the project exists and belongs to the user\n            const [project] = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.projectId));\n            if (!project) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"NOT_FOUND\",\n                    message: \"Project not found\"\n                });\n            }\n            // Ensure the user has access to this project\n            if (project.userId !== ctx.session.user.id) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"FORBIDDEN\",\n                    message: \"You don't have access to this project\"\n                });\n            }\n            // Apply the JSON patch\n            const patchOperations = input.patch;\n            const nextProps = (0,fast_json_patch__WEBPACK_IMPORTED_MODULE_6__.applyPatch)(structuredClone(project.props), patchOperations, true, false).newDocument;\n            // Save the new props and the patch\n            const updated = await ctx.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).set({\n                props: nextProps,\n                updatedAt: new Date()\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.projectId)).returning();\n            // Save the patch for history\n            await ctx.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.patches).values({\n                projectId: input.projectId,\n                patch: input.patch\n            });\n            return updated[0];\n        } catch (error) {\n            console.error(\"Error patching project:\", error);\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: error instanceof Error ? error.message : \"Failed to patch project\"\n            });\n        }\n    }),\n    /**\n   * Fetches all scene plans for a given project.\n   */ listScenePlans: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().uuid()\n    })).query(async ({ ctx, input })=>{\n        // First, verify project ownership (similar to getById)\n        const project = await ctx.db.query.projects.findFirst({\n            columns: {\n                id: true,\n                userId: true\n            },\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.projectId)\n        });\n        if (!project) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Project not found\"\n            });\n        }\n        if (project.userId !== ctx.session.user.id) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"FORBIDDEN\",\n                message: \"You don't have access to this project's scene plans.\"\n            });\n        }\n        // Fetch scene plans for the project, ordered by creation or a specific order if available\n        const plans = await ctx.db.query.scenePlans.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenePlans.projectId, input.projectId),\n            orderBy: [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.desc)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.scenePlans.createdAt)\n            ]\n        });\n        return plans;\n    }),\n    delete: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        id: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().uuid()\n    })).mutation(async ({ ctx, input })=>{\n        try {\n            // First check if the project exists and belongs to the user\n            const [project] = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.id));\n            if (!project) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"NOT_FOUND\",\n                    message: \"Project not found\"\n                });\n            }\n            // Ensure the user has access to this project\n            if (project.userId !== ctx.session.user.id) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"FORBIDDEN\",\n                    message: \"You don't have access to this project\"\n                });\n            }\n            // Delete the project (this will cascade delete related data due to foreign key constraints)\n            const deleted = await ctx.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.id)).returning();\n            if (!deleted[0]) {\n                throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to delete project\"\n                });\n            }\n            return {\n                success: true,\n                deletedProject: deleted[0]\n            };\n        } catch (error) {\n            console.error(\"Error deleting project:\", error);\n            if (error instanceof _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError) {\n                throw error; // Re-throw TRPC errors\n            }\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: \"Failed to delete project\"\n            });\n        }\n    }),\n    // New procedure for generating AI titles\n    generateAITitle: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_9__.z.object({\n        prompt: zod__WEBPACK_IMPORTED_MODULE_9__.z.string(),\n        contextId: zod__WEBPACK_IMPORTED_MODULE_9__.z.string().optional()\n    })).mutation(async ({ input })=>{\n        try {\n            // Call the AI title generator service\n            const result = await (0,_server_services_ai_titleGenerator_service__WEBPACK_IMPORTED_MODULE_8__.generateTitle)({\n                prompt: input.prompt,\n                contextId: input.contextId || \"api-call\"\n            });\n            // Return the generated title\n            return {\n                title: result.title || (0,_lib_utils_nameGenerator__WEBPACK_IMPORTED_MODULE_7__.generateNameFromPrompt)(input.prompt),\n                reasoning: result.reasoning\n            };\n        } catch (error) {\n            console.error(\"Error generating AI project title:\", error);\n            // Fall back to the regex-based approach on error\n            return {\n                title: (0,_lib_utils_nameGenerator__WEBPACK_IMPORTED_MODULE_7__.generateNameFromPrompt)(input.prompt),\n                error: error instanceof Error ? error.message : \"Unknown error\"\n            };\n        }\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c0JBLENBQUNLLE1BQU1pQyxNQUFNO2dCQUMxQ0csT0FBT0EsaUJBQWlCNEIsUUFBUTVCLE1BQU12QixPQUFPLEdBQUc7WUFDbEQ7UUFDRjtJQUNGO0FBQ0osR0FBRyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3NlcnZlci9hcGkvcm91dGVycy9wcm9qZWN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvcHJvamVjdC50c1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IGNyZWF0ZVRSUENSb3V0ZXIsIHByb3RlY3RlZFByb2NlZHVyZSB9IGZyb20gXCJ+L3NlcnZlci9hcGkvdHJwY1wiO1xuaW1wb3J0IHsgcHJvamVjdHMsIHBhdGNoZXMsIHNjZW5lUGxhbnMgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgZXEsIGRlc2MsIGxpa2UsIGFuZCwgbmUgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IFRSUENFcnJvciB9IGZyb20gXCJAdHJwYy9zZXJ2ZXJcIjtcbmltcG9ydCB7IGNyZWF0ZURlZmF1bHRQcm9qZWN0UHJvcHMgfSBmcm9tIFwifi9saWIvdHlwZXMvdmlkZW8vcmVtb3Rpb24tY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBqc29uUGF0Y2hTY2hlbWEgfSBmcm9tIFwifi9saWIvdHlwZXMvc2hhcmVkL2pzb24tcGF0Y2hcIjtcbmltcG9ydCB7IGFwcGx5UGF0Y2ggfSBmcm9tIFwiZmFzdC1qc29uLXBhdGNoXCI7XG5pbXBvcnQgdHlwZSB7IE9wZXJhdGlvbiB9IGZyb20gXCJmYXN0LWpzb24tcGF0Y2hcIjtcbmltcG9ydCB7IGdlbmVyYXRlTmFtZUZyb21Qcm9tcHQgfSBmcm9tIFwifi9saWIvdXRpbHMvbmFtZUdlbmVyYXRvclwiO1xuaW1wb3J0IHsgZ2VuZXJhdGVUaXRsZSB9IGZyb20gXCJ+L3NlcnZlci9zZXJ2aWNlcy9haS90aXRsZUdlbmVyYXRvci5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBleGVjdXRlV2l0aFJldHJ5IH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcblxuZXhwb3J0IGNvbnN0IHByb2plY3RSb3V0ZXIgPSBjcmVhdGVUUlBDUm91dGVyKHtcbiAgZ2V0QnlJZDogcHJvdGVjdGVkUHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIGlkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgICB9KSlcbiAgICAucXVlcnkoYXN5bmMgKHsgY3R4LCBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zdCBbcHJvamVjdF0gPSBhd2FpdCBjdHguZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIGlucHV0LmlkKSk7XG5cbiAgICAgIGlmICghcHJvamVjdCkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiUHJvamVjdCBub3QgZm91bmRcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEVuc3VyZSB0aGUgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgcHJvamVjdFxuICAgICAgaWYgKHByb2plY3QudXNlcklkICE9PSBjdHguc2Vzc2lvbi51c2VyLmlkKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiRk9SQklEREVOXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJZb3UgZG9uJ3QgaGF2ZSBhY2Nlc3MgdG8gdGhpcyBwcm9qZWN0XCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJvamVjdDtcbiAgICB9KSxcbiAgICBcbiAgbGlzdDogcHJvdGVjdGVkUHJvY2VkdXJlXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGN0eCB9KSA9PiB7XG4gICAgICAvLyBGZXRjaCBhbGwgcHJvamVjdHMgZm9yIHRoZSBjdXJyZW50IHVzZXIsIHNvcnRlZCBieSBtb3N0IHJlY2VudGx5IHVwZGF0ZWRcbiAgICAgIGNvbnN0IHVzZXJQcm9qZWN0cyA9IGF3YWl0IGN0eC5kYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20ocHJvamVjdHMpXG4gICAgICAgIC53aGVyZShlcShwcm9qZWN0cy51c2VySWQsIGN0eC5zZXNzaW9uLnVzZXIuaWQpKVxuICAgICAgICAub3JkZXJCeShkZXNjKHByb2plY3RzLnVwZGF0ZWRBdCkpO1xuICAgICAgICBcbiAgICAgIHJldHVybiB1c2VyUHJvamVjdHM7XG4gICAgfSksXG4gICAgXG4gIGNyZWF0ZTogcHJvdGVjdGVkUHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIGluaXRpYWxNZXNzYWdlOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMjAwMCkub3B0aW9uYWwoKSxcbiAgICB9KS5vcHRpb25hbCgpKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBjdHgsIGlucHV0IH0pID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEdlbmVyYXRlIHRpdGxlIGJhc2VkIG9uIGluaXRpYWxNZXNzYWdlIGlmIGF2YWlsYWJsZVxuICAgICAgICBjb25zb2xlLmxvZygnW3Byb2plY3QuY3JlYXRlXSBNdXRhdGlvbiBjYWxsZWQuIElucHV0OicsIEpTT04uc3RyaW5naWZ5KGlucHV0KSk7XG4gICAgICAgIGxldCB0aXRsZSA9IFwiVW50aXRsZWQgVmlkZW9cIjtcbiAgICAgICAgXG4gICAgICAgIGlmIChpbnB1dD8uaW5pdGlhbE1lc3NhZ2UpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gVXNlIEFJIHRvIGdlbmVyYXRlIGEgdGl0bGUgZnJvbSB0aGUgaW5pdGlhbE1lc3NhZ2VcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdlbmVyYXRlVGl0bGUoe1xuICAgICAgICAgICAgICBwcm9tcHQ6IGlucHV0LmluaXRpYWxNZXNzYWdlLFxuICAgICAgICAgICAgICBjb250ZXh0SWQ6IFwicHJvamVjdC1jcmVhdGVcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aXRsZSA9IHJlc3VsdC50aXRsZSB8fCBcIlVudGl0bGVkIFZpZGVvXCI7XG4gICAgICAgICAgfSBjYXRjaCAodGl0bGVFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdlbmVyYXRpbmcgQUkgdGl0bGU6XCIsIHRpdGxlRXJyb3IpO1xuICAgICAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGRlZmF1bHQgbmFtaW5nIHNjaGVtZSBvbiBlcnJvclxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSWYgQUkgdGl0bGUgZ2VuZXJhdGlvbiBmYWlsZWQgb3Igbm8gaW5pdGlhbE1lc3NhZ2Ugd2FzIHByb3ZpZGVkLFxuICAgICAgICAvLyB1c2UgdGhlIGV4aXN0aW5nIGluY3JlbWVudGFsIG5hbWluZyBzY2hlbWVcbiAgICAgICAgaWYgKHRpdGxlID09PSBcIlVudGl0bGVkIFZpZGVvXCIgfHwgdGl0bGUgPT09IFwiTmV3IFByb2plY3RcIikge1xuICAgICAgICAgIC8vIEdldCBhIGxpc3Qgb2YgYWxsIFwiVW50aXRsZWQgVmlkZW9cIiBwcm9qZWN0cyB3aXRoIHRoZWlyIG51bWJlcnNcbiAgICAgICAgICBjb25zdCB1c2VyUHJvamVjdHMgPSBhd2FpdCBleGVjdXRlV2l0aFJldHJ5KCgpID0+IGN0eC5kYlxuICAgICAgICAgICAgLnNlbGVjdCh7IHRpdGxlOiBwcm9qZWN0cy50aXRsZSB9KVxuICAgICAgICAgICAgLmZyb20ocHJvamVjdHMpXG4gICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICBlcShwcm9qZWN0cy51c2VySWQsIGN0eC5zZXNzaW9uPy51c2VyPy5pZCB8fCAnc3lzdGVtJyksXG4gICAgICAgICAgICAgICAgbGlrZShwcm9qZWN0cy50aXRsZSwgJ1VudGl0bGVkIFZpZGVvJScpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZpbmQgdGhlIGhpZ2hlc3QgbnVtYmVyIHVzZWQgaW4gXCJVbnRpdGxlZCBWaWRlbyBYXCIgdGl0bGVzXG4gICAgICAgICAgbGV0IGhpZ2hlc3ROdW1iZXIgPSAwO1xuICAgICAgICAgIGZvciAoY29uc3QgcHJvamVjdCBvZiB1c2VyUHJvamVjdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gL15VbnRpdGxlZCBWaWRlbyAoXFxkKykkLy5leGVjKHByb2plY3QudGl0bGUpO1xuICAgICAgICAgICAgaWYgKG1hdGNoPy5bMV0pIHtcbiAgICAgICAgICAgICAgY29uc3QgbnVtID0gcGFyc2VJbnQobWF0Y2hbMV0sIDEwKTtcbiAgICAgICAgICAgICAgaWYgKCFpc05hTihudW0pICYmIG51bSA+IGhpZ2hlc3ROdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBoaWdoZXN0TnVtYmVyID0gbnVtO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEdlbmVyYXRlIGEgdW5pcXVlIHRpdGxlIHdpdGggdGhlIG5leHQgYXZhaWxhYmxlIG51bWJlclxuICAgICAgICAgIGNvbnN0IG5leHROdW1iZXIgPSBoaWdoZXN0TnVtYmVyICsgMTtcbiAgICAgICAgICB0aXRsZSA9IHVzZXJQcm9qZWN0cy5sZW5ndGggPT09IDAgPyBcIlVudGl0bGVkIFZpZGVvXCIgOiBgVW50aXRsZWQgVmlkZW8gJHtuZXh0TnVtYmVyfWA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBwcm9qZWN0IGZvciB0aGUgbG9nZ2VkLWluIHVzZXIgd2l0aCByZXR1cm5pbmcgY2xhdXNlXG4gICAgICAgIC8vIFVzZSBleGVjdXRlV2l0aFJldHJ5IHRvIGhhbmRsZSBwb3RlbnRpYWwgZGF0YWJhc2UgY29ubmVjdGlvbiBpc3N1ZXNcbiAgICAgICAgY29uc3QgaW5zZXJ0ZWQgPSBhd2FpdCBleGVjdXRlV2l0aFJldHJ5KCgpID0+IGN0eC5kYlxuICAgICAgICAgIC5pbnNlcnQocHJvamVjdHMpXG4gICAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgICB1c2VySWQ6IGN0eC5zZXNzaW9uPy51c2VyPy5pZCB8fCAnc3lzdGVtJyxcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgcHJvcHM6IGNyZWF0ZURlZmF1bHRQcm9qZWN0UHJvcHMoKSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5yZXR1cm5pbmcoKSk7XG5cbiAgICAgICAgY29uc3QgaW5zZXJ0UmVzdWx0ID0gaW5zZXJ0ZWRbMF07XG4gICAgICAgICAgXG4gICAgICAgIGlmICghaW5zZXJ0UmVzdWx0KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIHByb2plY3RcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5PIFdFTENPTUUgTUVTU0FHRSBDUkVBVElPTiAtIExldCBVSSBzaG93IHRoZSBuaWNlIGRlZmF1bHQgaW5zdGVhZFxuXG4gICAgICAgIC8vIFRPRE86IEluaXRpYWwgbWVzc2FnZSBwcm9jZXNzaW5nIG5vdyBoYW5kbGVkIHZpYSBnZW5lcmF0aW9uIHJvdXRlclxuICAgICAgICAvLyBMZWdhY3kgcHJvY2Vzc1VzZXJNZXNzYWdlSW5Qcm9qZWN0IHJlbW92ZWQgZHVyaW5nIGNsZWFudXBcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHByb2plY3RJZDogaW5zZXJ0UmVzdWx0LmlkIH07XG5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBwcm9qZWN0OlwiLCBlcnJvcik7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIHByb2plY3RcIixcbiAgICAgICAgICBjYXVzZTogZXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pLFxuICAgIFxuICByZW5hbWU6IHByb3RlY3RlZFByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICBpZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDI1NSksXG4gICAgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGN0eCwgaW5wdXQgfSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIHByb2plY3QgZXhpc3RzIGFuZCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgICAgIGNvbnN0IFtwcm9qZWN0XSA9IGF3YWl0IGN0eC5kYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAgIC53aGVyZShlcShwcm9qZWN0cy5pZCwgaW5wdXQuaWQpKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghcHJvamVjdCkge1xuICAgICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJOT1RfRk9VTkRcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiUHJvamVjdCBub3QgZm91bmRcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRW5zdXJlIHRoZSB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBwcm9qZWN0XG4gICAgICAgIGlmIChwcm9qZWN0LnVzZXJJZCAhPT0gY3R4LnNlc3Npb24udXNlci5pZCkge1xuICAgICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJGT1JCSURERU5cIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiWW91IGRvbid0IGhhdmUgYWNjZXNzIHRvIHRoaXMgcHJvamVjdFwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBpZiBhbm90aGVyIHByb2plY3Qgd2l0aCB0aGlzIHRpdGxlIGFscmVhZHkgZXhpc3RzIGZvciB0aGlzIHVzZXJcbiAgICAgICAgY29uc3QgW2V4aXN0aW5nUHJvamVjdF0gPSBhd2FpdCBjdHguZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShwcm9qZWN0cylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHByb2plY3RzLnVzZXJJZCwgY3R4LnNlc3Npb24udXNlci5pZCksXG4gICAgICAgICAgICAgIGVxKHByb2plY3RzLnRpdGxlLCBpbnB1dC50aXRsZSksXG4gICAgICAgICAgICAgIG5lKHByb2plY3RzLmlkLCBpbnB1dC5pZCkgLy8gTm90IHRoZSBjdXJyZW50IHByb2plY3RcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgaWYgKGV4aXN0aW5nUHJvamVjdCkge1xuICAgICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJDT05GTElDVFwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJBIHByb2plY3Qgd2l0aCB0aGlzIHRpdGxlIGFscmVhZHkgZXhpc3RzXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgcHJvamVjdCB0aXRsZVxuICAgICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgY3R4LmRiXG4gICAgICAgICAgLnVwZGF0ZShwcm9qZWN0cylcbiAgICAgICAgICAuc2V0KHsgXG4gICAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICB9KVxuICAgICAgICAgIC53aGVyZShlcShwcm9qZWN0cy5pZCwgaW5wdXQuaWQpKVxuICAgICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIHVwZGF0ZWRbMF07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVuYW1pbmcgcHJvamVjdDpcIiwgZXJyb3IpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBUUlBDRXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgVFJQQyBlcnJvcnNcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJlbmFtZSBwcm9qZWN0XCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pLFxuICBwYXRjaDogcHJvdGVjdGVkUHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHByb2plY3RJZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgICBwYXRjaDoganNvblBhdGNoU2NoZW1hLFxuICAgIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBjdHgsIGlucHV0IH0pID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEZpcnN0IGNoZWNrIGlmIHRoZSBwcm9qZWN0IGV4aXN0cyBhbmQgYmVsb25ncyB0byB0aGUgdXNlclxuICAgICAgICBjb25zdCBbcHJvamVjdF0gPSBhd2FpdCBjdHguZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShwcm9qZWN0cylcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIGlucHV0LnByb2plY3RJZCkpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFwcm9qZWN0KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJQcm9qZWN0IG5vdCBmb3VuZFwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBFbnN1cmUgdGhlIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIHByb2plY3RcbiAgICAgICAgaWYgKHByb2plY3QudXNlcklkICE9PSBjdHguc2Vzc2lvbi51c2VyLmlkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgICBjb2RlOiBcIkZPUkJJRERFTlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJZb3UgZG9uJ3QgaGF2ZSBhY2Nlc3MgdG8gdGhpcyBwcm9qZWN0XCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBcHBseSB0aGUgSlNPTiBwYXRjaFxuICAgICAgICBjb25zdCBwYXRjaE9wZXJhdGlvbnMgPSBpbnB1dC5wYXRjaCBhcyB1bmtub3duIGFzIE9wZXJhdGlvbltdO1xuICAgICAgICBjb25zdCBuZXh0UHJvcHMgPSBhcHBseVBhdGNoKHN0cnVjdHVyZWRDbG9uZShwcm9qZWN0LnByb3BzKSwgcGF0Y2hPcGVyYXRpb25zLCB0cnVlLCBmYWxzZSkubmV3RG9jdW1lbnQ7XG4gICAgICAgIFxuICAgICAgICAvLyBTYXZlIHRoZSBuZXcgcHJvcHMgYW5kIHRoZSBwYXRjaFxuICAgICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgY3R4LmRiXG4gICAgICAgICAgLnVwZGF0ZShwcm9qZWN0cylcbiAgICAgICAgICAuc2V0KHsgXG4gICAgICAgICAgICBwcm9wczogbmV4dFByb3BzLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgfSlcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIGlucHV0LnByb2plY3RJZCkpXG4gICAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAgIC8vIFNhdmUgdGhlIHBhdGNoIGZvciBoaXN0b3J5XG4gICAgICAgIGF3YWl0IGN0eC5kYi5pbnNlcnQocGF0Y2hlcykudmFsdWVzKHtcbiAgICAgICAgICBwcm9qZWN0SWQ6IGlucHV0LnByb2plY3RJZCxcbiAgICAgICAgICBwYXRjaDogaW5wdXQucGF0Y2hcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdXBkYXRlZFswXTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwYXRjaGluZyBwcm9qZWN0OlwiLCBlcnJvcik7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIkZhaWxlZCB0byBwYXRjaCBwcm9qZWN0XCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pLFxuICAvKipcbiAgICogRmV0Y2hlcyBhbGwgc2NlbmUgcGxhbnMgZm9yIGEgZ2l2ZW4gcHJvamVjdC5cbiAgICovXG4gIGxpc3RTY2VuZVBsYW5zOiBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3QoeyBwcm9qZWN0SWQ6IHouc3RyaW5nKCkudXVpZCgpIH0pKVxuICAgIC5xdWVyeShhc3luYyAoeyBjdHgsIGlucHV0IH0pID0+IHtcbiAgICAgIC8vIEZpcnN0LCB2ZXJpZnkgcHJvamVjdCBvd25lcnNoaXAgKHNpbWlsYXIgdG8gZ2V0QnlJZClcbiAgICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBjdHguZGIucXVlcnkucHJvamVjdHMuZmluZEZpcnN0KHtcbiAgICAgICAgY29sdW1uczogeyBpZDogdHJ1ZSwgdXNlcklkOiB0cnVlIH0sXG4gICAgICAgIHdoZXJlOiBlcShwcm9qZWN0cy5pZCwgaW5wdXQucHJvamVjdElkKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXByb2plY3QpIHtcbiAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgY29kZTogXCJOT1RfRk9VTkRcIixcbiAgICAgICAgICBtZXNzYWdlOiBcIlByb2plY3Qgbm90IGZvdW5kXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvamVjdC51c2VySWQgIT09IGN0eC5zZXNzaW9uLnVzZXIuaWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgY29kZTogXCJGT1JCSURERU5cIixcbiAgICAgICAgICBtZXNzYWdlOiBcIllvdSBkb24ndCBoYXZlIGFjY2VzcyB0byB0aGlzIHByb2plY3QncyBzY2VuZSBwbGFucy5cIixcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZldGNoIHNjZW5lIHBsYW5zIGZvciB0aGUgcHJvamVjdCwgb3JkZXJlZCBieSBjcmVhdGlvbiBvciBhIHNwZWNpZmljIG9yZGVyIGlmIGF2YWlsYWJsZVxuICAgICAgY29uc3QgcGxhbnMgPSBhd2FpdCBjdHguZGIucXVlcnkuc2NlbmVQbGFucy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiBlcShzY2VuZVBsYW5zLnByb2plY3RJZCwgaW5wdXQucHJvamVjdElkKSxcbiAgICAgICAgb3JkZXJCeTogW2Rlc2Moc2NlbmVQbGFucy5jcmVhdGVkQXQpXSwgLy8gT3IgYW55IG90aGVyIHJlbGV2YW50IG9yZGVyXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHBsYW5zO1xuICAgIH0pLFxuICAgIFxuICBkZWxldGU6IHByb3RlY3RlZFByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICBpZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGN0eCwgaW5wdXQgfSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIHByb2plY3QgZXhpc3RzIGFuZCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgICAgIGNvbnN0IFtwcm9qZWN0XSA9IGF3YWl0IGN0eC5kYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAgIC53aGVyZShlcShwcm9qZWN0cy5pZCwgaW5wdXQuaWQpKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghcHJvamVjdCkge1xuICAgICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJOT1RfRk9VTkRcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiUHJvamVjdCBub3QgZm91bmRcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRW5zdXJlIHRoZSB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBwcm9qZWN0XG4gICAgICAgIGlmIChwcm9qZWN0LnVzZXJJZCAhPT0gY3R4LnNlc3Npb24udXNlci5pZCkge1xuICAgICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJGT1JCSURERU5cIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiWW91IGRvbid0IGhhdmUgYWNjZXNzIHRvIHRoaXMgcHJvamVjdFwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBEZWxldGUgdGhlIHByb2plY3QgKHRoaXMgd2lsbCBjYXNjYWRlIGRlbGV0ZSByZWxhdGVkIGRhdGEgZHVlIHRvIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnRzKVxuICAgICAgICBjb25zdCBkZWxldGVkID0gYXdhaXQgY3R4LmRiXG4gICAgICAgICAgLmRlbGV0ZShwcm9qZWN0cylcbiAgICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIGlucHV0LmlkKSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICAgICAgXG4gICAgICAgIGlmICghZGVsZXRlZFswXSkge1xuICAgICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGRlbGV0ZSBwcm9qZWN0XCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IFxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICAgIGRlbGV0ZWRQcm9qZWN0OiBkZWxldGVkWzBdIFxuICAgICAgICB9O1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIHByb2plY3Q6XCIsIGVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgVFJQQ0Vycm9yKSB7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IFRSUEMgZXJyb3JzXG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBkZWxldGUgcHJvamVjdFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KSxcbiAgICBcbiAgLy8gTmV3IHByb2NlZHVyZSBmb3IgZ2VuZXJhdGluZyBBSSB0aXRsZXNcbiAgZ2VuZXJhdGVBSVRpdGxlOiBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgcHJvbXB0OiB6LnN0cmluZygpLFxuICAgICAgY29udGV4dElkOiB6LnN0cmluZygpLm9wdGlvbmFsKClcbiAgICB9KSlcbiAgICAubXV0YXRpb24oYXN5bmMgKHsgaW5wdXQgfSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQ2FsbCB0aGUgQUkgdGl0bGUgZ2VuZXJhdG9yIHNlcnZpY2VcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2VuZXJhdGVUaXRsZSh7XG4gICAgICAgICAgcHJvbXB0OiBpbnB1dC5wcm9tcHQsXG4gICAgICAgICAgY29udGV4dElkOiBpbnB1dC5jb250ZXh0SWQgfHwgXCJhcGktY2FsbFwiXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gUmV0dXJuIHRoZSBnZW5lcmF0ZWQgdGl0bGVcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0aXRsZTogcmVzdWx0LnRpdGxlIHx8IGdlbmVyYXRlTmFtZUZyb21Qcm9tcHQoaW5wdXQucHJvbXB0KSxcbiAgICAgICAgICByZWFzb25pbmc6IHJlc3VsdC5yZWFzb25pbmdcbiAgICAgICAgfTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZW5lcmF0aW5nIEFJIHByb2plY3QgdGl0bGU6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIHRoZSByZWdleC1iYXNlZCBhcHByb2FjaCBvbiBlcnJvclxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpdGxlOiBnZW5lcmF0ZU5hbWVGcm9tUHJvbXB0KGlucHV0LnByb21wdCksXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KSxcbn0pOyAiXSwibmFtZXMiOlsieiIsImNyZWF0ZVRSUENSb3V0ZXIiLCJwcm90ZWN0ZWRQcm9jZWR1cmUiLCJwcm9qZWN0cyIsInBhdGNoZXMiLCJzY2VuZVBsYW5zIiwiZXEiLCJkZXNjIiwibGlrZSIsImFuZCIsIm5lIiwiVFJQQ0Vycm9yIiwiY3JlYXRlRGVmYXVsdFByb2plY3RQcm9wcyIsImpzb25QYXRjaFNjaGVtYSIsImFwcGx5UGF0Y2giLCJnZW5lcmF0ZU5hbWVGcm9tUHJvbXB0IiwiZ2VuZXJhdGVUaXRsZSIsImV4ZWN1dGVXaXRoUmV0cnkiLCJwcm9qZWN0Um91dGVyIiwiZ2V0QnlJZCIsImlucHV0Iiwib2JqZWN0IiwiaWQiLCJzdHJpbmciLCJ1dWlkIiwicXVlcnkiLCJjdHgiLCJwcm9qZWN0IiwiZGIiLCJzZWxlY3QiLCJmcm9tIiwid2hlcmUiLCJjb2RlIiwibWVzc2FnZSIsInVzZXJJZCIsInNlc3Npb24iLCJ1c2VyIiwibGlzdCIsInVzZXJQcm9qZWN0cyIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJjcmVhdGUiLCJpbml0aWFsTWVzc2FnZSIsIm1pbiIsIm1heCIsIm9wdGlvbmFsIiwibXV0YXRpb24iLCJjb25zb2xlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInRpdGxlIiwicmVzdWx0IiwicHJvbXB0IiwiY29udGV4dElkIiwidGl0bGVFcnJvciIsImVycm9yIiwiaGlnaGVzdE51bWJlciIsIm1hdGNoIiwiZXhlYyIsIm51bSIsInBhcnNlSW50IiwiaXNOYU4iLCJuZXh0TnVtYmVyIiwibGVuZ3RoIiwiaW5zZXJ0ZWQiLCJpbnNlcnQiLCJ2YWx1ZXMiLCJwcm9wcyIsInJldHVybmluZyIsImluc2VydFJlc3VsdCIsInByb2plY3RJZCIsImNhdXNlIiwicmVuYW1lIiwiZXhpc3RpbmdQcm9qZWN0IiwidXBkYXRlZCIsInVwZGF0ZSIsInNldCIsIkRhdGUiLCJwYXRjaCIsInBhdGNoT3BlcmF0aW9ucyIsIm5leHRQcm9wcyIsInN0cnVjdHVyZWRDbG9uZSIsIm5ld0RvY3VtZW50IiwiRXJyb3IiLCJsaXN0U2NlbmVQbGFucyIsImZpbmRGaXJzdCIsImNvbHVtbnMiLCJwbGFucyIsImZpbmRNYW55IiwiY3JlYXRlZEF0IiwiZGVsZXRlIiwiZGVsZXRlZCIsInN1Y2Nlc3MiLCJkZWxldGVkUHJvamVjdCIsImdlbmVyYXRlQUlUaXRsZSIsInJlYXNvbmluZyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/project.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/render.ts":
/*!******************************************!*\
  !*** ./src/server/api/routers/render.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   renderRouter: () => (/* binding */ renderRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _trpc_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @trpc/server */ \"(rsc)/../../node_modules/@trpc/server/dist/index.mjs\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__, drizzle_orm__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\nconst renderRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    // Basic start procedure to initiate rendering\n    start: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().uuid()\n    })).mutation(async ({ ctx, input })=>{\n        // First check if the project exists and belongs to the user\n        const [project] = await ctx.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.projects.id, input.projectId));\n        if (!project) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Project not found\"\n            });\n        }\n        // Ensure the user has access to this project\n        if (project.userId !== ctx.session.user.id) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"FORBIDDEN\",\n                message: \"You don't have access to this project\"\n            });\n        }\n        // For now, just return success - this will be replaced with actual Remotion Lambda rendering logic\n        return {\n            success: true,\n            message: \"Render started successfully\"\n        };\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL3JlbmRlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBd0I7QUFDaUQ7QUFDN0I7QUFDWDtBQUNRO0FBRWxDLE1BQU1NLGVBQWVMLGtFQUFnQkEsQ0FBQztJQUMzQyw4Q0FBOEM7SUFDOUNNLE9BQU9MLGdFQUFrQkEsQ0FDdEJNLEtBQUssQ0FBQ1Isa0NBQUNBLENBQUNTLE1BQU0sQ0FBQztRQUNkQyxXQUFXVixrQ0FBQ0EsQ0FBQ1csTUFBTSxHQUFHQyxJQUFJO0lBQzVCLElBQ0NDLFFBQVEsQ0FBQyxPQUFPLEVBQUVDLEdBQUcsRUFBRU4sS0FBSyxFQUFFO1FBQzdCLDREQUE0RDtRQUM1RCxNQUFNLENBQUNPLFFBQVEsR0FBRyxNQUFNRCxJQUFJRSxFQUFFLENBQzNCQyxNQUFNLEdBQ05DLElBQUksQ0FBQ2Ysc0RBQVFBLEVBQ2JnQixLQUFLLENBQUNmLCtDQUFFQSxDQUFDRCxzREFBUUEsQ0FBQ2lCLEVBQUUsRUFBRVosTUFBTUUsU0FBUztRQUV4QyxJQUFJLENBQUNLLFNBQVM7WUFDWixNQUFNLElBQUlWLG1EQUFTQSxDQUFDO2dCQUNsQmdCLE1BQU07Z0JBQ05DLFNBQVM7WUFDWDtRQUNGO1FBRUEsNkNBQTZDO1FBQzdDLElBQUlQLFFBQVFRLE1BQU0sS0FBS1QsSUFBSVUsT0FBTyxDQUFDQyxJQUFJLENBQUNMLEVBQUUsRUFBRTtZQUMxQyxNQUFNLElBQUlmLG1EQUFTQSxDQUFDO2dCQUNsQmdCLE1BQU07Z0JBQ05DLFNBQVM7WUFDWDtRQUNGO1FBRUEsbUdBQW1HO1FBQ25HLE9BQU87WUFDTEksU0FBUztZQUNUSixTQUFTO1FBRVg7SUFDRjtBQUNKLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvcmVuZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBjcmVhdGVUUlBDUm91dGVyLCBwcm90ZWN0ZWRQcm9jZWR1cmUgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3RycGNcIjtcbmltcG9ydCB7IHByb2plY3RzIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IGVxIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBUUlBDRXJyb3IgfSBmcm9tIFwiQHRycGMvc2VydmVyXCI7XG5cbmV4cG9ydCBjb25zdCByZW5kZXJSb3V0ZXIgPSBjcmVhdGVUUlBDUm91dGVyKHtcbiAgLy8gQmFzaWMgc3RhcnQgcHJvY2VkdXJlIHRvIGluaXRpYXRlIHJlbmRlcmluZ1xuICBzdGFydDogcHJvdGVjdGVkUHJvY2VkdXJlXG4gICAgLmlucHV0KHoub2JqZWN0KHtcbiAgICAgIHByb2plY3RJZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgfSkpXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGN0eCwgaW5wdXQgfSkgPT4ge1xuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIHByb2plY3QgZXhpc3RzIGFuZCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgICBjb25zdCBbcHJvamVjdF0gPSBhd2FpdCBjdHguZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHByb2plY3RzKVxuICAgICAgICAud2hlcmUoZXEocHJvamVjdHMuaWQsIGlucHV0LnByb2plY3RJZCkpO1xuICAgICAgXG4gICAgICBpZiAoIXByb2plY3QpIHtcbiAgICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7XG4gICAgICAgICAgY29kZTogXCJOT1RfRk9VTkRcIixcbiAgICAgICAgICBtZXNzYWdlOiBcIlByb2plY3Qgbm90IGZvdW5kXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBFbnN1cmUgdGhlIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIHByb2plY3RcbiAgICAgIGlmIChwcm9qZWN0LnVzZXJJZCAhPT0gY3R4LnNlc3Npb24udXNlci5pZCkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIkZPUkJJRERFTlwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiWW91IGRvbid0IGhhdmUgYWNjZXNzIHRvIHRoaXMgcHJvamVjdFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRm9yIG5vdywganVzdCByZXR1cm4gc3VjY2VzcyAtIHRoaXMgd2lsbCBiZSByZXBsYWNlZCB3aXRoIGFjdHVhbCBSZW1vdGlvbiBMYW1iZGEgcmVuZGVyaW5nIGxvZ2ljXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIlJlbmRlciBzdGFydGVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAvLyBUaGlzIHdvdWxkIGluY2x1ZGUgdGhlIGpvYiBJRCwgc3RhdHVzIFVSTCwgZXRjLiBvbmNlIGltcGxlbWVudGVkXG4gICAgICB9O1xuICAgIH0pLFxufSk7ICJdLCJuYW1lcyI6WyJ6IiwiY3JlYXRlVFJQQ1JvdXRlciIsInByb3RlY3RlZFByb2NlZHVyZSIsInByb2plY3RzIiwiZXEiLCJUUlBDRXJyb3IiLCJyZW5kZXJSb3V0ZXIiLCJzdGFydCIsImlucHV0Iiwib2JqZWN0IiwicHJvamVjdElkIiwic3RyaW5nIiwidXVpZCIsIm11dGF0aW9uIiwiY3R4IiwicHJvamVjdCIsImRiIiwic2VsZWN0IiwiZnJvbSIsIndoZXJlIiwiaWQiLCJjb2RlIiwibWVzc2FnZSIsInVzZXJJZCIsInNlc3Npb24iLCJ1c2VyIiwic3VjY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/render.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/scenes.ts":
/*!******************************************!*\
  !*** ./src/server/api/routers/scenes.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   scenesRouter: () => (/* binding */ scenesRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__, _bazaar_database__WEBPACK_IMPORTED_MODULE_2__]);\n([_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__, _bazaar_database__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n//src/server/api/routers/scenes.ts\n\n\n\n\nconst scenesRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.createTRPCRouter)({\n    updateSceneCode: _server_api_trpc__WEBPACK_IMPORTED_MODULE_0__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_3__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_3__.z.string(),\n        sceneId: zod__WEBPACK_IMPORTED_MODULE_3__.z.string(),\n        code: zod__WEBPACK_IMPORTED_MODULE_3__.z.string()\n    })).mutation(async ({ ctx, input })=>{\n        console.log(`[scenes.updateSceneCode] Updating scene ${input.sceneId} in project ${input.projectId}`);\n        // Verify project ownership\n        const existingScene = await ctx.db.query.scenes.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.scenes.id, input.sceneId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.scenes.projectId, input.projectId)),\n            with: {\n                project: true\n            }\n        });\n        if (!existingScene) {\n            throw new Error(\"Scene not found\");\n        }\n        if (existingScene.project.userId !== ctx.session.user.id) {\n            throw new Error(\"Unauthorized: You don't own this project\");\n        }\n        // Store the \"before\" code for tracking changes\n        const codeBefore = existingScene.tsxCode;\n        // Update scene code\n        const updatedScenes = await ctx.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.scenes).set({\n            tsxCode: input.code,\n            updatedAt: new Date()\n        }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.scenes.id, input.sceneId)).returning();\n        console.log(`[scenes.updateSceneCode]  Scene code updated successfully`);\n        return {\n            success: true,\n            scene: updatedScenes[0]\n        };\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL3NjZW5lcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLGtDQUFrQztBQUNWO0FBQ2lEO0FBQ25DO0FBQ3FCO0FBRXBELE1BQU1NLGVBQWVMLGtFQUFnQkEsQ0FBQztJQUMzQ00saUJBQWlCTCxnRUFBa0JBLENBQ2hDTSxLQUFLLENBQUNSLGtDQUFDQSxDQUFDUyxNQUFNLENBQUM7UUFDZEMsV0FBV1Ysa0NBQUNBLENBQUNXLE1BQU07UUFDbkJDLFNBQVNaLGtDQUFDQSxDQUFDVyxNQUFNO1FBQ2pCRSxNQUFNYixrQ0FBQ0EsQ0FBQ1csTUFBTTtJQUNoQixJQUNDRyxRQUFRLENBQUMsT0FBTyxFQUFFQyxHQUFHLEVBQUVQLEtBQUssRUFBRTtRQUM3QlEsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0NBQXdDLEVBQUVULE1BQU1JLE9BQU8sQ0FBQyxZQUFZLEVBQUVKLE1BQU1FLFNBQVMsRUFBRTtRQUVwRywyQkFBMkI7UUFDM0IsTUFBTVEsZ0JBQWdCLE1BQU1ILElBQUlJLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDZixNQUFNLENBQUNnQixTQUFTLENBQUM7WUFDeERDLE9BQU9sQixnREFBR0EsQ0FDUkQsK0NBQUVBLENBQUNFLG9EQUFNQSxDQUFDa0IsRUFBRSxFQUFFZixNQUFNSSxPQUFPLEdBQzNCVCwrQ0FBRUEsQ0FBQ0Usb0RBQU1BLENBQUNLLFNBQVMsRUFBRUYsTUFBTUUsU0FBUztZQUV0Q2MsTUFBTTtnQkFDSkMsU0FBUztZQUNYO1FBQ0Y7UUFFQSxJQUFJLENBQUNQLGVBQWU7WUFDbEIsTUFBTSxJQUFJUSxNQUFNO1FBQ2xCO1FBRUEsSUFBSVIsY0FBY08sT0FBTyxDQUFDRSxNQUFNLEtBQUtaLElBQUlhLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDTixFQUFFLEVBQUU7WUFDeEQsTUFBTSxJQUFJRyxNQUFNO1FBQ2xCO1FBRUEsK0NBQStDO1FBQy9DLE1BQU1JLGFBQWFaLGNBQWNhLE9BQU87UUFFeEMsb0JBQW9CO1FBQ3BCLE1BQU1DLGdCQUFnQixNQUFNakIsSUFBSUksRUFBRSxDQUMvQmMsTUFBTSxDQUFDNUIsb0RBQU1BLEVBQ2I2QixHQUFHLENBQUM7WUFDSEgsU0FBU3ZCLE1BQU1LLElBQUk7WUFDbkJzQixXQUFXLElBQUlDO1FBQ2pCLEdBQ0NkLEtBQUssQ0FBQ25CLCtDQUFFQSxDQUFDRSxvREFBTUEsQ0FBQ2tCLEVBQUUsRUFBRWYsTUFBTUksT0FBTyxHQUNqQ3lCLFNBQVM7UUFJWnJCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDBEQUEwRCxDQUFDO1FBRXhFLE9BQU87WUFDTHFCLFNBQVM7WUFDVEMsT0FBT1AsYUFBYSxDQUFDLEVBQUU7UUFDekI7SUFDRjtBQUNKLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvc2NlbmVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vc3JjL3NlcnZlci9hcGkvcm91dGVycy9zY2VuZXMudHNcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBjcmVhdGVUUlBDUm91dGVyLCBwcm90ZWN0ZWRQcm9jZWR1cmUgfSBmcm9tIFwifi9zZXJ2ZXIvYXBpL3RycGNcIjtcbmltcG9ydCB7IGVxLCBhbmQgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IHNjZW5lcywgc2NlbmVJdGVyYXRpb25zIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcblxuZXhwb3J0IGNvbnN0IHNjZW5lc1JvdXRlciA9IGNyZWF0ZVRSUENSb3V0ZXIoe1xuICB1cGRhdGVTY2VuZUNvZGU6IHByb3RlY3RlZFByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAgICBwcm9qZWN0SWQ6IHouc3RyaW5nKCksXG4gICAgICBzY2VuZUlkOiB6LnN0cmluZygpLFxuICAgICAgY29kZTogei5zdHJpbmcoKSxcbiAgICB9KSlcbiAgICAubXV0YXRpb24oYXN5bmMgKHsgY3R4LCBpbnB1dCB9KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgW3NjZW5lcy51cGRhdGVTY2VuZUNvZGVdIFVwZGF0aW5nIHNjZW5lICR7aW5wdXQuc2NlbmVJZH0gaW4gcHJvamVjdCAke2lucHV0LnByb2plY3RJZH1gKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IHByb2plY3Qgb3duZXJzaGlwXG4gICAgICBjb25zdCBleGlzdGluZ1NjZW5lID0gYXdhaXQgY3R4LmRiLnF1ZXJ5LnNjZW5lcy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgIGVxKHNjZW5lcy5pZCwgaW5wdXQuc2NlbmVJZCksXG4gICAgICAgICAgZXEoc2NlbmVzLnByb2plY3RJZCwgaW5wdXQucHJvamVjdElkKVxuICAgICAgICApLFxuICAgICAgICB3aXRoOiB7XG4gICAgICAgICAgcHJvamVjdDogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFleGlzdGluZ1NjZW5lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNjZW5lIG5vdCBmb3VuZFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV4aXN0aW5nU2NlbmUucHJvamVjdC51c2VySWQgIT09IGN0eC5zZXNzaW9uLnVzZXIuaWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hdXRob3JpemVkOiBZb3UgZG9uJ3Qgb3duIHRoaXMgcHJvamVjdFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RvcmUgdGhlIFwiYmVmb3JlXCIgY29kZSBmb3IgdHJhY2tpbmcgY2hhbmdlc1xuICAgICAgY29uc3QgY29kZUJlZm9yZSA9IGV4aXN0aW5nU2NlbmUudHN4Q29kZTtcblxuICAgICAgLy8gVXBkYXRlIHNjZW5lIGNvZGVcbiAgICAgIGNvbnN0IHVwZGF0ZWRTY2VuZXMgPSBhd2FpdCBjdHguZGJcbiAgICAgICAgLnVwZGF0ZShzY2VuZXMpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIHRzeENvZGU6IGlucHV0LmNvZGUsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NlbmVzLmlkLCBpbnB1dC5zY2VuZUlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG5cblxuICAgICAgY29uc29sZS5sb2coYFtzY2VuZXMudXBkYXRlU2NlbmVDb2RlXSDinIUgU2NlbmUgY29kZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseWApO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzY2VuZTogdXBkYXRlZFNjZW5lc1swXVxuICAgICAgfTtcbiAgICB9KSxcbn0pO1xuIl0sIm5hbWVzIjpbInoiLCJjcmVhdGVUUlBDUm91dGVyIiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiZXEiLCJhbmQiLCJzY2VuZXMiLCJzY2VuZXNSb3V0ZXIiLCJ1cGRhdGVTY2VuZUNvZGUiLCJpbnB1dCIsIm9iamVjdCIsInByb2plY3RJZCIsInN0cmluZyIsInNjZW5lSWQiLCJjb2RlIiwibXV0YXRpb24iLCJjdHgiLCJjb25zb2xlIiwibG9nIiwiZXhpc3RpbmdTY2VuZSIsImRiIiwicXVlcnkiLCJmaW5kRmlyc3QiLCJ3aGVyZSIsImlkIiwid2l0aCIsInByb2plY3QiLCJFcnJvciIsInVzZXJJZCIsInNlc3Npb24iLCJ1c2VyIiwiY29kZUJlZm9yZSIsInRzeENvZGUiLCJ1cGRhdGVkU2NlbmVzIiwidXBkYXRlIiwic2V0IiwidXBkYXRlZEF0IiwiRGF0ZSIsInJldHVybmluZyIsInN1Y2Nlc3MiLCJzY2VuZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/scenes.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/share.ts":
/*!*****************************************!*\
  !*** ./src/server/api/routers/share.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   shareRouter: () => (/* binding */ shareRouter)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var _trpc_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @trpc/server */ \"(rsc)/../../node_modules/@trpc/server/dist/index.mjs\");\n/* harmony import */ var _lib_utils_url__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/lib/utils/url */ \"(rsc)/./src/lib/utils/url.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([drizzle_orm__WEBPACK_IMPORTED_MODULE_0__, _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__, _bazaar_database__WEBPACK_IMPORTED_MODULE_2__]);\n([drizzle_orm__WEBPACK_IMPORTED_MODULE_0__, _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__, _bazaar_database__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n//src/server/api/routers/share.ts\n\n\n\n\n\n\n\n\nconst shareRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.createTRPCRouter)({\n    // Create a shared video link\n    createShare: _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_5__.z.object({\n        projectId: zod__WEBPACK_IMPORTED_MODULE_5__.z.string().uuid(),\n        title: zod__WEBPACK_IMPORTED_MODULE_5__.z.string().optional(),\n        description: zod__WEBPACK_IMPORTED_MODULE_5__.z.string().optional()\n    })).mutation(async ({ ctx, input })=>{\n        const { projectId, title, description } = input;\n        const userId = ctx.session.user.id;\n        const project = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.query.projects.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.projects.id, projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.projects.userId, userId))\n        });\n        if (!project) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Project not found or you don't have permission to share it\"\n            });\n        }\n        const projectScenes = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.query.scenes.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.scenes.projectId, projectId)\n        });\n        if (projectScenes.length === 0) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"No scenes found for this project. Please create some content first.\"\n            });\n        }\n        const existingShare = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.query.sharedVideos.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.projectId, projectId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.userId, userId))\n        });\n        let shareId;\n        if (existingShare) {\n            await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos).set({\n                title: title || project.title,\n                description,\n                videoUrl: null,\n                isPublic: true\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.id, existingShare.id));\n            shareId = existingShare.id;\n        } else {\n            const newShare = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos).values({\n                projectId,\n                userId,\n                title: title || project.title,\n                description,\n                videoUrl: null,\n                isPublic: true\n            }).returning({\n                id: _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.id\n            });\n            shareId = newShare[0].id;\n        }\n        return {\n            shareId,\n            shareUrl: (0,_lib_utils_url__WEBPACK_IMPORTED_MODULE_4__.getShareUrl)(shareId)\n        };\n    }),\n    // Get shared video by ID (public endpoint)\n    getSharedVideo: _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.publicProcedure.input(zod__WEBPACK_IMPORTED_MODULE_5__.z.object({\n        shareId: zod__WEBPACK_IMPORTED_MODULE_5__.z.string().uuid()\n    })).query(async ({ input })=>{\n        const { shareId } = input;\n        const sharedVideo = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.query.sharedVideos.findFirst({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.id, shareId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.isPublic, true), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.isNull)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.expiresAt), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`${_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.expiresAt} > NOW()`)),\n            with: {\n                project: {\n                    columns: {\n                        id: true,\n                        title: true,\n                        props: true\n                    },\n                    with: {\n                        scenes: {\n                            orderBy: (scenesTable, { asc })=>[\n                                    asc(scenesTable.order)\n                                ],\n                            columns: {\n                                id: true,\n                                tsxCode: true,\n                                duration: true,\n                                name: true,\n                                props: true,\n                                order: true\n                            }\n                        }\n                    }\n                },\n                user: {\n                    columns: {\n                        id: true,\n                        name: true\n                    }\n                }\n            }\n        });\n        if (!sharedVideo || !sharedVideo.project) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Shared video or associated project not found or no longer available\"\n            });\n        }\n        await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.update(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos).set({\n            viewCount: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`COALESCE(\"viewCount\", 0) + 1`\n        }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.id, shareId));\n        const allProjectScenes = sharedVideo.project.scenes;\n        let currentStart = 0;\n        // Map scenes to format compatible with DynamicVideo composition\n        const formattedScenes = allProjectScenes.map((dbScene, index)=>{\n            const sceneDuration = dbScene.duration || 180; // Default if null\n            const sceneToAdd = {\n                id: dbScene.id,\n                type: 'custom',\n                start: currentStart,\n                duration: sceneDuration,\n                data: {\n                    code: dbScene.tsxCode,\n                    name: dbScene.name || `Scene ${(dbScene.order ?? index) + 1}`,\n                    componentId: dbScene.id,\n                    props: dbScene.props || {}\n                }\n            };\n            currentStart += sceneDuration;\n            return sceneToAdd;\n        });\n        const projectInputProps = {\n            meta: {\n                title: sharedVideo.title || sharedVideo.project.title || \"Untitled Video\",\n                duration: currentStart,\n                backgroundColor: sharedVideo.project.props?.meta?.backgroundColor || '#000000'\n            },\n            scenes: formattedScenes\n        };\n        return {\n            id: sharedVideo.id,\n            projectId: sharedVideo.projectId,\n            userId: sharedVideo.userId,\n            title: sharedVideo.title,\n            description: sharedVideo.description,\n            videoUrl: sharedVideo.videoUrl,\n            thumbnailUrl: sharedVideo.thumbnailUrl,\n            isPublic: sharedVideo.isPublic,\n            viewCount: sharedVideo.viewCount,\n            createdAt: sharedVideo.createdAt,\n            expiresAt: sharedVideo.expiresAt,\n            creator: sharedVideo.user,\n            project: {\n                id: sharedVideo.project.id,\n                title: sharedVideo.project.title,\n                inputProps: projectInputProps\n            }\n        };\n    }),\n    // Get user's shared videos\n    getMyShares: _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.protectedProcedure.query(async ({ ctx })=>{\n        const userId = ctx.session.user.id;\n        const shares = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.query.sharedVideos.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.userId, userId),\n            with: {\n                project: {\n                    columns: {\n                        title: true\n                    }\n                }\n            },\n            orderBy: (sharedVideos, { desc })=>[\n                    desc(sharedVideos.createdAt)\n                ]\n        });\n        return shares.map((share)=>({\n                id: share.id,\n                title: share.title,\n                description: share.description,\n                viewCount: share.viewCount ?? 0,\n                createdAt: share.createdAt,\n                shareUrl: (0,_lib_utils_url__WEBPACK_IMPORTED_MODULE_4__.getShareUrl)(share.id),\n                project: share.project\n            }));\n    }),\n    // Delete shared video\n    deleteShare: _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_5__.z.object({\n        shareId: zod__WEBPACK_IMPORTED_MODULE_5__.z.string().uuid()\n    })).mutation(async ({ ctx, input })=>{\n        const { shareId } = input;\n        const userId = ctx.session.user.id;\n        const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.id, shareId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.userId, userId))).returning({\n            id: _bazaar_database__WEBPACK_IMPORTED_MODULE_2__.sharedVideos.id\n        });\n        if (result.length === 0) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_3__.TRPCError({\n                code: \"NOT_FOUND\",\n                message: \"Shared video not found or you don't have permission to delete it\"\n            });\n        }\n        return {\n            success: true\n        };\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvc2hhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL3NoYXJlLnRzXG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuaW1wb3J0IHsgZXEsIGFuZCwgZGVzYywgaXNOdWxsLCBvciwgYXNjIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyBzcWwgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IGNyZWF0ZVRSUENSb3V0ZXIsIHByb3RlY3RlZFByb2NlZHVyZSwgcHVibGljUHJvY2VkdXJlIH0gZnJvbSBcIn4vc2VydmVyL2FwaS90cnBjXCI7XG5pbXBvcnQgeyBkYiB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBwcm9qZWN0cywgc2NlbmVzLCBzaGFyZWRWaWRlb3MgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgVFJQQ0Vycm9yIH0gZnJvbSBcIkB0cnBjL3NlcnZlclwiO1xuaW1wb3J0IHsgZ2V0U2hhcmVVcmwgfSBmcm9tIFwifi9saWIvdXRpbHMvdXJsXCI7XG5pbXBvcnQgdHlwZSB7IElucHV0UHJvcHMgfSBmcm9tIFwifi9saWIvdHlwZXMvdmlkZW8vaW5wdXQtcHJvcHNcIjtcblxuZXhwb3J0IGNvbnN0IHNoYXJlUm91dGVyID0gY3JlYXRlVFJQQ1JvdXRlcih7XG4gIC8vIENyZWF0ZSBhIHNoYXJlZCB2aWRlbyBsaW5rXG4gIGNyZWF0ZVNoYXJlOiBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgcHJvamVjdElkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgICAgIHRpdGxlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBjdHgsIGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgcHJvamVjdElkLCB0aXRsZSwgZGVzY3JpcHRpb24gfSA9IGlucHV0O1xuICAgICAgY29uc3QgdXNlcklkID0gY3R4LnNlc3Npb24udXNlci5pZDtcblxuICAgICAgY29uc3QgcHJvamVjdCA9IGF3YWl0IGRiLnF1ZXJ5LnByb2plY3RzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoZXEocHJvamVjdHMuaWQsIHByb2plY3RJZCksIGVxKHByb2plY3RzLnVzZXJJZCwgdXNlcklkKSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFwcm9qZWN0KSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJQcm9qZWN0IG5vdCBmb3VuZCBvciB5b3UgZG9uJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHNoYXJlIGl0XCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwcm9qZWN0U2NlbmVzID0gYXdhaXQgZGIucXVlcnkuc2NlbmVzLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IGVxKHNjZW5lcy5wcm9qZWN0SWQsIHByb2plY3RJZCksXG4gICAgICB9KTtcblxuICAgICAgaWYgKHByb2plY3RTY2VuZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJObyBzY2VuZXMgZm91bmQgZm9yIHRoaXMgcHJvamVjdC4gUGxlYXNlIGNyZWF0ZSBzb21lIGNvbnRlbnQgZmlyc3QuXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBleGlzdGluZ1NoYXJlID0gYXdhaXQgZGIucXVlcnkuc2hhcmVkVmlkZW9zLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgZXEoc2hhcmVkVmlkZW9zLnByb2plY3RJZCwgcHJvamVjdElkKSxcbiAgICAgICAgICBlcShzaGFyZWRWaWRlb3MudXNlcklkLCB1c2VySWQpXG4gICAgICAgICksXG4gICAgICB9KTtcblxuICAgICAgbGV0IHNoYXJlSWQ6IHN0cmluZztcblxuICAgICAgaWYgKGV4aXN0aW5nU2hhcmUpIHtcbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAudXBkYXRlKHNoYXJlZFZpZGVvcylcbiAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSB8fCBwcm9qZWN0LnRpdGxlLFxuICAgICAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgICAgICB2aWRlb1VybDogbnVsbCwgXG4gICAgICAgICAgICBpc1B1YmxpYzogdHJ1ZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC53aGVyZShlcShzaGFyZWRWaWRlb3MuaWQsIGV4aXN0aW5nU2hhcmUuaWQpKTtcbiAgICAgICAgc2hhcmVJZCA9IGV4aXN0aW5nU2hhcmUuaWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBuZXdTaGFyZSA9IGF3YWl0IGRiXG4gICAgICAgICAgLmluc2VydChzaGFyZWRWaWRlb3MpXG4gICAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aXRsZTogdGl0bGUgfHwgcHJvamVjdC50aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgdmlkZW9Vcmw6IG51bGwsIFxuICAgICAgICAgICAgaXNQdWJsaWM6IHRydWUsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAucmV0dXJuaW5nKHsgaWQ6IHNoYXJlZFZpZGVvcy5pZCB9KTtcbiAgICAgICAgc2hhcmVJZCA9IG5ld1NoYXJlWzBdIS5pZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2hhcmVJZCxcbiAgICAgICAgc2hhcmVVcmw6IGdldFNoYXJlVXJsKHNoYXJlSWQpLFxuICAgICAgfTtcbiAgICB9KSxcblxuICAvLyBHZXQgc2hhcmVkIHZpZGVvIGJ5IElEIChwdWJsaWMgZW5kcG9pbnQpXG4gIGdldFNoYXJlZFZpZGVvOiBwdWJsaWNQcm9jZWR1cmVcbiAgICAuaW5wdXQoei5vYmplY3Qoe1xuICAgICAgc2hhcmVJZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgfSkpXG4gICAgLnF1ZXJ5KGFzeW5jICh7IGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgc2hhcmVJZCB9ID0gaW5wdXQ7XG5cbiAgICAgIGNvbnN0IHNoYXJlZFZpZGVvID0gYXdhaXQgZGIucXVlcnkuc2hhcmVkVmlkZW9zLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgZXEoc2hhcmVkVmlkZW9zLmlkLCBzaGFyZUlkKSxcbiAgICAgICAgICBlcShzaGFyZWRWaWRlb3MuaXNQdWJsaWMsIHRydWUpLFxuICAgICAgICAgIG9yKGlzTnVsbChzaGFyZWRWaWRlb3MuZXhwaXJlc0F0KSwgc3FsYCR7c2hhcmVkVmlkZW9zLmV4cGlyZXNBdH0gPiBOT1coKWApXG4gICAgICAgICksXG4gICAgICAgIHdpdGg6IHtcbiAgICAgICAgICBwcm9qZWN0OiB7XG4gICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgcHJvcHM6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd2l0aDoge1xuICAgICAgICAgICAgICBzY2VuZXM6IHtcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiAoc2NlbmVzVGFibGUsIHsgYXNjIH0pID0+IFthc2Moc2NlbmVzVGFibGUub3JkZXIpXSxcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHRzeENvZGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBwcm9wczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIG9yZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXNoYXJlZFZpZGVvIHx8ICFzaGFyZWRWaWRlby5wcm9qZWN0KSB7XG4gICAgICAgIHRocm93IG5ldyBUUlBDRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJTaGFyZWQgdmlkZW8gb3IgYXNzb2NpYXRlZCBwcm9qZWN0IG5vdCBmb3VuZCBvciBubyBsb25nZXIgYXZhaWxhYmxlXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNoYXJlZFZpZGVvcylcbiAgICAgICAgLnNldCh7IHZpZXdDb3VudDogc3FsYENPQUxFU0NFKFwidmlld0NvdW50XCIsIDApICsgMWAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNoYXJlZFZpZGVvcy5pZCwgc2hhcmVJZCkpO1xuICAgICAgICBcbiAgICAgIGNvbnN0IGFsbFByb2plY3RTY2VuZXMgPSBzaGFyZWRWaWRlby5wcm9qZWN0LnNjZW5lcztcbiAgICAgIGxldCBjdXJyZW50U3RhcnQgPSAwO1xuICAgICAgXG4gICAgICAvLyBNYXAgc2NlbmVzIHRvIGZvcm1hdCBjb21wYXRpYmxlIHdpdGggRHluYW1pY1ZpZGVvIGNvbXBvc2l0aW9uXG4gICAgICBjb25zdCBmb3JtYXR0ZWRTY2VuZXMgPSBhbGxQcm9qZWN0U2NlbmVzLm1hcCgoZGJTY2VuZSwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3Qgc2NlbmVEdXJhdGlvbiA9IGRiU2NlbmUuZHVyYXRpb24gfHwgMTgwOyAvLyBEZWZhdWx0IGlmIG51bGxcbiAgICAgICAgY29uc3Qgc2NlbmVUb0FkZCA9IHtcbiAgICAgICAgICBpZDogZGJTY2VuZS5pZCxcbiAgICAgICAgICB0eXBlOiAnY3VzdG9tJyBhcyBjb25zdCwgLy8gQWxsIGRhdGFiYXNlIHNjZW5lcyBhcmUgdHJlYXRlZCBhcyBjdXN0b20gVFNYIGNvbXBvbmVudHNcbiAgICAgICAgICBzdGFydDogY3VycmVudFN0YXJ0LFxuICAgICAgICAgIGR1cmF0aW9uOiBzY2VuZUR1cmF0aW9uLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGNvZGU6IGRiU2NlbmUudHN4Q29kZSwgLy8gSW5jbHVkZSB0aGUgVFNYIGNvZGUgZGlyZWN0bHlcbiAgICAgICAgICAgIG5hbWU6IGRiU2NlbmUubmFtZSB8fCBgU2NlbmUgJHsoZGJTY2VuZS5vcmRlciA/PyBpbmRleCkgKyAxfWAsXG4gICAgICAgICAgICBjb21wb25lbnRJZDogZGJTY2VuZS5pZCwgLy8gVXNlIHNjZW5lIElEIGFzIGNvbXBvbmVudCBJRFxuICAgICAgICAgICAgcHJvcHM6IGRiU2NlbmUucHJvcHMgfHwge30sXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgY3VycmVudFN0YXJ0ICs9IHNjZW5lRHVyYXRpb247XG4gICAgICAgIHJldHVybiBzY2VuZVRvQWRkO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHByb2plY3RJbnB1dFByb3BzOiBJbnB1dFByb3BzID0ge1xuICAgICAgICBtZXRhOiB7XG4gICAgICAgICAgdGl0bGU6IHNoYXJlZFZpZGVvLnRpdGxlIHx8IHNoYXJlZFZpZGVvLnByb2plY3QudGl0bGUgfHwgXCJVbnRpdGxlZCBWaWRlb1wiLFxuICAgICAgICAgIGR1cmF0aW9uOiBjdXJyZW50U3RhcnQsIC8vIFRvdGFsIGR1cmF0aW9uIG9mIGFsbCBzY2VuZXNcbiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IChzaGFyZWRWaWRlby5wcm9qZWN0LnByb3BzIGFzIElucHV0UHJvcHMpPy5tZXRhPy5iYWNrZ3JvdW5kQ29sb3IgfHwgJyMwMDAwMDAnLFxuICAgICAgICB9LFxuICAgICAgICBzY2VuZXM6IGZvcm1hdHRlZFNjZW5lcyxcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBzaGFyZWRWaWRlby5pZCxcbiAgICAgICAgcHJvamVjdElkOiBzaGFyZWRWaWRlby5wcm9qZWN0SWQsXG4gICAgICAgIHVzZXJJZDogc2hhcmVkVmlkZW8udXNlcklkLFxuICAgICAgICB0aXRsZTogc2hhcmVkVmlkZW8udGl0bGUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBzaGFyZWRWaWRlby5kZXNjcmlwdGlvbixcbiAgICAgICAgdmlkZW9Vcmw6IHNoYXJlZFZpZGVvLnZpZGVvVXJsLFxuICAgICAgICB0aHVtYm5haWxVcmw6IHNoYXJlZFZpZGVvLnRodW1ibmFpbFVybCxcbiAgICAgICAgaXNQdWJsaWM6IHNoYXJlZFZpZGVvLmlzUHVibGljLFxuICAgICAgICB2aWV3Q291bnQ6IHNoYXJlZFZpZGVvLnZpZXdDb3VudCxcbiAgICAgICAgY3JlYXRlZEF0OiBzaGFyZWRWaWRlby5jcmVhdGVkQXQsXG4gICAgICAgIGV4cGlyZXNBdDogc2hhcmVkVmlkZW8uZXhwaXJlc0F0LFxuICAgICAgICBjcmVhdG9yOiBzaGFyZWRWaWRlby51c2VyLFxuICAgICAgICBwcm9qZWN0OiB7XG4gICAgICAgICAgICBpZDogc2hhcmVkVmlkZW8ucHJvamVjdC5pZCxcbiAgICAgICAgICAgIHRpdGxlOiBzaGFyZWRWaWRlby5wcm9qZWN0LnRpdGxlLFxuICAgICAgICAgICAgaW5wdXRQcm9wczogcHJvamVjdElucHV0UHJvcHMgXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSksXG5cbiAgLy8gR2V0IHVzZXIncyBzaGFyZWQgdmlkZW9zXG4gIGdldE15U2hhcmVzOiBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgICAucXVlcnkoYXN5bmMgKHsgY3R4IH0pID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGN0eC5zZXNzaW9uLnVzZXIuaWQ7XG4gICAgICBjb25zdCBzaGFyZXMgPSBhd2FpdCBkYi5xdWVyeS5zaGFyZWRWaWRlb3MuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogZXEoc2hhcmVkVmlkZW9zLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgd2l0aDoge1xuICAgICAgICAgIHByb2plY3Q6IHsgY29sdW1uczogeyB0aXRsZTogdHJ1ZSB9IH0sXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IChzaGFyZWRWaWRlb3MsIHsgZGVzYyB9KSA9PiBbZGVzYyhzaGFyZWRWaWRlb3MuY3JlYXRlZEF0KV0sXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzaGFyZXMubWFwKHNoYXJlID0+ICh7XG4gICAgICAgIGlkOiBzaGFyZS5pZCxcbiAgICAgICAgdGl0bGU6IHNoYXJlLnRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogc2hhcmUuZGVzY3JpcHRpb24sXG4gICAgICAgIHZpZXdDb3VudDogc2hhcmUudmlld0NvdW50ID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogc2hhcmUuY3JlYXRlZEF0LFxuICAgICAgICBzaGFyZVVybDogZ2V0U2hhcmVVcmwoc2hhcmUuaWQpLFxuICAgICAgICBwcm9qZWN0OiBzaGFyZS5wcm9qZWN0LFxuICAgICAgfSkpO1xuICAgIH0pLFxuXG4gIC8vIERlbGV0ZSBzaGFyZWQgdmlkZW9cbiAgZGVsZXRlU2hhcmU6IHByb3RlY3RlZFByb2NlZHVyZVxuICAgIC5pbnB1dCh6Lm9iamVjdCh7IHNoYXJlSWQ6IHouc3RyaW5nKCkudXVpZCgpIH0pKVxuICAgIC5tdXRhdGlvbihhc3luYyAoeyBjdHgsIGlucHV0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgc2hhcmVJZCB9ID0gaW5wdXQ7XG4gICAgICBjb25zdCB1c2VySWQgPSBjdHguc2Vzc2lvbi51c2VyLmlkO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShzaGFyZWRWaWRlb3MpXG4gICAgICAgIC53aGVyZShhbmQoZXEoc2hhcmVkVmlkZW9zLmlkLCBzaGFyZUlkKSwgZXEoc2hhcmVkVmlkZW9zLnVzZXJJZCwgdXNlcklkKSkpXG4gICAgICAgIC5yZXR1cm5pbmcoeyBpZDogc2hhcmVkVmlkZW9zLmlkIH0pO1xuXG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgVFJQQ0Vycm9yKHtcbiAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiU2hhcmVkIHZpZGVvIG5vdCBmb3VuZCBvciB5b3UgZG9uJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGRlbGV0ZSBpdFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9KSxcbn0pO1xuIl0sIm5hbWVzIjpbInoiLCJlcSIsImFuZCIsImlzTnVsbCIsIm9yIiwic3FsIiwiY3JlYXRlVFJQQ1JvdXRlciIsInByb3RlY3RlZFByb2NlZHVyZSIsInB1YmxpY1Byb2NlZHVyZSIsImRiIiwicHJvamVjdHMiLCJzY2VuZXMiLCJzaGFyZWRWaWRlb3MiLCJUUlBDRXJyb3IiLCJnZXRTaGFyZVVybCIsInNoYXJlUm91dGVyIiwiY3JlYXRlU2hhcmUiLCJpbnB1dCIsIm9iamVjdCIsInByb2plY3RJZCIsInN0cmluZyIsInV1aWQiLCJ0aXRsZSIsIm9wdGlvbmFsIiwiZGVzY3JpcHRpb24iLCJtdXRhdGlvbiIsImN0eCIsInVzZXJJZCIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJwcm9qZWN0IiwicXVlcnkiLCJmaW5kRmlyc3QiLCJ3aGVyZSIsImNvZGUiLCJtZXNzYWdlIiwicHJvamVjdFNjZW5lcyIsImZpbmRNYW55IiwibGVuZ3RoIiwiZXhpc3RpbmdTaGFyZSIsInNoYXJlSWQiLCJ1cGRhdGUiLCJzZXQiLCJ2aWRlb1VybCIsImlzUHVibGljIiwibmV3U2hhcmUiLCJpbnNlcnQiLCJ2YWx1ZXMiLCJyZXR1cm5pbmciLCJzaGFyZVVybCIsImdldFNoYXJlZFZpZGVvIiwic2hhcmVkVmlkZW8iLCJleHBpcmVzQXQiLCJ3aXRoIiwiY29sdW1ucyIsInByb3BzIiwib3JkZXJCeSIsInNjZW5lc1RhYmxlIiwiYXNjIiwib3JkZXIiLCJ0c3hDb2RlIiwiZHVyYXRpb24iLCJuYW1lIiwidmlld0NvdW50IiwiYWxsUHJvamVjdFNjZW5lcyIsImN1cnJlbnRTdGFydCIsImZvcm1hdHRlZFNjZW5lcyIsIm1hcCIsImRiU2NlbmUiLCJpbmRleCIsInNjZW5lRHVyYXRpb24iLCJzY2VuZVRvQWRkIiwidHlwZSIsInN0YXJ0IiwiZGF0YSIsImNvbXBvbmVudElkIiwicHJvamVjdElucHV0UHJvcHMiLCJtZXRhIiwiYmFja2dyb3VuZENvbG9yIiwidGh1bWJuYWlsVXJsIiwiY3JlYXRlZEF0IiwiY3JlYXRvciIsImlucHV0UHJvcHMiLCJnZXRNeVNoYXJlcyIsInNoYXJlcyIsImRlc2MiLCJzaGFyZSIsImRlbGV0ZVNoYXJlIiwicmVzdWx0IiwiZGVsZXRlIiwic3VjY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/share.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/routers/voice.ts":
/*!*****************************************!*\
  !*** ./src/server/api/routers/voice.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   voiceRouter: () => (/* binding */ voiceRouter)\n/* harmony export */ });\n/* harmony import */ var openai_shims_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai/shims/node */ \"(rsc)/../../node_modules/openai/shims/node.mjs\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/server/api/trpc */ \"(rsc)/./src/server/api/trpc.ts\");\n/* harmony import */ var _server_lib_openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/server/lib/openai */ \"(rsc)/./src/server/lib/openai.ts\");\n/* harmony import */ var openai_uploads__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! openai/uploads */ \"(rsc)/../../node_modules/openai/uploads.mjs\");\n/* harmony import */ var _lib_utils_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/lib/utils/logger */ \"(rsc)/./src/lib/utils/logger.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_api_trpc__WEBPACK_IMPORTED_MODULE_1__]);\n_server_api_trpc__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// src/server/api/routers/voice.ts\n\n\n\n\n\n\n// Map MIME types to appropriate file extensions for Whisper API\nconst mimeToExtension = {\n    'audio/webm': 'webm',\n    'audio/webm;codecs=opus': 'webm',\n    'audio/mp4': 'mp4',\n    'audio/mpeg': 'mp3',\n    'audio/mp3': 'mp3',\n    'audio/ogg': 'ogg',\n    'audio/ogg;codecs=opus': 'ogg',\n    'audio/wav': 'wav',\n    'audio/x-wav': 'wav'\n};\nconst voiceRouter = (0,_server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.createTRPCRouter)({\n    transcribe: _server_api_trpc__WEBPACK_IMPORTED_MODULE_1__.protectedProcedure.input(zod__WEBPACK_IMPORTED_MODULE_4__.z.object({\n        audio: zod__WEBPACK_IMPORTED_MODULE_4__.z.string(),\n        mimeType: zod__WEBPACK_IMPORTED_MODULE_4__.z.string().optional()\n    })).mutation(async ({ input, ctx })=>{\n        try {\n            // Extract base64 data and determine appropriate file extension\n            const base64 = input.audio.replace(/^data:.*?;base64,/, '');\n            const mimeType = input.mimeType ?? 'audio/webm';\n            // Get appropriate extension or default to mp3\n            const extension = mimeToExtension[mimeType] || 'mp3';\n            const filename = `audio.${extension}`;\n            _lib_utils_logger__WEBPACK_IMPORTED_MODULE_3__.logger.info(`Processing audio transcription with format: ${mimeType} -> ${extension}`);\n            // Convert to buffer and create file\n            const buffer = Buffer.from(base64, 'base64');\n            const file = await (0,openai_uploads__WEBPACK_IMPORTED_MODULE_5__.toFile)(buffer, filename, {\n                type: mimeType\n            });\n            // Send to OpenAI Whisper API\n            const result = await _server_lib_openai__WEBPACK_IMPORTED_MODULE_2__.openai.audio.transcriptions.create({\n                file,\n                model: 'whisper-1',\n                response_format: 'text'\n            });\n            // Handle the response based on response_format: 'text'\n            // When response_format is 'text', result will be a string\n            let text;\n            if (typeof result === 'string') {\n                // Direct string response (expected with response_format: 'text')\n                text = result;\n            } else if (result && typeof result === 'object' && 'text' in result) {\n                // Object with text property\n                text = result.text;\n            } else {\n                // Fallback for unexpected formats\n                _lib_utils_logger__WEBPACK_IMPORTED_MODULE_3__.logger.warn('Unexpected response format from Whisper API:', result);\n                text = String(result);\n            }\n            _lib_utils_logger__WEBPACK_IMPORTED_MODULE_3__.logger.info(`Transcription successful: ${text.substring(0, 50)}${text.length > 50 ? '...' : ''}`);\n            return {\n                text\n            };\n        } catch (error) {\n            _lib_utils_logger__WEBPACK_IMPORTED_MODULE_3__.logger.error('Transcription error:', error);\n            throw error;\n        }\n    })\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS9yb3V0ZXJzL3ZvaWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxrQ0FBa0M7QUFDUDtBQUNIO0FBQ2lEO0FBQzVCO0FBQ0w7QUFDSTtBQVE1QyxnRUFBZ0U7QUFDaEUsTUFBTU0sa0JBQWtCO0lBQ3RCLGNBQWM7SUFDZCwwQkFBMEI7SUFDMUIsYUFBYTtJQUNiLGNBQWM7SUFDZCxhQUFhO0lBQ2IsYUFBYTtJQUNiLHlCQUF5QjtJQUN6QixhQUFhO0lBQ2IsZUFBZTtBQUNqQjtBQUVPLE1BQU1DLGNBQWNOLGtFQUFnQkEsQ0FBQztJQUMxQ08sWUFBWU4sZ0VBQWtCQSxDQUMzQk8sS0FBSyxDQUNKVCxrQ0FBQ0EsQ0FBQ1UsTUFBTSxDQUFDO1FBQ1BDLE9BQU9YLGtDQUFDQSxDQUFDWSxNQUFNO1FBQ2ZDLFVBQVViLGtDQUFDQSxDQUFDWSxNQUFNLEdBQUdFLFFBQVE7SUFDL0IsSUFFREMsUUFBUSxDQUFDLE9BQU8sRUFBRU4sS0FBSyxFQUFFTyxHQUFHLEVBQUU7UUFDN0IsSUFBSTtZQUNGLCtEQUErRDtZQUMvRCxNQUFNQyxTQUFTUixNQUFNRSxLQUFLLENBQUNPLE9BQU8sQ0FBQyxxQkFBcUI7WUFDeEQsTUFBTUwsV0FBV0osTUFBTUksUUFBUSxJQUFJO1lBRW5DLDhDQUE4QztZQUM5QyxNQUFNTSxZQUFZYixlQUFlLENBQUNPLFNBQXlDLElBQUk7WUFDL0UsTUFBTU8sV0FBVyxDQUFDLE1BQU0sRUFBRUQsV0FBVztZQUVyQ2QscURBQU1BLENBQUNnQixJQUFJLENBQUMsQ0FBQyw0Q0FBNEMsRUFBRVIsU0FBUyxJQUFJLEVBQUVNLFdBQVc7WUFFckYsb0NBQW9DO1lBQ3BDLE1BQU1HLFNBQVNDLE9BQU9DLElBQUksQ0FBQ1AsUUFBUTtZQUNuQyxNQUFNUSxPQUFPLE1BQU1yQixzREFBTUEsQ0FBQ2tCLFFBQVFGLFVBQVU7Z0JBQUVNLE1BQU1iO1lBQVM7WUFFN0QsNkJBQTZCO1lBQzdCLE1BQU1jLFNBQVMsTUFBTXhCLHNEQUFNQSxDQUFDUSxLQUFLLENBQUNpQixjQUFjLENBQUNDLE1BQU0sQ0FBQztnQkFDdERKO2dCQUNBSyxPQUFPO2dCQUNQQyxpQkFBaUI7WUFDbkI7WUFFQSx1REFBdUQ7WUFDdkQsMERBQTBEO1lBQzFELElBQUlDO1lBRUosSUFBSSxPQUFPTCxXQUFXLFVBQVU7Z0JBQzlCLGlFQUFpRTtnQkFDakVLLE9BQU9MO1lBQ1QsT0FBTyxJQUFJQSxVQUFVLE9BQU9BLFdBQVcsWUFBWSxVQUFVQSxRQUFRO2dCQUNuRSw0QkFBNEI7Z0JBQzVCSyxPQUFPLE9BQXdDQSxJQUFJO1lBQ3JELE9BQU87Z0JBQ0wsa0NBQWtDO2dCQUNsQzNCLHFEQUFNQSxDQUFDNEIsSUFBSSxDQUFDLGdEQUFnRE47Z0JBQzVESyxPQUFPRSxPQUFPUDtZQUNoQjtZQUVBdEIscURBQU1BLENBQUNnQixJQUFJLENBQUMsQ0FBQywwQkFBMEIsRUFBRVcsS0FBS0csU0FBUyxDQUFDLEdBQUcsTUFBTUgsS0FBS0ksTUFBTSxHQUFHLEtBQUssUUFBUSxJQUFJO1lBRWhHLE9BQU87Z0JBQUVKO1lBQUs7UUFDaEIsRUFBRSxPQUFPSyxPQUFPO1lBQ2RoQyxxREFBTUEsQ0FBQ2dDLEtBQUssQ0FBQyx3QkFBd0JBO1lBQ3JDLE1BQU1BO1FBQ1I7SUFDRjtBQUNKLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy9zZXJ2ZXIvYXBpL3JvdXRlcnMvdm9pY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9hcGkvcm91dGVycy92b2ljZS50c1xuaW1wb3J0IFwib3BlbmFpL3NoaW1zL25vZGVcIjtcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgY3JlYXRlVFJQQ1JvdXRlciwgcHJvdGVjdGVkUHJvY2VkdXJlIH0gZnJvbSAnfi9zZXJ2ZXIvYXBpL3RycGMnO1xuaW1wb3J0IHsgb3BlbmFpIH0gZnJvbSAnfi9zZXJ2ZXIvbGliL29wZW5haSc7XG5pbXBvcnQgeyB0b0ZpbGUgfSBmcm9tICdvcGVuYWkvdXBsb2Fkcyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICd+L2xpYi91dGlscy9sb2dnZXInO1xuXG4vLyBEZWZpbmUgcG9zc2libGUgcmVzcG9uc2UgdHlwZXMgZnJvbSBXaGlzcGVyIEFQSVxuaW50ZXJmYWNlIFRyYW5zY3JpcHRpb25SZXNwb25zZU9iamVjdCB7XG4gIHRleHQ6IHN0cmluZztcbiAgW2tleTogc3RyaW5nXTogdW5rbm93bjtcbn1cblxuLy8gTWFwIE1JTUUgdHlwZXMgdG8gYXBwcm9wcmlhdGUgZmlsZSBleHRlbnNpb25zIGZvciBXaGlzcGVyIEFQSVxuY29uc3QgbWltZVRvRXh0ZW5zaW9uID0ge1xuICAnYXVkaW8vd2VibSc6ICd3ZWJtJyxcbiAgJ2F1ZGlvL3dlYm07Y29kZWNzPW9wdXMnOiAnd2VibScsXG4gICdhdWRpby9tcDQnOiAnbXA0JyxcbiAgJ2F1ZGlvL21wZWcnOiAnbXAzJyxcbiAgJ2F1ZGlvL21wMyc6ICdtcDMnLFxuICAnYXVkaW8vb2dnJzogJ29nZycsXG4gICdhdWRpby9vZ2c7Y29kZWNzPW9wdXMnOiAnb2dnJyxcbiAgJ2F1ZGlvL3dhdic6ICd3YXYnLFxuICAnYXVkaW8veC13YXYnOiAnd2F2Jyxcbn07XG5cbmV4cG9ydCBjb25zdCB2b2ljZVJvdXRlciA9IGNyZWF0ZVRSUENSb3V0ZXIoe1xuICB0cmFuc2NyaWJlOiBwcm90ZWN0ZWRQcm9jZWR1cmVcbiAgICAuaW5wdXQoXG4gICAgICB6Lm9iamVjdCh7XG4gICAgICAgIGF1ZGlvOiB6LnN0cmluZygpLFxuICAgICAgICBtaW1lVHlwZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgfSlcbiAgICApXG4gICAgLm11dGF0aW9uKGFzeW5jICh7IGlucHV0LCBjdHggfSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRXh0cmFjdCBiYXNlNjQgZGF0YSBhbmQgZGV0ZXJtaW5lIGFwcHJvcHJpYXRlIGZpbGUgZXh0ZW5zaW9uXG4gICAgICAgIGNvbnN0IGJhc2U2NCA9IGlucHV0LmF1ZGlvLnJlcGxhY2UoL15kYXRhOi4qPztiYXNlNjQsLywgJycpO1xuICAgICAgICBjb25zdCBtaW1lVHlwZSA9IGlucHV0Lm1pbWVUeXBlID8/ICdhdWRpby93ZWJtJztcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBhcHByb3ByaWF0ZSBleHRlbnNpb24gb3IgZGVmYXVsdCB0byBtcDNcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gbWltZVRvRXh0ZW5zaW9uW21pbWVUeXBlIGFzIGtleW9mIHR5cGVvZiBtaW1lVG9FeHRlbnNpb25dIHx8ICdtcDMnO1xuICAgICAgICBjb25zdCBmaWxlbmFtZSA9IGBhdWRpby4ke2V4dGVuc2lvbn1gO1xuICAgICAgICBcbiAgICAgICAgbG9nZ2VyLmluZm8oYFByb2Nlc3NpbmcgYXVkaW8gdHJhbnNjcmlwdGlvbiB3aXRoIGZvcm1hdDogJHttaW1lVHlwZX0gLT4gJHtleHRlbnNpb259YCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDb252ZXJ0IHRvIGJ1ZmZlciBhbmQgY3JlYXRlIGZpbGVcbiAgICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oYmFzZTY0LCAnYmFzZTY0Jyk7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0b0ZpbGUoYnVmZmVyLCBmaWxlbmFtZSwgeyB0eXBlOiBtaW1lVHlwZSB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNlbmQgdG8gT3BlbkFJIFdoaXNwZXIgQVBJXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9wZW5haS5hdWRpby50cmFuc2NyaXB0aW9ucy5jcmVhdGUoe1xuICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgbW9kZWw6ICd3aGlzcGVyLTEnLFxuICAgICAgICAgIHJlc3BvbnNlX2Zvcm1hdDogJ3RleHQnLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSB0aGUgcmVzcG9uc2UgYmFzZWQgb24gcmVzcG9uc2VfZm9ybWF0OiAndGV4dCdcbiAgICAgICAgLy8gV2hlbiByZXNwb25zZV9mb3JtYXQgaXMgJ3RleHQnLCByZXN1bHQgd2lsbCBiZSBhIHN0cmluZ1xuICAgICAgICBsZXQgdGV4dDogc3RyaW5nO1xuICAgICAgICBcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgLy8gRGlyZWN0IHN0cmluZyByZXNwb25zZSAoZXhwZWN0ZWQgd2l0aCByZXNwb25zZV9mb3JtYXQ6ICd0ZXh0JylcbiAgICAgICAgICB0ZXh0ID0gcmVzdWx0O1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAndGV4dCcgaW4gcmVzdWx0KSB7XG4gICAgICAgICAgLy8gT2JqZWN0IHdpdGggdGV4dCBwcm9wZXJ0eVxuICAgICAgICAgIHRleHQgPSAocmVzdWx0IGFzIFRyYW5zY3JpcHRpb25SZXNwb25zZU9iamVjdCkudGV4dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGYWxsYmFjayBmb3IgdW5leHBlY3RlZCBmb3JtYXRzXG4gICAgICAgICAgbG9nZ2VyLndhcm4oJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZm9ybWF0IGZyb20gV2hpc3BlciBBUEk6JywgcmVzdWx0KTtcbiAgICAgICAgICB0ZXh0ID0gU3RyaW5nKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGxvZ2dlci5pbmZvKGBUcmFuc2NyaXB0aW9uIHN1Y2Nlc3NmdWw6ICR7dGV4dC5zdWJzdHJpbmcoMCwgNTApfSR7dGV4dC5sZW5ndGggPiA1MCA/ICcuLi4nIDogJyd9YCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4geyB0ZXh0IH07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1RyYW5zY3JpcHRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9KSxcbn0pO1xuIl0sIm5hbWVzIjpbInoiLCJjcmVhdGVUUlBDUm91dGVyIiwicHJvdGVjdGVkUHJvY2VkdXJlIiwib3BlbmFpIiwidG9GaWxlIiwibG9nZ2VyIiwibWltZVRvRXh0ZW5zaW9uIiwidm9pY2VSb3V0ZXIiLCJ0cmFuc2NyaWJlIiwiaW5wdXQiLCJvYmplY3QiLCJhdWRpbyIsInN0cmluZyIsIm1pbWVUeXBlIiwib3B0aW9uYWwiLCJtdXRhdGlvbiIsImN0eCIsImJhc2U2NCIsInJlcGxhY2UiLCJleHRlbnNpb24iLCJmaWxlbmFtZSIsImluZm8iLCJidWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiZmlsZSIsInR5cGUiLCJyZXN1bHQiLCJ0cmFuc2NyaXB0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwicmVzcG9uc2VfZm9ybWF0IiwidGV4dCIsIndhcm4iLCJTdHJpbmciLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJlcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/routers/voice.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/api/trpc.ts":
/*!********************************!*\
  !*** ./src/server/api/trpc.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createCallerFactory: () => (/* binding */ createCallerFactory),\n/* harmony export */   createTRPCContext: () => (/* binding */ createTRPCContext),\n/* harmony export */   createTRPCRouter: () => (/* binding */ createTRPCRouter),\n/* harmony export */   protectedProcedure: () => (/* binding */ protectedProcedure),\n/* harmony export */   publicProcedure: () => (/* binding */ publicProcedure)\n/* harmony export */ });\n/* harmony import */ var _trpc_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @trpc/server */ \"(rsc)/../../node_modules/@trpc/server/dist/index.mjs\");\n/* harmony import */ var superjson__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! superjson */ \"(rsc)/../../node_modules/superjson/dist/index.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n/* harmony import */ var _bazaar_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @bazaar/auth */ \"(rsc)/../../packages/auth/index.ts\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_bazaar_auth__WEBPACK_IMPORTED_MODULE_2__, _bazaar_database__WEBPACK_IMPORTED_MODULE_3__]);\n([_bazaar_auth__WEBPACK_IMPORTED_MODULE_2__, _bazaar_database__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/api/trpc.ts\n/**\n * YOU PROBABLY DON'T NEED TO EDIT THIS FILE, UNLESS:\n * 1. You want to modify request context (see Part 1).\n * 2. You want to create a new middleware or type of procedure (see Part 3).\n *\n * TL;DR - This is where all the tRPC server stuff is created and plugged in. The pieces you will\n * need to use are documented accordingly near the end.\n */ \n\n\n\n\n/**\n * 1. CONTEXT\n *\n * This section defines the \"contexts\" that are available in the backend API.\n *\n * These allow you to access things when processing a request, like the database, the session, etc.\n *\n * This helper generates the \"internals\" for a tRPC context. The API handler and RSC clients each\n * wrap this and provides the required context.\n *\n * @see https://trpc.io/docs/server/context\n */ const createTRPCContext = async (opts)=>{\n    const session = await (0,_bazaar_auth__WEBPACK_IMPORTED_MODULE_2__.auth)();\n    return {\n        db: _bazaar_database__WEBPACK_IMPORTED_MODULE_3__.db,\n        session,\n        ...opts\n    };\n};\n/**\n * 2. INITIALIZATION\n *\n * This is where the tRPC API is initialized, connecting the context and transformer. We also parse\n * ZodErrors so that you get typesafety on the frontend if your procedure fails due to validation\n * errors on the backend.\n */ const t = _trpc_server__WEBPACK_IMPORTED_MODULE_0__.initTRPC.context().create({\n    transformer: superjson__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n    errorFormatter ({ shape, error }) {\n        return {\n            ...shape,\n            data: {\n                ...shape.data,\n                zodError: error.cause instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError ? error.cause.flatten() : null\n            }\n        };\n    }\n});\n/**\n * Create a server-side caller.\n *\n * @see https://trpc.io/docs/server/server-side-calls\n */ const createCallerFactory = t.createCallerFactory;\n/**\n * 3. ROUTER & PROCEDURE (THE IMPORTANT BIT)\n *\n * These are the pieces you use to build your tRPC API. You should import these a lot in the\n * \"/src/server/api/routers\" directory.\n */ /**\n * This is how you create new routers and sub-routers in your tRPC API.\n *\n * @see https://trpc.io/docs/router\n */ const createTRPCRouter = t.router;\n/**\n * Middleware for timing procedure execution and adding an artificial delay in development.\n *\n * You can remove this if you don't like it, but it can help catch unwanted waterfalls by simulating\n * network latency that would occur in production but not in local development.\n */ const timingMiddleware = t.middleware(async ({ next, path })=>{\n    const start = Date.now();\n    if (t._config.isDev) {\n        // artificial delay in dev\n        const waitMs = Math.floor(Math.random() * 400) + 100;\n        await new Promise((resolve)=>setTimeout(resolve, waitMs));\n    }\n    const result = await next();\n    const end = Date.now();\n    // Only log timing if TRPC_DEBUG environment variable is set or for extremely slow requests\n    const shouldLog = process.env.TRPC_DEBUG === 'true' || end - start > 5000;\n    const executionTime = end - start;\n    if (shouldLog) {\n    // console.log(`[TRPC] ${path} took ${executionTime}ms to execute`);\n    } else if (executionTime > 3000) {\n    // Only log very slow requests (>3s) with a different prefix so they don't get filtered\n    // console.log(` Slow procedure: ${path} took ${executionTime}ms to execute`);\n    }\n    return result;\n});\n/**\n * Public (unauthenticated) procedure\n *\n * This is the base piece you use to build new queries and mutations on your tRPC API. It does not\n * guarantee that a user querying is authorized, but you can still access user session data if they\n * are logged in.\n */ const publicProcedure = t.procedure.use(timingMiddleware);\n/**\n * Protected (authenticated) procedure\n *\n * If you want a query or mutation to ONLY be accessible to logged in users, use this. It verifies\n * the session is valid and guarantees `ctx.session.user` is not null.\n *\n * @see https://trpc.io/docs/procedures\n */ const protectedProcedure = t.procedure.use(timingMiddleware).use({\n    \"use[protectedProcedure]\": ({ ctx, next })=>{\n        if (!ctx.session?.user) {\n            throw new _trpc_server__WEBPACK_IMPORTED_MODULE_0__.TRPCError({\n                code: \"UNAUTHORIZED\"\n            });\n        }\n        return next({\n            ctx: {\n                // infers the `session` as non-nullable\n                session: {\n                    ...ctx.session,\n                    user: ctx.session.user\n                }\n            }\n        });\n    }\n}[\"use[protectedProcedure]\"]);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2FwaS90cnBjLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBeUI7QUFDekI7Ozs7Ozs7Q0FPQyxHQUVrRDtBQUNqQjtBQUNIO0FBRUs7QUFDRTtBQUV0Qzs7Ozs7Ozs7Ozs7Q0FXQyxHQUNNLE1BQU1NLG9CQUFvQixPQUFPQztJQUN0QyxNQUFNQyxVQUFVLE1BQU1KLGtEQUFJQTtJQUUxQixPQUFPO1FBQ0xDLEVBQUVBLGtEQUFBQTtRQUNGRztRQUNBLEdBQUdELElBQUk7SUFDVDtBQUNGLEVBQUU7QUFFRjs7Ozs7O0NBTUMsR0FDRCxNQUFNRSxJQUFJVCxrREFBUUEsQ0FBQ1UsT0FBTyxHQUE2QkMsTUFBTSxDQUFDO0lBQzVEQyxhQUFhVixpREFBU0E7SUFDdEJXLGdCQUFlLEVBQUVDLEtBQUssRUFBRUMsS0FBSyxFQUFFO1FBQzdCLE9BQU87WUFDTCxHQUFHRCxLQUFLO1lBQ1JFLE1BQU07Z0JBQ0osR0FBR0YsTUFBTUUsSUFBSTtnQkFDYkMsVUFDRUYsTUFBTUcsS0FBSyxZQUFZZix5Q0FBUUEsR0FBR1ksTUFBTUcsS0FBSyxDQUFDQyxPQUFPLEtBQUs7WUFDOUQ7UUFDRjtJQUNGO0FBQ0Y7QUFFQTs7OztDQUlDLEdBQ00sTUFBTUMsc0JBQXNCWCxFQUFFVyxtQkFBbUIsQ0FBQztBQUV6RDs7Ozs7Q0FLQyxHQUVEOzs7O0NBSUMsR0FDTSxNQUFNQyxtQkFBbUJaLEVBQUVhLE1BQU0sQ0FBQztBQUV6Qzs7Ozs7Q0FLQyxHQUNELE1BQU1DLG1CQUFtQmQsRUFBRWUsVUFBVSxDQUFDLE9BQU8sRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUU7SUFDekQsTUFBTUMsUUFBUUMsS0FBS0MsR0FBRztJQUV0QixJQUFJcEIsRUFBRXFCLE9BQU8sQ0FBQ0MsS0FBSyxFQUFFO1FBQ25CLDBCQUEwQjtRQUMxQixNQUFNQyxTQUFTQyxLQUFLQyxLQUFLLENBQUNELEtBQUtFLE1BQU0sS0FBSyxPQUFPO1FBQ2pELE1BQU0sSUFBSUMsUUFBUSxDQUFDQyxVQUFZQyxXQUFXRCxTQUFTTDtJQUNyRDtJQUVBLE1BQU1PLFNBQVMsTUFBTWQ7SUFFckIsTUFBTWUsTUFBTVosS0FBS0MsR0FBRztJQUVwQiwyRkFBMkY7SUFDM0YsTUFBTVksWUFBWUMsUUFBUUMsR0FBRyxDQUFDQyxVQUFVLEtBQUssVUFBV0osTUFBTWIsUUFBUTtJQUN0RSxNQUFNa0IsZ0JBQWdCTCxNQUFNYjtJQUU1QixJQUFJYyxXQUFXO0lBQ2Isb0VBQW9FO0lBQ3RFLE9BQU8sSUFBSUksZ0JBQWdCLE1BQU07SUFDL0IsdUZBQXVGO0lBQ3ZGLGdGQUFnRjtJQUNsRjtJQUVBLE9BQU9OO0FBQ1Q7QUFFQTs7Ozs7O0NBTUMsR0FDTSxNQUFNTyxrQkFBa0JyQyxFQUFFc0MsU0FBUyxDQUFDQyxHQUFHLENBQUN6QixrQkFBa0I7QUFFakU7Ozs7Ozs7Q0FPQyxHQUNNLE1BQU0wQixxQkFBcUJ4QyxFQUFFc0MsU0FBUyxDQUMxQ0MsR0FBRyxDQUFDekIsa0JBQ0p5QixHQUFHOytCQUFDLENBQUMsRUFBRUUsR0FBRyxFQUFFekIsSUFBSSxFQUFFO1FBQ2pCLElBQUksQ0FBQ3lCLElBQUkxQyxPQUFPLEVBQUUyQyxNQUFNO1lBQ3RCLE1BQU0sSUFBSWxELG1EQUFTQSxDQUFDO2dCQUFFbUQsTUFBTTtZQUFlO1FBQzdDO1FBQ0EsT0FBTzNCLEtBQUs7WUFDVnlCLEtBQUs7Z0JBQ0gsdUNBQXVDO2dCQUN2QzFDLFNBQVM7b0JBQUUsR0FBRzBDLElBQUkxQyxPQUFPO29CQUFFMkMsTUFBTUQsSUFBSTFDLE9BQU8sQ0FBQzJDLElBQUk7Z0JBQUM7WUFDcEQ7UUFDRjtJQUNGOzhCQUFHIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL2FwaS90cnBjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvYXBpL3RycGMudHNcbi8qKlxuICogWU9VIFBST0JBQkxZIERPTidUIE5FRUQgVE8gRURJVCBUSElTIEZJTEUsIFVOTEVTUzpcbiAqIDEuIFlvdSB3YW50IHRvIG1vZGlmeSByZXF1ZXN0IGNvbnRleHQgKHNlZSBQYXJ0IDEpLlxuICogMi4gWW91IHdhbnQgdG8gY3JlYXRlIGEgbmV3IG1pZGRsZXdhcmUgb3IgdHlwZSBvZiBwcm9jZWR1cmUgKHNlZSBQYXJ0IDMpLlxuICpcbiAqIFRMO0RSIC0gVGhpcyBpcyB3aGVyZSBhbGwgdGhlIHRSUEMgc2VydmVyIHN0dWZmIGlzIGNyZWF0ZWQgYW5kIHBsdWdnZWQgaW4uIFRoZSBwaWVjZXMgeW91IHdpbGxcbiAqIG5lZWQgdG8gdXNlIGFyZSBkb2N1bWVudGVkIGFjY29yZGluZ2x5IG5lYXIgdGhlIGVuZC5cbiAqL1xuXG5pbXBvcnQgeyBpbml0VFJQQywgVFJQQ0Vycm9yIH0gZnJvbSBcIkB0cnBjL3NlcnZlclwiO1xuaW1wb3J0IHN1cGVyanNvbiBmcm9tIFwic3VwZXJqc29uXCI7XG5pbXBvcnQgeyBab2RFcnJvciB9IGZyb20gXCJ6b2RcIjtcblxuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAYmF6YWFyL2F1dGhcIjtcbmltcG9ydCB7IGRiIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcblxuLyoqXG4gKiAxLiBDT05URVhUXG4gKlxuICogVGhpcyBzZWN0aW9uIGRlZmluZXMgdGhlIFwiY29udGV4dHNcIiB0aGF0IGFyZSBhdmFpbGFibGUgaW4gdGhlIGJhY2tlbmQgQVBJLlxuICpcbiAqIFRoZXNlIGFsbG93IHlvdSB0byBhY2Nlc3MgdGhpbmdzIHdoZW4gcHJvY2Vzc2luZyBhIHJlcXVlc3QsIGxpa2UgdGhlIGRhdGFiYXNlLCB0aGUgc2Vzc2lvbiwgZXRjLlxuICpcbiAqIFRoaXMgaGVscGVyIGdlbmVyYXRlcyB0aGUgXCJpbnRlcm5hbHNcIiBmb3IgYSB0UlBDIGNvbnRleHQuIFRoZSBBUEkgaGFuZGxlciBhbmQgUlNDIGNsaWVudHMgZWFjaFxuICogd3JhcCB0aGlzIGFuZCBwcm92aWRlcyB0aGUgcmVxdWlyZWQgY29udGV4dC5cbiAqXG4gKiBAc2VlIGh0dHBzOi8vdHJwYy5pby9kb2NzL3NlcnZlci9jb250ZXh0XG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVUUlBDQ29udGV4dCA9IGFzeW5jIChvcHRzOiB7IGhlYWRlcnM6IEhlYWRlcnMgfSkgPT4ge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aCgpO1xuXG4gIHJldHVybiB7XG4gICAgZGIsXG4gICAgc2Vzc2lvbixcbiAgICAuLi5vcHRzLFxuICB9O1xufTtcblxuLyoqXG4gKiAyLiBJTklUSUFMSVpBVElPTlxuICpcbiAqIFRoaXMgaXMgd2hlcmUgdGhlIHRSUEMgQVBJIGlzIGluaXRpYWxpemVkLCBjb25uZWN0aW5nIHRoZSBjb250ZXh0IGFuZCB0cmFuc2Zvcm1lci4gV2UgYWxzbyBwYXJzZVxuICogWm9kRXJyb3JzIHNvIHRoYXQgeW91IGdldCB0eXBlc2FmZXR5IG9uIHRoZSBmcm9udGVuZCBpZiB5b3VyIHByb2NlZHVyZSBmYWlscyBkdWUgdG8gdmFsaWRhdGlvblxuICogZXJyb3JzIG9uIHRoZSBiYWNrZW5kLlxuICovXG5jb25zdCB0ID0gaW5pdFRSUEMuY29udGV4dDx0eXBlb2YgY3JlYXRlVFJQQ0NvbnRleHQ+KCkuY3JlYXRlKHtcbiAgdHJhbnNmb3JtZXI6IHN1cGVyanNvbixcbiAgZXJyb3JGb3JtYXR0ZXIoeyBzaGFwZSwgZXJyb3IgfSkge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zaGFwZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgLi4uc2hhcGUuZGF0YSxcbiAgICAgICAgem9kRXJyb3I6XG4gICAgICAgICAgZXJyb3IuY2F1c2UgaW5zdGFuY2VvZiBab2RFcnJvciA/IGVycm9yLmNhdXNlLmZsYXR0ZW4oKSA6IG51bGwsXG4gICAgICB9LFxuICAgIH07XG4gIH0sXG59KTtcblxuLyoqXG4gKiBDcmVhdGUgYSBzZXJ2ZXItc2lkZSBjYWxsZXIuXG4gKlxuICogQHNlZSBodHRwczovL3RycGMuaW8vZG9jcy9zZXJ2ZXIvc2VydmVyLXNpZGUtY2FsbHNcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUNhbGxlckZhY3RvcnkgPSB0LmNyZWF0ZUNhbGxlckZhY3Rvcnk7XG5cbi8qKlxuICogMy4gUk9VVEVSICYgUFJPQ0VEVVJFIChUSEUgSU1QT1JUQU5UIEJJVClcbiAqXG4gKiBUaGVzZSBhcmUgdGhlIHBpZWNlcyB5b3UgdXNlIHRvIGJ1aWxkIHlvdXIgdFJQQyBBUEkuIFlvdSBzaG91bGQgaW1wb3J0IHRoZXNlIGEgbG90IGluIHRoZVxuICogXCIvc3JjL3NlcnZlci9hcGkvcm91dGVyc1wiIGRpcmVjdG9yeS5cbiAqL1xuXG4vKipcbiAqIFRoaXMgaXMgaG93IHlvdSBjcmVhdGUgbmV3IHJvdXRlcnMgYW5kIHN1Yi1yb3V0ZXJzIGluIHlvdXIgdFJQQyBBUEkuXG4gKlxuICogQHNlZSBodHRwczovL3RycGMuaW8vZG9jcy9yb3V0ZXJcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZVRSUENSb3V0ZXIgPSB0LnJvdXRlcjtcblxuLyoqXG4gKiBNaWRkbGV3YXJlIGZvciB0aW1pbmcgcHJvY2VkdXJlIGV4ZWN1dGlvbiBhbmQgYWRkaW5nIGFuIGFydGlmaWNpYWwgZGVsYXkgaW4gZGV2ZWxvcG1lbnQuXG4gKlxuICogWW91IGNhbiByZW1vdmUgdGhpcyBpZiB5b3UgZG9uJ3QgbGlrZSBpdCwgYnV0IGl0IGNhbiBoZWxwIGNhdGNoIHVud2FudGVkIHdhdGVyZmFsbHMgYnkgc2ltdWxhdGluZ1xuICogbmV0d29yayBsYXRlbmN5IHRoYXQgd291bGQgb2NjdXIgaW4gcHJvZHVjdGlvbiBidXQgbm90IGluIGxvY2FsIGRldmVsb3BtZW50LlxuICovXG5jb25zdCB0aW1pbmdNaWRkbGV3YXJlID0gdC5taWRkbGV3YXJlKGFzeW5jICh7IG5leHQsIHBhdGggfSkgPT4ge1xuICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XG5cbiAgaWYgKHQuX2NvbmZpZy5pc0Rldikge1xuICAgIC8vIGFydGlmaWNpYWwgZGVsYXkgaW4gZGV2XG4gICAgY29uc3Qgd2FpdE1zID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNDAwKSArIDEwMDtcbiAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCB3YWl0TXMpKTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG5leHQoKTtcblxuICBjb25zdCBlbmQgPSBEYXRlLm5vdygpO1xuICBcbiAgLy8gT25seSBsb2cgdGltaW5nIGlmIFRSUENfREVCVUcgZW52aXJvbm1lbnQgdmFyaWFibGUgaXMgc2V0IG9yIGZvciBleHRyZW1lbHkgc2xvdyByZXF1ZXN0c1xuICBjb25zdCBzaG91bGRMb2cgPSBwcm9jZXNzLmVudi5UUlBDX0RFQlVHID09PSAndHJ1ZScgfHwgKGVuZCAtIHN0YXJ0ID4gNTAwMCk7XG4gIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBlbmQgLSBzdGFydDtcbiAgXG4gIGlmIChzaG91bGRMb2cpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhgW1RSUENdICR7cGF0aH0gdG9vayAke2V4ZWN1dGlvblRpbWV9bXMgdG8gZXhlY3V0ZWApO1xuICB9IGVsc2UgaWYgKGV4ZWN1dGlvblRpbWUgPiAzMDAwKSB7XG4gICAgLy8gT25seSBsb2cgdmVyeSBzbG93IHJlcXVlc3RzICg+M3MpIHdpdGggYSBkaWZmZXJlbnQgcHJlZml4IHNvIHRoZXkgZG9uJ3QgZ2V0IGZpbHRlcmVkXG4gICAgLy8gY29uc29sZS5sb2coYOKaoO+4jyBTbG93IHByb2NlZHVyZTogJHtwYXRofSB0b29rICR7ZXhlY3V0aW9uVGltZX1tcyB0byBleGVjdXRlYCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufSk7XG5cbi8qKlxuICogUHVibGljICh1bmF1dGhlbnRpY2F0ZWQpIHByb2NlZHVyZVxuICpcbiAqIFRoaXMgaXMgdGhlIGJhc2UgcGllY2UgeW91IHVzZSB0byBidWlsZCBuZXcgcXVlcmllcyBhbmQgbXV0YXRpb25zIG9uIHlvdXIgdFJQQyBBUEkuIEl0IGRvZXMgbm90XG4gKiBndWFyYW50ZWUgdGhhdCBhIHVzZXIgcXVlcnlpbmcgaXMgYXV0aG9yaXplZCwgYnV0IHlvdSBjYW4gc3RpbGwgYWNjZXNzIHVzZXIgc2Vzc2lvbiBkYXRhIGlmIHRoZXlcbiAqIGFyZSBsb2dnZWQgaW4uXG4gKi9cbmV4cG9ydCBjb25zdCBwdWJsaWNQcm9jZWR1cmUgPSB0LnByb2NlZHVyZS51c2UodGltaW5nTWlkZGxld2FyZSk7XG5cbi8qKlxuICogUHJvdGVjdGVkIChhdXRoZW50aWNhdGVkKSBwcm9jZWR1cmVcbiAqXG4gKiBJZiB5b3Ugd2FudCBhIHF1ZXJ5IG9yIG11dGF0aW9uIHRvIE9OTFkgYmUgYWNjZXNzaWJsZSB0byBsb2dnZWQgaW4gdXNlcnMsIHVzZSB0aGlzLiBJdCB2ZXJpZmllc1xuICogdGhlIHNlc3Npb24gaXMgdmFsaWQgYW5kIGd1YXJhbnRlZXMgYGN0eC5zZXNzaW9uLnVzZXJgIGlzIG5vdCBudWxsLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly90cnBjLmlvL2RvY3MvcHJvY2VkdXJlc1xuICovXG5leHBvcnQgY29uc3QgcHJvdGVjdGVkUHJvY2VkdXJlID0gdC5wcm9jZWR1cmVcbiAgLnVzZSh0aW1pbmdNaWRkbGV3YXJlKVxuICAudXNlKCh7IGN0eCwgbmV4dCB9KSA9PiB7XG4gICAgaWYgKCFjdHguc2Vzc2lvbj8udXNlcikge1xuICAgICAgdGhyb3cgbmV3IFRSUENFcnJvcih7IGNvZGU6IFwiVU5BVVRIT1JJWkVEXCIgfSk7XG4gICAgfVxuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIGN0eDoge1xuICAgICAgICAvLyBpbmZlcnMgdGhlIGBzZXNzaW9uYCBhcyBub24tbnVsbGFibGVcbiAgICAgICAgc2Vzc2lvbjogeyAuLi5jdHguc2Vzc2lvbiwgdXNlcjogY3R4LnNlc3Npb24udXNlciB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG4iXSwibmFtZXMiOlsiaW5pdFRSUEMiLCJUUlBDRXJyb3IiLCJzdXBlcmpzb24iLCJab2RFcnJvciIsImF1dGgiLCJkYiIsImNyZWF0ZVRSUENDb250ZXh0Iiwib3B0cyIsInNlc3Npb24iLCJ0IiwiY29udGV4dCIsImNyZWF0ZSIsInRyYW5zZm9ybWVyIiwiZXJyb3JGb3JtYXR0ZXIiLCJzaGFwZSIsImVycm9yIiwiZGF0YSIsInpvZEVycm9yIiwiY2F1c2UiLCJmbGF0dGVuIiwiY3JlYXRlQ2FsbGVyRmFjdG9yeSIsImNyZWF0ZVRSUENSb3V0ZXIiLCJyb3V0ZXIiLCJ0aW1pbmdNaWRkbGV3YXJlIiwibWlkZGxld2FyZSIsIm5leHQiLCJwYXRoIiwic3RhcnQiLCJEYXRlIiwibm93IiwiX2NvbmZpZyIsImlzRGV2Iiwid2FpdE1zIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwicmVzdWx0IiwiZW5kIiwic2hvdWxkTG9nIiwicHJvY2VzcyIsImVudiIsIlRSUENfREVCVUciLCJleGVjdXRpb25UaW1lIiwicHVibGljUHJvY2VkdXJlIiwicHJvY2VkdXJlIiwidXNlIiwicHJvdGVjdGVkUHJvY2VkdXJlIiwiY3R4IiwidXNlciIsImNvZGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/api/trpc.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/init.ts":
/*!****************************!*\
  !*** ./src/server/init.ts ***!
  \****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanupServer: () => (/* binding */ cleanupServer),\n/* harmony export */   initializeServer: () => (/* binding */ initializeServer)\n/* harmony export */ });\n/* harmony import */ var _server_services_data_dataLifecycle_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/services/data/dataLifecycle.service */ \"(rsc)/./src/server/services/data/dataLifecycle.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_server_services_data_dataLifecycle_service__WEBPACK_IMPORTED_MODULE_0__]);\n_server_services_data_dataLifecycle_service__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// src/server/init.ts\n\n// Initialize global state if it doesn't exist\nif (typeof global.__SERVER_INITIALIZED === 'undefined') {\n    global.__SERVER_INITIALIZED = false;\n}\n// Initialize global cleanup functions array if it doesn't exist\nif (!global.__SERVER_CLEANUP_FUNCTIONS) {\n    global.__SERVER_CLEANUP_FUNCTIONS = [];\n}\n// Use global references for initialization state and cleanup functions\nconst isInitialized = global.__SERVER_INITIALIZED;\nconst workerCleanupFunctions = global.__SERVER_CLEANUP_FUNCTIONS;\n/**\n * Initialize server-side background processes.\n * This is called from the Next.js instrumentation hook to ensure\n * background workers are running only once in development and production.\n * \n * Uses a singleton pattern to prevent multiple initializations.\n */ function initializeServer() {\n    if (false) {}\n    if (isInitialized) {\n        console.log(' Server already initialized, skipping duplicate initialization');\n        return;\n    }\n    console.log(' Initializing server background processes...');\n    // Start Data Lifecycle Management\n    try {\n        _server_services_data_dataLifecycle_service__WEBPACK_IMPORTED_MODULE_0__.dataLifecycleService.startAutomatedCleanup({\n            imageAnalysisRetentionDays: 30,\n            conversationContextRetentionDays: 90,\n            sceneIterationsRetentionDays: 60,\n            projectMemoryRetentionDays: 180,\n            enableAutoCleanup: \"development\" === 'production',\n            cleanupIntervalHours: 24\n        });\n        workerCleanupFunctions.push(()=>_server_services_data_dataLifecycle_service__WEBPACK_IMPORTED_MODULE_0__.dataLifecycleService.stopAutomatedCleanup());\n        console.log(' Data lifecycle management service started');\n    } catch (error) {\n        console.error(' Failed to start data lifecycle management:', error);\n    }\n    // Mark as initialized in the global state\n    global.__SERVER_INITIALIZED = true;\n    // Clean up on process exit\n    process.on('beforeExit', cleanupServer);\n    process.on('SIGINT', ()=>{\n        cleanupServer();\n        process.exit(0);\n    });\n    process.on('SIGTERM', ()=>{\n        cleanupServer();\n        process.exit(0);\n    });\n}\n/**\n * Cleanup function for server shutdown\n */ function cleanupServer() {\n    console.log(' Cleaning up server resources...');\n    // Call all registered cleanup functions\n    for (const cleanupFn of workerCleanupFunctions){\n        try {\n            cleanupFn();\n        } catch (e) {\n            console.error('Error during worker cleanup:', e);\n        }\n    }\n    workerCleanupFunctions.length = 0; // Clear the array\n    global.__SERVER_INITIALIZED = false;\n}\n// Export the cleanup function for manual use if needed\n // REMOVED: Do not initialize on import anymore\n // initializeServer();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2luaXQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEscUJBQXFCO0FBQytEO0FBVXBGLDhDQUE4QztBQUM5QyxJQUFJLE9BQU9DLE9BQU9DLG9CQUFvQixLQUFLLGFBQWE7SUFDdERELE9BQU9DLG9CQUFvQixHQUFHO0FBQ2hDO0FBRUEsZ0VBQWdFO0FBQ2hFLElBQUksQ0FBQ0QsT0FBT0UsMEJBQTBCLEVBQUU7SUFDdENGLE9BQU9FLDBCQUEwQixHQUFHLEVBQUU7QUFDeEM7QUFFQSx1RUFBdUU7QUFDdkUsTUFBTUMsZ0JBQWdCSCxPQUFPQyxvQkFBb0I7QUFDakQsTUFBTUcseUJBQXlCSixPQUFPRSwwQkFBMEI7QUFFaEU7Ozs7OztDQU1DLEdBQ00sU0FBU0c7SUFDZCxJQUFJLEtBQTZCLEVBQUUsRUFHbEM7SUFFRCxJQUFJRixlQUFlO1FBQ2pCRyxRQUFRQyxHQUFHLENBQUM7UUFDWjtJQUNGO0lBRUFELFFBQVFDLEdBQUcsQ0FBQztJQUVaLGtDQUFrQztJQUNsQyxJQUFJO1FBQ0ZSLDZGQUFvQkEsQ0FBQ1MscUJBQXFCLENBQUM7WUFDekNDLDRCQUE0QjtZQUM1QkMsa0NBQWtDO1lBQ2xDQyw4QkFBOEI7WUFDOUJDLDRCQUE0QjtZQUM1QkMsbUJBQW1CQyxrQkFBeUI7WUFDNUNDLHNCQUFzQjtRQUN4QjtRQUNBWCx1QkFBdUJZLElBQUksQ0FBQyxJQUFNakIsNkZBQW9CQSxDQUFDa0Isb0JBQW9CO1FBQzNFWCxRQUFRQyxHQUFHLENBQUM7SUFDZCxFQUFFLE9BQU9XLE9BQU87UUFDZFosUUFBUVksS0FBSyxDQUFDLGdEQUFnREE7SUFDaEU7SUFFQSwwQ0FBMEM7SUFDMUNsQixPQUFPQyxvQkFBb0IsR0FBRztJQUU5QiwyQkFBMkI7SUFDM0JhLFFBQVFLLEVBQUUsQ0FBQyxjQUFjQztJQUN6Qk4sUUFBUUssRUFBRSxDQUFDLFVBQVU7UUFDbkJDO1FBQ0FOLFFBQVFPLElBQUksQ0FBQztJQUNmO0lBQ0FQLFFBQVFLLEVBQUUsQ0FBQyxXQUFXO1FBQ3BCQztRQUNBTixRQUFRTyxJQUFJLENBQUM7SUFDZjtBQUNGO0FBRUE7O0NBRUMsR0FDRCxTQUFTRDtJQUNQZCxRQUFRQyxHQUFHLENBQUM7SUFDWix3Q0FBd0M7SUFDeEMsS0FBSyxNQUFNZSxhQUFhbEIsdUJBQXdCO1FBQzlDLElBQUk7WUFDRmtCO1FBQ0YsRUFBRSxPQUFPQyxHQUFHO1lBQ1ZqQixRQUFRWSxLQUFLLENBQUMsZ0NBQWdDSztRQUNoRDtJQUNGO0lBQ0FuQix1QkFBdUJvQixNQUFNLEdBQUcsR0FBRyxrQkFBa0I7SUFDckR4QixPQUFPQyxvQkFBb0IsR0FBRztBQUNoQztBQUVBLHVEQUF1RDtBQUM5QixDQUV6QiwrQ0FBK0M7Q0FDL0Msc0JBQXNCIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL2luaXQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9pbml0LnRzXG5pbXBvcnQgeyBkYXRhTGlmZWN5Y2xlU2VydmljZSB9IGZyb20gJ34vc2VydmVyL3NlcnZpY2VzL2RhdGEvZGF0YUxpZmVjeWNsZS5zZXJ2aWNlJztcblxuLy8gQ3JlYXRlIGEgZ2xvYmFsIG9iamVjdCBmb3IgdHJ1bHkgcGVyc2lzdGluZyBzdGF0ZSBhY3Jvc3MgSE1SIGN5Y2xlc1xuZGVjbGFyZSBnbG9iYWwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG4gIHZhciBfX1NFUlZFUl9JTklUSUFMSVpFRDogYm9vbGVhbjtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgX19TRVJWRVJfQ0xFQU5VUF9GVU5DVElPTlM6ICgoKSA9PiB2b2lkKVtdO1xufVxuXG4vLyBJbml0aWFsaXplIGdsb2JhbCBzdGF0ZSBpZiBpdCBkb2Vzbid0IGV4aXN0XG5pZiAodHlwZW9mIGdsb2JhbC5fX1NFUlZFUl9JTklUSUFMSVpFRCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgZ2xvYmFsLl9fU0VSVkVSX0lOSVRJQUxJWkVEID0gZmFsc2U7XG59XG5cbi8vIEluaXRpYWxpemUgZ2xvYmFsIGNsZWFudXAgZnVuY3Rpb25zIGFycmF5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbmlmICghZ2xvYmFsLl9fU0VSVkVSX0NMRUFOVVBfRlVOQ1RJT05TKSB7XG4gIGdsb2JhbC5fX1NFUlZFUl9DTEVBTlVQX0ZVTkNUSU9OUyA9IFtdO1xufVxuXG4vLyBVc2UgZ2xvYmFsIHJlZmVyZW5jZXMgZm9yIGluaXRpYWxpemF0aW9uIHN0YXRlIGFuZCBjbGVhbnVwIGZ1bmN0aW9uc1xuY29uc3QgaXNJbml0aWFsaXplZCA9IGdsb2JhbC5fX1NFUlZFUl9JTklUSUFMSVpFRDtcbmNvbnN0IHdvcmtlckNsZWFudXBGdW5jdGlvbnMgPSBnbG9iYWwuX19TRVJWRVJfQ0xFQU5VUF9GVU5DVElPTlM7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBzZXJ2ZXItc2lkZSBiYWNrZ3JvdW5kIHByb2Nlc3Nlcy5cbiAqIFRoaXMgaXMgY2FsbGVkIGZyb20gdGhlIE5leHQuanMgaW5zdHJ1bWVudGF0aW9uIGhvb2sgdG8gZW5zdXJlXG4gKiBiYWNrZ3JvdW5kIHdvcmtlcnMgYXJlIHJ1bm5pbmcgb25seSBvbmNlIGluIGRldmVsb3BtZW50IGFuZCBwcm9kdWN0aW9uLlxuICogXG4gKiBVc2VzIGEgc2luZ2xldG9uIHBhdHRlcm4gdG8gcHJldmVudCBtdWx0aXBsZSBpbml0aWFsaXphdGlvbnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplU2VydmVyKCkge1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBTa2lwIGlmIGNsaWVudC1zaWRlXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGlzSW5pdGlhbGl6ZWQpIHtcbiAgICBjb25zb2xlLmxvZygn4o+t77iPIFNlcnZlciBhbHJlYWR5IGluaXRpYWxpemVkLCBza2lwcGluZyBkdXBsaWNhdGUgaW5pdGlhbGl6YXRpb24nKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zb2xlLmxvZygn8J+agCBJbml0aWFsaXppbmcgc2VydmVyIGJhY2tncm91bmQgcHJvY2Vzc2VzLi4uJyk7XG5cbiAgLy8gU3RhcnQgRGF0YSBMaWZlY3ljbGUgTWFuYWdlbWVudFxuICB0cnkge1xuICAgIGRhdGFMaWZlY3ljbGVTZXJ2aWNlLnN0YXJ0QXV0b21hdGVkQ2xlYW51cCh7XG4gICAgICBpbWFnZUFuYWx5c2lzUmV0ZW50aW9uRGF5czogMzAsXG4gICAgICBjb252ZXJzYXRpb25Db250ZXh0UmV0ZW50aW9uRGF5czogOTAsXG4gICAgICBzY2VuZUl0ZXJhdGlvbnNSZXRlbnRpb25EYXlzOiA2MCxcbiAgICAgIHByb2plY3RNZW1vcnlSZXRlbnRpb25EYXlzOiAxODAsXG4gICAgICBlbmFibGVBdXRvQ2xlYW51cDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcbiAgICAgIGNsZWFudXBJbnRlcnZhbEhvdXJzOiAyNFxuICAgIH0pO1xuICAgIHdvcmtlckNsZWFudXBGdW5jdGlvbnMucHVzaCgoKSA9PiBkYXRhTGlmZWN5Y2xlU2VydmljZS5zdG9wQXV0b21hdGVkQ2xlYW51cCgpKTtcbiAgICBjb25zb2xlLmxvZygn8J+Xgu+4jyBEYXRhIGxpZmVjeWNsZSBtYW5hZ2VtZW50IHNlcnZpY2Ugc3RhcnRlZCcpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gc3RhcnQgZGF0YSBsaWZlY3ljbGUgbWFuYWdlbWVudDonLCBlcnJvcik7XG4gIH1cblxuICAvLyBNYXJrIGFzIGluaXRpYWxpemVkIGluIHRoZSBnbG9iYWwgc3RhdGVcbiAgZ2xvYmFsLl9fU0VSVkVSX0lOSVRJQUxJWkVEID0gdHJ1ZTtcblxuICAvLyBDbGVhbiB1cCBvbiBwcm9jZXNzIGV4aXRcbiAgcHJvY2Vzcy5vbignYmVmb3JlRXhpdCcsIGNsZWFudXBTZXJ2ZXIpO1xuICBwcm9jZXNzLm9uKCdTSUdJTlQnLCAoKSA9PiB7XG4gICAgY2xlYW51cFNlcnZlcigpO1xuICAgIHByb2Nlc3MuZXhpdCgwKTtcbiAgfSk7XG4gIHByb2Nlc3Mub24oJ1NJR1RFUk0nLCAoKSA9PiB7XG4gICAgY2xlYW51cFNlcnZlcigpO1xuICAgIHByb2Nlc3MuZXhpdCgwKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQ2xlYW51cCBmdW5jdGlvbiBmb3Igc2VydmVyIHNodXRkb3duXG4gKi9cbmZ1bmN0aW9uIGNsZWFudXBTZXJ2ZXIoKSB7XG4gIGNvbnNvbGUubG9nKCfwn6e5IENsZWFuaW5nIHVwIHNlcnZlciByZXNvdXJjZXMuLi4nKTtcbiAgLy8gQ2FsbCBhbGwgcmVnaXN0ZXJlZCBjbGVhbnVwIGZ1bmN0aW9uc1xuICBmb3IgKGNvbnN0IGNsZWFudXBGbiBvZiB3b3JrZXJDbGVhbnVwRnVuY3Rpb25zKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNsZWFudXBGbigpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyB3b3JrZXIgY2xlYW51cDonLCBlKTtcbiAgICB9XG4gIH1cbiAgd29ya2VyQ2xlYW51cEZ1bmN0aW9ucy5sZW5ndGggPSAwOyAvLyBDbGVhciB0aGUgYXJyYXlcbiAgZ2xvYmFsLl9fU0VSVkVSX0lOSVRJQUxJWkVEID0gZmFsc2U7XG59XG5cbi8vIEV4cG9ydCB0aGUgY2xlYW51cCBmdW5jdGlvbiBmb3IgbWFudWFsIHVzZSBpZiBuZWVkZWRcbmV4cG9ydCB7IGNsZWFudXBTZXJ2ZXIgfTtcblxuLy8gUkVNT1ZFRDogRG8gbm90IGluaXRpYWxpemUgb24gaW1wb3J0IGFueW1vcmVcbi8vIGluaXRpYWxpemVTZXJ2ZXIoKTtcbiJdLCJuYW1lcyI6WyJkYXRhTGlmZWN5Y2xlU2VydmljZSIsImdsb2JhbCIsIl9fU0VSVkVSX0lOSVRJQUxJWkVEIiwiX19TRVJWRVJfQ0xFQU5VUF9GVU5DVElPTlMiLCJpc0luaXRpYWxpemVkIiwid29ya2VyQ2xlYW51cEZ1bmN0aW9ucyIsImluaXRpYWxpemVTZXJ2ZXIiLCJjb25zb2xlIiwibG9nIiwic3RhcnRBdXRvbWF0ZWRDbGVhbnVwIiwiaW1hZ2VBbmFseXNpc1JldGVudGlvbkRheXMiLCJjb252ZXJzYXRpb25Db250ZXh0UmV0ZW50aW9uRGF5cyIsInNjZW5lSXRlcmF0aW9uc1JldGVudGlvbkRheXMiLCJwcm9qZWN0TWVtb3J5UmV0ZW50aW9uRGF5cyIsImVuYWJsZUF1dG9DbGVhbnVwIiwicHJvY2VzcyIsImNsZWFudXBJbnRlcnZhbEhvdXJzIiwicHVzaCIsInN0b3BBdXRvbWF0ZWRDbGVhbnVwIiwiZXJyb3IiLCJvbiIsImNsZWFudXBTZXJ2ZXIiLCJleGl0IiwiY2xlYW51cEZuIiwiZSIsImxlbmd0aCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/init.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/lib/openai.ts":
/*!**********************************!*\
  !*** ./src/server/lib/openai.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   openai: () => (/* binding */ openai)\n/* harmony export */ });\n/* harmony import */ var openai_shims_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai/shims/node */ \"(rsc)/../../node_modules/openai/shims/node.mjs\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/../../node_modules/openai/index.mjs\");\n/* harmony import */ var _env__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/env */ \"(rsc)/./src/env.js\");\n\n\n\n/**\n * OpenAI API client for server-side operations\n * Used primarily for chatbot interactions and JSON Patch generation\n */ const openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n    apiKey: _env__WEBPACK_IMPORTED_MODULE_1__.env.OPENAI_API_KEY\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2xpYi9vcGVuYWkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEyQjtBQUNDO0FBQ0E7QUFFNUI7OztDQUdDLEdBQ00sTUFBTUUsU0FBUyxJQUFJRiw4Q0FBTUEsQ0FBQztJQUMvQkcsUUFBUUYscUNBQUdBLENBQUNHLGNBQWM7QUFDNUIsR0FBRyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3NlcnZlci9saWIvb3BlbmFpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIm9wZW5haS9zaGltcy9ub2RlXCI7XG5pbXBvcnQgT3BlbkFJIGZyb20gXCJvcGVuYWlcIjtcbmltcG9ydCB7IGVudiB9IGZyb20gXCJ+L2VudlwiO1xuXG4vKipcbiAqIE9wZW5BSSBBUEkgY2xpZW50IGZvciBzZXJ2ZXItc2lkZSBvcGVyYXRpb25zXG4gKiBVc2VkIHByaW1hcmlseSBmb3IgY2hhdGJvdCBpbnRlcmFjdGlvbnMgYW5kIEpTT04gUGF0Y2ggZ2VuZXJhdGlvblxuICovXG5leHBvcnQgY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogZW52Lk9QRU5BSV9BUElfS0VZLFxufSk7ICJdLCJuYW1lcyI6WyJPcGVuQUkiLCJlbnYiLCJvcGVuYWkiLCJhcGlLZXkiLCJPUEVOQUlfQVBJX0tFWSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/lib/openai.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/ai/aiClient.service.ts":
/*!****************************************************!*\
  !*** ./src/server/services/ai/aiClient.service.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AIClientService: () => (/* binding */ AIClientService),\n/* harmony export */   createLegacyOpenAIClient: () => (/* binding */ createLegacyOpenAIClient)\n/* harmony export */ });\n/* harmony import */ var openai_shims_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai/shims/node */ \"(rsc)/../../node_modules/openai/shims/node.mjs\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/../../node_modules/openai/index.mjs\");\n/* harmony import */ var _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @anthropic-ai/sdk */ \"(rsc)/../../node_modules/@anthropic-ai/sdk/index.mjs\");\n// src/server/services/ai/aiClient.service.ts\n\n\n\nclass AIClientService {\n    static{\n        this.openaiClient = null;\n    }\n    static{\n        this.anthropicClient = null;\n    }\n    // Initialize clients lazily\n    static getOpenAIClient() {\n        if (!this.openaiClient) {\n            this.openaiClient = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n                apiKey: process.env.OPENAI_API_KEY\n            });\n        }\n        return this.openaiClient;\n    }\n    static getAnthropicClient() {\n        if (!this.anthropicClient) {\n            this.anthropicClient = new _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n                apiKey: process.env.ANTHROPIC_API_KEY\n            });\n        }\n        return this.anthropicClient;\n    }\n    // =============================================================================\n    // MAIN API METHOD\n    // =============================================================================\n    static async generateResponse(config, messages, systemPrompt, options) {\n        // Add system prompt if provided\n        const fullMessages = systemPrompt ? [\n            systemPrompt,\n            ...messages.filter((m)=>m.role !== 'system')\n        ] : messages;\n        switch(config.provider){\n            case 'openai':\n                return this.callOpenAI(config, fullMessages, options);\n            case 'anthropic':\n                return this.callAnthropic(config, fullMessages);\n            default:\n                throw new Error(`Unsupported AI provider: ${config.provider}`);\n        }\n    }\n    // =============================================================================\n    // OPENAI IMPLEMENTATION\n    // =============================================================================\n    static async callOpenAI(config, messages, options) {\n        const client = this.getOpenAIClient();\n        try {\n            // Handle O1 models (different API structure)\n            const isO1Model = config.model.includes('o1');\n            if (isO1Model) {\n                // O1 models don't support temperature and have different message structure\n                const response = await client.chat.completions.create({\n                    model: config.model,\n                    messages: messages.map((msg)=>({\n                            role: msg.role === 'system' ? 'user' : msg.role,\n                            content: msg.content\n                        })),\n                    max_completion_tokens: config.maxTokens\n                });\n                return {\n                    content: response.choices[0]?.message?.content || '',\n                    usage: {\n                        promptTokens: response.usage?.prompt_tokens,\n                        completionTokens: response.usage?.completion_tokens,\n                        totalTokens: response.usage?.total_tokens\n                    }\n                };\n            } else {\n                // Standard GPT models\n                const response = await client.chat.completions.create({\n                    model: config.model,\n                    messages: messages,\n                    temperature: config.temperature ?? 0.7,\n                    max_tokens: config.maxTokens,\n                    ...options?.responseFormat && {\n                        response_format: options.responseFormat\n                    }\n                });\n                return {\n                    content: response.choices[0]?.message?.content || '',\n                    usage: {\n                        promptTokens: response.usage?.prompt_tokens,\n                        completionTokens: response.usage?.completion_tokens,\n                        totalTokens: response.usage?.total_tokens\n                    }\n                };\n            }\n        } catch (error) {\n            console.error('OpenAI API Error:', error);\n            throw new Error(`OpenAI API call failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n    // =============================================================================\n    // ANTHROPIC IMPLEMENTATION\n    // =============================================================================\n    static async callAnthropic(config, messages) {\n        const client = this.getAnthropicClient();\n        try {\n            // Anthropic has different message structure - system message is separate\n            const systemMessage = messages.find((m)=>m.role === 'system');\n            const conversationMessages = messages.filter((m)=>m.role !== 'system');\n            // Handle messages - Claude Sonnet 4 supports vision\n            const processedMessages = conversationMessages.map((msg)=>{\n                if (typeof msg.content === 'string') {\n                    return {\n                        role: msg.role,\n                        content: msg.content\n                    };\n                } else if (Array.isArray(msg.content)) {\n                    // Convert OpenAI format to Claude format for vision content\n                    const claudeContent = msg.content.map((item)=>{\n                        if (item.type === 'text') {\n                            return {\n                                type: 'text',\n                                text: item.text || ''\n                            };\n                        } else if (item.type === 'image_url' && item.image_url?.url) {\n                            return {\n                                type: 'image',\n                                source: {\n                                    type: 'url',\n                                    url: item.image_url.url\n                                }\n                            };\n                        }\n                        return null;\n                    }).filter(Boolean);\n                    return {\n                        role: msg.role,\n                        content: claudeContent.length > 0 ? claudeContent : ''\n                    };\n                }\n                return {\n                    role: msg.role,\n                    content: String(msg.content)\n                };\n            });\n            const response = await client.messages.create({\n                model: config.model,\n                system: typeof systemMessage?.content === 'string' ? systemMessage.content : undefined,\n                messages: processedMessages,\n                temperature: config.temperature ?? 0.7,\n                max_tokens: config.maxTokens ?? 4096\n            });\n            const content = response.content.filter((block)=>block.type === 'text').map((block)=>block.text).join('');\n            return {\n                content,\n                usage: {\n                    promptTokens: response.usage.input_tokens,\n                    completionTokens: response.usage.output_tokens,\n                    totalTokens: response.usage.input_tokens + response.usage.output_tokens\n                }\n            };\n        } catch (error) {\n            console.error('Anthropic API Error:', error);\n            // Check for image download timeout specifically\n            if (error?.error?.message?.includes('timed out while trying to download the file')) {\n                throw new Error('Image download timeout - The AI couldn\\'t fetch the uploaded image. Please try again in a moment.');\n            }\n            // Check for other timeout errors\n            if (error?.error?.message?.includes('timeout') || error?.message?.includes('timeout')) {\n                throw new Error('Request timeout - The AI service is temporarily slow. Please try again.');\n            }\n            throw new Error(`Anthropic API call failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n    // =============================================================================\n    // VISION API SUPPORT\n    // =============================================================================\n    /**\n   * Generate response with vision support (images + text)\n   * Now supports both OpenAI and Claude vision models\n   */ static async generateVisionResponse(config, content, systemPrompt, options) {\n        switch(config.provider){\n            case 'openai':\n                return this.callOpenAIVision(config, content, systemPrompt, options);\n            case 'anthropic':\n                return this.callAnthropicVision(config, content, systemPrompt);\n            default:\n                throw new Error(`Vision API not supported for provider: ${config.provider}`);\n        }\n    }\n    /**\n   * OpenAI Vision API implementation\n   */ static async callOpenAIVision(config, content, systemPrompt, options) {\n        const client = this.getOpenAIClient();\n        try {\n            const messages = [];\n            // Add system message if provided\n            if (systemPrompt) {\n                messages.push({\n                    role: 'system',\n                    content: systemPrompt\n                });\n            }\n            // Add user message with vision content\n            messages.push({\n                role: 'user',\n                content: content\n            });\n            const response = await client.chat.completions.create({\n                model: config.model,\n                messages: messages,\n                temperature: config.temperature ?? 0.4,\n                max_tokens: config.maxTokens ?? 4000,\n                ...options?.responseFormat && {\n                    response_format: options.responseFormat\n                }\n            });\n            return {\n                content: response.choices[0]?.message?.content || '',\n                usage: {\n                    promptTokens: response.usage?.prompt_tokens,\n                    completionTokens: response.usage?.completion_tokens,\n                    totalTokens: response.usage?.total_tokens\n                }\n            };\n        } catch (error) {\n            console.error('OpenAI Vision API Error:', error);\n            throw new Error(`OpenAI Vision API call failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n    /**\n   * Claude Vision API implementation (NEW)\n   * Claude 3.5 Haiku and Sonnet support vision\n   */ static async callAnthropicVision(config, content, systemPrompt) {\n        const client = this.getAnthropicClient();\n        try {\n            // Convert OpenAI vision format to Claude format\n            const claudeContent = content.map((item)=>{\n                if (item.type === 'text') {\n                    return {\n                        type: 'text',\n                        text: item.text || ''\n                    };\n                } else if (item.type === 'image_url' && item.image_url?.url) {\n                    return {\n                        type: 'image',\n                        source: {\n                            type: 'url',\n                            url: item.image_url.url\n                        }\n                    };\n                }\n                return null;\n            }).filter(Boolean);\n            const response = await client.messages.create({\n                model: config.model,\n                system: systemPrompt,\n                messages: [\n                    {\n                        role: 'user',\n                        content: claudeContent\n                    }\n                ],\n                temperature: config.temperature ?? 0.4,\n                max_tokens: config.maxTokens ?? 4000\n            });\n            const responseContent = response.content.filter((block)=>block.type === 'text').map((block)=>block.text).join('');\n            return {\n                content: responseContent,\n                usage: {\n                    promptTokens: response.usage.input_tokens,\n                    completionTokens: response.usage.output_tokens,\n                    totalTokens: response.usage.input_tokens + response.usage.output_tokens\n                }\n            };\n        } catch (error) {\n            console.error('Claude Vision API Error:', error);\n            throw new Error(`Claude Vision API call failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n    /**\n   * Helper method for image-to-code generation\n   */ static async generateCodeFromImages(config, imageUrls, prompt, systemPrompt) {\n        const content = [\n            {\n                type: 'text',\n                text: prompt\n            },\n            ...imageUrls.map((url)=>({\n                    type: 'image_url',\n                    image_url: {\n                        url,\n                        detail: 'high'\n                    }\n                }))\n        ];\n        return this.generateVisionResponse(config, content, systemPrompt);\n    }\n    // =============================================================================\n    // CONVENIENCE METHODS\n    // =============================================================================\n    static async generateCompletion(config, userPrompt, systemPrompt) {\n        const messages = [\n            {\n                role: 'user',\n                content: userPrompt\n            }\n        ];\n        const response = await this.generateResponse(config, messages, systemPrompt);\n        return response.content;\n    }\n    static async generateWithContext(config, userPrompt, context, systemPrompt) {\n        const messages = [\n            {\n                role: 'user',\n                content: context\n            },\n            {\n                role: 'user',\n                content: userPrompt\n            }\n        ];\n        const response = await this.generateResponse(config, messages, systemPrompt);\n        return response.content;\n    }\n    // =============================================================================\n    // DEVELOPMENT HELPERS\n    // =============================================================================\n    static logModelUsage(config, usage) {\n        if (true) {\n            console.log(` AI Call: ${config.provider}/${config.model}`);\n            if (usage) {\n                console.log(` Tokens: ${usage.totalTokens} (${usage.promptTokens} + ${usage.completionTokens})`);\n            }\n        }\n    }\n}\n// =============================================================================\n// LEGACY COMPATIBILITY HELPERS\n// =============================================================================\n// Helper to create OpenAI-compatible client for existing code\nfunction createLegacyOpenAIClient(config) {\n    return {\n        chat: {\n            completions: {\n                create: async (params)=>{\n                    const messages = params.messages;\n                    const systemMessage = messages.find((m)=>m.role === 'system');\n                    const userMessages = messages.filter((m)=>m.role !== 'system');\n                    const response = await AIClientService.generateResponse(config, userMessages, systemMessage);\n                    // Return OpenAI-compatible format\n                    return {\n                        choices: [\n                            {\n                                message: {\n                                    content: response.content\n                                }\n                            }\n                        ],\n                        usage: {\n                            prompt_tokens: response.usage?.promptTokens,\n                            completion_tokens: response.usage?.completionTokens,\n                            total_tokens: response.usage?.totalTokens\n                        }\n                    };\n                }\n            }\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2FpL2FpQ2xpZW50LnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSw2Q0FBNkM7QUFFbEI7QUFDQztBQUNjO0FBbUNuQyxNQUFNRTs7YUFDSUMsZUFBOEI7OzthQUM5QkMsa0JBQW9DOztJQUVuRCw0QkFBNEI7SUFDNUIsT0FBZUMsa0JBQTBCO1FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUNGLFlBQVksRUFBRTtZQUN0QixJQUFJLENBQUNBLFlBQVksR0FBRyxJQUFJSCw4Q0FBTUEsQ0FBQztnQkFDN0JNLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztZQUNwQztRQUNGO1FBQ0EsT0FBTyxJQUFJLENBQUNOLFlBQVk7SUFDMUI7SUFFQSxPQUFlTyxxQkFBZ0M7UUFDN0MsSUFBSSxDQUFDLElBQUksQ0FBQ04sZUFBZSxFQUFFO1lBQ3pCLElBQUksQ0FBQ0EsZUFBZSxHQUFHLElBQUlILHlEQUFTQSxDQUFDO2dCQUNuQ0ssUUFBUUMsUUFBUUMsR0FBRyxDQUFDRyxpQkFBaUI7WUFDdkM7UUFDRjtRQUNBLE9BQU8sSUFBSSxDQUFDUCxlQUFlO0lBQzdCO0lBRUEsZ0ZBQWdGO0lBQ2hGLGtCQUFrQjtJQUNsQixnRkFBZ0Y7SUFFaEYsYUFBb0JRLGlCQUNsQkMsTUFBbUIsRUFDbkJDLFFBQXFCLEVBQ3JCQyxZQUFpQyxFQUNqQ0MsT0FBeUIsRUFDSjtRQUNyQixnQ0FBZ0M7UUFDaEMsTUFBTUMsZUFBZUYsZUFDakI7WUFBQ0E7ZUFBaUJELFNBQVNJLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsSUFBSSxLQUFLO1NBQVUsR0FDNUROO1FBRUosT0FBUUQsT0FBT1EsUUFBUTtZQUNyQixLQUFLO2dCQUNILE9BQU8sSUFBSSxDQUFDQyxVQUFVLENBQUNULFFBQVFJLGNBQWNEO1lBRS9DLEtBQUs7Z0JBQ0gsT0FBTyxJQUFJLENBQUNPLGFBQWEsQ0FBQ1YsUUFBUUk7WUFFcEM7Z0JBQ0UsTUFBTSxJ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RTt3QkFDRkssT0FBTzs0QkFDTEUsZUFBZWIsU0FBU1csS0FBSyxFQUFFQzs0QkFDL0JHLG1CQUFtQmYsU0FBU1csS0FBSyxFQUFFRzs0QkFDbkNHLGNBQWNqQixTQUFTVyxLQUFLLEVBQUVLO3dCQUNoQztvQkFDRjtnQkFDRjtZQUNGO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL3NlcnZpY2VzL2FpL2FpQ2xpZW50LnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9zZXJ2aWNlcy9haS9haUNsaWVudC5zZXJ2aWNlLnRzXG5cbmltcG9ydCAnb3BlbmFpL3NoaW1zL25vZGUnO1xuaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknO1xuaW1wb3J0IEFudGhyb3BpYyBmcm9tICdAYW50aHJvcGljLWFpL3Nkayc7XG5pbXBvcnQgdHlwZSB7IE1vZGVsQ29uZmlnLCBNb2RlbFByb3ZpZGVyIH0gZnJvbSAnfi9jb25maWcvbW9kZWxzLmNvbmZpZyc7XG5pbXBvcnQgeyBTWVNURU1fUFJPTVBUUyB9IGZyb20gJ34vY29uZmlnL3Byb21wdHMuY29uZmlnJztcblxudHlwZSBTeXN0ZW1Qcm9tcHRDb25maWcgPSB0eXBlb2YgU1lTVEVNX1BST01QVFNba2V5b2YgdHlwZW9mIFNZU1RFTV9QUk9NUFRTXTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFJIENMSUVOVCBGQUNUT1JZXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIEFJTWVzc2FnZSB7XG4gIHJvbGU6ICdzeXN0ZW0nIHwgJ3VzZXInIHwgJ2Fzc2lzdGFudCc7XG4gIGNvbnRlbnQ6IHN0cmluZyB8IEFycmF5PHtcbiAgICB0eXBlOiAndGV4dCcgfCAnaW1hZ2VfdXJsJztcbiAgICB0ZXh0Pzogc3RyaW5nO1xuICAgIGltYWdlX3VybD86IHtcbiAgICAgIHVybDogc3RyaW5nO1xuICAgICAgZGV0YWlsPzogJ2xvdycgfCAnaGlnaCcgfCAnYXV0byc7XG4gICAgfTtcbiAgfT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQUlSZXNwb25zZSB7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdXNhZ2U/OiB7XG4gICAgcHJvbXB0VG9rZW5zPzogbnVtYmVyO1xuICAgIGNvbXBsZXRpb25Ub2tlbnM/OiBudW1iZXI7XG4gICAgdG90YWxUb2tlbnM/OiBudW1iZXI7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQUlDbGllbnRPcHRpb25zIHtcbiAgcmVzcG9uc2VGb3JtYXQ/OiB7IHR5cGU6IFwianNvbl9vYmplY3RcIiB9O1xufVxuXG5leHBvcnQgY2xhc3MgQUlDbGllbnRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgb3BlbmFpQ2xpZW50OiBPcGVuQUkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzdGF0aWMgYW50aHJvcGljQ2xpZW50OiBBbnRocm9waWMgfCBudWxsID0gbnVsbDtcblxuICAvLyBJbml0aWFsaXplIGNsaWVudHMgbGF6aWx5XG4gIHByaXZhdGUgc3RhdGljIGdldE9wZW5BSUNsaWVudCgpOiBPcGVuQUkge1xuICAgIGlmICghdGhpcy5vcGVuYWlDbGllbnQpIHtcbiAgICAgIHRoaXMub3BlbmFpQ2xpZW50ID0gbmV3IE9wZW5BSSh7XG4gICAgICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub3BlbmFpQ2xpZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0QW50aHJvcGljQ2xpZW50KCk6IEFudGhyb3BpYyB7XG4gICAgaWYgKCF0aGlzLmFudGhyb3BpY0NsaWVudCkge1xuICAgICAgdGhpcy5hbnRocm9waWNDbGllbnQgPSBuZXcgQW50aHJvcGljKHtcbiAgICAgICAgYXBpS2V5OiBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hbnRocm9waWNDbGllbnQ7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBNQUlOIEFQSSBNRVRIT0RcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwdWJsaWMgc3RhdGljIGFzeW5jIGdlbmVyYXRlUmVzcG9uc2UoXG4gICAgY29uZmlnOiBNb2RlbENvbmZpZyxcbiAgICBtZXNzYWdlczogQUlNZXNzYWdlW10sXG4gICAgc3lzdGVtUHJvbXB0PzogU3lzdGVtUHJvbXB0Q29uZmlnLFxuICAgIG9wdGlvbnM/OiBBSUNsaWVudE9wdGlvbnNcbiAgKTogUHJvbWlzZTxBSVJlc3BvbnNlPiB7XG4gICAgLy8gQWRkIHN5c3RlbSBwcm9tcHQgaWYgcHJvdmlkZWRcbiAgICBjb25zdCBmdWxsTWVzc2FnZXMgPSBzeXN0ZW1Qcm9tcHQgXG4gICAgICA/IFtzeXN0ZW1Qcm9tcHQsIC4uLm1lc3NhZ2VzLmZpbHRlcihtID0+IG0ucm9sZSAhPT0gJ3N5c3RlbScpXVxuICAgICAgOiBtZXNzYWdlcztcblxuICAgIHN3aXRjaCAoY29uZmlnLnByb3ZpZGVyKSB7XG4gICAgICBjYXNlICdvcGVuYWknOlxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsT3BlbkFJKGNvbmZpZywgZnVsbE1lc3NhZ2VzLCBvcHRpb25zKTtcbiAgICAgIFxuICAgICAgY2FzZSAnYW50aHJvcGljJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsbEFudGhyb3BpYyhjb25maWcsIGZ1bGxNZXNzYWdlcyk7XG4gICAgICBcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgQUkgcHJvdmlkZXI6ICR7Y29uZmlnLnByb3ZpZGVyfWApO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIE9QRU5BSSBJTVBMRU1FTlRBVElPTlxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGNhbGxPcGVuQUkoY29uZmlnOiBNb2RlbENvbmZpZywgbWVzc2FnZXM6IEFJTWVzc2FnZVtdLCBvcHRpb25zPzogQUlDbGllbnRPcHRpb25zKTogUHJvbWlzZTxBSVJlc3BvbnNlPiB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5nZXRPcGVuQUlDbGllbnQoKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gSGFuZGxlIE8xIG1vZGVscyAoZGlmZmVyZW50IEFQSSBzdHJ1Y3R1cmUpXG4gICAgICBjb25zdCBpc08xTW9kZWwgPSBjb25maWcubW9kZWwuaW5jbHVkZXMoJ28xJyk7XG4gICAgICBcbiAgICAgIGlmIChpc08xTW9kZWwpIHtcbiAgICAgICAgLy8gTzEgbW9kZWxzIGRvbid0IHN1cHBvcnQgdGVtcGVyYXR1cmUgYW5kIGhhdmUgZGlmZmVyZW50IG1lc3NhZ2Ugc3RydWN0dXJlXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgICBtb2RlbDogY29uZmlnLm1vZGVsLFxuICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcy5tYXAobXNnID0+ICh7XG4gICAgICAgICAgICByb2xlOiBtc2cucm9sZSA9PT0gJ3N5c3RlbScgPyAndXNlcicgOiBtc2cucm9sZSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50XG4gICAgICAgICAgfSkpIGFzIGFueSxcbiAgICAgICAgICBtYXhfY29tcGxldGlvbl90b2tlbnM6IGNvbmZpZy5tYXhUb2tlbnMsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29udGVudDogcmVzcG9uc2UuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudCB8fCAnJyxcbiAgICAgICAgICB1c2FnZToge1xuICAgICAgICAgICAgcHJvbXB0VG9rZW5zOiByZXNwb25zZS51c2FnZT8ucHJvbXB0X3Rva2VucyxcbiAgICAgICAgICAgIGNvbXBsZXRpb25Ub2tlbnM6IHJlc3BvbnNlLnVzYWdlPy5jb21wbGV0aW9uX3Rva2VucyxcbiAgICAgICAgICAgIHRvdGFsVG9rZW5zOiByZXNwb25zZS51c2FnZT8udG90YWxfdG9rZW5zLFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFN0YW5kYXJkIEdQVCBtb2RlbHNcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICAgIG1vZGVsOiBjb25maWcubW9kZWwsXG4gICAgICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzIGFzIGFueSxcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogY29uZmlnLnRlbXBlcmF0dXJlID8/IDAuNyxcbiAgICAgICAgICBtYXhfdG9rZW5zOiBjb25maWcubWF4VG9rZW5zLFxuICAgICAgICAgIC4uLihvcHRpb25zPy5yZXNwb25zZUZvcm1hdCAmJiB7IHJlc3BvbnNlX2Zvcm1hdDogb3B0aW9ucy5yZXNwb25zZUZvcm1hdCB9KSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50IHx8ICcnLFxuICAgICAgICAgIHVzYWdlOiB7XG4gICAgICAgICAgICBwcm9tcHRUb2tlbnM6IHJlc3BvbnNlLnVzYWdlPy5wcm9tcHRfdG9rZW5zLFxuICAgICAgICAgICAgY29tcGxldGlvblRva2VuczogcmVzcG9uc2UudXNhZ2U/LmNvbXBsZXRpb25fdG9rZW5zLFxuICAgICAgICAgICAgdG90YWxUb2tlbnM6IHJlc3BvbnNlLnVzYWdlPy50b3RhbF90b2tlbnMsXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdPcGVuQUkgQVBJIEVycm9yOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJIEFQSSBjYWxsIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBBTlRIUk9QSUMgSU1QTEVNRU5UQVRJT05cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBjYWxsQW50aHJvcGljKGNvbmZpZzogTW9kZWxDb25maWcsIG1lc3NhZ2VzOiBBSU1lc3NhZ2VbXSk6IFByb21pc2U8QUlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuZ2V0QW50aHJvcGljQ2xpZW50KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEFudGhyb3BpYyBoYXMgZGlmZmVyZW50IG1lc3NhZ2Ugc3RydWN0dXJlIC0gc3lzdGVtIG1lc3NhZ2UgaXMgc2VwYXJhdGVcbiAgICAgIGNvbnN0IHN5c3RlbU1lc3NhZ2UgPSBtZXNzYWdlcy5maW5kKG0gPT4gbS5yb2xlID09PSAnc3lzdGVtJyk7XG4gICAgICBjb25zdCBjb252ZXJzYXRpb25NZXNzYWdlcyA9IG1lc3NhZ2VzLmZpbHRlcihtID0+IG0ucm9sZSAhPT0gJ3N5c3RlbScpO1xuXG4gICAgICAvLyBIYW5kbGUgbWVzc2FnZXMgLSBDbGF1ZGUgU29ubmV0IDQgc3VwcG9ydHMgdmlzaW9uXG4gICAgICBjb25zdCBwcm9jZXNzZWRNZXNzYWdlcyA9IGNvbnZlcnNhdGlvbk1lc3NhZ2VzLm1hcChtc2cgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIG1zZy5jb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByb2xlOiBtc2cucm9sZSBhcyAndXNlcicgfCAnYXNzaXN0YW50JyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50XG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG1zZy5jb250ZW50KSkge1xuICAgICAgICAgIC8vIENvbnZlcnQgT3BlbkFJIGZvcm1hdCB0byBDbGF1ZGUgZm9ybWF0IGZvciB2aXNpb24gY29udGVudFxuICAgICAgICAgIGNvbnN0IGNsYXVkZUNvbnRlbnQgPSBtc2cuY29udGVudC5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS50eXBlID09PSAndGV4dCcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogJ3RleHQnIGFzIGNvbnN0LCB0ZXh0OiBpdGVtLnRleHQgfHwgJycgfTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSAnaW1hZ2VfdXJsJyAmJiBpdGVtLmltYWdlX3VybD8udXJsKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2ltYWdlJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICd1cmwnIGFzIGNvbnN0LFxuICAgICAgICAgICAgICAgICAgdXJsOiBpdGVtLmltYWdlX3VybC51cmxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9KS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJvbGU6IG1zZy5yb2xlIGFzICd1c2VyJyB8ICdhc3Npc3RhbnQnLFxuICAgICAgICAgICAgY29udGVudDogY2xhdWRlQ29udGVudC5sZW5ndGggPiAwID8gY2xhdWRlQ29udGVudCA6ICcnXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJvbGU6IG1zZy5yb2xlIGFzICd1c2VyJyB8ICdhc3Npc3RhbnQnLFxuICAgICAgICAgIGNvbnRlbnQ6IFN0cmluZyhtc2cuY29udGVudClcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5tZXNzYWdlcy5jcmVhdGUoe1xuICAgICAgICBtb2RlbDogY29uZmlnLm1vZGVsLFxuICAgICAgICBzeXN0ZW06IHR5cGVvZiBzeXN0ZW1NZXNzYWdlPy5jb250ZW50ID09PSAnc3RyaW5nJyA/IHN5c3RlbU1lc3NhZ2UuY29udGVudCA6IHVuZGVmaW5lZCxcbiAgICAgICAgbWVzc2FnZXM6IHByb2Nlc3NlZE1lc3NhZ2VzIGFzIGFueSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IGNvbmZpZy50ZW1wZXJhdHVyZSA/PyAwLjcsXG4gICAgICAgIG1heF90b2tlbnM6IGNvbmZpZy5tYXhUb2tlbnMgPz8gNDA5NixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb250ZW50ID0gcmVzcG9uc2UuY29udGVudFxuICAgICAgICAuZmlsdGVyKChibG9jazogYW55KSA9PiBibG9jay50eXBlID09PSAndGV4dCcpXG4gICAgICAgIC5tYXAoKGJsb2NrOiBhbnkpID0+IGJsb2NrLnRleHQpXG4gICAgICAgIC5qb2luKCcnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udGVudCxcbiAgICAgICAgdXNhZ2U6IHtcbiAgICAgICAgICBwcm9tcHRUb2tlbnM6IHJlc3BvbnNlLnVzYWdlLmlucHV0X3Rva2VucyxcbiAgICAgICAgICBjb21wbGV0aW9uVG9rZW5zOiByZXNwb25zZS51c2FnZS5vdXRwdXRfdG9rZW5zLFxuICAgICAgICAgIHRvdGFsVG9rZW5zOiByZXNwb25zZS51c2FnZS5pbnB1dF90b2tlbnMgKyByZXNwb25zZS51c2FnZS5vdXRwdXRfdG9rZW5zLFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0FudGhyb3BpYyBBUEkgRXJyb3I6JywgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3IgaW1hZ2UgZG93bmxvYWQgdGltZW91dCBzcGVjaWZpY2FsbHlcbiAgICAgIGlmIChlcnJvcj8uZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCd0aW1lZCBvdXQgd2hpbGUgdHJ5aW5nIHRvIGRvd25sb2FkIHRoZSBmaWxlJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbWFnZSBkb3dubG9hZCB0aW1lb3V0IC0gVGhlIEFJIGNvdWxkblxcJ3QgZmV0Y2ggdGhlIHVwbG9hZGVkIGltYWdlLiBQbGVhc2UgdHJ5IGFnYWluIGluIGEgbW9tZW50LicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3Igb3RoZXIgdGltZW91dCBlcnJvcnNcbiAgICAgIGlmIChlcnJvcj8uZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCd0aW1lb3V0JykgfHwgZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCd0aW1lb3V0JykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IHRpbWVvdXQgLSBUaGUgQUkgc2VydmljZSBpcyB0ZW1wb3JhcmlseSBzbG93LiBQbGVhc2UgdHJ5IGFnYWluLicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFudGhyb3BpYyBBUEkgY2FsbCBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVklTSU9OIEFQSSBTVVBQT1JUXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHJlc3BvbnNlIHdpdGggdmlzaW9uIHN1cHBvcnQgKGltYWdlcyArIHRleHQpXG4gICAqIE5vdyBzdXBwb3J0cyBib3RoIE9wZW5BSSBhbmQgQ2xhdWRlIHZpc2lvbiBtb2RlbHNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2VuZXJhdGVWaXNpb25SZXNwb25zZShcbiAgICBjb25maWc6IE1vZGVsQ29uZmlnLFxuICAgIGNvbnRlbnQ6IEFycmF5PHtcbiAgICAgIHR5cGU6ICd0ZXh0JyB8ICdpbWFnZV91cmwnO1xuICAgICAgdGV4dD86IHN0cmluZztcbiAgICAgIGltYWdlX3VybD86IHtcbiAgICAgICAgdXJsOiBzdHJpbmc7XG4gICAgICAgIGRldGFpbD86ICdsb3cnIHwgJ2hpZ2gnIHwgJ2F1dG8nO1xuICAgICAgfTtcbiAgICB9PixcbiAgICBzeXN0ZW1Qcm9tcHQ/OiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IEFJQ2xpZW50T3B0aW9uc1xuICApOiBQcm9taXNlPEFJUmVzcG9uc2U+IHtcbiAgICBzd2l0Y2ggKGNvbmZpZy5wcm92aWRlcikge1xuICAgICAgY2FzZSAnb3BlbmFpJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsbE9wZW5BSVZpc2lvbihjb25maWcsIGNvbnRlbnQsIHN5c3RlbVByb21wdCwgb3B0aW9ucyk7XG4gICAgICBjYXNlICdhbnRocm9waWMnOlxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsQW50aHJvcGljVmlzaW9uKGNvbmZpZywgY29udGVudCwgc3lzdGVtUHJvbXB0KTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVmlzaW9uIEFQSSBub3Qgc3VwcG9ydGVkIGZvciBwcm92aWRlcjogJHtjb25maWcucHJvdmlkZXJ9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9wZW5BSSBWaXNpb24gQVBJIGltcGxlbWVudGF0aW9uXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBjYWxsT3BlbkFJVmlzaW9uKFxuICAgIGNvbmZpZzogTW9kZWxDb25maWcsXG4gICAgY29udGVudDogQXJyYXk8e1xuICAgICAgdHlwZTogJ3RleHQnIHwgJ2ltYWdlX3VybCc7XG4gICAgICB0ZXh0Pzogc3RyaW5nO1xuICAgICAgaW1hZ2VfdXJsPzoge1xuICAgICAgICB1cmw6IHN0cmluZztcbiAgICAgICAgZGV0YWlsPzogJ2xvdycgfCAnaGlnaCcgfCAnYXV0byc7XG4gICAgICB9O1xuICAgIH0+LFxuICAgIHN5c3RlbVByb21wdD86IHN0cmluZyxcbiAgICBvcHRpb25zPzogQUlDbGllbnRPcHRpb25zXG4gICk6IFByb21pc2U8QUlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuZ2V0T3BlbkFJQ2xpZW50KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzOiBhbnlbXSA9IFtdO1xuICAgICAgXG4gICAgICAvLyBBZGQgc3lzdGVtIG1lc3NhZ2UgaWYgcHJvdmlkZWRcbiAgICAgIGlmIChzeXN0ZW1Qcm9tcHQpIHtcbiAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgcm9sZTogJ3N5c3RlbScsXG4gICAgICAgICAgY29udGVudDogc3lzdGVtUHJvbXB0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGQgdXNlciBtZXNzYWdlIHdpdGggdmlzaW9uIGNvbnRlbnRcbiAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICAgIG1vZGVsOiBjb25maWcubW9kZWwsXG4gICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyxcbiAgICAgICAgdGVtcGVyYXR1cmU6IGNvbmZpZy50ZW1wZXJhdHVyZSA/PyAwLjQsXG4gICAgICAgIG1heF90b2tlbnM6IGNvbmZpZy5tYXhUb2tlbnMgPz8gNDAwMCxcbiAgICAgICAgLi4uKG9wdGlvbnM/LnJlc3BvbnNlRm9ybWF0ICYmIHsgcmVzcG9uc2VfZm9ybWF0OiBvcHRpb25zLnJlc3BvbnNlRm9ybWF0IH0pLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgJycsXG4gICAgICAgIHVzYWdlOiB7XG4gICAgICAgICAgcHJvbXB0VG9rZW5zOiByZXNwb25zZS51c2FnZT8ucHJvbXB0X3Rva2VucyxcbiAgICAgICAgICBjb21wbGV0aW9uVG9rZW5zOiByZXNwb25zZS51c2FnZT8uY29tcGxldGlvbl90b2tlbnMsXG4gICAgICAgICAgdG90YWxUb2tlbnM6IHJlc3BvbnNlLnVzYWdlPy50b3RhbF90b2tlbnMsXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ09wZW5BSSBWaXNpb24gQVBJIEVycm9yOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJIFZpc2lvbiBBUEkgY2FsbCBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsYXVkZSBWaXNpb24gQVBJIGltcGxlbWVudGF0aW9uIChORVcpXG4gICAqIENsYXVkZSAzLjUgSGFpa3UgYW5kIFNvbm5ldCBzdXBwb3J0IHZpc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgY2FsbEFudGhyb3BpY1Zpc2lvbihcbiAgICBjb25maWc6IE1vZGVsQ29uZmlnLFxuICAgIGNvbnRlbnQ6IEFycmF5PHtcbiAgICAgIHR5cGU6ICd0ZXh0JyB8ICdpbWFnZV91cmwnO1xuICAgICAgdGV4dD86IHN0cmluZztcbiAgICAgIGltYWdlX3VybD86IHtcbiAgICAgICAgdXJsOiBzdHJpbmc7XG4gICAgICAgIGRldGFpbD86ICdsb3cnIHwgJ2hpZ2gnIHwgJ2F1dG8nO1xuICAgICAgfTtcbiAgICB9PixcbiAgICBzeXN0ZW1Qcm9tcHQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxBSVJlc3BvbnNlPiB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5nZXRBbnRocm9waWNDbGllbnQoKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gQ29udmVydCBPcGVuQUkgdmlzaW9uIGZvcm1hdCB0byBDbGF1ZGUgZm9ybWF0XG4gICAgICBjb25zdCBjbGF1ZGVDb250ZW50ID0gY29udGVudC5tYXAoaXRlbSA9PiB7XG4gICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICd0ZXh0Jykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcgYXMgY29uc3QsXG4gICAgICAgICAgICB0ZXh0OiBpdGVtLnRleHQgfHwgJydcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gJ2ltYWdlX3VybCcgJiYgaXRlbS5pbWFnZV91cmw/LnVybCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnaW1hZ2UnIGFzIGNvbnN0LFxuICAgICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICd1cmwnIGFzIGNvbnN0LFxuICAgICAgICAgICAgICB1cmw6IGl0ZW0uaW1hZ2VfdXJsLnVybFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9KS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50Lm1lc3NhZ2VzLmNyZWF0ZSh7XG4gICAgICAgIG1vZGVsOiBjb25maWcubW9kZWwsXG4gICAgICAgIHN5c3RlbTogc3lzdGVtUHJvbXB0LFxuICAgICAgICBtZXNzYWdlczogW3tcbiAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgY29udGVudDogY2xhdWRlQ29udGVudCBhcyBhbnlcbiAgICAgICAgfV0sXG4gICAgICAgIHRlbXBlcmF0dXJlOiBjb25maWcudGVtcGVyYXR1cmUgPz8gMC40LFxuICAgICAgICBtYXhfdG9rZW5zOiBjb25maWcubWF4VG9rZW5zID8/IDQwMDAsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzcG9uc2VDb250ZW50ID0gcmVzcG9uc2UuY29udGVudFxuICAgICAgICAuZmlsdGVyKChibG9jazogYW55KSA9PiBibG9jay50eXBlID09PSAndGV4dCcpXG4gICAgICAgIC5tYXAoKGJsb2NrOiBhbnkpID0+IGJsb2NrLnRleHQpXG4gICAgICAgIC5qb2luKCcnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udGVudDogcmVzcG9uc2VDb250ZW50LFxuICAgICAgICB1c2FnZToge1xuICAgICAgICAgIHByb21wdFRva2VuczogcmVzcG9uc2UudXNhZ2UuaW5wdXRfdG9rZW5zLFxuICAgICAgICAgIGNvbXBsZXRpb25Ub2tlbnM6IHJlc3BvbnNlLnVzYWdlLm91dHB1dF90b2tlbnMsXG4gICAgICAgICAgdG90YWxUb2tlbnM6IHJlc3BvbnNlLnVzYWdlLmlucHV0X3Rva2VucyArIHJlc3BvbnNlLnVzYWdlLm91dHB1dF90b2tlbnMsXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NsYXVkZSBWaXNpb24gQVBJIEVycm9yOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2xhdWRlIFZpc2lvbiBBUEkgY2FsbCBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgZm9yIGltYWdlLXRvLWNvZGUgZ2VuZXJhdGlvblxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyBnZW5lcmF0ZUNvZGVGcm9tSW1hZ2VzKFxuICAgIGNvbmZpZzogTW9kZWxDb25maWcsXG4gICAgaW1hZ2VVcmxzOiBzdHJpbmdbXSxcbiAgICBwcm9tcHQ6IHN0cmluZyxcbiAgICBzeXN0ZW1Qcm9tcHQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxBSVJlc3BvbnNlPiB7XG4gICAgY29uc3QgY29udGVudCA9IFtcbiAgICAgIHsgdHlwZTogJ3RleHQnIGFzIGNvbnN0LCB0ZXh0OiBwcm9tcHQgfSxcbiAgICAgIC4uLmltYWdlVXJscy5tYXAodXJsID0+ICh7XG4gICAgICAgIHR5cGU6ICdpbWFnZV91cmwnIGFzIGNvbnN0LFxuICAgICAgICBpbWFnZV91cmw6IHtcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgZGV0YWlsOiAnaGlnaCcgYXMgY29uc3RcbiAgICAgICAgfVxuICAgICAgfSkpXG4gICAgXTtcblxuICAgIHJldHVybiB0aGlzLmdlbmVyYXRlVmlzaW9uUmVzcG9uc2UoY29uZmlnLCBjb250ZW50LCBzeXN0ZW1Qcm9tcHQpO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQ09OVkVOSUVOQ0UgTUVUSE9EU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2VuZXJhdGVDb21wbGV0aW9uKFxuICAgIGNvbmZpZzogTW9kZWxDb25maWcsXG4gICAgdXNlclByb21wdDogc3RyaW5nLFxuICAgIHN5c3RlbVByb21wdD86IFN5c3RlbVByb21wdENvbmZpZ1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IG1lc3NhZ2VzOiBBSU1lc3NhZ2VbXSA9IFtcbiAgICAgIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiB1c2VyUHJvbXB0IH1cbiAgICBdO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUmVzcG9uc2UoY29uZmlnLCBtZXNzYWdlcywgc3lzdGVtUHJvbXB0KTtcbiAgICByZXR1cm4gcmVzcG9uc2UuY29udGVudDtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2VuZXJhdGVXaXRoQ29udGV4dChcbiAgICBjb25maWc6IE1vZGVsQ29uZmlnLFxuICAgIHVzZXJQcm9tcHQ6IHN0cmluZyxcbiAgICBjb250ZXh0OiBzdHJpbmcsXG4gICAgc3lzdGVtUHJvbXB0PzogU3lzdGVtUHJvbXB0Q29uZmlnXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgbWVzc2FnZXM6IEFJTWVzc2FnZVtdID0gW1xuICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IGNvbnRleHQgfSxcbiAgICAgIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiB1c2VyUHJvbXB0IH1cbiAgICBdO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUmVzcG9uc2UoY29uZmlnLCBtZXNzYWdlcywgc3lzdGVtUHJvbXB0KTtcbiAgICByZXR1cm4gcmVzcG9uc2UuY29udGVudDtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIERFVkVMT1BNRU5UIEhFTFBFUlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwdWJsaWMgc3RhdGljIGxvZ01vZGVsVXNhZ2UoY29uZmlnOiBNb2RlbENvbmZpZywgdXNhZ2U/OiBBSVJlc3BvbnNlWyd1c2FnZSddKSB7XG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+kliBBSSBDYWxsOiAke2NvbmZpZy5wcm92aWRlcn0vJHtjb25maWcubW9kZWx9YCk7XG4gICAgICBpZiAodXNhZ2UpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4ogVG9rZW5zOiAke3VzYWdlLnRvdGFsVG9rZW5zfSAoJHt1c2FnZS5wcm9tcHRUb2tlbnN9ICsgJHt1c2FnZS5jb21wbGV0aW9uVG9rZW5zfSlgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIExFR0FDWSBDT01QQVRJQklMSVRZIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIEhlbHBlciB0byBjcmVhdGUgT3BlbkFJLWNvbXBhdGlibGUgY2xpZW50IGZvciBleGlzdGluZyBjb2RlXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTGVnYWN5T3BlbkFJQ2xpZW50KGNvbmZpZzogTW9kZWxDb25maWcpOiB7XG4gIGNoYXQ6IHtcbiAgICBjb21wbGV0aW9uczoge1xuICAgICAgY3JlYXRlOiAocGFyYW1zOiBhbnkpID0+IFByb21pc2U8YW55PjtcbiAgICB9O1xuICB9O1xufSB7XG4gIHJldHVybiB7XG4gICAgY2hhdDoge1xuICAgICAgY29tcGxldGlvbnM6IHtcbiAgICAgICAgY3JlYXRlOiBhc3luYyAocGFyYW1zOiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCBtZXNzYWdlczogQUlNZXNzYWdlW10gPSBwYXJhbXMubWVzc2FnZXM7XG4gICAgICAgICAgY29uc3Qgc3lzdGVtTWVzc2FnZSA9IG1lc3NhZ2VzLmZpbmQobSA9PiBtLnJvbGUgPT09ICdzeXN0ZW0nKTtcbiAgICAgICAgICBjb25zdCB1c2VyTWVzc2FnZXMgPSBtZXNzYWdlcy5maWx0ZXIobSA9PiBtLnJvbGUgIT09ICdzeXN0ZW0nKTtcblxuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQUlDbGllbnRTZXJ2aWNlLmdlbmVyYXRlUmVzcG9uc2UoXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICB1c2VyTWVzc2FnZXMsXG4gICAgICAgICAgICBzeXN0ZW1NZXNzYWdlIGFzIFN5c3RlbVByb21wdENvbmZpZ1xuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBSZXR1cm4gT3BlbkFJLWNvbXBhdGlibGUgZm9ybWF0XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNob2ljZXM6IFt7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5jb250ZW50XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgdXNhZ2U6IHtcbiAgICAgICAgICAgICAgcHJvbXB0X3Rva2VuczogcmVzcG9uc2UudXNhZ2U/LnByb21wdFRva2VucyxcbiAgICAgICAgICAgICAgY29tcGxldGlvbl90b2tlbnM6IHJlc3BvbnNlLnVzYWdlPy5jb21wbGV0aW9uVG9rZW5zLFxuICAgICAgICAgICAgICB0b3RhbF90b2tlbnM6IHJlc3BvbnNlLnVzYWdlPy50b3RhbFRva2VucyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsIkFudGhyb3BpYyIsIkFJQ2xpZW50U2VydmljZSIsIm9wZW5haUNsaWVudCIsImFudGhyb3BpY0NsaWVudCIsImdldE9wZW5BSUNsaWVudCIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImdldEFudGhyb3BpY0NsaWVudCIsIkFOVEhST1BJQ19BUElfS0VZIiwiZ2VuZXJhdGVSZXNwb25zZSIsImNvbmZpZyIsIm1lc3NhZ2VzIiwic3lzdGVtUHJvbXB0Iiwib3B0aW9ucyIsImZ1bGxNZXNzYWdlcyIsImZpbHRlciIsIm0iLCJyb2xlIiwicHJvdmlkZXIiLCJjYWxsT3BlbkFJIiwiY2FsbEFudGhyb3BpYyIsIkVycm9yIiwiY2xpZW50IiwiaXNPMU1vZGVsIiwibW9kZWwiLCJpbmNsdWRlcyIsInJlc3BvbnNlIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWFwIiwibXNnIiwiY29udGVudCIsIm1heF9jb21wbGV0aW9uX3Rva2VucyIsIm1heFRva2VucyIsImNob2ljZXMiLCJtZXNzYWdlIiwidXNhZ2UiLCJwcm9tcHRUb2tlbnMiLCJwcm9tcHRfdG9rZW5zIiwiY29tcGxldGlvblRva2VucyIsImNvbXBsZXRpb25fdG9rZW5zIiwidG90YWxUb2tlbnMiLCJ0b3RhbF90b2tlbnMiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJyZXNwb25zZUZvcm1hdCIsInJlc3BvbnNlX2Zvcm1hdCIsImVycm9yIiwiY29uc29sZSIsInN5c3RlbU1lc3NhZ2UiLCJmaW5kIiwiY29udmVyc2F0aW9uTWVzc2FnZXMiLCJwcm9jZXNzZWRNZXNzYWdlcyIsIkFycmF5IiwiaXNBcnJheSIsImNsYXVkZUNvbnRlbnQiLCJpdGVtIiwidHlwZSIsInRleHQiLCJpbWFnZV91cmwiLCJ1cmwiLCJzb3VyY2UiLCJCb29sZWFuIiwibGVuZ3RoIiwiU3RyaW5nIiwic3lzdGVtIiwidW5kZWZpbmVkIiwiYmxvY2siLCJqb2luIiwiaW5wdXRfdG9rZW5zIiwib3V0cHV0X3Rva2VucyIsImdlbmVyYXRlVmlzaW9uUmVzcG9uc2UiLCJjYWxsT3BlbkFJVmlzaW9uIiwiY2FsbEFudGhyb3BpY1Zpc2lvbiIsInB1c2giLCJyZXNwb25zZUNvbnRlbnQiLCJnZW5lcmF0ZUNvZGVGcm9tSW1hZ2VzIiwiaW1hZ2VVcmxzIiwicHJvbXB0IiwiZGV0YWlsIiwiZ2VuZXJhdGVDb21wbGV0aW9uIiwidXNlclByb21wdCIsImdlbmVyYXRlV2l0aENvbnRleHQiLCJjb250ZXh0IiwibG9nTW9kZWxVc2FnZSIsImxvZyIsImNyZWF0ZUxlZ2FjeU9wZW5BSUNsaWVudCIsInBhcmFtcyIsInVzZXJNZXNzYWdlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/ai/aiClient.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/ai/titleGenerator.service.ts":
/*!**********************************************************!*\
  !*** ./src/server/services/ai/titleGenerator.service.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateTitle: () => (/* binding */ generateTitle)\n/* harmony export */ });\n/* harmony import */ var _lib_utils_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/lib/utils/logger */ \"(rsc)/./src/lib/utils/logger.ts\");\n/* harmony import */ var _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/server/services/ai/aiClient.service */ \"(rsc)/./src/server/services/ai/aiClient.service.ts\");\n/* harmony import */ var _config_models_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/config/models.config */ \"(rsc)/./src/config/models.config.ts\");\n/* harmony import */ var _config_prompts_config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/config/prompts.config */ \"(rsc)/./src/config/prompts.config.ts\");\n// src/server/services/ai/titleGenerator.service.ts\n\n\n\n\n// Create a logger for title generation\nconst titleLogger = {\n    start: (contextId, message, meta = {})=>{\n        _lib_utils_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].debug(`[TITLE:START][CTX:${contextId}] ${message}`, {\n            ...meta,\n            titleGenerator: true\n        });\n    },\n    prompt: (contextId, message, meta = {})=>{\n        _lib_utils_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].debug(`[TITLE:PROMPT][CTX:${contextId}] ${message}`, {\n            ...meta,\n            titleGenerator: true\n        });\n    },\n    llm: (contextId, message, meta = {})=>{\n        _lib_utils_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].debug(`[TITLE:LLM][CTX:${contextId}] ${message}`, {\n            ...meta,\n            titleGenerator: true\n        });\n    },\n    error: (contextId, message, meta = {})=>{\n        _lib_utils_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(`[TITLE:ERROR][CTX:${contextId}] ${message}`, {\n            ...meta,\n            titleGenerator: true\n        });\n    },\n    success: (contextId, message, meta = {})=>{\n        _lib_utils_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].info(`[TITLE:SUCCESS][CTX:${contextId}] ${message}`, {\n            ...meta,\n            titleGenerator: true\n        });\n    }\n};\n/**\n * Generate a concise, descriptive video project title based on the user's initial prompt\n * using LLM capabilities.\n *\n * @param params The parameters for title generation\n * @returns A promise resolving to the generated title\n */ async function generateTitle(params) {\n    const { prompt, contextId = \"unknown\" } = params;\n    const startTime = Date.now();\n    titleLogger.start(contextId, `Generating title for prompt: \"${prompt.substring(0, 50)}...\"`);\n    try {\n        // Use centralized model and prompt configuration\n        const titleModelConfig = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_2__.getModel)('titleGenerator');\n        const systemPromptConfig = (0,_config_prompts_config__WEBPACK_IMPORTED_MODULE_3__.getSystemPrompt)('TITLE_GENERATOR');\n        titleLogger.prompt(contextId, \"Sending title generation prompt to LLM\", {\n            promptLength: prompt.length,\n            model: `${titleModelConfig.provider}/${titleModelConfig.model}`\n        });\n        const llmStartTime = Date.now();\n        const messages = [\n            {\n                role: \"user\",\n                content: prompt\n            }\n        ];\n        const aiResponse = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_1__.AIClientService.generateResponse(titleModelConfig, messages, systemPromptConfig, {\n            responseFormat: {\n                type: \"json_object\"\n            }\n        });\n        const llmDuration = Date.now() - llmStartTime;\n        titleLogger.llm(contextId, `Received LLM response in ${llmDuration}ms`, {\n            duration: llmDuration,\n            model: titleModelConfig.model,\n            usage: aiResponse.usage\n        });\n        let args;\n        try {\n            if (!aiResponse.content) {\n                throw new Error(\"LLM response content is empty.\");\n            }\n            args = JSON.parse(aiResponse.content);\n            if (!args.title || typeof args.title !== 'string' || args.title.trim() === \"\") {\n                throw new Error(\"Parsed title is empty, not a string, or invalid.\");\n            }\n        } catch (error) {\n            const errMessage = error instanceof Error ? error.message : String(error);\n            titleLogger.error(contextId, \"Failed to parse LLM JSON response or invalid format\", {\n                error: errMessage,\n                responseContent: aiResponse.content\n            });\n            return {\n                title: \"New Video Project\"\n            }; // Fallback\n        }\n        const duration = Date.now() - startTime;\n        titleLogger.success(contextId, `Title generated in ${duration}ms: \"${args.title}\"`, {\n            title: args.title,\n            duration,\n            hasReasoning: !!args.reasoning\n        });\n        return {\n            title: args.title,\n            reasoning: args.reasoning\n        };\n    } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n        titleLogger.error(contextId, `Failed to generate title: ${errorMessage}`, {\n            error\n        });\n        return {\n            title: \"New Video Project\"\n        }; // Fallback\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2FpL3RpdGxlR2VuZXJhdG9yLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxtREFBbUQ7QUFDWDtBQUNnRDtBQUN0QztBQUNRO0FBRTFELHVDQUF1QztBQUN2QyxNQUFNSSxjQUFjO0lBQ2xCQyxPQUFPLENBQUNDLFdBQW1CQyxTQUFpQkMsT0FBNEIsQ0FBQyxDQUFDO1FBQ3hFUix5REFBTUEsQ0FBQ1MsS0FBSyxDQUFDLENBQUMsa0JBQWtCLEVBQUVILFVBQVUsRUFBRSxFQUFFQyxTQUFTLEVBQUU7WUFBRSxHQUFHQyxJQUFJO1lBQUVFLGdCQUFnQjtRQUFLO0lBQzdGO0lBQ0FDLFFBQVEsQ0FBQ0wsV0FBbUJDLFNBQWlCQyxPQUE0QixDQUFDLENBQUM7UUFDekVSLHlEQUFNQSxDQUFDUyxLQUFLLENBQUMsQ0FBQyxtQkFBbUIsRUFBRUgsVUFBVSxFQUFFLEVBQUVDLFNBQVMsRUFBRTtZQUFFLEdBQUdDLElBQUk7WUFBRUUsZ0JBQWdCO1FBQUs7SUFDOUY7SUFDQUUsS0FBSyxDQUFDTixXQUFtQkMsU0FBaUJDLE9BQTRCLENBQUMsQ0FBQztRQUN0RVIseURBQU1BLENBQUNTLEtBQUssQ0FBQyxDQUFDLGdCQUFnQixFQUFFSCxVQUFVLEVBQUUsRUFBRUMsU0FBUyxFQUFFO1lBQUUsR0FBR0MsSUFBSTtZQUFFRSxnQkFBZ0I7UUFBSztJQUMzRjtJQUNBRyxPQUFPLENBQUNQLFdBQW1CQyxTQUFpQkMsT0FBNEIsQ0FBQyxDQUFDO1FBQ3hFUix5REFBTUEsQ0FBQ2EsS0FBSyxDQUFDLENBQUMsa0JBQWtCLEVBQUVQLFVBQVUsRUFBRSxFQUFFQyxTQUFTLEVBQUU7WUFBRSxHQUFHQyxJQUFJO1lBQUVFLGdCQUFnQjtRQUFLO0lBQzdGO0lBQ0FJLFNBQVMsQ0FBQ1IsV0FBbUJDLFNBQWlCQyxPQUE0QixDQUFDLENBQUM7UUFDMUVSLHlEQUFNQSxDQUFDZSxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsRUFBRVQsVUFBVSxFQUFFLEVBQUVDLFNBQVMsRUFBRTtZQUFFLEdBQUdDLElBQUk7WUFBRUUsZ0JBQWdCO1FBQUs7SUFDOUY7QUFDRjtBQWNBOzs7Ozs7Q0FNQyxHQUNNLGVBQWVNLGNBQ3BCQyxNQUE2QjtJQUU3QixNQUFNLEVBQUVOLE1BQU0sRUFBRUwsWUFBWSxTQUFTLEVBQUUsR0FBR1c7SUFDMUMsTUFBTUMsWUFBWUMsS0FBS0MsR0FBRztJQUUxQmhCLFlBQVlDLEtBQUssQ0FBQ0MsV0FBVyxDQUFDLDhCQUE4QixFQUFFSyxPQUFPVSxTQUFTLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQztJQUUzRixJQUFJO1FBQ0YsaURBQWlEO1FBQ2pELE1BQU1DLG1CQUFtQnBCLCtEQUFRQSxDQUFDO1FBQ2xDLE1BQU1xQixxQkFBcUJwQix1RUFBZUEsQ0FBQztRQUUzQ0MsWUFBWU8sTUFBTSxDQUFDTCxXQUFXLDBDQUEwQztZQUN0RWtCLGNBQWNiLE9BQU9jLE1BQU07WUFDM0JDLE9BQU8sR0FBR0osaUJBQWlCSyxRQUFRLENBQUMsQ0FBQyxFQUFFTCxpQkFBaUJJLEtBQUssRUFBRTtRQUNqRTtRQUVBLE1BQU1FLGVBQWVULEtBQUtDLEdBQUc7UUFFN0IsTUFBTVMsV0FBd0I7WUFDNUI7Z0JBQUVDLE1BQU07Z0JBQVFDLFNBQVNwQjtZQUFPO1NBQ2pDO1FBRUQsTUFBTXFCLGFBQWEsTUFBTS9CLGlGQUFlQSxDQUFDZ0MsZ0JBQWdCLENBQ3ZEWCxrQkFDQU8sVUFDQU4sb0JBQ0E7WUFBRVcsZ0JBQWdCO2dCQUFFQyxNQUFNO1lBQWM7UUFBRTtRQUc1QyxNQUFNQyxjQUFjakIsS0FBS0MsR0FBRyxLQUFLUTtRQUNqQ3hCLFlBQVlRLEdBQUcsQ0FBQ04sV0FBVyxDQUFDLHlCQUF5QixFQUFFOEIsWUFBWSxFQUFFLENBQUMsRUFBRTtZQUN0RUMsVUFBVUQ7WUFDVlYsT0FBT0osaUJBQWlCSSxLQUFLO1lBQzdCWSxPQUFPTixXQUFXTSxLQUFLO1FBQ3pCO1FBRUEsSUFBSUM7UUFDSixJQUFJO1lBQ0YsSUFBSSxDQUFDUCxXQUFXRCxPQUFPLEVBQUU7Z0JBQ3ZCLE1BQU0sSUFBSVMsTUFBTTtZQUNsQjtZQUNBRCxPQUFPRSxLQUFLQyxLQUFLLENBQUNWLFdBQVdELE9BQU87WUFFcEMsSUFBSSxDQUFDUSxLQUFLSSxLQUFLLElBQUksT0FBT0osS0FBS0ksS0FBSyxLQUFLLFlBQVlKLEtBQUtJLEtBQUssQ0FBQ0MsSUFBSSxPQUFPLElBQUk7Z0JBQzdFLE1BQU0sSUFBSUosTUFBTTtZQUNsQjtRQUNGLEVBQUUsT0FBTzNCLE9BQU87WUFDZCxNQUFNZ0MsYUFBYWhDLGlCQUFpQjJCLFFBQVEzQixNQUFNTixPQUFPLEdBQUd1QyxPQUFPakM7WUFDbkVULFlBQVlTLEtBQUssQ0FBQ1AsV0FBVyx1REFBdUQ7Z0JBQ2xGTyxPQUFPZ0M7Z0JBQ1BFLGlCQUFpQmYsV0FBV0QsT0FBTztZQUNyQztZQUNBLE9BQU87Z0JBQUVZLE9BQU87WUFBb0IsR0FBRyxXQUFXO1FBQ3BEO1FBRUEsTUFBTU4sV0FBV2xCLEtBQUtDLEdBQUcsS0FBS0Y7UUFDOUJkLFlBQVlVLE9BQU8sQ0FBQ1IsV0FBVyxDQUFDLG1CQUFtQixFQUFFK0IsU0FBUyxLQUFLLEVBQUVFLEtBQUtJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNsRkEsT0FBT0osS0FBS0ksS0FBSztZQUNqQk47WUFDQVcsY0FBYyxDQUFDLENBQUNULEtBQUtVLFNBQVM7UUFDaEM7UUFFQSxPQUFPO1lBQ0xOLE9BQU9KLEtBQUtJLEtBQUs7WUFDakJNLFdBQVdWLEtBQUtVLFNBQVM7UUFDM0I7SUFDRixFQUFFLE9BQU9wQyxPQUFPO1FBQ2QsTUFBTXFDLGVBQWVyQyxpQkFBaUIyQixRQUFRM0IsTUFBTU4sT0FBTyxHQUFHO1FBQzlESCxZQUFZUyxLQUFLLENBQUNQLFdBQVcsQ0FBQywwQkFBMEIsRUFBRTRDLGNBQWMsRUFBRTtZQUFFckM7UUFBTTtRQUVsRixPQUFPO1lBQUU4QixPQUFPO1FBQW9CLEdBQUcsV0FBVztJQUNwRDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL3NlcnZpY2VzL2FpL3RpdGxlR2VuZXJhdG9yLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZlci9zZXJ2aWNlcy9haS90aXRsZUdlbmVyYXRvci5zZXJ2aWNlLnRzXG5pbXBvcnQgbG9nZ2VyIGZyb20gJ34vbGliL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBBSUNsaWVudFNlcnZpY2UsIHR5cGUgQUlNZXNzYWdlIH0gZnJvbSAnfi9zZXJ2ZXIvc2VydmljZXMvYWkvYWlDbGllbnQuc2VydmljZSc7XG5pbXBvcnQgeyBnZXRNb2RlbCB9IGZyb20gJ34vY29uZmlnL21vZGVscy5jb25maWcnO1xuaW1wb3J0IHsgZ2V0U3lzdGVtUHJvbXB0IH0gZnJvbSAnfi9jb25maWcvcHJvbXB0cy5jb25maWcnO1xuXG4vLyBDcmVhdGUgYSBsb2dnZXIgZm9yIHRpdGxlIGdlbmVyYXRpb25cbmNvbnN0IHRpdGxlTG9nZ2VyID0ge1xuICBzdGFydDogKGNvbnRleHRJZDogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkgPT4ge1xuICAgIGxvZ2dlci5kZWJ1ZyhgW1RJVExFOlNUQVJUXVtDVFg6JHtjb250ZXh0SWR9XSAke21lc3NhZ2V9YCwgeyAuLi5tZXRhLCB0aXRsZUdlbmVyYXRvcjogdHJ1ZSB9KTtcbiAgfSxcbiAgcHJvbXB0OiAoY29udGV4dElkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gICAgbG9nZ2VyLmRlYnVnKGBbVElUTEU6UFJPTVBUXVtDVFg6JHtjb250ZXh0SWR9XSAke21lc3NhZ2V9YCwgeyAuLi5tZXRhLCB0aXRsZUdlbmVyYXRvcjogdHJ1ZSB9KTtcbiAgfSxcbiAgbGxtOiAoY29udGV4dElkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgbWV0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KSA9PiB7XG4gICAgbG9nZ2VyLmRlYnVnKGBbVElUTEU6TExNXVtDVFg6JHtjb250ZXh0SWR9XSAke21lc3NhZ2V9YCwgeyAuLi5tZXRhLCB0aXRsZUdlbmVyYXRvcjogdHJ1ZSB9KTtcbiAgfSxcbiAgZXJyb3I6IChjb250ZXh0SWQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgICBsb2dnZXIuZXJyb3IoYFtUSVRMRTpFUlJPUl1bQ1RYOiR7Y29udGV4dElkfV0gJHttZXNzYWdlfWAsIHsgLi4ubWV0YSwgdGl0bGVHZW5lcmF0b3I6IHRydWUgfSk7XG4gIH0sXG4gIHN1Y2Nlc3M6IChjb250ZXh0SWQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBtZXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pID0+IHtcbiAgICBsb2dnZXIuaW5mbyhgW1RJVExFOlNVQ0NFU1NdW0NUWDoke2NvbnRleHRJZH1dICR7bWVzc2FnZX1gLCB7IC4uLm1ldGEsIHRpdGxlR2VuZXJhdG9yOiB0cnVlIH0pO1xuICB9XG59O1xuXG4vLyBUeXBlIGRlZmluaXRpb24gZm9yIHRpdGxlIGdlbmVyYXRpb24gcGFyYW1ldGVyc1xuZXhwb3J0IGludGVyZmFjZSBUaXRsZUdlbmVyYXRpb25QYXJhbXMge1xuICBwcm9tcHQ6IHN0cmluZztcbiAgY29udGV4dElkPzogc3RyaW5nOyAvLyBQcm9qZWN0IElEIG9yIG90aGVyIGlkZW50aWZpZXIgZm9yIGxvZ2dpbmdcbn1cblxuLy8gVHlwZSBkZWZpbml0aW9uIGZvciB0aXRsZSBnZW5lcmF0aW9uIHJlc3BvbnNlXG5leHBvcnQgaW50ZXJmYWNlIFRpdGxlR2VuZXJhdGlvblJlc3BvbnNlIHtcbiAgdGl0bGU6IHN0cmluZztcbiAgcmVhc29uaW5nPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlIGEgY29uY2lzZSwgZGVzY3JpcHRpdmUgdmlkZW8gcHJvamVjdCB0aXRsZSBiYXNlZCBvbiB0aGUgdXNlcidzIGluaXRpYWwgcHJvbXB0XG4gKiB1c2luZyBMTE0gY2FwYWJpbGl0aWVzLlxuICpcbiAqIEBwYXJhbSBwYXJhbXMgVGhlIHBhcmFtZXRlcnMgZm9yIHRpdGxlIGdlbmVyYXRpb25cbiAqIEByZXR1cm5zIEEgcHJvbWlzZSByZXNvbHZpbmcgdG8gdGhlIGdlbmVyYXRlZCB0aXRsZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVUaXRsZShcbiAgcGFyYW1zOiBUaXRsZUdlbmVyYXRpb25QYXJhbXNcbik6IFByb21pc2U8VGl0bGVHZW5lcmF0aW9uUmVzcG9uc2U+IHtcbiAgY29uc3QgeyBwcm9tcHQsIGNvbnRleHRJZCA9IFwidW5rbm93blwiIH0gPSBwYXJhbXM7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIFxuICB0aXRsZUxvZ2dlci5zdGFydChjb250ZXh0SWQsIGBHZW5lcmF0aW5nIHRpdGxlIGZvciBwcm9tcHQ6IFwiJHtwcm9tcHQuc3Vic3RyaW5nKDAsIDUwKX0uLi5cImApO1xuXG4gIHRyeSB7XG4gICAgLy8gVXNlIGNlbnRyYWxpemVkIG1vZGVsIGFuZCBwcm9tcHQgY29uZmlndXJhdGlvblxuICAgIGNvbnN0IHRpdGxlTW9kZWxDb25maWcgPSBnZXRNb2RlbCgndGl0bGVHZW5lcmF0b3InKTtcbiAgICBjb25zdCBzeXN0ZW1Qcm9tcHRDb25maWcgPSBnZXRTeXN0ZW1Qcm9tcHQoJ1RJVExFX0dFTkVSQVRPUicpO1xuXG4gICAgdGl0bGVMb2dnZXIucHJvbXB0KGNvbnRleHRJZCwgXCJTZW5kaW5nIHRpdGxlIGdlbmVyYXRpb24gcHJvbXB0IHRvIExMTVwiLCB7XG4gICAgICBwcm9tcHRMZW5ndGg6IHByb21wdC5sZW5ndGgsXG4gICAgICBtb2RlbDogYCR7dGl0bGVNb2RlbENvbmZpZy5wcm92aWRlcn0vJHt0aXRsZU1vZGVsQ29uZmlnLm1vZGVsfWBcbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCBsbG1TdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgY29uc3QgbWVzc2FnZXM6IEFJTWVzc2FnZVtdID0gW1xuICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogcHJvbXB0IH1cbiAgICBdO1xuXG4gICAgY29uc3QgYWlSZXNwb25zZSA9IGF3YWl0IEFJQ2xpZW50U2VydmljZS5nZW5lcmF0ZVJlc3BvbnNlKFxuICAgICAgdGl0bGVNb2RlbENvbmZpZyxcbiAgICAgIG1lc3NhZ2VzLFxuICAgICAgc3lzdGVtUHJvbXB0Q29uZmlnLFxuICAgICAgeyByZXNwb25zZUZvcm1hdDogeyB0eXBlOiBcImpzb25fb2JqZWN0XCIgfSB9XG4gICAgKTtcbiAgICBcbiAgICBjb25zdCBsbG1EdXJhdGlvbiA9IERhdGUubm93KCkgLSBsbG1TdGFydFRpbWU7XG4gICAgdGl0bGVMb2dnZXIubGxtKGNvbnRleHRJZCwgYFJlY2VpdmVkIExMTSByZXNwb25zZSBpbiAke2xsbUR1cmF0aW9ufW1zYCwge1xuICAgICAgZHVyYXRpb246IGxsbUR1cmF0aW9uLFxuICAgICAgbW9kZWw6IHRpdGxlTW9kZWxDb25maWcubW9kZWwsXG4gICAgICB1c2FnZTogYWlSZXNwb25zZS51c2FnZVxuICAgIH0pO1xuICAgIFxuICAgIGxldCBhcmdzOiB7IHRpdGxlOiBzdHJpbmc7IHJlYXNvbmluZz86IHN0cmluZyB9O1xuICAgIHRyeSB7XG4gICAgICBpZiAoIWFpUmVzcG9uc2UuY29udGVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMTE0gcmVzcG9uc2UgY29udGVudCBpcyBlbXB0eS5cIik7XG4gICAgICB9XG4gICAgICBhcmdzID0gSlNPTi5wYXJzZShhaVJlc3BvbnNlLmNvbnRlbnQpO1xuICAgICAgXG4gICAgICBpZiAoIWFyZ3MudGl0bGUgfHwgdHlwZW9mIGFyZ3MudGl0bGUgIT09ICdzdHJpbmcnIHx8IGFyZ3MudGl0bGUudHJpbSgpID09PSBcIlwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhcnNlZCB0aXRsZSBpcyBlbXB0eSwgbm90IGEgc3RyaW5nLCBvciBpbnZhbGlkLlwiKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyTWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcbiAgICAgIHRpdGxlTG9nZ2VyLmVycm9yKGNvbnRleHRJZCwgXCJGYWlsZWQgdG8gcGFyc2UgTExNIEpTT04gcmVzcG9uc2Ugb3IgaW52YWxpZCBmb3JtYXRcIiwgeyBcbiAgICAgICAgZXJyb3I6IGVyck1lc3NhZ2UsXG4gICAgICAgIHJlc3BvbnNlQ29udGVudDogYWlSZXNwb25zZS5jb250ZW50IFxuICAgICAgfSk7XG4gICAgICByZXR1cm4geyB0aXRsZTogXCJOZXcgVmlkZW8gUHJvamVjdFwiIH07IC8vIEZhbGxiYWNrXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICB0aXRsZUxvZ2dlci5zdWNjZXNzKGNvbnRleHRJZCwgYFRpdGxlIGdlbmVyYXRlZCBpbiAke2R1cmF0aW9ufW1zOiBcIiR7YXJncy50aXRsZX1cImAsIHtcbiAgICAgIHRpdGxlOiBhcmdzLnRpdGxlLFxuICAgICAgZHVyYXRpb24sXG4gICAgICBoYXNSZWFzb25pbmc6ICEhYXJncy5yZWFzb25pbmdcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdGl0bGU6IGFyZ3MudGl0bGUsXG4gICAgICByZWFzb25pbmc6IGFyZ3MucmVhc29uaW5nXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiO1xuICAgIHRpdGxlTG9nZ2VyLmVycm9yKGNvbnRleHRJZCwgYEZhaWxlZCB0byBnZW5lcmF0ZSB0aXRsZTogJHtlcnJvck1lc3NhZ2V9YCwgeyBlcnJvciB9KTtcbiAgICBcbiAgICByZXR1cm4geyB0aXRsZTogXCJOZXcgVmlkZW8gUHJvamVjdFwiIH07IC8vIEZhbGxiYWNrXG4gIH1cbn0gIl0sIm5hbWVzIjpbImxvZ2dlciIsIkFJQ2xpZW50U2VydmljZSIsImdldE1vZGVsIiwiZ2V0U3lzdGVtUHJvbXB0IiwidGl0bGVMb2dnZXIiLCJzdGFydCIsImNvbnRleHRJZCIsIm1lc3NhZ2UiLCJtZXRhIiwiZGVidWciLCJ0aXRsZUdlbmVyYXRvciIsInByb21wdCIsImxsbSIsImVycm9yIiwic3VjY2VzcyIsImluZm8iLCJnZW5lcmF0ZVRpdGxlIiwicGFyYW1zIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsInN1YnN0cmluZyIsInRpdGxlTW9kZWxDb25maWciLCJzeXN0ZW1Qcm9tcHRDb25maWciLCJwcm9tcHRMZW5ndGgiLCJsZW5ndGgiLCJtb2RlbCIsInByb3ZpZGVyIiwibGxtU3RhcnRUaW1lIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsImFpUmVzcG9uc2UiLCJnZW5lcmF0ZVJlc3BvbnNlIiwicmVzcG9uc2VGb3JtYXQiLCJ0eXBlIiwibGxtRHVyYXRpb24iLCJkdXJhdGlvbiIsInVzYWdlIiwiYXJncyIsIkVycm9yIiwiSlNPTiIsInBhcnNlIiwidGl0bGUiLCJ0cmltIiwiZXJyTWVzc2FnZSIsIlN0cmluZyIsInJlc3BvbnNlQ29udGVudCIsImhhc1JlYXNvbmluZyIsInJlYXNvbmluZyIsImVycm9yTWVzc2FnZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/ai/titleGenerator.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/data/dataLifecycle.service.ts":
/*!***********************************************************!*\
  !*** ./src/server/services/data/dataLifecycle.service.ts ***!
  \***********************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DataLifecycleService: () => (/* binding */ DataLifecycleService),\n/* harmony export */   dataLifecycleService: () => (/* binding */ dataLifecycleService)\n/* harmony export */ });\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_bazaar_database__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__]);\n([_bazaar_database__WEBPACK_IMPORTED_MODULE_0__, drizzle_orm__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/services/data/dataLifecycle.service.ts\n\n\n\nclass DataLifecycleService {\n    /**\n   * Start automated cleanup service\n   */ startAutomatedCleanup(config = {}) {\n        const fullConfig = {\n            ...this.defaultConfig,\n            ...config\n        };\n        if (!fullConfig.enableAutoCleanup) {\n            console.log(' [DataLifecycle] Automated cleanup disabled');\n            return;\n        }\n        // Clear any existing interval\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n        }\n        const intervalMs = fullConfig.cleanupIntervalHours * 60 * 60 * 1000;\n        this.cleanupInterval = setInterval(async ()=>{\n            try {\n                console.log(' [DataLifecycle] Starting automated cleanup...');\n                const result = await this.performCleanup(fullConfig);\n                this.logCleanupResult(result);\n            } catch (error) {\n                console.error(' [DataLifecycle] Automated cleanup failed:', error);\n            }\n        }, intervalMs);\n        console.log(` [DataLifecycle] Automated cleanup started (every ${fullConfig.cleanupIntervalHours}h)`);\n    }\n    /**\n   * Stop automated cleanup service\n   */ stopAutomatedCleanup() {\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n            this.cleanupInterval = null;\n            console.log(' [DataLifecycle] Automated cleanup stopped');\n        }\n    }\n    /**\n   * Perform comprehensive data cleanup\n   */ async performCleanup(config = {}) {\n        const fullConfig = {\n            ...this.defaultConfig,\n            ...config\n        };\n        const startTime = performance.now();\n        const cleanupStartTime = Date.now();\n        console.log(' [DataLifecycle] Starting comprehensive cleanup...');\n        console.log(` Retention periods: Images(${fullConfig.imageAnalysisRetentionDays}d), Context(${fullConfig.conversationContextRetentionDays}d), Iterations(${fullConfig.sceneIterationsRetentionDays}d), Memory(${fullConfig.projectMemoryRetentionDays}d)`);\n        try {\n            // Cleanup old image analysis records\n            const imageAnalysisDeleted = await this.cleanupImageAnalysis(fullConfig.imageAnalysisRetentionDays);\n            // Cleanup old conversation context\n            const conversationDeleted = await this.cleanupConversationContext(fullConfig.conversationContextRetentionDays);\n            // Cleanup old scene iterations  \n            const sceneIterationsDeleted = await this.cleanupSceneIterations(fullConfig.sceneIterationsRetentionDays);\n            // Cleanup old project memory records\n            const projectMemoryDeleted = await this.cleanupProjectMemory(fullConfig.projectMemoryRetentionDays);\n            const cleanupDuration = Date.now() - cleanupStartTime;\n            const result = {\n                imageAnalysisRecordsDeleted: imageAnalysisDeleted,\n                conversationRecordsDeleted: conversationDeleted,\n                sceneIterationsDeleted: sceneIterationsDeleted,\n                projectMemoryRecordsDeleted: projectMemoryDeleted,\n                totalSpaceReclaimed: this.estimateSpaceReclaimed(imageAnalysisDeleted + conversationDeleted + sceneIterationsDeleted + projectMemoryDeleted),\n                cleanupDurationMs: cleanupDuration\n            };\n            console.log(' [DataLifecycle] Cleanup completed successfully');\n            return result;\n        } catch (error) {\n            // Cleanup ended\n            console.error(' [DataLifecycle] Cleanup failed:', error);\n            throw error;\n        }\n    }\n    /**\n   * Cleanup old image analysis records\n   */ async cleanupImageAnalysis(retentionDays) {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n        if (this.DEBUG) {\n            console.log(` [DataLifecycle] Cleaning image analysis older than ${cutoffDate.toISOString()}`);\n        }\n        try {\n            const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.imageAnalysis).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.lt)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.imageAnalysis.createdAt, cutoffDate));\n            const deletedCount = result.rowCount || 0;\n            console.log(` [DataLifecycle] Deleted ${deletedCount} old image analysis records`);\n            return deletedCount;\n        } catch (error) {\n            console.error(' [DataLifecycle] Image analysis cleanup failed:', error);\n            return 0;\n        }\n    }\n    /**\n   * Cleanup old conversation context from project memory\n   */ async cleanupConversationContext(retentionDays) {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n        if (this.DEBUG) {\n            console.log(` [DataLifecycle] Cleaning conversation context older than ${cutoffDate.toISOString()}`);\n        }\n        try {\n            const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory.memoryType, 'conversation_context'), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.lt)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory.updatedAt, cutoffDate)));\n            const deletedCount = result.rowCount || 0;\n            console.log(` [DataLifecycle] Deleted ${deletedCount} old conversation context records`);\n            return deletedCount;\n        } catch (error) {\n            console.error(' [DataLifecycle] Conversation context cleanup failed:', error);\n            return 0;\n        }\n    }\n    /**\n   * Cleanup old scene iterations\n   */ async cleanupSceneIterations(retentionDays) {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n        if (this.DEBUG) {\n            console.log(` [DataLifecycle] Cleaning scene iterations older than ${cutoffDate.toISOString()}`);\n        }\n        try {\n            const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.lt)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations.createdAt, cutoffDate));\n            const deletedCount = result.rowCount || 0;\n            console.log(` [DataLifecycle] Deleted ${deletedCount} old scene iteration records`);\n            return deletedCount;\n        } catch (error) {\n            console.error(' [DataLifecycle] Scene iterations cleanup failed:', error);\n            return 0;\n        }\n    }\n    /**\n   * Cleanup old project memory records (keep user preferences, clean temporary data)\n   */ async cleanupProjectMemory(retentionDays) {\n        const cutoffDate = new Date();\n        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n        if (this.DEBUG) {\n            console.log(` [DataLifecycle] Cleaning temporary project memory older than ${cutoffDate.toISOString()}`);\n        }\n        try {\n            // Only delete temporary/transient memory types, keep user preferences\n            const temporaryTypes = [\n                'conversation_context',\n                'temporary_note',\n                'session_data'\n            ];\n            let totalDeleted = 0;\n            for (const memoryType of temporaryTypes){\n                const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.delete(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory.memoryType, memoryType), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.lt)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory.updatedAt, cutoffDate)));\n                totalDeleted += result.rowCount || 0;\n            }\n            console.log(` [DataLifecycle] Deleted ${totalDeleted} old temporary project memory records`);\n            return totalDeleted;\n        } catch (error) {\n            console.error(' [DataLifecycle] Project memory cleanup failed:', error);\n            return 0;\n        }\n    }\n    /**\n   * Estimate space reclaimed from cleanup\n   */ estimateSpaceReclaimed(totalRecords) {\n        // Rough estimates for record sizes\n        const avgRecordSizeKB = 2; // Conservative estimate\n        const totalKB = totalRecords * avgRecordSizeKB;\n        if (totalKB < 1024) {\n            return `${totalKB.toFixed(1)} KB`;\n        } else if (totalKB < 1024 * 1024) {\n            return `${(totalKB / 1024).toFixed(1)} MB`;\n        } else {\n            return `${(totalKB / (1024 * 1024)).toFixed(1)} GB`;\n        }\n    }\n    /**\n   * Get data lifecycle statistics\n   */ async getLifecycleStats() {\n        try {\n            // Get counts from each table\n            const [imageCount] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.imageAnalysis);\n            const [conversationCount] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_1__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory.memoryType, 'conversation_context'));\n            const [iterationsCount] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.sceneIterations);\n            const [memoryCount] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.projectMemory);\n            // Find oldest record\n            const oldestImage = await _bazaar_database__WEBPACK_IMPORTED_MODULE_0__.db.select().from(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.imageAnalysis).orderBy(_bazaar_database__WEBPACK_IMPORTED_MODULE_0__.imageAnalysis.createdAt).limit(1);\n            const oldestAge = oldestImage.length > 0 ? this.formatAge(oldestImage[0].createdAt) : 'No records';\n            return {\n                imageAnalysisCount: imageCount ? 1 : 0,\n                conversationContextCount: conversationCount ? 1 : 0,\n                sceneIterationsCount: iterationsCount ? 1 : 0,\n                projectMemoryCount: memoryCount ? 1 : 0,\n                oldestRecordAge: oldestAge\n            };\n        } catch (error) {\n            console.error(' [DataLifecycle] Failed to get stats:', error);\n            throw error;\n        }\n    }\n    /**\n   * Format age of record for display\n   */ formatAge(date) {\n        const now = new Date();\n        const diffMs = now.getTime() - date.getTime();\n        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n        if (diffDays < 1) {\n            return 'Less than 1 day';\n        } else if (diffDays < 30) {\n            return `${diffDays} days`;\n        } else if (diffDays < 365) {\n            const months = Math.floor(diffDays / 30);\n            return `${months} month${months === 1 ? '' : 's'}`;\n        } else {\n            const years = Math.floor(diffDays / 365);\n            return `${years} year${years === 1 ? '' : 's'}`;\n        }\n    }\n    /**\n   * Log cleanup results\n   */ logCleanupResult(result) {\n        console.log(`\\n [DataLifecycle] Cleanup Results:`);\n        console.log(`   Records deleted:`);\n        console.log(`      Image analysis: ${result.imageAnalysisRecordsDeleted}`);\n        console.log(`     Conversation context: ${result.conversationRecordsDeleted}`);\n        console.log(`     Scene iterations: ${result.sceneIterationsDeleted}`);\n        console.log(`     Project memory: ${result.projectMemoryRecordsDeleted}`);\n        console.log(`   Space reclaimed: ${result.totalSpaceReclaimed}`);\n        console.log(`    Duration: ${result.cleanupDurationMs.toFixed(2)}ms`);\n    }\n    /**\n   * Force immediate cleanup (for testing/admin)\n   */ async forceCleanup(config = {}) {\n        console.log(' [DataLifecycle] Force cleanup requested');\n        return await this.performCleanup(config);\n    }\n    constructor(){\n        this.DEBUG = \"development\" === 'development';\n        this.cleanupInterval = null;\n        this.defaultConfig = {\n            imageAnalysisRetentionDays: 30,\n            conversationContextRetentionDays: 90,\n            sceneIterationsRetentionDays: 60,\n            projectMemoryRetentionDays: 180,\n            enableAutoCleanup: true,\n            cleanupIntervalHours: 24\n        };\n    }\n}\n// Export singleton instance\nconst dataLifecycleService = new DataLifecycleService();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2RhdGEvZGF0YUxpZmVjeWNsZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxvREFBb0Q7QUFDZDtBQUMyQztBQUN2QztBQXlCbkMsTUFBTU87SUFhWDs7R0FFQyxHQUNEQyxzQkFBc0JDLFNBQXVDLENBQUMsQ0FBQyxFQUFRO1FBQ3JFLE1BQU1DLGFBQWE7WUFBRSxHQUFHLElBQUksQ0FBQ0MsYUFBYTtZQUFFLEdBQUdGLE1BQU07UUFBQztRQUV0RCxJQUFJLENBQUNDLFdBQVdFLGlCQUFpQixFQUFFO1lBQ2pDQyxRQUFRQyxHQUFHLENBQUM7WUFDWjtRQUNGO1FBRUEsOEJBQThCO1FBQzlCLElBQUksSUFBSSxDQUFDQyxlQUFlLEVBQUU7WUFDeEJDLGNBQWMsSUFBSSxDQUFDRCxlQUFlO1FBQ3BDO1FBRUEsTUFBTUUsYUFBYVAsV0FBV1Esb0JBQW9CLEdBQUcsS0FBSyxLQUFLO1FBRS9ELElBQUksQ0FBQ0gsZUFBZSxHQUFHSSxZQUFZO1lBQ2pDLElBQUk7Z0JBQ0ZOLFFBQVFDLEdBQUcsQ0FBQztnQkFDWixNQUFNTSxTQUFTLE1BQU0sSUFBSSxDQUFDQyxjQUFjLENBQUNYO2dCQUN6QyxJQUFJLENBQUNZLGdCQUFnQixDQUFDRjtZQUN4QixFQUFFLE9BQU9HLE9BQU87Z0JBQ2RWLFFBQVFVLEtBQUssQ0FBQywrQ0FBK0NBO1lBQy9EO1FBQ0YsR0FBR047UUFFSEosUUFBUUMsR0FBRyxDQUFDLENBQUMscURBQXFELEVBQUVKLFdBQVdRLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztJQUN6RztJQUVBOztHQUVDLEdBQ0RNLHVCQUE2QjtRQUMzQixJQUFJLElBQUksQ0FBQ1QsZUFBZSxFQUFFO1lBQ3hCQyxjQUFjLElBQUksQ0FBQ0QsZUFBZTtZQUNsQyxJQUFJLENBQUNBLGVBQWUsR0FBRztZQUN2QkYsUUFBUUMsR0FBRyxDQUFDO1FBQ2Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTU8sZUFB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QyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRU0sT0FBTzRCLGlCQUFpQixDQUFDbUIsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3hFO0lBRUE7O0dBRUMsR0FDRCxNQUFNMkIsYUFBYXJGLFNBQXVDLENBQUMsQ0FBQyxFQUEwQjtRQUNwRkksUUFBUUMsR0FBRyxDQUFDO1FBQ1osT0FBTyxNQUFNLElBQUksQ0FBQ08sY0FBYyxDQUFDWjtJQUNuQzs7YUFuVWlCNEMsUUFBUTBDLGtCQUF5QjthQUMxQ2hGLGtCQUF5QzthQUVoQ0osZ0JBQXFDO1lBQ3BEbUIsNEJBQTRCO1lBQzVCQyxrQ0FBa0M7WUFDbENDLDhCQUE4QjtZQUM5QkMsNEJBQTRCO1lBQzVCckIsbUJBQW1CO1lBQ25CTSxzQkFBc0I7UUFDeEI7O0FBMFRGO0FBRUEsNEJBQTRCO0FBQ3JCLE1BQU04RSx1QkFBdUIsSUFBSXpGLHVCQUF1QiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3NlcnZlci9zZXJ2aWNlcy9kYXRhL2RhdGFMaWZlY3ljbGUuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmVyL3NlcnZpY2VzL2RhdGEvZGF0YUxpZmVjeWNsZS5zZXJ2aWNlLnRzXG5pbXBvcnQgeyBkYiB9IGZyb20gXCJAYmF6YWFyL2RhdGFiYXNlXCI7XG5pbXBvcnQgeyBpbWFnZUFuYWx5c2lzLCBwcm9qZWN0TWVtb3J5LCBzY2VuZUl0ZXJhdGlvbnMgfSBmcm9tIFwiQGJhemFhci9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgbHQsIGFuZCwgZXEgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuLyoqXG4gKiBEYXRhIExpZmVjeWNsZSBNYW5hZ2VtZW50IFNlcnZpY2VcbiAqIFBoYXNlIDQuMTogQXV0b21hdGVkIGNsZWFudXAgYW5kIHJldGVudGlvbiBtYW5hZ2VtZW50XG4gKi9cblxuZXhwb3J0IGludGVyZmFjZSBEYXRhTGlmZWN5Y2xlQ29uZmlnIHtcbiAgaW1hZ2VBbmFseXNpc1JldGVudGlvbkRheXM6IG51bWJlcjtcbiAgY29udmVyc2F0aW9uQ29udGV4dFJldGVudGlvbkRheXM6IG51bWJlcjtcbiAgc2NlbmVJdGVyYXRpb25zUmV0ZW50aW9uRGF5czogbnVtYmVyO1xuICBwcm9qZWN0TWVtb3J5UmV0ZW50aW9uRGF5czogbnVtYmVyO1xuICBlbmFibGVBdXRvQ2xlYW51cDogYm9vbGVhbjtcbiAgY2xlYW51cEludGVydmFsSG91cnM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDbGVhbnVwUmVzdWx0IHtcbiAgaW1hZ2VBbmFseXNpc1JlY29yZHNEZWxldGVkOiBudW1iZXI7XG4gIGNvbnZlcnNhdGlvblJlY29yZHNEZWxldGVkOiBudW1iZXI7XG4gIHNjZW5lSXRlcmF0aW9uc0RlbGV0ZWQ6IG51bWJlcjtcbiAgcHJvamVjdE1lbW9yeVJlY29yZHNEZWxldGVkOiBudW1iZXI7XG4gIHRvdGFsU3BhY2VSZWNsYWltZWQ6IHN0cmluZztcbiAgY2xlYW51cER1cmF0aW9uTXM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGFMaWZlY3ljbGVTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBERUJVRyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xuICBwcml2YXRlIGNsZWFudXBJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgXG4gIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdENvbmZpZzogRGF0YUxpZmVjeWNsZUNvbmZpZyA9IHtcbiAgICBpbWFnZUFuYWx5c2lzUmV0ZW50aW9uRGF5czogMzAsICAgICAgICAvLyAzMCBkYXlzIGZvciBpbWFnZSBhbmFseXNpc1xuICAgIGNvbnZlcnNhdGlvbkNvbnRleHRSZXRlbnRpb25EYXlzOiA5MCwgIC8vIDkwIGRheXMgZm9yIGNvbnZlcnNhdGlvbiBjb250ZXh0XG4gICAgc2NlbmVJdGVyYXRpb25zUmV0ZW50aW9uRGF5czogNjAsICAgICAgLy8gNjAgZGF5cyBmb3Igc2NlbmUgaXRlcmF0aW9uc1xuICAgIHByb2plY3RNZW1vcnlSZXRlbnRpb25EYXlzOiAxODAsICAgICAgIC8vIDYgbW9udGhzIGZvciBwcm9qZWN0IG1lbW9yeVxuICAgIGVuYWJsZUF1dG9DbGVhbnVwOiB0cnVlLFxuICAgIGNsZWFudXBJbnRlcnZhbEhvdXJzOiAyNCwgICAgICAgICAgICAgIC8vIERhaWx5IGNsZWFudXBcbiAgfTtcblxuICAvKipcbiAgICogU3RhcnQgYXV0b21hdGVkIGNsZWFudXAgc2VydmljZVxuICAgKi9cbiAgc3RhcnRBdXRvbWF0ZWRDbGVhbnVwKGNvbmZpZzogUGFydGlhbDxEYXRhTGlmZWN5Y2xlQ29uZmlnPiA9IHt9KTogdm9pZCB7XG4gICAgY29uc3QgZnVsbENvbmZpZyA9IHsgLi4udGhpcy5kZWZhdWx0Q29uZmlnLCAuLi5jb25maWcgfTtcbiAgICBcbiAgICBpZiAoIWZ1bGxDb25maWcuZW5hYmxlQXV0b0NsZWFudXApIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5eC77iPIFtEYXRhTGlmZWN5Y2xlXSBBdXRvbWF0ZWQgY2xlYW51cCBkaXNhYmxlZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGFueSBleGlzdGluZyBpbnRlcnZhbFxuICAgIGlmICh0aGlzLmNsZWFudXBJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBJbnRlcnZhbCk7XG4gICAgfVxuXG4gICAgY29uc3QgaW50ZXJ2YWxNcyA9IGZ1bGxDb25maWcuY2xlYW51cEludGVydmFsSG91cnMgKiA2MCAqIDYwICogMTAwMDtcbiAgICBcbiAgICB0aGlzLmNsZWFudXBJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5eC77iPIFtEYXRhTGlmZWN5Y2xlXSBTdGFydGluZyBhdXRvbWF0ZWQgY2xlYW51cC4uLicpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBlcmZvcm1DbGVhbnVwKGZ1bGxDb25maWcpO1xuICAgICAgICB0aGlzLmxvZ0NsZWFudXBSZXN1bHQocmVzdWx0KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbRGF0YUxpZmVjeWNsZV0gQXV0b21hdGVkIGNsZWFudXAgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9LCBpbnRlcnZhbE1zKTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5eC77iPIFtEYXRhTGlmZWN5Y2xlXSBBdXRvbWF0ZWQgY2xlYW51cCBzdGFydGVkIChldmVyeSAke2Z1bGxDb25maWcuY2xlYW51cEludGVydmFsSG91cnN9aClgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIGF1dG9tYXRlZCBjbGVhbnVwIHNlcnZpY2VcbiAgICovXG4gIHN0b3BBdXRvbWF0ZWRDbGVhbnVwKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNsZWFudXBJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBJbnRlcnZhbCk7XG4gICAgICB0aGlzLmNsZWFudXBJbnRlcnZhbCA9IG51bGw7XG4gICAgICBjb25zb2xlLmxvZygn8J+Xgu+4jyBbRGF0YUxpZmVjeWNsZV0gQXV0b21hdGVkIGNsZWFudXAgc3RvcHBlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIGNvbXByZWhlbnNpdmUgZGF0YSBjbGVhbnVwXG4gICAqL1xuICBhc3luYyBwZXJmb3JtQ2xlYW51cChjb25maWc6IFBhcnRpYWw8RGF0YUxpZmVjeWNsZUNvbmZpZz4gPSB7fSk6IFByb21pc2U8Q2xlYW51cFJlc3VsdD4ge1xuICAgIGNvbnN0IGZ1bGxDb25maWcgPSB7IC4uLnRoaXMuZGVmYXVsdENvbmZpZywgLi4uY29uZmlnIH07XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgXG4gICAgY29uc3QgY2xlYW51cFN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICBjb25zb2xlLmxvZygn8J+Xgu+4jyBbRGF0YUxpZmVjeWNsZV0gU3RhcnRpbmcgY29tcHJlaGVuc2l2ZSBjbGVhbnVwLi4uJyk7XG4gICAgY29uc29sZS5sb2coYPCfk4UgUmV0ZW50aW9uIHBlcmlvZHM6IEltYWdlcygke2Z1bGxDb25maWcuaW1hZ2VBbmFseXNpc1JldGVudGlvbkRheXN9ZCksIENvbnRleHQoJHtmdWxsQ29uZmlnLmNvbnZlcnNhdGlvbkNvbnRleHRSZXRlbnRpb25EYXlzfWQpLCBJdGVyYXRpb25zKCR7ZnVsbENvbmZpZy5zY2VuZUl0ZXJhdGlvbnNSZXRlbnRpb25EYXlzfWQpLCBNZW1vcnkoJHtmdWxsQ29uZmlnLnByb2plY3RNZW1vcnlSZXRlbnRpb25EYXlzfWQpYCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2xlYW51cCBvbGQgaW1hZ2UgYW5hbHlzaXMgcmVjb3Jkc1xuICAgICAgY29uc3QgaW1hZ2VBbmFseXNpc0RlbGV0ZWQgPSBhd2FpdCB0aGlzLmNsZWFudXBJbWFnZUFuYWx5c2lzKGZ1bGxDb25maWcuaW1hZ2VBbmFseXNpc1JldGVudGlvbkRheXMpO1xuICAgICAgXG4gICAgICAvLyBDbGVhbnVwIG9sZCBjb252ZXJzYXRpb24gY29udGV4dFxuICAgICAgY29uc3QgY29udmVyc2F0aW9uRGVsZXRlZCA9IGF3YWl0IHRoaXMuY2xlYW51cENvbnZlcnNhdGlvbkNvbnRleHQoZnVsbENvbmZpZy5jb252ZXJzYXRpb25Db250ZXh0UmV0ZW50aW9uRGF5cyk7XG4gICAgICBcbiAgICAgIC8vIENsZWFudXAgb2xkIHNjZW5lIGl0ZXJhdGlvbnMgIFxuICAgICAgY29uc3Qgc2NlbmVJdGVyYXRpb25zRGVsZXRlZCA9IGF3YWl0IHRoaXMuY2xlYW51cFNjZW5lSXRlcmF0aW9ucyhmdWxsQ29uZmlnLnNjZW5lSXRlcmF0aW9uc1JldGVudGlvbkRheXMpO1xuICAgICAgXG4gICAgICAvLyBDbGVhbnVwIG9sZCBwcm9qZWN0IG1lbW9yeSByZWNvcmRzXG4gICAgICBjb25zdCBwcm9qZWN0TWVtb3J5RGVsZXRlZCA9IGF3YWl0IHRoaXMuY2xlYW51cFByb2plY3RNZW1vcnkoZnVsbENvbmZpZy5wcm9qZWN0TWVtb3J5UmV0ZW50aW9uRGF5cyk7XG5cbiAgICAgIGNvbnN0IGNsZWFudXBEdXJhdGlvbiA9IERhdGUubm93KCkgLSBjbGVhbnVwU3RhcnRUaW1lO1xuXG4gICAgICBjb25zdCByZXN1bHQ6IENsZWFudXBSZXN1bHQgPSB7XG4gICAgICAgIGltYWdlQW5hbHlzaXNSZWNvcmRzRGVsZXRlZDogaW1hZ2VBbmFseXNpc0RlbGV0ZWQsXG4gICAgICAgIGNvbnZlcnNhdGlvblJlY29yZHNEZWxldGVkOiBjb252ZXJzYXRpb25EZWxldGVkLFxuICAgICAgICBzY2VuZUl0ZXJhdGlvbnNEZWxldGVkOiBzY2VuZUl0ZXJhdGlvbnNEZWxldGVkLFxuICAgICAgICBwcm9qZWN0TWVtb3J5UmVjb3Jkc0RlbGV0ZWQ6IHByb2plY3RNZW1vcnlEZWxldGVkLFxuICAgICAgICB0b3RhbFNwYWNlUmVjbGFpbWVkOiB0aGlzLmVzdGltYXRlU3BhY2VSZWNsYWltZWQoaW1hZ2VBbmFseXNpc0RlbGV0ZWQgKyBjb252ZXJzYXRpb25EZWxldGVkICsgc2NlbmVJdGVyYXRpb25zRGVsZXRlZCArIHByb2plY3RNZW1vcnlEZWxldGVkKSxcbiAgICAgICAgY2xlYW51cER1cmF0aW9uTXM6IGNsZWFudXBEdXJhdGlvblxuICAgICAgfTtcblxuICAgICAgY29uc29sZS5sb2coJ+KchSBbRGF0YUxpZmVjeWNsZV0gQ2xlYW51cCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIENsZWFudXAgZW5kZWRcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbRGF0YUxpZmVjeWNsZV0gQ2xlYW51cCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgb2xkIGltYWdlIGFuYWx5c2lzIHJlY29yZHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY2xlYW51cEltYWdlQW5hbHlzaXMocmV0ZW50aW9uRGF5czogbnVtYmVyKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKTtcbiAgICBjdXRvZmZEYXRlLnNldERhdGUoY3V0b2ZmRGF0ZS5nZXREYXRlKCkgLSByZXRlbnRpb25EYXlzKTtcblxuICAgIGlmICh0aGlzLkRFQlVHKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+WvO+4jyBbRGF0YUxpZmVjeWNsZV0gQ2xlYW5pbmcgaW1hZ2UgYW5hbHlzaXMgb2xkZXIgdGhhbiAke2N1dG9mZkRhdGUudG9JU09TdHJpbmcoKX1gKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShpbWFnZUFuYWx5c2lzKVxuICAgICAgICAud2hlcmUobHQoaW1hZ2VBbmFseXNpcy5jcmVhdGVkQXQsIGN1dG9mZkRhdGUpKTtcblxuICAgICAgY29uc3QgZGVsZXRlZENvdW50ID0gcmVzdWx0LnJvd0NvdW50IHx8IDA7XG4gICAgICBjb25zb2xlLmxvZyhg8J+WvO+4jyBbRGF0YUxpZmVjeWNsZV0gRGVsZXRlZCAke2RlbGV0ZWRDb3VudH0gb2xkIGltYWdlIGFuYWx5c2lzIHJlY29yZHNgKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGRlbGV0ZWRDb3VudDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFtEYXRhTGlmZWN5Y2xlXSBJbWFnZSBhbmFseXNpcyBjbGVhbnVwIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW51cCBvbGQgY29udmVyc2F0aW9uIGNvbnRleHQgZnJvbSBwcm9qZWN0IG1lbW9yeVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjbGVhbnVwQ29udmVyc2F0aW9uQ29udGV4dChyZXRlbnRpb25EYXlzOiBudW1iZXIpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIHJldGVudGlvbkRheXMpO1xuXG4gICAgaWYgKHRoaXMuREVCVUcpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5KsIFtEYXRhTGlmZWN5Y2xlXSBDbGVhbmluZyBjb252ZXJzYXRpb24gY29udGV4dCBvbGRlciB0aGFuICR7Y3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpfWApO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKHByb2plY3RNZW1vcnkpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShwcm9qZWN0TWVtb3J5Lm1lbW9yeVR5cGUsICdjb252ZXJzYXRpb25fY29udGV4dCcpLFxuICAgICAgICAgICAgbHQocHJvamVjdE1lbW9yeS51cGRhdGVkQXQsIGN1dG9mZkRhdGUpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBkZWxldGVkQ291bnQgPSByZXN1bHQucm93Q291bnQgfHwgMDtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5KsIFtEYXRhTGlmZWN5Y2xlXSBEZWxldGVkICR7ZGVsZXRlZENvdW50fSBvbGQgY29udmVyc2F0aW9uIGNvbnRleHQgcmVjb3Jkc2ApO1xuICAgICAgXG4gICAgICByZXR1cm4gZGVsZXRlZENvdW50O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW0RhdGFMaWZlY3ljbGVdIENvbnZlcnNhdGlvbiBjb250ZXh0IGNsZWFudXAgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIG9sZCBzY2VuZSBpdGVyYXRpb25zXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNsZWFudXBTY2VuZUl0ZXJhdGlvbnMocmV0ZW50aW9uRGF5czogbnVtYmVyKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKTtcbiAgICBjdXRvZmZEYXRlLnNldERhdGUoY3V0b2ZmRGF0ZS5nZXREYXRlKCkgLSByZXRlbnRpb25EYXlzKTtcblxuICAgIGlmICh0aGlzLkRFQlVHKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+OrCBbRGF0YUxpZmVjeWNsZV0gQ2xlYW5pbmcgc2NlbmUgaXRlcmF0aW9ucyBvbGRlciB0aGFuICR7Y3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpfWApO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKHNjZW5lSXRlcmF0aW9ucylcbiAgICAgICAgLndoZXJlKGx0KHNjZW5lSXRlcmF0aW9ucy5jcmVhdGVkQXQsIGN1dG9mZkRhdGUpKTtcblxuICAgICAgY29uc3QgZGVsZXRlZENvdW50ID0gcmVzdWx0LnJvd0NvdW50IHx8IDA7XG4gICAgICBjb25zb2xlLmxvZyhg8J+OrCBbRGF0YUxpZmVjeWNsZV0gRGVsZXRlZCAke2RlbGV0ZWRDb3VudH0gb2xkIHNjZW5lIGl0ZXJhdGlvbiByZWNvcmRzYCk7XG4gICAgICBcbiAgICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbRGF0YUxpZmVjeWNsZV0gU2NlbmUgaXRlcmF0aW9ucyBjbGVhbnVwIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW51cCBvbGQgcHJvamVjdCBtZW1vcnkgcmVjb3JkcyAoa2VlcCB1c2VyIHByZWZlcmVuY2VzLCBjbGVhbiB0ZW1wb3JhcnkgZGF0YSlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY2xlYW51cFByb2plY3RNZW1vcnkocmV0ZW50aW9uRGF5czogbnVtYmVyKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKTtcbiAgICBjdXRvZmZEYXRlLnNldERhdGUoY3V0b2ZmRGF0ZS5nZXREYXRlKCkgLSByZXRlbnRpb25EYXlzKTtcblxuICAgIGlmICh0aGlzLkRFQlVHKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+noCBbRGF0YUxpZmVjeWNsZV0gQ2xlYW5pbmcgdGVtcG9yYXJ5IHByb2plY3QgbWVtb3J5IG9sZGVyIHRoYW4gJHtjdXRvZmZEYXRlLnRvSVNPU3RyaW5nKCl9YCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIE9ubHkgZGVsZXRlIHRlbXBvcmFyeS90cmFuc2llbnQgbWVtb3J5IHR5cGVzLCBrZWVwIHVzZXIgcHJlZmVyZW5jZXNcbiAgICAgIGNvbnN0IHRlbXBvcmFyeVR5cGVzID0gWydjb252ZXJzYXRpb25fY29udGV4dCcsICd0ZW1wb3Jhcnlfbm90ZScsICdzZXNzaW9uX2RhdGEnXTtcbiAgICAgIFxuICAgICAgbGV0IHRvdGFsRGVsZXRlZCA9IDA7XG4gICAgICBmb3IgKGNvbnN0IG1lbW9yeVR5cGUgb2YgdGVtcG9yYXJ5VHlwZXMpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuZGVsZXRlKHByb2plY3RNZW1vcnkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShwcm9qZWN0TWVtb3J5Lm1lbW9yeVR5cGUsIG1lbW9yeVR5cGUgYXMgYW55KSxcbiAgICAgICAgICAgICAgbHQocHJvamVjdE1lbW9yeS51cGRhdGVkQXQsIGN1dG9mZkRhdGUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHRvdGFsRGVsZXRlZCArPSByZXN1bHQucm93Q291bnQgfHwgMDtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfp6AgW0RhdGFMaWZlY3ljbGVdIERlbGV0ZWQgJHt0b3RhbERlbGV0ZWR9IG9sZCB0ZW1wb3JhcnkgcHJvamVjdCBtZW1vcnkgcmVjb3Jkc2ApO1xuICAgICAgXG4gICAgICByZXR1cm4gdG90YWxEZWxldGVkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW0RhdGFMaWZlY3ljbGVdIFByb2plY3QgbWVtb3J5IGNsZWFudXAgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFc3RpbWF0ZSBzcGFjZSByZWNsYWltZWQgZnJvbSBjbGVhbnVwXG4gICAqL1xuICBwcml2YXRlIGVzdGltYXRlU3BhY2VSZWNsYWltZWQodG90YWxSZWNvcmRzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIC8vIFJvdWdoIGVzdGltYXRlcyBmb3IgcmVjb3JkIHNpemVzXG4gICAgY29uc3QgYXZnUmVjb3JkU2l6ZUtCID0gMjsgLy8gQ29uc2VydmF0aXZlIGVzdGltYXRlXG4gICAgY29uc3QgdG90YWxLQiA9IHRvdGFsUmVjb3JkcyAqIGF2Z1JlY29yZFNpemVLQjtcbiAgICBcbiAgICBpZiAodG90YWxLQiA8IDEwMjQpIHtcbiAgICAgIHJldHVybiBgJHt0b3RhbEtCLnRvRml4ZWQoMSl9IEtCYDtcbiAgICB9IGVsc2UgaWYgKHRvdGFsS0IgPCAxMDI0ICogMTAyNCkge1xuICAgICAgcmV0dXJuIGAkeyh0b3RhbEtCIC8gMTAyNCkudG9GaXhlZCgxKX0gTUJgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7KHRvdGFsS0IgLyAoMTAyNCAqIDEwMjQpKS50b0ZpeGVkKDEpfSBHQmA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkYXRhIGxpZmVjeWNsZSBzdGF0aXN0aWNzXG4gICAqL1xuICBhc3luYyBnZXRMaWZlY3ljbGVTdGF0cygpOiBQcm9taXNlPHtcbiAgICBpbWFnZUFuYWx5c2lzQ291bnQ6IG51bWJlcjtcbiAgICBjb252ZXJzYXRpb25Db250ZXh0Q291bnQ6IG51bWJlcjtcbiAgICBzY2VuZUl0ZXJhdGlvbnNDb3VudDogbnVtYmVyO1xuICAgIHByb2plY3RNZW1vcnlDb3VudDogbnVtYmVyO1xuICAgIG9sZGVzdFJlY29yZEFnZTogc3RyaW5nO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBjb3VudHMgZnJvbSBlYWNoIHRhYmxlXG4gICAgICBjb25zdCBbaW1hZ2VDb3VudF0gPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKGltYWdlQW5hbHlzaXMpO1xuICAgICAgY29uc3QgW2NvbnZlcnNhdGlvbkNvdW50XSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShwcm9qZWN0TWVtb3J5KVxuICAgICAgICAud2hlcmUoZXEocHJvamVjdE1lbW9yeS5tZW1vcnlUeXBlLCAnY29udmVyc2F0aW9uX2NvbnRleHQnKSk7XG4gICAgICBjb25zdCBbaXRlcmF0aW9uc0NvdW50XSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NlbmVJdGVyYXRpb25zKTtcbiAgICAgIGNvbnN0IFttZW1vcnlDb3VudF0gPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHByb2plY3RNZW1vcnkpO1xuXG4gICAgICAvLyBGaW5kIG9sZGVzdCByZWNvcmRcbiAgICAgIGNvbnN0IG9sZGVzdEltYWdlID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGltYWdlQW5hbHlzaXMpXG4gICAgICAgIC5vcmRlckJ5KGltYWdlQW5hbHlzaXMuY3JlYXRlZEF0KVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGNvbnN0IG9sZGVzdEFnZSA9IG9sZGVzdEltYWdlLmxlbmd0aCA+IDAgXG4gICAgICAgID8gdGhpcy5mb3JtYXRBZ2Uob2xkZXN0SW1hZ2VbMF0hLmNyZWF0ZWRBdClcbiAgICAgICAgOiAnTm8gcmVjb3Jkcyc7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGltYWdlQW5hbHlzaXNDb3VudDogaW1hZ2VDb3VudCA/IDEgOiAwLCAvLyBUaGlzIGlzIGEgcm91Z2ggY291bnQsIGFjdHVhbCBpbXBsZW1lbnRhdGlvbiB3b3VsZCBiZSBtb3JlIHByZWNpc2VcbiAgICAgICAgY29udmVyc2F0aW9uQ29udGV4dENvdW50OiBjb252ZXJzYXRpb25Db3VudCA/IDEgOiAwLFxuICAgICAgICBzY2VuZUl0ZXJhdGlvbnNDb3VudDogaXRlcmF0aW9uc0NvdW50ID8gMSA6IDAsXG4gICAgICAgIHByb2plY3RNZW1vcnlDb3VudDogbWVtb3J5Q291bnQgPyAxIDogMCxcbiAgICAgICAgb2xkZXN0UmVjb3JkQWdlOiBvbGRlc3RBZ2VcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbRGF0YUxpZmVjeWNsZV0gRmFpbGVkIHRvIGdldCBzdGF0czonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0IGFnZSBvZiByZWNvcmQgZm9yIGRpc3BsYXlcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0QWdlKGRhdGU6IERhdGUpOiBzdHJpbmcge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGlmZk1zID0gbm93LmdldFRpbWUoKSAtIGRhdGUuZ2V0VGltZSgpO1xuICAgIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5mbG9vcihkaWZmTXMgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xuICAgIFxuICAgIGlmIChkaWZmRGF5cyA8IDEpIHtcbiAgICAgIHJldHVybiAnTGVzcyB0aGFuIDEgZGF5JztcbiAgICB9IGVsc2UgaWYgKGRpZmZEYXlzIDwgMzApIHtcbiAgICAgIHJldHVybiBgJHtkaWZmRGF5c30gZGF5c2A7XG4gICAgfSBlbHNlIGlmIChkaWZmRGF5cyA8IDM2NSkge1xuICAgICAgY29uc3QgbW9udGhzID0gTWF0aC5mbG9vcihkaWZmRGF5cyAvIDMwKTtcbiAgICAgIHJldHVybiBgJHttb250aHN9IG1vbnRoJHttb250aHMgPT09IDEgPyAnJyA6ICdzJ31gO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB5ZWFycyA9IE1hdGguZmxvb3IoZGlmZkRheXMgLyAzNjUpO1xuICAgICAgcmV0dXJuIGAke3llYXJzfSB5ZWFyJHt5ZWFycyA9PT0gMSA/ICcnIDogJ3MnfWA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvZyBjbGVhbnVwIHJlc3VsdHNcbiAgICovXG4gIHByaXZhdGUgbG9nQ2xlYW51cFJlc3VsdChyZXN1bHQ6IENsZWFudXBSZXN1bHQpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhgXFxu8J+Xgu+4jyBbRGF0YUxpZmVjeWNsZV0gQ2xlYW51cCBSZXN1bHRzOmApO1xuICAgIGNvbnNvbGUubG9nKGAgIPCfk4ogUmVjb3JkcyBkZWxldGVkOmApO1xuICAgIGNvbnNvbGUubG9nKGAgICAg8J+WvO+4jyAgSW1hZ2UgYW5hbHlzaXM6ICR7cmVzdWx0LmltYWdlQW5hbHlzaXNSZWNvcmRzRGVsZXRlZH1gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgIPCfkqwgQ29udmVyc2F0aW9uIGNvbnRleHQ6ICR7cmVzdWx0LmNvbnZlcnNhdGlvblJlY29yZHNEZWxldGVkfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICAg8J+OrCBTY2VuZSBpdGVyYXRpb25zOiAke3Jlc3VsdC5zY2VuZUl0ZXJhdGlvbnNEZWxldGVkfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICAg8J+noCBQcm9qZWN0IG1lbW9yeTogJHtyZXN1bHQucHJvamVjdE1lbW9yeVJlY29yZHNEZWxldGVkfWApO1xuICAgIGNvbnNvbGUubG9nKGAgIPCfkr4gU3BhY2UgcmVjbGFpbWVkOiAke3Jlc3VsdC50b3RhbFNwYWNlUmVjbGFpbWVkfWApO1xuICAgIGNvbnNvbGUubG9nKGAgIOKPse+4jyAgRHVyYXRpb246ICR7cmVzdWx0LmNsZWFudXBEdXJhdGlvbk1zLnRvRml4ZWQoMil9bXNgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JjZSBpbW1lZGlhdGUgY2xlYW51cCAoZm9yIHRlc3RpbmcvYWRtaW4pXG4gICAqL1xuICBhc3luYyBmb3JjZUNsZWFudXAoY29uZmlnOiBQYXJ0aWFsPERhdGFMaWZlY3ljbGVDb25maWc+ID0ge30pOiBQcm9taXNlPENsZWFudXBSZXN1bHQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+Xgu+4jyBbRGF0YUxpZmVjeWNsZV0gRm9yY2UgY2xlYW51cCByZXF1ZXN0ZWQnKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wZXJmb3JtQ2xlYW51cChjb25maWcpO1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBkYXRhTGlmZWN5Y2xlU2VydmljZSA9IG5ldyBEYXRhTGlmZWN5Y2xlU2VydmljZSgpOyAiXSwibmFtZXMiOlsiZGIiLCJpbWFnZUFuYWx5c2lzIiwicHJvamVjdE1lbW9yeSIsInNjZW5lSXRlcmF0aW9ucyIsImx0IiwiYW5kIiwiZXEiLCJEYXRhTGlmZWN5Y2xlU2VydmljZSIsInN0YXJ0QXV0b21hdGVkQ2xlYW51cCIsImNvbmZpZyIsImZ1bGxDb25maWciLCJkZWZhdWx0Q29uZmlnIiwiZW5hYmxlQXV0b0NsZWFudXAiLCJjb25zb2xlIiwibG9nIiwiY2xlYW51cEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImludGVydmFsTXMiLCJjbGVhbnVwSW50ZXJ2YWxIb3VycyIsInNldEludGVydmFsIiwicmVzdWx0IiwicGVyZm9ybUNsZWFudXAiLCJsb2dDbGVhbnVwUmVzdWx0IiwiZXJyb3IiLCJzdG9wQXV0b21hdGVkQ2xlYW51cCIsInN0YXJ0VGltZSIsInBlcmZvcm1hbmNlIiwibm93IiwiY2xlYW51cFN0YXJ0VGltZSIsIkRhdGUiLCJpbWFnZUFuYWx5c2lzUmV0ZW50aW9uRGF5cyIsImNvbnZlcnNhdGlvbkNvbnRleHRSZXRlbnRpb25EYXlzIiwic2NlbmVJdGVyYXRpb25zUmV0ZW50aW9uRGF5cyIsInByb2plY3RNZW1vcnlSZXRlbnRpb25EYXlzIiwiaW1hZ2VBbmFseXNpc0RlbGV0ZWQiLCJjbGVhbnVwSW1hZ2VBbmFseXNpcyIsImNvbnZlcnNhdGlvbkRlbGV0ZWQiLCJjbGVhbnVwQ29udmVyc2F0aW9uQ29udGV4dCIsInNjZW5lSXRlcmF0aW9uc0RlbGV0ZWQiLCJjbGVhbnVwU2NlbmVJdGVyYXRpb25zIiwicHJvamVjdE1lbW9yeURlbGV0ZWQiLCJjbGVhbnVwUHJvamVjdE1lbW9yeSIsImNsZWFudXBEdXJhdGlvbiIsImltYWdlQW5hbHlzaXNSZWNvcmRzRGVsZXRlZCIsImNvbnZlcnNhdGlvblJlY29yZHNEZWxldGVkIiwicHJvamVjdE1lbW9yeVJlY29yZHNEZWxldGVkIiwidG90YWxTcGFjZVJlY2xhaW1lZCIsImVzdGltYXRlU3BhY2VSZWNsYWltZWQiLCJjbGVhbnVwRHVyYXRpb25NcyIsInJldGVudGlvbkRheXMiLCJjdXRvZmZEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJERUJVRyIsInRvSVNPU3RyaW5nIiwiZGVsZXRlIiwid2hlcmUiLCJjcmVhdGVkQXQiLCJkZWxldGVkQ291bnQiLCJyb3dDb3VudCIsIm1lbW9yeVR5cGUiLCJ1cGRhdGVkQXQiLCJ0ZW1wb3JhcnlUeXBlcyIsInRvdGFsRGVsZXRlZCIsInRvdGFsUmVjb3JkcyIsImF2Z1JlY29yZFNpemVLQiIsInRvdGFsS0IiLCJ0b0ZpeGVkIiwiZ2V0TGlmZWN5Y2xlU3RhdHMiLCJpbWFnZUNvdW50Iiwic2VsZWN0IiwiZnJvbSIsImNvbnZlcnNhdGlvbkNvdW50IiwiaXRlcmF0aW9uc0NvdW50IiwibWVtb3J5Q291bnQiLCJvbGRlc3RJbWFnZSIsIm9yZGVyQnkiLCJsaW1pdCIsIm9sZGVzdEFnZSIsImxlbmd0aCIsImZvcm1hdEFnZSIsImltYWdlQW5hbHlzaXNDb3VudCIsImNvbnZlcnNhdGlvbkNvbnRleHRDb3VudCIsInNjZW5lSXRlcmF0aW9uc0NvdW50IiwicHJvamVjdE1lbW9yeUNvdW50Iiwib2xkZXN0UmVjb3JkQWdlIiwiZGF0ZSIsImRpZmZNcyIsImdldFRpbWUiLCJkaWZmRGF5cyIsIk1hdGgiLCJmbG9vciIsIm1vbnRocyIsInllYXJzIiwiZm9yY2VDbGVhbnVwIiwicHJvY2VzcyIsImRhdGFMaWZlY3ljbGVTZXJ2aWNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/data/dataLifecycle.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/data/message.service.ts":
/*!*****************************************************!*\
  !*** ./src/server/services/data/message.service.ts ***!
  \*****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MessageService: () => (/* binding */ MessageService),\n/* harmony export */   messageService: () => (/* binding */ messageService)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! drizzle-orm */ \"drizzle-orm\");\n/* harmony import */ var _bazaar_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @bazaar/database */ \"(rsc)/../../packages/database/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([drizzle_orm__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__]);\n([drizzle_orm__WEBPACK_IMPORTED_MODULE_0__, _bazaar_database__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// src/server/services/data/message.service.ts\n\n\n\nclass MessageService {\n    /**\n   * Get the next sequence number for a project's messages\n   * This ensures proper message ordering even with concurrent requests\n   */ async getNextSequenceNumber(projectId) {\n        // Use a single query to get the max sequence number\n        const result = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.select({\n            maxSequence: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.sql)`COALESCE(MAX(${_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.sequence}), 0)`\n        }).from(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_0__.eq)(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages.projectId, projectId));\n        const maxSequence = result[0]?.maxSequence ?? 0;\n        return maxSequence + 1;\n    }\n    /**\n   * Create a message with proper sequence number\n   */ async createMessage(data) {\n        const sequence = await this.getNextSequenceNumber(data.projectId);\n        const messageData = {\n            id: data.id,\n            projectId: data.projectId,\n            content: data.content,\n            role: data.role,\n            sequence,\n            createdAt: new Date(),\n            imageUrls: data.imageUrls,\n            status: data.status,\n            kind: data.kind\n        };\n        const [newMessage] = await _bazaar_database__WEBPACK_IMPORTED_MODULE_1__.db.insert(_bazaar_database__WEBPACK_IMPORTED_MODULE_1__.messages).values(messageData).returning();\n        return newMessage;\n    }\n}\n// Export singleton instance\nconst messageService = new MessageService();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2RhdGEvbWVzc2FnZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSw4Q0FBOEM7QUFDRjtBQUNOO0FBQ007QUFFckMsTUFBTUk7SUFDWDs7O0dBR0MsR0FDRCxNQUFNQyxzQkFBc0JDLFNBQWlCLEVBQW1CO1FBQzlELG9EQUFvRDtRQUNwRCxNQUFNQyxTQUFTLE1BQU1MLGdEQUFFQSxDQUNwQk0sTUFBTSxDQUFDO1lBQUVDLGFBQWFSLGdEQUFXLENBQUMsYUFBYSxFQUFFRSxzREFBUUEsQ0FBQ08sUUFBUSxDQUFDLEtBQUssQ0FBQztRQUFDLEdBQzFFQyxJQUFJLENBQUNSLHNEQUFRQSxFQUNiUyxLQUFLLENBQUNaLCtDQUFFQSxDQUFDRyxzREFBUUEsQ0FBQ0csU0FBUyxFQUFFQTtRQUVoQyxNQUFNRyxjQUFjRixNQUFNLENBQUMsRUFBRSxFQUFFRSxlQUFlO1FBQzlDLE9BQU9BLGNBQWM7SUFDdkI7SUFFQTs7R0FFQyxHQUNELE1BQU1JLGNBQWNDLElBUW5CLEVBQUU7UUFDRCxNQUFNSixXQUFXLE1BQU0sSUFBSSxDQUFDTCxxQkFBcUIsQ0FBQ1MsS0FBS1IsU0FBUztRQUVoRSxNQUFNUyxjQUFjO1lBQ2xCQyxJQUFJRixLQUFLRSxFQUFFO1lBQ1hWLFdBQVdRLEtBQUtSLFNBQVM7WUFDekJXLFNBQVNILEtBQUtHLE9BQU87WUFDckJDLE1BQU1KLEtBQUtJLElBQUk7WUFDZlI7WUFDQVMsV0FBVyxJQUFJQztZQUNmQyxXQUFXUCxLQUFLTyxTQUFTO1lBQ3pCQyxRQUFRUixLQUFLUSxNQUFNO1lBQ25CQyxNQUFNVCxLQUFLUyxJQUFJO1FBQ2pCO1FBRUEsTUFBTSxDQUFDQyxXQUFXLEdBQUcsTUFBTXRCLGdEQUFFQSxDQUFDdUIsTUFBTSxDQUFDdEIsc0RBQVFBLEVBQUV1QixNQUFNLENBQUNYLGFBQWFZLFNBQVM7UUFFNUUsT0FBT0g7SUFDVDtBQUNGO0FBRUEsNEJBQTRCO0FBQ3JCLE1BQU1JLGlCQUFpQixJQUFJeEIsaUJBQWlCIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvc2VydmVyL3NlcnZpY2VzL2RhdGEvbWVzc2FnZS5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2ZXIvc2VydmljZXMvZGF0YS9tZXNzYWdlLnNlcnZpY2UudHNcbmltcG9ydCB7IGVxLCBkZXNjLCBzcWwgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IGRiIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IG1lc3NhZ2VzIH0gZnJvbSBcIkBiYXphYXIvZGF0YWJhc2VcIjtcblxuZXhwb3J0IGNsYXNzIE1lc3NhZ2VTZXJ2aWNlIHtcbiAgLyoqXG4gICAqIEdldCB0aGUgbmV4dCBzZXF1ZW5jZSBudW1iZXIgZm9yIGEgcHJvamVjdCdzIG1lc3NhZ2VzXG4gICAqIFRoaXMgZW5zdXJlcyBwcm9wZXIgbWVzc2FnZSBvcmRlcmluZyBldmVuIHdpdGggY29uY3VycmVudCByZXF1ZXN0c1xuICAgKi9cbiAgYXN5bmMgZ2V0TmV4dFNlcXVlbmNlTnVtYmVyKHByb2plY3RJZDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBVc2UgYSBzaW5nbGUgcXVlcnkgdG8gZ2V0IHRoZSBtYXggc2VxdWVuY2UgbnVtYmVyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBtYXhTZXF1ZW5jZTogc3FsPG51bWJlcj5gQ09BTEVTQ0UoTUFYKCR7bWVzc2FnZXMuc2VxdWVuY2V9KSwgMClgIH0pXG4gICAgICAuZnJvbShtZXNzYWdlcylcbiAgICAgIC53aGVyZShlcShtZXNzYWdlcy5wcm9qZWN0SWQsIHByb2plY3RJZCkpO1xuICAgIFxuICAgIGNvbnN0IG1heFNlcXVlbmNlID0gcmVzdWx0WzBdPy5tYXhTZXF1ZW5jZSA/PyAwO1xuICAgIHJldHVybiBtYXhTZXF1ZW5jZSArIDE7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbWVzc2FnZSB3aXRoIHByb3BlciBzZXF1ZW5jZSBudW1iZXJcbiAgICovXG4gIGFzeW5jIGNyZWF0ZU1lc3NhZ2UoZGF0YToge1xuICAgIHByb2plY3RJZDogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JztcbiAgICBpbWFnZVVybHM/OiBzdHJpbmdbXTtcbiAgICBzdGF0dXM/OiBzdHJpbmc7XG4gICAga2luZD86IHN0cmluZztcbiAgICBpZD86IHN0cmluZztcbiAgfSkge1xuICAgIGNvbnN0IHNlcXVlbmNlID0gYXdhaXQgdGhpcy5nZXROZXh0U2VxdWVuY2VOdW1iZXIoZGF0YS5wcm9qZWN0SWQpO1xuICAgIFxuICAgIGNvbnN0IG1lc3NhZ2VEYXRhID0ge1xuICAgICAgaWQ6IGRhdGEuaWQsXG4gICAgICBwcm9qZWN0SWQ6IGRhdGEucHJvamVjdElkLFxuICAgICAgY29udGVudDogZGF0YS5jb250ZW50LFxuICAgICAgcm9sZTogZGF0YS5yb2xlLFxuICAgICAgc2VxdWVuY2UsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICBpbWFnZVVybHM6IGRhdGEuaW1hZ2VVcmxzLFxuICAgICAgc3RhdHVzOiBkYXRhLnN0YXR1cyxcbiAgICAgIGtpbmQ6IGRhdGEua2luZCxcbiAgICB9O1xuXG4gICAgY29uc3QgW25ld01lc3NhZ2VdID0gYXdhaXQgZGIuaW5zZXJ0KG1lc3NhZ2VzKS52YWx1ZXMobWVzc2FnZURhdGEpLnJldHVybmluZygpO1xuICAgIFxuICAgIHJldHVybiBuZXdNZXNzYWdlO1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBtZXNzYWdlU2VydmljZSA9IG5ldyBNZXNzYWdlU2VydmljZSgpOyJdLCJuYW1lcyI6WyJlcSIsInNxbCIsImRiIiwibWVzc2FnZXMiLCJNZXNzYWdlU2VydmljZSIsImdldE5leHRTZXF1ZW5jZU51bWJlciIsInByb2plY3RJZCIsInJlc3VsdCIsInNlbGVjdCIsIm1heFNlcXVlbmNlIiwic2VxdWVuY2UiLCJmcm9tIiwid2hlcmUiLCJjcmVhdGVNZXNzYWdlIiwiZGF0YSIsIm1lc3NhZ2VEYXRhIiwiaWQiLCJjb250ZW50Iiwicm9sZSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJpbWFnZVVybHMiLCJzdGF0dXMiLCJraW5kIiwibmV3TWVzc2FnZSIsImluc2VydCIsInZhbHVlcyIsInJldHVybmluZyIsIm1lc3NhZ2VTZXJ2aWNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/data/message.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/add/add.ts":
/*!******************************!*\
  !*** ./src/tools/add/add.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AddTool: () => (/* binding */ AddTool),\n/* harmony export */   addTool: () => (/* binding */ addTool)\n/* harmony export */ });\n/* harmony import */ var _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/tools/helpers/base */ \"(rsc)/./src/tools/helpers/base.ts\");\n/* harmony import */ var _add_helpers_CodeGeneratorNEW__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add_helpers/CodeGeneratorNEW */ \"(rsc)/./src/tools/add/add_helpers/CodeGeneratorNEW.ts\");\n/* harmony import */ var _tools_helpers_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/tools/helpers/types */ \"(rsc)/./src/tools/helpers/types.ts\");\n\n\n\n/**\n * ADD Tool - Pure function that generates scene content\n * NO DATABASE ACCESS - only generation\n * Sprint 42: Refactored to pure function\n */ class AddTool extends _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__.BaseMCPTool {\n    async execute(input) {\n        console.log('\\n [ADD TOOL - PURE FUNCTION] === EXECUTING ===');\n        console.log(' [ADD TOOL] Input:', {\n            prompt: input.userPrompt.substring(0, 50) + '...',\n            hasImages: !!input.imageUrls?.length,\n            hasWebContext: !!input.webContext,\n            sceneNumber: input.sceneNumber,\n            hasPreviousScene: !!input.previousSceneContext\n        });\n        console.log(' [ADD TOOL] NOTE: This is a PURE FUNCTION - no database access!');\n        try {\n            // Handle web context + image-based scene creation\n            if (input.webContext && (input.imageUrls?.length || 0) > 0) {\n                console.log(' [ADD TOOL] Using web context + images generation');\n                return await this.generateFromWebAndImages(input);\n            }\n            // Handle web context only\n            if (input.webContext) {\n                console.log(' [ADD TOOL] Using web context generation for', input.webContext.originalUrl);\n                return await this.generateFromWebContext(input);\n            }\n            // Handle image-based scene creation\n            if (input.imageUrls && input.imageUrls.length > 0) {\n                console.log(' [ADD TOOL] Using image-based generation for', input.imageUrls.length, 'images');\n                return await this.generateFromImages(input);\n            }\n            // Handle text-based scene creation\n            console.log(' [ADD TOOL] Using text-based generation');\n            return await this.generateFromText(input);\n        } catch (error) {\n            return {\n                success: false,\n                reasoning: `Failed to generate scene: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                error: error instanceof Error ? error.message : 'Unknown error'\n            };\n        }\n    }\n    /**\n   * Generate scene from text prompt\n   * PURE FUNCTION - no side effects\n   */ async generateFromText(input) {\n        // Generate function name (deterministic based on input)\n        const functionName = this.generateFunctionName(input.projectId, input.sceneNumber);\n        // If we have a previous scene with code, use it as reference\n        if (input.previousSceneContext?.tsxCode) {\n            console.log(' [ADD TOOL] Previous scene detected - using code reference');\n            // Generate code directly using previous scene as reference\n            const codeResult = await _add_helpers_CodeGeneratorNEW__WEBPACK_IMPORTED_MODULE_1__.codeGenerator.generateCodeWithReference({\n                userPrompt: input.userPrompt,\n                functionName: functionName,\n                projectId: input.projectId,\n                previousSceneCode: input.previousSceneContext.tsxCode\n            });\n            const result = {\n                success: true,\n                tsxCode: codeResult.code,\n                name: codeResult.name,\n                duration: codeResult.duration,\n                reasoning: `Generated new scene based on previous scene: ${codeResult.reasoning}`,\n                chatResponse: `I've created a new scene based on the previous scene style`,\n                scene: {\n                    tsxCode: codeResult.code,\n                    name: codeResult.name,\n                    duration: codeResult.duration\n                },\n                debug: {\n                    usedPreviousScene: true,\n                    codeGeneration: codeResult.debug\n                }\n            };\n            console.log(' [ADD TOOL] Finished with reference - returning result:', {\n                name: result.name,\n                duration: result.duration,\n                codeLength: result.tsxCode.length,\n                firstLine: result.tsxCode.split('\\n')[0]\n            });\n            return result;\n        }\n        // DIRECT CODE GENERATION - Skip layout entirely!\n        console.log(' [ADD TOOL] Using DIRECT code generation - no layout step!');\n        const codeResult = await _add_helpers_CodeGeneratorNEW__WEBPACK_IMPORTED_MODULE_1__.codeGenerator.generateCodeDirect({\n            userPrompt: input.userPrompt,\n            functionName: functionName,\n            projectId: input.projectId\n        });\n        // Return generated content - NO DATABASE!\n        const result = {\n            success: true,\n            tsxCode: codeResult.code,\n            name: codeResult.name,\n            duration: codeResult.duration,\n            reasoning: `Generated ${codeResult.name}: ${codeResult.reasoning}`,\n            chatResponse: `I've created ${codeResult.name}`,\n            scene: {\n                tsxCode: codeResult.code,\n                name: codeResult.name,\n                duration: codeResult.duration\n            },\n            debug: {\n                method: 'direct',\n                codeGeneration: codeResult.debug\n            }\n        };\n        console.log(' [ADD TOOL] Finished direct generation - returning result:', {\n            name: result.name,\n            duration: result.duration,\n            codeLength: result.tsxCode.length,\n            firstLine: result.tsxCode.split('\\n')[0]\n        });\n        return result;\n    }\n    /**\n   * Generate scene from images\n   * PURE FUNCTION - no side effects\n   */ async generateFromImages(input) {\n        if (!input.imageUrls || input.imageUrls.length === 0) {\n            throw new Error(\"No images provided\");\n        }\n        const functionName = this.generateFunctionName(input.projectId, input.sceneNumber);\n        // Generate code directly from images\n        const codeResult = await _add_helpers_CodeGeneratorNEW__WEBPACK_IMPORTED_MODULE_1__.codeGenerator.generateCodeFromImage({\n            imageUrls: input.imageUrls,\n            userPrompt: input.userPrompt,\n            functionName: functionName,\n            visionAnalysis: input.visionAnalysis\n        });\n        // Return generated content - NO DATABASE!\n        const result = {\n            success: true,\n            tsxCode: codeResult.code,\n            name: codeResult.name,\n            duration: codeResult.duration,\n            reasoning: `Generated from ${input.imageUrls.length} image(s): ${codeResult.reasoning}`,\n            chatResponse: `I've created ${codeResult.name} based on your image(s)`,\n            scene: {\n                tsxCode: codeResult.code,\n                name: codeResult.name,\n                duration: codeResult.duration\n            },\n            debug: {\n                imageGeneration: codeResult.debug\n            }\n        };\n        console.log(' [ADD TOOL] Finished image generation - returning result:', {\n            name: result.name,\n            duration: result.duration,\n            codeLength: result.tsxCode.length,\n            imageCount: input.imageUrls.length\n        });\n        return result;\n    }\n    /**\n   * Generate scene from web context screenshots\n   * PURE FUNCTION - no side effects\n   */ async generateFromWebContext(input) {\n        if (!input.webContext) {\n            throw new Error(\"No web context provided\");\n        }\n        const functionName = this.generateFunctionName(input.projectId, input.sceneNumber);\n        // Create combined image list with web screenshots\n        const allImageUrls = [\n            input.webContext.screenshotUrls.desktop,\n            input.webContext.screenshotUrls.mobile\n        ];\n        // Enhanced prompt for web context\n        const enhancedPrompt = `${input.userPrompt}\n\nWEBSITE CONTEXT:\n- URL: ${input.webContext.originalUrl}\n- Title: ${input.webContext.pageData.title}\n- Description: ${input.webContext.pageData.description || 'Not available'}\n- Key headings: ${input.webContext.pageData.headings.slice(0, 5).join(', ')}\n\nBRAND MATCHING INSTRUCTIONS:\n- Use the website screenshots to match the brand's visual identity\n- Extract colors, fonts, and design patterns from the screenshots\n- Maintain brand consistency in the motion graphics\n- The desktop screenshot shows the full layout, mobile shows the mobile design`;\n        // Generate code using website screenshots\n        const codeResult = await _add_helpers_CodeGeneratorNEW__WEBPACK_IMPORTED_MODULE_1__.codeGenerator.generateCodeFromImage({\n            imageUrls: allImageUrls,\n            userPrompt: enhancedPrompt,\n            functionName: functionName,\n            visionAnalysis: {\n                webContext: input.webContext,\n                analysisType: 'website_brand_matching'\n            }\n        });\n        const result = {\n            success: true,\n            tsxCode: codeResult.code,\n            name: codeResult.name,\n            duration: codeResult.duration,\n            reasoning: `Generated scene based on website ${input.webContext.pageData.title}: ${codeResult.reasoning}`,\n            chatResponse: `I've created a scene inspired by the ${input.webContext.pageData.title} website, matching their brand identity`,\n            scene: {\n                tsxCode: codeResult.code,\n                name: codeResult.name,\n                duration: codeResult.duration\n            },\n            debug: {\n                webContextGeneration: codeResult.debug,\n                websiteUrl: input.webContext.originalUrl,\n                pageTitle: input.webContext.pageData.title\n            }\n        };\n        console.log(' [ADD TOOL] Finished web context generation - returning result:', {\n            name: result.name,\n            duration: result.duration,\n            codeLength: result.tsxCode.length,\n            websiteUrl: input.webContext.originalUrl\n        });\n        return result;\n    }\n    /**\n   * Generate scene from web context + additional images\n   * PURE FUNCTION - no side effects\n   */ async generateFromWebAndImages(input) {\n        if (!input.webContext || !input.imageUrls?.length) {\n            throw new Error(\"No web context or images provided\");\n        }\n        const functionName = this.generateFunctionName(input.projectId, input.sceneNumber);\n        // Combine website screenshots with user images\n        const allImageUrls = [\n            input.webContext.screenshotUrls.desktop,\n            input.webContext.screenshotUrls.mobile,\n            ...input.imageUrls\n        ];\n        // Enhanced prompt combining web context with user images\n        const enhancedPrompt = `${input.userPrompt}\n\nWEBSITE BRAND CONTEXT:\n- URL: ${input.webContext.originalUrl}\n- Title: ${input.webContext.pageData.title}\n- Description: ${input.webContext.pageData.description || 'Not available'}\n\nCOMBINED CONTEXT INSTRUCTIONS:\n- Use the website screenshots (first 2 images) to understand the brand identity\n- Use the additional user images for specific content requirements\n- Blend the brand's visual style with the user's image content\n- Maintain brand consistency while incorporating user image elements`;\n        // Generate code using combined context\n        const codeResult = await _add_helpers_CodeGeneratorNEW__WEBPACK_IMPORTED_MODULE_1__.codeGenerator.generateCodeFromImage({\n            imageUrls: allImageUrls,\n            userPrompt: enhancedPrompt,\n            functionName: functionName,\n            visionAnalysis: {\n                webContext: input.webContext,\n                userImageCount: input.imageUrls.length,\n                analysisType: 'website_plus_images'\n            }\n        });\n        const result = {\n            success: true,\n            tsxCode: codeResult.code,\n            name: codeResult.name,\n            duration: codeResult.duration,\n            reasoning: `Generated scene combining ${input.webContext.pageData.title} brand with ${input.imageUrls.length} user image(s): ${codeResult.reasoning}`,\n            chatResponse: `I've created a scene that combines the ${input.webContext.pageData.title} brand style with your images`,\n            scene: {\n                tsxCode: codeResult.code,\n                name: codeResult.name,\n                duration: codeResult.duration\n            },\n            debug: {\n                webAndImageGeneration: codeResult.debug,\n                websiteUrl: input.webContext.originalUrl,\n                userImageCount: input.imageUrls.length\n            }\n        };\n        console.log(' [ADD TOOL] Finished web+images generation - returning result:', {\n            name: result.name,\n            duration: result.duration,\n            codeLength: result.tsxCode.length,\n            websiteUrl: input.webContext.originalUrl,\n            userImageCount: input.imageUrls.length\n        });\n        return result;\n    }\n    /**\n   * Generate unique component name using a stable ID\n   * This prevents naming collisions when scenes are deleted/reordered\n   */ generateFunctionName(projectId, sceneNumber) {\n        // Generate a unique 8-character ID for this scene\n        // This ensures component names never collide, even after deletions\n        const uniqueId = this.generateUniqueId();\n        return `Scene_${uniqueId}`;\n    }\n    /**\n   * Generate a unique 8-character ID\n   */ generateUniqueId() {\n        // Use timestamp + random for uniqueness\n        const timestamp = Date.now().toString(36);\n        const random = Math.random().toString(36).substring(2, 6);\n        return (timestamp + random).substring(0, 8);\n    }\n    constructor(...args){\n        super(...args), this.name = \"ADD\", this.description = \"Generate new motion graphics scene content\", this.inputSchema = _tools_helpers_types__WEBPACK_IMPORTED_MODULE_2__.addToolInputSchema;\n    }\n}\n// Export singleton instance\nconst addTool = new AddTool();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy90b29scy9hZGQvYWRkLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VNQ1BUb29sIH0gZnJvbSBcIn4vdG9vbHMvaGVscGVycy9iYXNlXCI7XG5pbXBvcnQgeyBjb2RlR2VuZXJhdG9yIH0gZnJvbSBcIi4vYWRkX2hlbHBlcnMvQ29kZUdlbmVyYXRvck5FV1wiO1xuaW1wb3J0IHR5cGUgeyBBZGRUb29sSW5wdXQsIEFkZFRvb2xPdXRwdXQgfSBmcm9tIFwifi90b29scy9oZWxwZXJzL3R5cGVzXCI7XG5pbXBvcnQgeyBhZGRUb29sSW5wdXRTY2hlbWEgfSBmcm9tIFwifi90b29scy9oZWxwZXJzL3R5cGVzXCI7XG5cbi8qKlxuICogQUREIFRvb2wgLSBQdXJlIGZ1bmN0aW9uIHRoYXQgZ2VuZXJhdGVzIHNjZW5lIGNvbnRlbnRcbiAqIE5PIERBVEFCQVNFIEFDQ0VTUyAtIG9ubHkgZ2VuZXJhdGlvblxuICogU3ByaW50IDQyOiBSZWZhY3RvcmVkIHRvIHB1cmUgZnVuY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIEFkZFRvb2wgZXh0ZW5kcyBCYXNlTUNQVG9vbDxBZGRUb29sSW5wdXQsIEFkZFRvb2xPdXRwdXQ+IHtcbiAgbmFtZSA9IFwiQUREXCI7XG4gIGRlc2NyaXB0aW9uID0gXCJHZW5lcmF0ZSBuZXcgbW90aW9uIGdyYXBoaWNzIHNjZW5lIGNvbnRlbnRcIjtcbiAgaW5wdXRTY2hlbWEgPSBhZGRUb29sSW5wdXRTY2hlbWE7XG5cbiAgcHJvdGVjdGVkIGFzeW5jIGV4ZWN1dGUoaW5wdXQ6IEFkZFRvb2xJbnB1dCk6IFByb21pc2U8QWRkVG9vbE91dHB1dD4ge1xuICAgIGNvbnNvbGUubG9nKCdcXG7wn5SoIFtBREQgVE9PTCAtIFBVUkUgRlVOQ1RJT05dID09PSBFWEVDVVRJTkcgPT09Jyk7XG4gICAgY29uc29sZS5sb2coJ/CflKggW0FERCBUT09MXSBJbnB1dDonLCB7XG4gICAgICBwcm9tcHQ6IGlucHV0LnVzZXJQcm9tcHQuc3Vic3RyaW5nKDAsIDUwKSArICcuLi4nLFxuICAgICAgaGFzSW1hZ2VzOiAhIWlucHV0LmltYWdlVXJscz8ubGVuZ3RoLFxuICAgICAgaGFzV2ViQ29udGV4dDogISFpbnB1dC53ZWJDb250ZXh0LFxuICAgICAgc2NlbmVOdW1iZXI6IGlucHV0LnNjZW5lTnVtYmVyLFxuICAgICAgaGFzUHJldmlvdXNTY2VuZTogISFpbnB1dC5wcmV2aW91c1NjZW5lQ29udGV4dFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKCfwn5SoIFtBREQgVE9PTF0gTk9URTogVGhpcyBpcyBhIFBVUkUgRlVOQ1RJT04gLSBubyBkYXRhYmFzZSBhY2Nlc3MhJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEhhbmRsZSB3ZWIgY29udGV4dCArIGltYWdlLWJhc2VkIHNjZW5lIGNyZWF0aW9uXG4gICAgICBpZiAoaW5wdXQud2ViQ29udGV4dCAmJiAoaW5wdXQuaW1hZ2VVcmxzPy5sZW5ndGggfHwgMCkgPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SoIFtBREQgVE9PTF0gVXNpbmcgd2ViIGNvbnRleHQgKyBpbWFnZXMgZ2VuZXJhdGlvbicpO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW5lcmF0ZUZyb21XZWJBbmRJbWFnZXMoaW5wdXQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBIYW5kbGUgd2ViIGNvbnRleHQgb25seVxuICAgICAgaWYgKGlucHV0LndlYkNvbnRleHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflKggW0FERCBUT09MXSBVc2luZyB3ZWIgY29udGV4dCBnZW5lcmF0aW9uIGZvcicsIGlucHV0LndlYkNvbnRleHQub3JpZ2luYWxVcmwpO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW5lcmF0ZUZyb21XZWJDb250ZXh0KGlucHV0KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGltYWdlLWJhc2VkIHNjZW5lIGNyZWF0aW9uXG4gICAgICBpZiAoaW5wdXQuaW1hZ2VVcmxzICYmIGlucHV0LmltYWdlVXJscy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SoIFtBREQgVE9PTF0gVXNpbmcgaW1hZ2UtYmFzZWQgZ2VuZXJhdGlvbiBmb3InLCBpbnB1dC5pbWFnZVVybHMubGVuZ3RoLCAnaW1hZ2VzJyk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbmVyYXRlRnJvbUltYWdlcyhpbnB1dCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEhhbmRsZSB0ZXh0LWJhc2VkIHNjZW5lIGNyZWF0aW9uXG4gICAgICBjb25zb2xlLmxvZygn8J+UqCBbQUREIFRPT0xdIFVzaW5nIHRleHQtYmFzZWQgZ2VuZXJhdGlvbicpO1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2VuZXJhdGVGcm9tVGV4dChpbnB1dCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICByZWFzb25pbmc6IGBGYWlsZWQgdG8gZ2VuZXJhdGUgc2NlbmU6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSBhcyBBZGRUb29sT3V0cHV0O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBzY2VuZSBmcm9tIHRleHQgcHJvbXB0XG4gICAqIFBVUkUgRlVOQ1RJT04gLSBubyBzaWRlIGVmZmVjdHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVGcm9tVGV4dChpbnB1dDogQWRkVG9vbElucHV0KTogUHJvbWlzZTxBZGRUb29sT3V0cHV0PiB7XG4gICAgLy8gR2VuZXJhdGUgZnVuY3Rpb24gbmFtZSAoZGV0ZXJtaW5pc3RpYyBiYXNlZCBvbiBpbnB1dClcbiAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSB0aGlzLmdlbmVyYXRlRnVuY3Rpb25OYW1lKGlucHV0LnByb2plY3RJZCwgaW5wdXQuc2NlbmVOdW1iZXIpO1xuICAgIFxuICAgIC8vIElmIHdlIGhhdmUgYSBwcmV2aW91cyBzY2VuZSB3aXRoIGNvZGUsIHVzZSBpdCBhcyByZWZlcmVuY2VcbiAgICBpZiAoaW5wdXQucHJldmlvdXNTY2VuZUNvbnRleHQ/LnRzeENvZGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SoIFtBREQgVE9PTF0gUHJldmlvdXMgc2NlbmUgZGV0ZWN0ZWQgLSB1c2luZyBjb2RlIHJlZmVyZW5jZScpO1xuICAgICAgXG4gICAgICAvLyBHZW5lcmF0ZSBjb2RlIGRpcmVjdGx5IHVzaW5nIHByZXZpb3VzIHNjZW5lIGFzIHJlZmVyZW5jZVxuICAgICAgY29uc3QgY29kZVJlc3VsdCA9IGF3YWl0IGNvZGVHZW5lcmF0b3IuZ2VuZXJhdGVDb2RlV2l0aFJlZmVyZW5jZSh7XG4gICAgICAgIHVzZXJQcm9tcHQ6IGlucHV0LnVzZXJQcm9tcHQsXG4gICAgICAgIGZ1bmN0aW9uTmFtZTogZnVuY3Rpb25OYW1lLFxuICAgICAgICBwcm9qZWN0SWQ6IGlucHV0LnByb2plY3RJZCxcbiAgICAgICAgcHJldmlvdXNTY2VuZUNvZGU6IGlucHV0LnByZXZpb3VzU2NlbmVDb250ZXh0LnRzeENvZGUsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0c3hDb2RlOiBjb2RlUmVzdWx0LmNvZGUsXG4gICAgICAgIG5hbWU6IGNvZGVSZXN1bHQubmFtZSxcbiAgICAgICAgZHVyYXRpb246IGNvZGVSZXN1bHQuZHVyYXRpb24sXG4gICAgICAgIHJlYXNvbmluZzogYEdlbmVyYXRlZCBuZXcgc2NlbmUgYmFzZWQgb24gcHJldmlvdXMgc2NlbmU6ICR7Y29kZVJlc3VsdC5yZWFzb25pbmd9YCxcbiAgICAgICAgY2hhdFJlc3BvbnNlOiBgSSd2ZSBjcmVhdGVkIGEgbmV3IHNjZW5lIGJhc2VkIG9uIHRoZSBwcmV2aW91cyBzY2VuZSBzdHlsZWAsXG4gICAgICAgIHNjZW5lOiB7XG4gICAgICAgICAgdHN4Q29kZTogY29kZVJlc3VsdC5jb2RlLFxuICAgICAgICAgIG5hbWU6IGNvZGVSZXN1bHQubmFtZSxcbiAgICAgICAgICBkdXJhdGlvbjogY29kZVJlc3VsdC5kdXJhdGlvbixcbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IHtcbiAgICAgICAgICB1c2VkUHJldmlvdXNTY2VuZTogdHJ1ZSxcbiAgICAgICAgICBjb2RlR2VuZXJhdGlvbjogY29kZVJlc3VsdC5kZWJ1ZyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgW0FERCBUT09MXSBGaW5pc2hlZCB3aXRoIHJlZmVyZW5jZSAtIHJldHVybmluZyByZXN1bHQ6Jywge1xuICAgICAgICBuYW1lOiByZXN1bHQubmFtZSxcbiAgICAgICAgZHVyYXRpb246IHJlc3VsdC5kdXJhdGlvbixcbiAgICAgICAgY29kZUxlbmd0aDogcmVzdWx0LnRzeENvZGUubGVuZ3RoLFxuICAgICAgICBmaXJzdExpbmU6IHJlc3VsdC50c3hDb2RlLnNwbGl0KCdcXG4nKVswXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIFxuICAgIC8vIERJUkVDVCBDT0RFIEdFTkVSQVRJT04gLSBTa2lwIGxheW91dCBlbnRpcmVseSFcbiAgICBjb25zb2xlLmxvZygn4pqhIFtBREQgVE9PTF0gVXNpbmcgRElSRUNUIGNvZGUgZ2VuZXJhdGlvbiAtIG5vIGxheW91dCBzdGVwIScpO1xuICAgIFxuICAgIGNvbnN0IGNvZGVSZXN1bHQgPSBhd2FpdCBjb2RlR2VuZXJhdG9yLmdlbmVyYXRlQ29kZURpcmVjdCh7XG4gICAgICB1c2VyUHJvbXB0OiBpbnB1dC51c2VyUHJvbXB0LFxuICAgICAgZnVuY3Rpb25OYW1lOiBmdW5jdGlvbk5hbWUsXG4gICAgICBwcm9qZWN0SWQ6IGlucHV0LnByb2plY3RJZCxcbiAgICB9KTtcblxuICAgIC8vIFJldHVybiBnZW5lcmF0ZWQgY29udGVudCAtIE5PIERBVEFCQVNFIVxuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB0c3hDb2RlOiBjb2RlUmVzdWx0LmNvZGUsICAgICAgICAgLy8g4pyTIENvcnJlY3QgZmllbGQgbmFtZVxuICAgICAgbmFtZTogY29kZVJlc3VsdC5uYW1lLFxuICAgICAgZHVyYXRpb246IGNvZGVSZXN1bHQuZHVyYXRpb24sICAgIC8vIEluIGZyYW1lc1xuICAgICAgcmVhc29uaW5nOiBgR2VuZXJhdGVkICR7Y29kZVJlc3VsdC5uYW1lfTogJHtjb2RlUmVzdWx0LnJlYXNvbmluZ31gLFxuICAgICAgY2hhdFJlc3BvbnNlOiBgSSd2ZSBjcmVhdGVkICR7Y29kZVJlc3VsdC5uYW1lfWAsXG4gICAgICBzY2VuZToge1xuICAgICAgICB0c3hDb2RlOiBjb2RlUmVzdWx0LmNvZGUsXG4gICAgICAgIG5hbWU6IGNvZGVSZXN1bHQubmFtZSxcbiAgICAgICAgZHVyYXRpb246IGNvZGVSZXN1bHQuZHVyYXRpb24sXG4gICAgICB9LFxuICAgICAgZGVidWc6IHtcbiAgICAgICAgbWV0aG9kOiAnZGlyZWN0JyxcbiAgICAgICAgY29kZUdlbmVyYXRpb246IGNvZGVSZXN1bHQuZGVidWcsXG4gICAgICB9LFxuICAgIH07XG4gICAgXG4gICAgY29uc29sZS5sb2coJ+KchSBbQUREIFRPT0xdIEZpbmlzaGVkIGRpcmVjdCBnZW5lcmF0aW9uIC0gcmV0dXJuaW5nIHJlc3VsdDonLCB7XG4gICAgICBuYW1lOiByZXN1bHQubmFtZSxcbiAgICAgIGR1cmF0aW9uOiByZXN1bHQuZHVyYXRpb24sXG4gICAgICBjb2RlTGVuZ3RoOiByZXN1bHQudHN4Q29kZS5sZW5ndGgsXG4gICAgICBmaXJzdExpbmU6IHJlc3VsdC50c3hDb2RlLnNwbGl0KCdcXG4nKVswXVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgc2NlbmUgZnJvbSBpbWFnZXNcbiAgICogUFVSRSBGVU5DVElPTiAtIG5vIHNpZGUgZWZmZWN0c1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUZyb21JbWFnZXMoaW5wdXQ6IEFkZFRvb2xJbnB1dCk6IFByb21pc2U8QWRkVG9vbE91dHB1dD4ge1xuICAgIGlmICghaW5wdXQuaW1hZ2VVcmxzIHx8IGlucHV0LmltYWdlVXJscy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGltYWdlcyBwcm92aWRlZFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSB0aGlzLmdlbmVyYXRlRnVuY3Rpb25OYW1lKGlucHV0LnByb2plY3RJZCwgaW5wdXQuc2NlbmVOdW1iZXIpO1xuXG4gICAgLy8gR2VuZXJhdGUgY29kZSBkaXJlY3RseSBmcm9tIGltYWdlc1xuICAgIGNvbnN0IGNvZGVSZXN1bHQgPSBhd2FpdCBjb2RlR2VuZXJhdG9yLmdlbmVyYXRlQ29kZUZyb21JbWFnZSh7XG4gICAgICBpbWFnZVVybHM6IGlucHV0LmltYWdlVXJscyxcbiAgICAgIHVzZXJQcm9tcHQ6IGlucHV0LnVzZXJQcm9tcHQsXG4gICAgICBmdW5jdGlvbk5hbWU6IGZ1bmN0aW9uTmFtZSxcbiAgICAgIHZpc2lvbkFuYWx5c2lzOiBpbnB1dC52aXNpb25BbmFseXNpcyxcbiAgICB9KTtcblxuICAgIC8vIFJldHVybiBnZW5lcmF0ZWQgY29udGVudCAtIE5PIERBVEFCQVNFIVxuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB0c3hDb2RlOiBjb2RlUmVzdWx0LmNvZGUsICAgICAgICAgLy8g4pyTIENvcnJlY3QgZmllbGQgbmFtZVxuICAgICAgbmFtZTogY29kZVJlc3VsdC5uYW1lLFxuICAgICAgZHVyYXRpb246IGNvZGVSZXN1bHQuZHVyYXRpb24sICAgIC8vIEluIGZyYW1lc1xuICAgICAgcmVhc29uaW5nOiBgR2VuZXJhdGVkIGZyb20gJHtpbnB1dC5pbWFnZVVybHMubGVuZ3RofSBpbWFnZShzKTogJHtjb2RlUmVzdWx0LnJlYXNvbmluZ31gLFxuICAgICAgY2hhdFJlc3BvbnNlOiBgSSd2ZSBjcmVhdGVkICR7Y29kZVJlc3VsdC5uYW1lfSBiYXNlZCBvbiB5b3VyIGltYWdlKHMpYCxcbiAgICAgIHNjZW5lOiB7XG4gICAgICAgIHRzeENvZGU6IGNvZGVSZXN1bHQuY29kZSxcbiAgICAgICAgbmFtZTogY29kZVJlc3VsdC5uYW1lLFxuICAgICAgICBkdXJhdGlvbjogY29kZVJlc3VsdC5kdXJhdGlvbixcbiAgICAgIH0sXG4gICAgICBkZWJ1Zzoge1xuICAgICAgICBpbWFnZUdlbmVyYXRpb246IGNvZGVSZXN1bHQuZGVidWcsXG4gICAgICB9LFxuICAgIH07XG4gICAgXG4gICAgY29uc29sZS5sb2coJ+KchSBbQUREIFRPT0xdIEZpbmlzaGVkIGltYWdlIGdlbmVyYXRpb24gLSByZXR1cm5pbmcgcmVzdWx0OicsIHtcbiAgICAgIG5hbWU6IHJlc3VsdC5uYW1lLFxuICAgICAgZHVyYXRpb246IHJlc3VsdC5kdXJhdGlvbixcbiAgICAgIGNvZGVMZW5ndGg6IHJlc3VsdC50c3hDb2RlLmxlbmd0aCxcbiAgICAgIGltYWdlQ291bnQ6IGlucHV0LmltYWdlVXJscy5sZW5ndGhcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHNjZW5lIGZyb20gd2ViIGNvbnRleHQgc2NyZWVuc2hvdHNcbiAgICogUFVSRSBGVU5DVElPTiAtIG5vIHNpZGUgZWZmZWN0c1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUZyb21XZWJDb250ZXh0KGlucHV0OiBBZGRUb29sSW5wdXQpOiBQcm9taXNlPEFkZFRvb2xPdXRwdXQ+IHtcbiAgICBpZiAoIWlucHV0LndlYkNvbnRleHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHdlYiBjb250ZXh0IHByb3ZpZGVkXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IHRoaXMuZ2VuZXJhdGVGdW5jdGlvbk5hbWUoaW5wdXQucHJvamVjdElkLCBpbnB1dC5zY2VuZU51bWJlcik7XG5cbiAgICAvLyBDcmVhdGUgY29tYmluZWQgaW1hZ2UgbGlzdCB3aXRoIHdlYiBzY3JlZW5zaG90c1xuICAgIGNvbnN0IGFsbEltYWdlVXJscyA9IFtcbiAgICAgIGlucHV0LndlYkNvbnRleHQuc2NyZWVuc2hvdFVybHMuZGVza3RvcCxcbiAgICAgIGlucHV0LndlYkNvbnRleHQuc2NyZWVuc2hvdFVybHMubW9iaWxlLFxuICAgIF07XG5cbiAgICAvLyBFbmhhbmNlZCBwcm9tcHQgZm9yIHdlYiBjb250ZXh0XG4gICAgY29uc3QgZW5oYW5jZWRQcm9tcHQgPSBgJHtpbnB1dC51c2VyUHJvbXB0fVxuXG5XRUJTSVRFIENPTlRFWFQ6XG4tIFVSTDogJHtpbnB1dC53ZWJDb250ZXh0Lm9yaWdpbmFsVXJsfVxuLSBUaXRsZTogJHtpbnB1dC53ZWJDb250ZXh0LnBhZ2VEYXRhLnRpdGxlfVxuLSBEZXNjcmlwdGlvbjogJHtpbnB1dC53ZWJDb250ZXh0LnBhZ2VEYXRhLmRlc2NyaXB0aW9uIHx8ICdOb3QgYXZhaWxhYmxlJ31cbi0gS2V5IGhlYWRpbmdzOiAke2lucHV0LndlYkNvbnRleHQucGFnZURhdGEuaGVhZGluZ3Muc2xpY2UoMCwgNSkuam9pbignLCAnKX1cblxuQlJBTkQgTUFUQ0hJTkcgSU5TVFJVQ1RJT05TOlxuLSBVc2UgdGhlIHdlYnNpdGUgc2NyZWVuc2hvdHMgdG8gbWF0Y2ggdGhlIGJyYW5kJ3MgdmlzdWFsIGlkZW50aXR5XG4tIEV4dHJhY3QgY29sb3JzLCBmb250cywgYW5kIGRlc2lnbiBwYXR0ZXJucyBmcm9tIHRoZSBzY3JlZW5zaG90c1xuLSBNYWludGFpbiBicmFuZCBjb25zaXN0ZW5jeSBpbiB0aGUgbW90aW9uIGdyYXBoaWNzXG4tIFRoZSBkZXNrdG9wIHNjcmVlbnNob3Qgc2hvd3MgdGhlIGZ1bGwgbGF5b3V0LCBtb2JpbGUgc2hvd3MgdGhlIG1vYmlsZSBkZXNpZ25gO1xuXG4gICAgLy8gR2VuZXJhdGUgY29kZSB1c2luZyB3ZWJzaXRlIHNjcmVlbnNob3RzXG4gICAgY29uc3QgY29kZVJlc3VsdCA9IGF3YWl0IGNvZGVHZW5lcmF0b3IuZ2VuZXJhdGVDb2RlRnJvbUltYWdlKHtcbiAgICAgIGltYWdlVXJsczogYWxsSW1hZ2VVcmxzLFxuICAgICAgdXNlclByb21wdDogZW5oYW5jZWRQcm9tcHQsXG4gICAgICBmdW5jdGlvbk5hbWU6IGZ1bmN0aW9uTmFtZSxcbiAgICAgIHZpc2lvbkFuYWx5c2lzOiB7XG4gICAgICAgIHdlYkNvbnRleHQ6IGlucHV0LndlYkNvbnRleHQsXG4gICAgICAgIGFuYWx5c2lzVHlwZTogJ3dlYnNpdGVfYnJhbmRfbWF0Y2hpbmcnXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHRzeENvZGU6IGNvZGVSZXN1bHQuY29kZSxcbiAgICAgIG5hbWU6IGNvZGVSZXN1bHQubmFtZSxcbiAgICAgIGR1cmF0aW9uOiBjb2RlUmVzdWx0LmR1cmF0aW9uLFxuICAgICAgcmVhc29uaW5nOiBgR2VuZXJhdGVkIHNjZW5lIGJhc2VkIG9uIHdlYnNpdGUgJHtpbnB1dC53ZWJDb250ZXh0LnBhZ2VEYXRhLnRpdGxlfTogJHtjb2RlUmVzdWx0LnJlYXNvbmluZ31gLFxuICAgICAgY2hhdFJlc3BvbnNlOiBgSSd2ZSBjcmVhdGVkIGEgc2NlbmUgaW5zcGlyZWQgYnkgdGhlICR7aW5wdXQud2ViQ29udGV4dC5wYWdlRGF0YS50aXRsZX0gd2Vic2l0ZSwgbWF0Y2hpbmcgdGhlaXIgYnJhbmQgaWRlbnRpdHlgLFxuICAgICAgc2NlbmU6IHtcbiAgICAgICAgdHN4Q29kZTogY29kZVJlc3VsdC5jb2RlLFxuICAgICAgICBuYW1lOiBjb2RlUmVzdWx0Lm5hbWUsXG4gICAgICAgIGR1cmF0aW9uOiBjb2RlUmVzdWx0LmR1cmF0aW9uLFxuICAgICAgfSxcbiAgICAgIGRlYnVnOiB7XG4gICAgICAgIHdlYkNvbnRleHRHZW5lcmF0aW9uOiBjb2RlUmVzdWx0LmRlYnVnLFxuICAgICAgICB3ZWJzaXRlVXJsOiBpbnB1dC53ZWJDb250ZXh0Lm9yaWdpbmFsVXJsLFxuICAgICAgICBwYWdlVGl0bGU6IGlucHV0LndlYkNvbnRleHQucGFnZURhdGEudGl0bGUsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZygn4pyFIFtBREQgVE9PTF0gRmluaXNoZWQgd2ViIGNvbnRleHQgZ2VuZXJhdGlvbiAtIHJldHVybmluZyByZXN1bHQ6Jywge1xuICAgICAgbmFtZTogcmVzdWx0Lm5hbWUsXG4gICAgICBkdXJhdGlvbjogcmVzdWx0LmR1cmF0aW9uLFxuICAgICAgY29kZUxlbmd0aDogcmVzdWx0LnRzeENvZGUubGVuZ3RoLFxuICAgICAgd2Vic2l0ZVVybDogaW5wdXQud2ViQ29udGV4dC5vcmlnaW5hbFVybFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBzY2VuZSBmcm9tIHdlYiBjb250ZXh0ICsgYWRkaXRpb25hbCBpbWFnZXNcbiAgICogUFVSRSBGVU5DVElPTiAtIG5vIHNpZGUgZWZmZWN0c1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUZyb21XZWJBbmRJbWFnZXMoaW5wdXQ6IEFkZFRvb2xJbnB1dCk6IFByb21pc2U8QWRkVG9vbE91dHB1dD4ge1xuICAgIGlmICghaW5wdXQud2ViQ29udGV4dCB8fCAhaW5wdXQuaW1hZ2VVcmxzPy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHdlYiBjb250ZXh0IG9yIGltYWdlcyBwcm92aWRlZFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSB0aGlzLmdlbmVyYXRlRnVuY3Rpb25OYW1lKGlucHV0LnByb2plY3RJZCwgaW5wdXQuc2NlbmVOdW1iZXIpO1xuXG4gICAgLy8gQ29tYmluZSB3ZWJzaXRlIHNjcmVlbnNob3RzIHdpdGggdXNlciBpbWFnZXNcbiAgICBjb25zdCBhbGxJbWFnZVVybHMgPSBbXG4gICAgICBpbnB1dC53ZWJDb250ZXh0LnNjcmVlbnNob3RVcmxzLmRlc2t0b3AsXG4gICAgICBpbnB1dC53ZWJDb250ZXh0LnNjcmVlbnNob3RVcmxzLm1vYmlsZSxcbiAgICAgIC4uLmlucHV0LmltYWdlVXJsc1xuICAgIF07XG5cbiAgICAvLyBFbmhhbmNlZCBwcm9tcHQgY29tYmluaW5nIHdlYiBjb250ZXh0IHdpdGggdXNlciBpbWFnZXNcbiAgICBjb25zdCBlbmhhbmNlZFByb21wdCA9IGAke2lucHV0LnVzZXJQcm9tcHR9XG5cbldFQlNJVEUgQlJBTkQgQ09OVEVYVDpcbi0gVVJMOiAke2lucHV0LndlYkNvbnRleHQub3JpZ2luYWxVcmx9XG4tIFRpdGxlOiAke2lucHV0LndlYkNvbnRleHQucGFnZURhdGEudGl0bGV9XG4tIERlc2NyaXB0aW9uOiAke2lucHV0LndlYkNvbnRleHQucGFnZURhdGEuZGVzY3JpcHRpb24gfHwgJ05vdCBhdmFpbGFibGUnfVxuXG5DT01CSU5FRCBDT05URVhUIElOU1RSVUNUSU9OUzpcbi0gVXNlIHRoZSB3ZWJzaXRlIHNjcmVlbnNob3RzIChmaXJzdCAyIGltYWdlcykgdG8gdW5kZXJzdGFuZCB0aGUgYnJhbmQgaWRlbnRpdHlcbi0gVXNlIHRoZSBhZGRpdGlvbmFsIHVzZXIgaW1hZ2VzIGZvciBzcGVjaWZpYyBjb250ZW50IHJlcXVpcmVtZW50c1xuLSBCbGVuZCB0aGUgYnJhbmQncyB2aXN1YWwgc3R5bGUgd2l0aCB0aGUgdXNlcidzIGltYWdlIGNvbnRlbnRcbi0gTWFpbnRhaW4gYnJhbmQgY29uc2lzdGVuY3kgd2hpbGUgaW5jb3Jwb3JhdGluZyB1c2VyIGltYWdlIGVsZW1lbnRzYDtcblxuICAgIC8vIEdlbmVyYXRlIGNvZGUgdXNpbmcgY29tYmluZWQgY29udGV4dFxuICAgIGNvbnN0IGNvZGVSZXN1bHQgPSBhd2FpdCBjb2RlR2VuZXJhdG9yLmdlbmVyYXRlQ29kZUZyb21JbWFnZSh7XG4gICAgICBpbWFnZVVybHM6IGFsbEltYWdlVXJscyxcbiAgICAgIHVzZXJQcm9tcHQ6IGVuaGFuY2VkUHJvbXB0LFxuICAgICAgZnVuY3Rpb25OYW1lOiBmdW5jdGlvbk5hbWUsXG4gICAgICB2aXNpb25BbmFseXNpczoge1xuICAgICAgICB3ZWJDb250ZXh0OiBpbnB1dC53ZWJDb250ZXh0LFxuICAgICAgICB1c2VySW1hZ2VDb3VudDogaW5wdXQuaW1hZ2VVcmxzLmxlbmd0aCxcbiAgICAgICAgYW5hbHlzaXNUeXBlOiAnd2Vic2l0ZV9wbHVzX2ltYWdlcydcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdHN4Q29kZTogY29kZVJlc3VsdC5jb2RlLFxuICAgICAgbmFtZTogY29kZVJlc3VsdC5uYW1lLFxuICAgICAgZHVyYXRpb246IGNvZGVSZXN1bHQuZHVyYXRpb24sXG4gICAgICByZWFzb25pbmc6IGBHZW5lcmF0ZWQgc2NlbmUgY29tYmluaW5nICR7aW5wdXQud2ViQ29udGV4dC5wYWdlRGF0YS50aXRsZX0gYnJhbmQgd2l0aCAke2lucHV0LmltYWdlVXJscy5sZW5ndGh9IHVzZXIgaW1hZ2Uocyk6ICR7Y29kZVJlc3VsdC5yZWFzb25pbmd9YCxcbiAgICAgIGNoYXRSZXNwb25zZTogYEkndmUgY3JlYXRlZCBhIHNjZW5lIHRoYXQgY29tYmluZXMgdGhlICR7aW5wdXQud2ViQ29udGV4dC5wYWdlRGF0YS50aXRsZX0gYnJhbmQgc3R5bGUgd2l0aCB5b3VyIGltYWdlc2AsXG4gICAgICBzY2VuZToge1xuICAgICAgICB0c3hDb2RlOiBjb2RlUmVzdWx0LmNvZGUsXG4gICAgICAgIG5hbWU6IGNvZGVSZXN1bHQubmFtZSxcbiAgICAgICAgZHVyYXRpb246IGNvZGVSZXN1bHQuZHVyYXRpb24sXG4gICAgICB9LFxuICAgICAgZGVidWc6IHtcbiAgICAgICAgd2ViQW5kSW1hZ2VHZW5lcmF0aW9uOiBjb2RlUmVzdWx0LmRlYnVnLFxuICAgICAgICB3ZWJzaXRlVXJsOiBpbnB1dC53ZWJDb250ZXh0Lm9yaWdpbmFsVXJsLFxuICAgICAgICB1c2VySW1hZ2VDb3VudDogaW5wdXQuaW1hZ2VVcmxzLmxlbmd0aCxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnNvbGUubG9nKCfinIUgW0FERCBUT09MXSBGaW5pc2hlZCB3ZWIraW1hZ2VzIGdlbmVyYXRpb24gLSByZXR1cm5pbmcgcmVzdWx0OicsIHtcbiAgICAgIG5hbWU6IHJlc3VsdC5uYW1lLFxuICAgICAgZHVyYXRpb246IHJlc3VsdC5kdXJhdGlvbixcbiAgICAgIGNvZGVMZW5ndGg6IHJlc3VsdC50c3hDb2RlLmxlbmd0aCxcbiAgICAgIHdlYnNpdGVVcmw6IGlucHV0LndlYkNvbnRleHQub3JpZ2luYWxVcmwsXG4gICAgICB1c2VySW1hZ2VDb3VudDogaW5wdXQuaW1hZ2VVcmxzLmxlbmd0aFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB1bmlxdWUgY29tcG9uZW50IG5hbWUgdXNpbmcgYSBzdGFibGUgSURcbiAgICogVGhpcyBwcmV2ZW50cyBuYW1pbmcgY29sbGlzaW9ucyB3aGVuIHNjZW5lcyBhcmUgZGVsZXRlZC9yZW9yZGVyZWRcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVGdW5jdGlvbk5hbWUocHJvamVjdElkOiBzdHJpbmcsIHNjZW5lTnVtYmVyPzogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAvLyBHZW5lcmF0ZSBhIHVuaXF1ZSA4LWNoYXJhY3RlciBJRCBmb3IgdGhpcyBzY2VuZVxuICAgIC8vIFRoaXMgZW5zdXJlcyBjb21wb25lbnQgbmFtZXMgbmV2ZXIgY29sbGlkZSwgZXZlbiBhZnRlciBkZWxldGlvbnNcbiAgICBjb25zdCB1bmlxdWVJZCA9IHRoaXMuZ2VuZXJhdGVVbmlxdWVJZCgpO1xuICAgIHJldHVybiBgU2NlbmVfJHt1bmlxdWVJZH1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgdW5pcXVlIDgtY2hhcmFjdGVyIElEXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlVW5pcXVlSWQoKTogc3RyaW5nIHtcbiAgICAvLyBVc2UgdGltZXN0YW1wICsgcmFuZG9tIGZvciB1bmlxdWVuZXNzXG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKS50b1N0cmluZygzNik7XG4gICAgY29uc3QgcmFuZG9tID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDYpO1xuICAgIHJldHVybiAodGltZXN0YW1wICsgcmFuZG9tKS5zdWJzdHJpbmcoMCwgOCk7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGFkZFRvb2wgPSBuZXcgQWRkVG9vbCgpO1xuIl0sIm5hbWVzIjpbIkJhc2VNQ1BUb29sIiwiY29kZUdlbmVyYXRvciIsImFkZFRvb2xJbnB1dFNjaGVtYSIsIkFkZFRvb2wiLCJleGVjdXRlIiwiaW5wdXQiLCJjb25zb2xlIiwibG9nIiwicHJvbXB0IiwidXNlclByb21wdCIsInN1YnN0cmluZyIsImhhc0ltYWdlcyIsImltYWdlVXJscyIsImxlbmd0aCIsImhhc1dlYkNvbnRleHQiLCJ3ZWJDb250ZXh0Iiwic2NlbmVOdW1iZXIiLCJoYXNQcmV2aW91c1NjZW5lIiwicHJldmlvdXNTY2VuZUNvbnRleHQiLCJnZW5lcmF0ZUZyb21XZWJBbmRJbWFnZXMiLCJvcmlnaW5hbFVybCIsImdlbmVyYXRlRnJvbVdlYkNvbnRleHQiLCJnZW5lcmF0ZUZyb21JbWFnZXMiLCJnZW5lcmF0ZUZyb21UZXh0IiwiZXJyb3IiLCJzdWNjZXNzIiwicmVhc29uaW5nIiwiRXJyb3IiLCJtZXNzYWdlIiwiZnVuY3Rpb25OYW1lIiwiZ2VuZXJhdGVGdW5jdGlvbk5hbWUiLCJwcm9qZWN0SWQiLCJ0c3hDb2RlIiwiY29kZVJlc3VsdCIsImdlbmVyYXRlQ29kZVdpdGhSZWZlcmVuY2UiLCJwcmV2aW91c1NjZW5lQ29kZSIsInJlc3VsdCIsImNvZGUiLCJuYW1lIiwiZHVyYXRpb24iLCJjaGF0UmVzcG9uc2UiLCJzY2VuZSIsImRlYnVnIiwidXNlZFByZXZpb3VzU2NlbmUiLCJjb2RlR2VuZXJhdGlvbiIsImNvZGVMZW5ndGgiLCJmaXJzdExpbmUiLCJzcGxpdCIsImdlbmVyYXRlQ29kZURpcmVjdCIsIm1ldGhvZCIsImdlbmVyYXRlQ29kZUZyb21JbWFnZSIsInZpc2lvbkFuYWx5c2lzIiwiaW1hZ2VHZW5lcmF0aW9uIiwiaW1hZ2VDb3VudCIsImFsbEltYWdlVXJscyIsInNjcmVlbnNob3RVcmxzIiwiZGVza3RvcCIsIm1vYmlsZSIsImVuaGFuY2VkUHJvbXB0IiwicGFnZURhdGEiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiaGVhZGluZ3MiLCJzbGljZSIsImpvaW4iLCJhbmFseXNpc1R5cGUiLCJ3ZWJDb250ZXh0R2VuZXJhdGlvbiIsIndlYnNpdGVVcmwiLCJwYWdlVGl0bGUiLCJ1c2VySW1hZ2VDb3VudCIsIndlYkFuZEltYWdlR2VuZXJhdGlvbiIsInVuaXF1ZUlkIiwiZ2VuZXJhdGVVbmlxdWVJZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsInJhbmRvbSIsIk1hdGgiLCJpbnB1dFNjaGVtYSIsImFkZFRvb2wiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/add/add.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/add/add_helpers/CodeGeneratorNEW.ts":
/*!*******************************************************!*\
  !*** ./src/tools/add/add_helpers/CodeGeneratorNEW.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CodeGeneratorService: () => (/* binding */ CodeGeneratorService),\n/* harmony export */   codeGenerator: () => (/* binding */ codeGenerator)\n/* harmony export */ });\n/* harmony import */ var _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/server/services/ai/aiClient.service */ \"(rsc)/./src/server/services/ai/aiClient.service.ts\");\n/* harmony import */ var _config_models_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/config/models.config */ \"(rsc)/./src/config/models.config.ts\");\n/* harmony import */ var _config_prompts_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/config/prompts.config */ \"(rsc)/./src/config/prompts.config.ts\");\n/* harmony import */ var _lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/lib/utils/codeDurationExtractor */ \"(rsc)/./src/lib/utils/codeDurationExtractor.ts\");\n\n\n\n\n/**\n * Code Generator Service - converts JSON specifications to React/Remotion code\n * Second step of the two-step pipeline: JSON Spec  React Code\n */ class CodeGeneratorService {\n    /**\n   * Generate code directly from prompt (FASTEST PATH - no layout)\n   */ async generateCodeDirect(input) {\n        const config = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_1__.getModel)('codeGenerator');\n        console.log(' [CODE GENERATOR] DIRECT PATH: Generating code from prompt only');\n        try {\n            const systemPrompt = (0,_config_prompts_config__WEBPACK_IMPORTED_MODULE_2__.getParameterizedPrompt)('CODE_GENERATOR', {\n                FUNCTION_NAME: input.functionName\n            });\n            const userPrompt = `USER REQUEST: \"${input.userPrompt}\"\n\nFUNCTION NAME: ${input.functionName}\n\nGenerate a complete Remotion component based on the user's request.\n- Create engaging motion graphics\n- Use modern animations with Framer Motion\n- Ensure it's a complete, self-contained component\n- Default duration: 5 seconds (150 frames at 30fps)`;\n            const messages = [\n                {\n                    role: 'user',\n                    content: userPrompt\n                }\n            ];\n            const response = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__.AIClientService.generateResponse(config, messages, {\n                role: 'system',\n                content: systemPrompt.content\n            });\n            const rawOutput = response?.content;\n            if (!rawOutput) {\n                throw new Error(\"No response from CodeGenerator LLM\");\n            }\n            // Clean and process code\n            let cleanCode = rawOutput.trim();\n            cleanCode = cleanCode.replace(/^```(?:javascript|tsx|ts|js)?\\n?/i, '').replace(/\\n?```$/i, '');\n            // Extract duration\n            const durationAnalysis = (0,_lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__.analyzeDuration)(cleanCode);\n            return {\n                code: cleanCode,\n                name: \"Scene\",\n                duration: durationAnalysis.frames,\n                reasoning: `Generated scene directly from prompt (${durationAnalysis.frames} frames)`,\n                debug: {\n                    method: 'direct',\n                    promptLength: userPrompt.length,\n                    responseLength: rawOutput.length,\n                    durationAnalysis\n                }\n            };\n        } catch (error) {\n            console.error('[CODE GENERATOR] Direct path failed:', error);\n            throw error;\n        }\n    }\n    /**\n   * Generate code using previous scene as reference (FAST PATH)\n   */ async generateCodeWithReference(input) {\n        const config = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_1__.getModel)('codeGenerator');\n        console.log(' [CODE GENERATOR] FAST PATH: Using previous scene as reference');\n        try {\n            const systemPrompt = (0,_config_prompts_config__WEBPACK_IMPORTED_MODULE_2__.getParameterizedPrompt)('CODE_GENERATOR', {\n                FUNCTION_NAME: input.functionName\n            });\n            const userPrompt = `PREVIOUS SCENE CODE:\n\\`\\`\\`tsx\n${input.previousSceneCode}\n\\`\\`\\`\n\nUSER REQUEST: \"${input.userPrompt}\"\n\nFUNCTION NAME: ${input.functionName}\n\nGenerate a NEW scene based on the user's request, using the previous scene's code as a style reference. \n- Keep the same visual style, colors, fonts, and animation patterns\n- Create NEW content based on the user's request\n- Ensure it's a complete, self-contained Remotion component`;\n            const messages = [\n                {\n                    role: 'user',\n                    content: userPrompt\n                }\n            ];\n            const response = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__.AIClientService.generateResponse(config, messages, {\n                role: 'system',\n                content: systemPrompt.content\n            });\n            const rawOutput = response?.content;\n            if (!rawOutput) {\n                throw new Error(\"No response from CodeGenerator LLM\");\n            }\n            // Clean and process code\n            let cleanCode = rawOutput.trim();\n            cleanCode = cleanCode.replace(/^```(?:javascript|tsx|ts|js)?\\n?/i, '').replace(/\\n?```$/i, '');\n            // Extract duration\n            const durationAnalysis = (0,_lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__.analyzeDuration)(cleanCode);\n            return {\n                code: cleanCode,\n                name: \"Scene\",\n                duration: durationAnalysis.frames,\n                reasoning: `Generated new scene using previous scene style (${durationAnalysis.frames} frames)`,\n                debug: {\n                    method: 'withReference',\n                    promptLength: userPrompt.length,\n                    responseLength: rawOutput.length,\n                    durationAnalysis\n                }\n            };\n        } catch (error) {\n            console.error('[CODE GENERATOR] Fast path failed:', error);\n            throw error;\n        }\n    }\n    /**\n   * Generate React code from layout JSON\n   */ async generateCode(input) {\n        const config = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_1__.getModel)('codeGenerator');\n        const prompt = this.buildCodePrompt(input);\n        console.log('==================== codeGenerator reached:');\n        console.log('==================== generateCode reached:');\n        try {\n            const messages = [\n                {\n                    role: 'user',\n                    content: prompt.user\n                }\n            ];\n            const response = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__.AIClientService.generateResponse(config, messages, {\n                role: 'system',\n                content: prompt.system\n            });\n            const rawOutput = response?.content;\n            if (!rawOutput) {\n                throw new Error(\"No response from CodeGenerator LLM\");\n            }\n            // Remove markdown code fences if present\n            let cleanCode = rawOutput.trim();\n            cleanCode = cleanCode.replace(/^```(?:javascript|tsx|ts|js)?\\n?/i, '').replace(/\\n?```$/i, '');\n            // Ensure single export default only\n            if (cleanCode.includes('export default function') && cleanCode.includes('function SingleSceneComposition')) {\n                const sceneMatch = cleanCode.match(/const \\{[^}]+\\} = window\\.Remotion;[\\s\\S]*?export default function \\w+\\(\\)[^{]*\\{[\\s\\S]*?\\n\\}/);\n                if (sceneMatch) {\n                    cleanCode = sceneMatch[0];\n                }\n            }\n            // Extract actual duration from generated code\n            const durationAnalysis = (0,_lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__.analyzeDuration)(cleanCode);\n            return {\n                code: cleanCode,\n                name: \"Scene\",\n                duration: durationAnalysis.frames,\n                reasoning: `Code generated with ${durationAnalysis.frames} frames duration (${durationAnalysis.confidence} confidence from ${durationAnalysis.source})`,\n                debug: {\n                    prompt,\n                    response: rawOutput,\n                    parsed: {\n                        code: cleanCode,\n                        validated: false,\n                        durationAnalysis\n                    }\n                }\n            };\n        } catch (error) {\n            // Return error code that auto-fix can work with\n            const errorCode = `const { AbsoluteFill } = window.Remotion;\n// CodeGenerator error: ${error instanceof Error ? error.message : 'Unknown error'}\n// Layout JSON was: ${JSON.stringify(input.layoutJson, null, 2)}\n// User wanted: ${input.userPrompt}\n\nexport default function ${input.functionName}() {\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#ff0000\" }}>\n      <div>CodeGenerator Error - Auto Fix Available</div>\n    </AbsoluteFill>\n  );\n}`;\n            const fallbackDuration = (0,_lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__.extractDurationFromCode)(errorCode);\n            return {\n                code: errorCode,\n                name: \"Scene\",\n                duration: fallbackDuration,\n                reasoning: \"CodeGenerator encountered an error - auto-fix can restore from layout JSON\",\n                debug: {\n                    error: `${error instanceof Error ? error.message : 'Unknown error'}. Fallback duration: ${fallbackDuration} frames. Layout: ${JSON.stringify(input.layoutJson, null, 2)}. User prompt: ${input.userPrompt}`\n                }\n            };\n        }\n    }\n    /**\n   * Generate code directly from images\n   */ async generateCodeFromImage(input) {\n        try {\n            const config = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_1__.getModel)('codeGenerator');\n            console.log('==================== codeGenerator reached:');\n            console.log('==================== generateCodeFromImage reached:');\n            // Get the IMAGE_CODE_GENERATOR prompt specifically for image-based generation\n            const systemPrompt = (0,_config_prompts_config__WEBPACK_IMPORTED_MODULE_2__.getParameterizedPrompt)('CODE_GENERATOR', {\n                FUNCTION_NAME: input.functionName\n            });\n            // Build user message for vision API - include the actual user prompt!\n            const userPrompt = `USER REQUEST: \"${input.userPrompt}\"\n\nIMPORTANT: Recreate the UI/layout shown in the image as accurately as possible. Match colors, text, positioning, and visual hierarchy exactly. Then add appropriate animations based on the user's request.\n${input.visionAnalysis ? `Vision analysis: ${JSON.stringify(input.visionAnalysis, null, 2)}` : ''}`;\n            // Use centralized vision API with proper message format\n            const visionMessagesContent = [\n                {\n                    type: 'text',\n                    text: userPrompt\n                }\n            ];\n            for (const url of input.imageUrls){\n                visionMessagesContent.push({\n                    type: 'image_url',\n                    image_url: {\n                        url\n                    }\n                });\n            }\n            const response = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_0__.AIClientService.generateResponse(config, [\n                {\n                    role: 'user',\n                    content: visionMessagesContent\n                }\n            ], {\n                role: 'system',\n                content: systemPrompt.content\n            });\n            // Clean up code\n            let cleanCode = response?.content?.trim() || '';\n            cleanCode = cleanCode.replace(/^```(?:javascript|tsx|ts|js)?\\n?/i, '').replace(/\\n?```$/i, '');\n            // Extract duration from image-generated code\n            const durationAnalysis = (0,_lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__.analyzeDuration)(cleanCode);\n            return {\n                code: cleanCode,\n                name: \"Scene\",\n                duration: durationAnalysis.frames,\n                reasoning: `Generated motion graphics directly from image analysis with ${durationAnalysis.frames} frames duration`,\n                debug: {\n                    prompt: {\n                        system: 'Vision-based generation',\n                        user: `${input.imageUrls.length} images provided`\n                    },\n                    response: response?.content || '',\n                    parsed: {\n                        code: cleanCode,\n                        imageCount: input.imageUrls.length,\n                        durationAnalysis\n                    }\n                }\n            };\n        } catch (error) {\n            const errorCode = `const { AbsoluteFill } = window.Remotion;\n// Image-to-code generation error: ${error instanceof Error ? error.message : 'Unknown error'}\n// User wanted: ${input.userPrompt}\n// Images provided: ${input.imageUrls.length}\n\nexport default function ${input.functionName}() {\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#1a1a2e\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\" }}>\n      <div style={{ color: \"#ffffff\", fontSize: \"2rem\", textAlign: \"center\" }}>\n        <div>Image Analysis Error</div>\n        <div style={{ fontSize: \"1rem\", opacity: 0.7, marginTop: \"1rem\" }}>Auto-fix available</div>\n      </div>\n    </AbsoluteFill>\n  );\n}`;\n            const fallbackDuration = (0,_lib_utils_codeDurationExtractor__WEBPACK_IMPORTED_MODULE_3__.extractDurationFromCode)(errorCode);\n            return {\n                code: errorCode,\n                name: \"Scene\",\n                duration: fallbackDuration,\n                reasoning: \"Image-to-code generation failed - auto-fix available\",\n                debug: {\n                    error: `${error instanceof Error ? error.message : 'Unknown error'}. Fallback duration: ${fallbackDuration} frames. Images: ${input.imageUrls.length}. User prompt: ${input.userPrompt}`\n                }\n            };\n        }\n    }\n    buildCodePrompt(input) {\n        const { layoutJson, userPrompt, functionName } = input;\n        console.log('==================== codeGenerator reached:');\n        console.log('==================== buildCodePrompt reached:');\n        const systemPrompt = (0,_config_prompts_config__WEBPACK_IMPORTED_MODULE_2__.getParameterizedPrompt)('CODE_GENERATOR', {\n            FUNCTION_NAME: functionName,\n            USER_PROMPT: userPrompt\n        });\n        const user = JSON.stringify(layoutJson, null, 2);\n        return {\n            system: systemPrompt.content,\n            user\n        };\n    }\n    constructor(){\n        this.DEBUG = \"development\" === 'development';\n    }\n}\n// Export singleton instance\nconst codeGenerator = new CodeGeneratorService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvdG9vbHMvYWRkL2FkZF9oZWxwZXJzL0NvZGVHZW5lcmF0b3JORVcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXdGO0FBQ3RDO0FBQ2U7QUFDNEI7QUFHN0Y7OztDQUdDLEdBQ00sTUFBTUs7SUFHWDs7R0FFQyxHQUNELE1BQU1DLG1CQUFtQkMsS0FJeEIsRUFBaUM7UUFDaEMsTUFBTUMsU0FBU1AsK0RBQVFBLENBQUM7UUFFeEJRLFFBQVFDLEdBQUcsQ0FBQztRQUVaLElBQUk7WUFDRixNQUFNQyxlQUFlVCw4RUFBc0JBLENBQUMsa0JBQWtCO2dCQUM1RFUsZUFBZUwsTUFBTU0sWUFBWTtZQUNuQztZQUNBLE1BQU1DLGFBQWEsQ0FBQyxlQUFlLEVBQUVQLE1BQU1PLFVBQVUsQ0FBQzs7ZUFFN0MsRUFBRVAsTUFBTU0sWUFBWSxDQUFDOzs7Ozs7bURBTWUsQ0FBQztZQUU5QyxNQUFNRSxXQUFXO2dCQUNmO29CQUFFQyxNQUFNO29CQUFpQkMsU0FBU0g7Z0JBQVc7YUFDOUM7WUFFRCxNQUFNSSxXQUFXLE1BQU1sQixpRkFBZUEsQ0FBQ21CLGdCQUFnQixDQUNyRFgsUUFDQU8sVUFDQTtnQkFBRUMsTUFBTTtnQkFBVUMsU0FBU04sYUFBYU0sT0FBTztZQUFDO1lBR2xELE1BQU1HLFlBQVlGLFVBQVVEO1lBQzVCLElBQUksQ0FBQ0csV0FBVztnQkFDZCxNQUFNLElBQUlDLE1BQU07WUFDbEI7WUFFQSx5QkFBeUI7WUFDekIsSUFBSUMsWUFBWUYsVUFBVUcsSUFBSTtZQUM5QkQsWUFBWUEsVUFBVUUsT0FBTyxDQUFDLHFDQUFxQyxJQUFJQSxPQUFPLENBQUMsWUFBWTtZQUUzRixtQkFBbUI7WUFDbkIsTUFBTUMsbUJBQW1CckIsaUZBQWVBLENBQUNrQjtZQUV6QyxPQUFPO2dCQUNMSSxNQUFNSjtnQkFDTkssTUFBTTtnQkFDTkMsVUFBVUgsaUJBQWlCSSxNQUFNO2dCQUNqQ0MsV0FBVyxDQUFDLHNDQUFzQyxFQUFFTCxpQkFBaUJJLE1BQU0s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LEVBQUVELFlBQVksRUFBRSxHQUFHTjtRQUVqREUsUUFBUUMsR0FBRyxDQUFDO1FBQ1pELFFBQVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1DLGVBQWVULDhFQUFzQkEsQ0FBQyxrQkFBa0I7WUFDNURVLGVBQWVDO1lBQ2ZzRCxhQUFhckQ7UUFDZjtRQUVBLE1BQU00QixPQUFPVyxLQUFLQyxTQUFTLENBQUNDLFlBQVksTUFBTTtRQUU5QyxPQUFPO1lBQUVaLFFBQVFoQyxhQUFhTSxPQUFPO1lBQUV5QjtRQUFLO0lBQzlDOzthQXRVaUIwQixRQUFRQyxrQkFBeUI7O0FBeVVwRDtBQUVBLDRCQUE0QjtBQUNyQixNQUFNQyxnQkFBZ0IsSUFBSWpFLHVCQUF1QiIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3Rvb2xzL2FkZC9hZGRfaGVscGVycy9Db2RlR2VuZXJhdG9yTkVXLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFJQ2xpZW50U2VydmljZSwgdHlwZSBBSU1lc3NhZ2UgfSBmcm9tIFwifi9zZXJ2ZXIvc2VydmljZXMvYWkvYWlDbGllbnQuc2VydmljZVwiO1xuaW1wb3J0IHsgZ2V0TW9kZWwgfSBmcm9tIFwifi9jb25maWcvbW9kZWxzLmNvbmZpZ1wiO1xuaW1wb3J0IHsgZ2V0UGFyYW1ldGVyaXplZFByb21wdCB9IGZyb20gXCJ+L2NvbmZpZy9wcm9tcHRzLmNvbmZpZ1wiO1xuaW1wb3J0IHsgZXh0cmFjdER1cmF0aW9uRnJvbUNvZGUsIGFuYWx5emVEdXJhdGlvbiB9IGZyb20gXCJ+L2xpYi91dGlscy9jb2RlRHVyYXRpb25FeHRyYWN0b3JcIjtcbmltcG9ydCB0eXBlIHsgQ29kZUdlbmVyYXRpb25JbnB1dCwgQ29kZUdlbmVyYXRpb25PdXRwdXQsIEltYWdlVG9Db2RlSW5wdXQgfSBmcm9tIFwifi90b29scy9oZWxwZXJzL3R5cGVzXCI7XG5cbi8qKlxuICogQ29kZSBHZW5lcmF0b3IgU2VydmljZSAtIGNvbnZlcnRzIEpTT04gc3BlY2lmaWNhdGlvbnMgdG8gUmVhY3QvUmVtb3Rpb24gY29kZVxuICogU2Vjb25kIHN0ZXAgb2YgdGhlIHR3by1zdGVwIHBpcGVsaW5lOiBKU09OIFNwZWMg4oaSIFJlYWN0IENvZGVcbiAqL1xuZXhwb3J0IGNsYXNzIENvZGVHZW5lcmF0b3JTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBERUJVRyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb2RlIGRpcmVjdGx5IGZyb20gcHJvbXB0IChGQVNURVNUIFBBVEggLSBubyBsYXlvdXQpXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZUNvZGVEaXJlY3QoaW5wdXQ6IHtcbiAgICB1c2VyUHJvbXB0OiBzdHJpbmc7XG4gICAgZnVuY3Rpb25OYW1lOiBzdHJpbmc7XG4gICAgcHJvamVjdElkOiBzdHJpbmc7XG4gIH0pOiBQcm9taXNlPENvZGVHZW5lcmF0aW9uT3V0cHV0PiB7XG4gICAgY29uc3QgY29uZmlnID0gZ2V0TW9kZWwoJ2NvZGVHZW5lcmF0b3InKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygn4pqhIFtDT0RFIEdFTkVSQVRPUl0gRElSRUNUIFBBVEg6IEdlbmVyYXRpbmcgY29kZSBmcm9tIHByb21wdCBvbmx5Jyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGdldFBhcmFtZXRlcml6ZWRQcm9tcHQoJ0NPREVfR0VORVJBVE9SJywge1xuICAgICAgICBGVU5DVElPTl9OQU1FOiBpbnB1dC5mdW5jdGlvbk5hbWVcbiAgICAgIH0pO1xuICAgICAgY29uc3QgdXNlclByb21wdCA9IGBVU0VSIFJFUVVFU1Q6IFwiJHtpbnB1dC51c2VyUHJvbXB0fVwiXG5cbkZVTkNUSU9OIE5BTUU6ICR7aW5wdXQuZnVuY3Rpb25OYW1lfVxuXG5HZW5lcmF0ZSBhIGNvbXBsZXRlIFJlbW90aW9uIGNvbXBvbmVudCBiYXNlZCBvbiB0aGUgdXNlcidzIHJlcXVlc3QuXG4tIENyZWF0ZSBlbmdhZ2luZyBtb3Rpb24gZ3JhcGhpY3Ncbi0gVXNlIG1vZGVybiBhbmltYXRpb25zIHdpdGggRnJhbWVyIE1vdGlvblxuLSBFbnN1cmUgaXQncyBhIGNvbXBsZXRlLCBzZWxmLWNvbnRhaW5lZCBjb21wb25lbnRcbi0gRGVmYXVsdCBkdXJhdGlvbjogNSBzZWNvbmRzICgxNTAgZnJhbWVzIGF0IDMwZnBzKWA7XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW1xuICAgICAgICB7IHJvbGU6ICd1c2VyJyBhcyBjb25zdCwgY29udGVudDogdXNlclByb21wdCB9XG4gICAgICBdO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEFJQ2xpZW50U2VydmljZS5nZW5lcmF0ZVJlc3BvbnNlKFxuICAgICAgICBjb25maWcsXG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQuY29udGVudCB9XG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zdCByYXdPdXRwdXQgPSByZXNwb25zZT8uY29udGVudDtcbiAgICAgIGlmICghcmF3T3V0cHV0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHJlc3BvbnNlIGZyb20gQ29kZUdlbmVyYXRvciBMTE1cIik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENsZWFuIGFuZCBwcm9jZXNzIGNvZGVcbiAgICAgIGxldCBjbGVhbkNvZGUgPSByYXdPdXRwdXQudHJpbSgpO1xuICAgICAgY2xlYW5Db2RlID0gY2xlYW5Db2RlLnJlcGxhY2UoL15gYGAoPzpqYXZhc2NyaXB0fHRzeHx0c3xqcyk/XFxuPy9pLCAnJykucmVwbGFjZSgvXFxuP2BgYCQvaSwgJycpO1xuICAgICAgXG4gICAgICAvLyBFeHRyYWN0IGR1cmF0aW9uXG4gICAgICBjb25zdCBkdXJhdGlvbkFuYWx5c2lzID0gYW5hbHl6ZUR1cmF0aW9uKGNsZWFuQ29kZSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvZGU6IGNsZWFuQ29kZSxcbiAgICAgICAgbmFtZTogXCJTY2VuZVwiLCAvLyBTaW1wbGUgZGlzcGxheSBuYW1lLCBVSSB3aWxsIHNob3cgcG9zaXRpb24tYmFzZWQgbnVtYmVyaW5nXG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbkFuYWx5c2lzLmZyYW1lcyxcbiAgICAgICAgcmVhc29uaW5nOiBgR2VuZXJhdGVkIHNjZW5lIGRpcmVjdGx5IGZyb20gcHJvbXB0ICgke2R1cmF0aW9uQW5hbHlzaXMuZnJhbWVzfSBmcmFtZXMpYCxcbiAgICAgICAgZGVidWc6IHtcbiAgICAgICAgICBtZXRob2Q6ICdkaXJlY3QnLFxuICAgICAgICAgIHByb21wdExlbmd0aDogdXNlclByb21wdC5sZW5ndGgsXG4gICAgICAgICAgcmVzcG9uc2VMZW5ndGg6IHJhd091dHB1dC5sZW5ndGgsXG4gICAgICAgICAgZHVyYXRpb25BbmFseXNpc1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ09ERSBHRU5FUkFUT1JdIERpcmVjdCBwYXRoIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29kZSB1c2luZyBwcmV2aW91cyBzY2VuZSBhcyByZWZlcmVuY2UgKEZBU1QgUEFUSClcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlQ29kZVdpdGhSZWZlcmVuY2UoaW5wdXQ6IHtcbiAgICB1c2VyUHJvbXB0OiBzdHJpbmc7XG4gICAgZnVuY3Rpb25OYW1lOiBzdHJpbmc7XG4gICAgcHJvamVjdElkOiBzdHJpbmc7XG4gICAgcHJldmlvdXNTY2VuZUNvZGU6IHN0cmluZztcbiAgfSk6IFByb21pc2U8Q29kZUdlbmVyYXRpb25PdXRwdXQ+IHtcbiAgICBjb25zdCBjb25maWcgPSBnZXRNb2RlbCgnY29kZUdlbmVyYXRvcicpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5qAIFtDT0RFIEdFTkVSQVRPUl0gRkFTVCBQQVRIOiBVc2luZyBwcmV2aW91cyBzY2VuZSBhcyByZWZlcmVuY2UnKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gZ2V0UGFyYW1ldGVyaXplZFByb21wdCgnQ09ERV9HRU5FUkFUT1InLCB7XG4gICAgICAgIEZVTkNUSU9OX05BTUU6IGlucHV0LmZ1bmN0aW9uTmFtZVxuICAgICAgfSk7XG4gICAgICBjb25zdCB1c2VyUHJvbXB0ID0gYFBSRVZJT1VTIFNDRU5FIENPREU6XG5cXGBcXGBcXGB0c3hcbiR7aW5wdXQucHJldmlvdXNTY2VuZUNvZGV9XG5cXGBcXGBcXGBcblxuVVNFUiBSRVFVRVNUOiBcIiR7aW5wdXQudXNlclByb21wdH1cIlxuXG5GVU5DVElPTiBOQU1FOiAke2lucHV0LmZ1bmN0aW9uTmFtZX1cblxuR2VuZXJhdGUgYSBORVcgc2NlbmUgYmFzZWQgb24gdGhlIHVzZXIncyByZXF1ZXN0LCB1c2luZyB0aGUgcHJldmlvdXMgc2NlbmUncyBjb2RlIGFzIGEgc3R5bGUgcmVmZXJlbmNlLiBcbi0gS2VlcCB0aGUgc2FtZSB2aXN1YWwgc3R5bGUsIGNvbG9ycywgZm9udHMsIGFuZCBhbmltYXRpb24gcGF0dGVybnNcbi0gQ3JlYXRlIE5FVyBjb250ZW50IGJhc2VkIG9uIHRoZSB1c2VyJ3MgcmVxdWVzdFxuLSBFbnN1cmUgaXQncyBhIGNvbXBsZXRlLCBzZWxmLWNvbnRhaW5lZCBSZW1vdGlvbiBjb21wb25lbnRgO1xuXG4gICAgICBjb25zdCBtZXNzYWdlcyA9IFtcbiAgICAgICAgeyByb2xlOiAndXNlcicgYXMgY29uc3QsIGNvbnRlbnQ6IHVzZXJQcm9tcHQgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBBSUNsaWVudFNlcnZpY2UuZ2VuZXJhdGVSZXNwb25zZShcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3lzdGVtUHJvbXB0LmNvbnRlbnQgfVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmF3T3V0cHV0ID0gcmVzcG9uc2U/LmNvbnRlbnQ7XG4gICAgICBpZiAoIXJhd091dHB1dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyByZXNwb25zZSBmcm9tIENvZGVHZW5lcmF0b3IgTExNXCIpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDbGVhbiBhbmQgcHJvY2VzcyBjb2RlXG4gICAgICBsZXQgY2xlYW5Db2RlID0gcmF3T3V0cHV0LnRyaW0oKTtcbiAgICAgIGNsZWFuQ29kZSA9IGNsZWFuQ29kZS5yZXBsYWNlKC9eYGBgKD86amF2YXNjcmlwdHx0c3h8dHN8anMpP1xcbj8vaSwgJycpLnJlcGxhY2UoL1xcbj9gYGAkL2ksICcnKTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCBkdXJhdGlvblxuICAgICAgY29uc3QgZHVyYXRpb25BbmFseXNpcyA9IGFuYWx5emVEdXJhdGlvbihjbGVhbkNvZGUpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb2RlOiBjbGVhbkNvZGUsXG4gICAgICAgIG5hbWU6IFwiU2NlbmVcIiwgLy8gU2ltcGxlIGRpc3BsYXkgbmFtZSwgVUkgd2lsbCBzaG93IHBvc2l0aW9uLWJhc2VkIG51bWJlcmluZ1xuICAgICAgICBkdXJhdGlvbjogZHVyYXRpb25BbmFseXNpcy5mcmFtZXMsXG4gICAgICAgIHJlYXNvbmluZzogYEdlbmVyYXRlZCBuZXcgc2NlbmUgdXNpbmcgcHJldmlvdXMgc2NlbmUgc3R5bGUgKCR7ZHVyYXRpb25BbmFseXNpcy5mcmFtZXN9IGZyYW1lcylgLFxuICAgICAgICBkZWJ1Zzoge1xuICAgICAgICAgIG1ldGhvZDogJ3dpdGhSZWZlcmVuY2UnLFxuICAgICAgICAgIHByb21wdExlbmd0aDogdXNlclByb21wdC5sZW5ndGgsXG4gICAgICAgICAgcmVzcG9uc2VMZW5ndGg6IHJhd091dHB1dC5sZW5ndGgsXG4gICAgICAgICAgZHVyYXRpb25BbmFseXNpc1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ09ERSBHRU5FUkFUT1JdIEZhc3QgcGF0aCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIFJlYWN0IGNvZGUgZnJvbSBsYXlvdXQgSlNPTlxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVDb2RlKGlucHV0OiBDb2RlR2VuZXJhdGlvbklucHV0KTogUHJvbWlzZTxDb2RlR2VuZXJhdGlvbk91dHB1dD4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IGdldE1vZGVsKCdjb2RlR2VuZXJhdG9yJyk7XG4gICAgY29uc3QgcHJvbXB0ID0gdGhpcy5idWlsZENvZGVQcm9tcHQoaW5wdXQpO1xuXG4gICAgY29uc29sZS5sb2coJz09PT09PT09PT09PT09PT09PT09IGNvZGVHZW5lcmF0b3IgcmVhY2hlZDonKTtcbiAgICBjb25zb2xlLmxvZygnPT09PT09PT09PT09PT09PT09PT0gZ2VuZXJhdGVDb2RlIHJlYWNoZWQ6Jyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW1xuICAgICAgICB7IHJvbGU6ICd1c2VyJyBhcyBjb25zdCwgY29udGVudDogcHJvbXB0LnVzZXIgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBBSUNsaWVudFNlcnZpY2UuZ2VuZXJhdGVSZXNwb25zZShcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogcHJvbXB0LnN5c3RlbSB9XG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zdCByYXdPdXRwdXQgPSByZXNwb25zZT8uY29udGVudDtcbiAgICAgIGlmICghcmF3T3V0cHV0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHJlc3BvbnNlIGZyb20gQ29kZUdlbmVyYXRvciBMTE1cIik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFJlbW92ZSBtYXJrZG93biBjb2RlIGZlbmNlcyBpZiBwcmVzZW50XG4gICAgICBsZXQgY2xlYW5Db2RlID0gcmF3T3V0cHV0LnRyaW0oKTtcbiAgICAgIGNsZWFuQ29kZSA9IGNsZWFuQ29kZS5yZXBsYWNlKC9eYGBgKD86amF2YXNjcmlwdHx0c3h8dHN8anMpP1xcbj8vaSwgJycpLnJlcGxhY2UoL1xcbj9gYGAkL2ksICcnKTtcbiAgICAgIFxuICAgICAgLy8gRW5zdXJlIHNpbmdsZSBleHBvcnQgZGVmYXVsdCBvbmx5XG4gICAgICBpZiAoY2xlYW5Db2RlLmluY2x1ZGVzKCdleHBvcnQgZGVmYXVsdCBmdW5jdGlvbicpICYmIGNsZWFuQ29kZS5pbmNsdWRlcygnZnVuY3Rpb24gU2luZ2xlU2NlbmVDb21wb3NpdGlvbicpKSB7XG4gICAgICAgIGNvbnN0IHNjZW5lTWF0Y2ggPSBjbGVhbkNvZGUubWF0Y2goL2NvbnN0IFxce1tefV0rXFx9ID0gd2luZG93XFwuUmVtb3Rpb247W1xcc1xcU10qP2V4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFxcdytcXChcXClbXntdKlxce1tcXHNcXFNdKj9cXG5cXH0vKTtcbiAgICAgICAgaWYgKHNjZW5lTWF0Y2gpIHtcbiAgICAgICAgICBjbGVhbkNvZGUgPSBzY2VuZU1hdGNoWzBdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEV4dHJhY3QgYWN0dWFsIGR1cmF0aW9uIGZyb20gZ2VuZXJhdGVkIGNvZGVcbiAgICAgIGNvbnN0IGR1cmF0aW9uQW5hbHlzaXMgPSBhbmFseXplRHVyYXRpb24oY2xlYW5Db2RlKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29kZTogY2xlYW5Db2RlLFxuICAgICAgICBuYW1lOiBcIlNjZW5lXCIsIC8vIFNpbXBsZSBkaXNwbGF5IG5hbWUsIFVJIHdpbGwgc2hvdyBwb3NpdGlvbi1iYXNlZCBudW1iZXJpbmdcbiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uQW5hbHlzaXMuZnJhbWVzLFxuICAgICAgICByZWFzb25pbmc6IGBDb2RlIGdlbmVyYXRlZCB3aXRoICR7ZHVyYXRpb25BbmFseXNpcy5mcmFtZXN9IGZyYW1lcyBkdXJhdGlvbiAoJHtkdXJhdGlvbkFuYWx5c2lzLmNvbmZpZGVuY2V9IGNvbmZpZGVuY2UgZnJvbSAke2R1cmF0aW9uQW5hbHlzaXMuc291cmNlfSlgLFxuICAgICAgICBkZWJ1Zzoge1xuICAgICAgICAgIHByb21wdCxcbiAgICAgICAgICByZXNwb25zZTogcmF3T3V0cHV0LFxuICAgICAgICAgIHBhcnNlZDogeyBcbiAgICAgICAgICAgIGNvZGU6IGNsZWFuQ29kZSwgXG4gICAgICAgICAgICB2YWxpZGF0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgZHVyYXRpb25BbmFseXNpcyBcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gUmV0dXJuIGVycm9yIGNvZGUgdGhhdCBhdXRvLWZpeCBjYW4gd29yayB3aXRoXG4gICAgICBjb25zdCBlcnJvckNvZGUgPSBgY29uc3QgeyBBYnNvbHV0ZUZpbGwgfSA9IHdpbmRvdy5SZW1vdGlvbjtcbi8vIENvZGVHZW5lcmF0b3IgZXJyb3I6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9XG4vLyBMYXlvdXQgSlNPTiB3YXM6ICR7SlNPTi5zdHJpbmdpZnkoaW5wdXQubGF5b3V0SnNvbiwgbnVsbCwgMil9XG4vLyBVc2VyIHdhbnRlZDogJHtpbnB1dC51c2VyUHJvbXB0fVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAke2lucHV0LmZ1bmN0aW9uTmFtZX0oKSB7XG4gIHJldHVybiAoXG4gICAgPEFic29sdXRlRmlsbCBzdHlsZT17eyBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmMDAwMFwiIH19PlxuICAgICAgPGRpdj5Db2RlR2VuZXJhdG9yIEVycm9yIC0gQXV0byBGaXggQXZhaWxhYmxlPC9kaXY+XG4gICAgPC9BYnNvbHV0ZUZpbGw+XG4gICk7XG59YDtcblxuICAgICAgY29uc3QgZmFsbGJhY2tEdXJhdGlvbiA9IGV4dHJhY3REdXJhdGlvbkZyb21Db2RlKGVycm9yQ29kZSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvZGU6IGVycm9yQ29kZSxcbiAgICAgICAgbmFtZTogXCJTY2VuZVwiLCAvLyBTaW1wbGUgZGlzcGxheSBuYW1lLCBVSSB3aWxsIHNob3cgcG9zaXRpb24tYmFzZWQgbnVtYmVyaW5nXG4gICAgICAgIGR1cmF0aW9uOiBmYWxsYmFja0R1cmF0aW9uLFxuICAgICAgICByZWFzb25pbmc6IFwiQ29kZUdlbmVyYXRvciBlbmNvdW50ZXJlZCBhbiBlcnJvciAtIGF1dG8tZml4IGNhbiByZXN0b3JlIGZyb20gbGF5b3V0IEpTT05cIixcbiAgICAgICAgZGVidWc6IHsgXG4gICAgICAgICAgZXJyb3I6IGAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfS4gRmFsbGJhY2sgZHVyYXRpb246ICR7ZmFsbGJhY2tEdXJhdGlvbn0gZnJhbWVzLiBMYXlvdXQ6ICR7SlNPTi5zdHJpbmdpZnkoaW5wdXQubGF5b3V0SnNvbiwgbnVsbCwgMil9LiBVc2VyIHByb21wdDogJHtpbnB1dC51c2VyUHJvbXB0fWBcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29kZSBkaXJlY3RseSBmcm9tIGltYWdlc1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVDb2RlRnJvbUltYWdlKGlucHV0OiBJbWFnZVRvQ29kZUlucHV0KTogUHJvbWlzZTxDb2RlR2VuZXJhdGlvbk91dHB1dD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25maWcgPSBnZXRNb2RlbCgnY29kZUdlbmVyYXRvcicpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PT09PT09PT09PT0gY29kZUdlbmVyYXRvciByZWFjaGVkOicpO1xuICAgICAgY29uc29sZS5sb2coJz09PT09PT09PT09PT09PT09PT09IGdlbmVyYXRlQ29kZUZyb21JbWFnZSByZWFjaGVkOicpO1xuICAgICAgXG4gICAgICAvLyBHZXQgdGhlIElNQUdFX0NPREVfR0VORVJBVE9SIHByb21wdCBzcGVjaWZpY2FsbHkgZm9yIGltYWdlLWJhc2VkIGdlbmVyYXRpb25cbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGdldFBhcmFtZXRlcml6ZWRQcm9tcHQoJ0NPREVfR0VORVJBVE9SJywge1xuICAgICAgICBGVU5DVElPTl9OQU1FOiBpbnB1dC5mdW5jdGlvbk5hbWVcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBCdWlsZCB1c2VyIG1lc3NhZ2UgZm9yIHZpc2lvbiBBUEkgLSBpbmNsdWRlIHRoZSBhY3R1YWwgdXNlciBwcm9tcHQhXG4gICAgICBjb25zdCB1c2VyUHJvbXB0ID0gYFVTRVIgUkVRVUVTVDogXCIke2lucHV0LnVzZXJQcm9tcHR9XCJcblxuSU1QT1JUQU5UOiBSZWNyZWF0ZSB0aGUgVUkvbGF5b3V0IHNob3duIGluIHRoZSBpbWFnZSBhcyBhY2N1cmF0ZWx5IGFzIHBvc3NpYmxlLiBNYXRjaCBjb2xvcnMsIHRleHQsIHBvc2l0aW9uaW5nLCBhbmQgdmlzdWFsIGhpZXJhcmNoeSBleGFjdGx5LiBUaGVuIGFkZCBhcHByb3ByaWF0ZSBhbmltYXRpb25zIGJhc2VkIG9uIHRoZSB1c2VyJ3MgcmVxdWVzdC5cbiR7aW5wdXQudmlzaW9uQW5hbHlzaXMgPyBgVmlzaW9uIGFuYWx5c2lzOiAke0pTT04uc3RyaW5naWZ5KGlucHV0LnZpc2lvbkFuYWx5c2lzLCBudWxsLCAyKX1gIDogJyd9YDtcbiAgICAgIFxuICAgICAgLy8gVXNlIGNlbnRyYWxpemVkIHZpc2lvbiBBUEkgd2l0aCBwcm9wZXIgbWVzc2FnZSBmb3JtYXRcbiAgICAgIGNvbnN0IHZpc2lvbk1lc3NhZ2VzQ29udGVudDogQUlNZXNzYWdlWydjb250ZW50J10gPSBbXG4gICAgICAgIHsgdHlwZTogJ3RleHQnLCB0ZXh0OiB1c2VyUHJvbXB0IH1cbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdXJsIG9mIGlucHV0LmltYWdlVXJscykge1xuICAgICAgICB2aXNpb25NZXNzYWdlc0NvbnRlbnQucHVzaCh7IFxuICAgICAgICAgIHR5cGU6ICdpbWFnZV91cmwnLCBcbiAgICAgICAgICBpbWFnZV91cmw6IHsgdXJsIH0gXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEFJQ2xpZW50U2VydmljZS5nZW5lcmF0ZVJlc3BvbnNlKFxuICAgICAgICBjb25maWcsXG4gICAgICAgIFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogdmlzaW9uTWVzc2FnZXNDb250ZW50IH1dLFxuICAgICAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQuY29udGVudCB9XG4gICAgICApO1xuXG4gICAgICAvLyBDbGVhbiB1cCBjb2RlXG4gICAgICBsZXQgY2xlYW5Db2RlID0gcmVzcG9uc2U/LmNvbnRlbnQ/LnRyaW0oKSB8fCAnJztcbiAgICAgIGNsZWFuQ29kZSA9IGNsZWFuQ29kZS5yZXBsYWNlKC9eYGBgKD86amF2YXNjcmlwdHx0c3h8dHN8anMpP1xcbj8vaSwgJycpLnJlcGxhY2UoL1xcbj9gYGAkL2ksICcnKTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCBkdXJhdGlvbiBmcm9tIGltYWdlLWdlbmVyYXRlZCBjb2RlXG4gICAgICBjb25zdCBkdXJhdGlvbkFuYWx5c2lzID0gYW5hbHl6ZUR1cmF0aW9uKGNsZWFuQ29kZSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvZGU6IGNsZWFuQ29kZSxcbiAgICAgICAgbmFtZTogXCJTY2VuZVwiLCAvLyBTaW1wbGUgZGlzcGxheSBuYW1lLCBVSSB3aWxsIHNob3cgcG9zaXRpb24tYmFzZWQgbnVtYmVyaW5nXG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbkFuYWx5c2lzLmZyYW1lcyxcbiAgICAgICAgcmVhc29uaW5nOiBgR2VuZXJhdGVkIG1vdGlvbiBncmFwaGljcyBkaXJlY3RseSBmcm9tIGltYWdlIGFuYWx5c2lzIHdpdGggJHtkdXJhdGlvbkFuYWx5c2lzLmZyYW1lc30gZnJhbWVzIGR1cmF0aW9uYCxcbiAgICAgICAgZGVidWc6IHtcbiAgICAgICAgICBwcm9tcHQ6IHsgc3lzdGVtOiAnVmlzaW9uLWJhc2VkIGdlbmVyYXRpb24nLCB1c2VyOiBgJHtpbnB1dC5pbWFnZVVybHMubGVuZ3RofSBpbWFnZXMgcHJvdmlkZWRgIH0sXG4gICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlPy5jb250ZW50IHx8ICcnLFxuICAgICAgICAgIHBhcnNlZDogeyBjb2RlOiBjbGVhbkNvZGUsIGltYWdlQ291bnQ6IGlucHV0LmltYWdlVXJscy5sZW5ndGgsIGR1cmF0aW9uQW5hbHlzaXMgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yQ29kZSA9IGBjb25zdCB7IEFic29sdXRlRmlsbCB9ID0gd2luZG93LlJlbW90aW9uO1xuLy8gSW1hZ2UtdG8tY29kZSBnZW5lcmF0aW9uIGVycm9yOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfVxuLy8gVXNlciB3YW50ZWQ6ICR7aW5wdXQudXNlclByb21wdH1cbi8vIEltYWdlcyBwcm92aWRlZDogJHtpbnB1dC5pbWFnZVVybHMubGVuZ3RofVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAke2lucHV0LmZ1bmN0aW9uTmFtZX0oKSB7XG4gIHJldHVybiAoXG4gICAgPEFic29sdXRlRmlsbCBzdHlsZT17eyBiYWNrZ3JvdW5kQ29sb3I6IFwiIzFhMWEyZVwiLCBkaXNwbGF5OiBcImZsZXhcIiwgYWxpZ25JdGVtczogXCJjZW50ZXJcIiwganVzdGlmeUNvbnRlbnQ6IFwiY2VudGVyXCIgfX0+XG4gICAgICA8ZGl2IHN0eWxlPXt7IGNvbG9yOiBcIiNmZmZmZmZcIiwgZm9udFNpemU6IFwiMnJlbVwiLCB0ZXh0QWxpZ246IFwiY2VudGVyXCIgfX0+XG4gICAgICAgIDxkaXY+SW1hZ2UgQW5hbHlzaXMgRXJyb3I8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogXCIxcmVtXCIsIG9wYWNpdHk6IDAuNywgbWFyZ2luVG9wOiBcIjFyZW1cIiB9fT5BdXRvLWZpeCBhdmFpbGFibGU8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvQWJzb2x1dGVGaWxsPlxuICApO1xufWA7XG5cbiAgICAgIGNvbnN0IGZhbGxiYWNrRHVyYXRpb24gPSBleHRyYWN0RHVyYXRpb25Gcm9tQ29kZShlcnJvckNvZGUpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb2RlOiBlcnJvckNvZGUsXG4gICAgICAgIG5hbWU6IFwiU2NlbmVcIiwgLy8gU2ltcGxlIGRpc3BsYXkgbmFtZSwgVUkgd2lsbCBzaG93IHBvc2l0aW9uLWJhc2VkIG51bWJlcmluZ1xuICAgICAgICBkdXJhdGlvbjogZmFsbGJhY2tEdXJhdGlvbixcbiAgICAgICAgcmVhc29uaW5nOiBcIkltYWdlLXRvLWNvZGUgZ2VuZXJhdGlvbiBmYWlsZWQgLSBhdXRvLWZpeCBhdmFpbGFibGVcIixcbiAgICAgICAgZGVidWc6IHsgXG4gICAgICAgICAgZXJyb3I6IGAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfS4gRmFsbGJhY2sgZHVyYXRpb246ICR7ZmFsbGJhY2tEdXJhdGlvbn0gZnJhbWVzLiBJbWFnZXM6ICR7aW5wdXQuaW1hZ2VVcmxzLmxlbmd0aH0uIFVzZXIgcHJvbXB0OiAke2lucHV0LnVzZXJQcm9tcHR9YFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRDb2RlUHJvbXB0KGlucHV0OiBDb2RlR2VuZXJhdGlvbklucHV0KTogeyBzeXN0ZW06IHN0cmluZzsgdXNlcjogc3RyaW5nIH0ge1xuICAgIGNvbnN0IHsgbGF5b3V0SnNvbiwgdXNlclByb21wdCwgZnVuY3Rpb25OYW1lIH0gPSBpbnB1dDtcblxuICAgIGNvbnNvbGUubG9nKCc9PT09PT09PT09PT09PT09PT09PSBjb2RlR2VuZXJhdG9yIHJlYWNoZWQ6Jyk7XG4gICAgY29uc29sZS5sb2coJz09PT09PT09PT09PT09PT09PT09IGJ1aWxkQ29kZVByb21wdCByZWFjaGVkOicpO1xuICAgIFxuICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGdldFBhcmFtZXRlcml6ZWRQcm9tcHQoJ0NPREVfR0VORVJBVE9SJywge1xuICAgICAgRlVOQ1RJT05fTkFNRTogZnVuY3Rpb25OYW1lLFxuICAgICAgVVNFUl9QUk9NUFQ6IHVzZXJQcm9tcHQsXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgdXNlciA9IEpTT04uc3RyaW5naWZ5KGxheW91dEpzb24sIG51bGwsIDIpO1xuICAgIFxuICAgIHJldHVybiB7IHN5c3RlbTogc3lzdGVtUHJvbXB0LmNvbnRlbnQsIHVzZXIgfTtcbiAgfVxuXG4gIC8vIFJlbW92ZWQgYnVpbGRJbWFnZVRvQ29kZVByb21wdCAtIG5vdyB1c2luZyBjZW50cmFsaXplZCBJTUFHRV9DT0RFX0dFTkVSQVRPUiBwcm9tcHRcbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGNvZGVHZW5lcmF0b3IgPSBuZXcgQ29kZUdlbmVyYXRvclNlcnZpY2UoKTtcbiJdLCJuYW1lcyI6WyJBSUNsaWVudFNlcnZpY2UiLCJnZXRNb2RlbCIsImdldFBhcmFtZXRlcml6ZWRQcm9tcHQiLCJleHRyYWN0RHVyYXRpb25Gcm9tQ29kZSIsImFuYWx5emVEdXJhdGlvbiIsIkNvZGVHZW5lcmF0b3JTZXJ2aWNlIiwiZ2VuZXJhdGVDb2RlRGlyZWN0IiwiaW5wdXQiLCJjb25maWciLCJjb25zb2xlIiwibG9nIiwic3lzdGVtUHJvbXB0IiwiRlVOQ1RJT05fTkFNRSIsImZ1bmN0aW9uTmFtZSIsInVzZXJQcm9tcHQiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwicmVzcG9uc2UiLCJnZW5lcmF0ZVJlc3BvbnNlIiwicmF3T3V0cHV0IiwiRXJyb3IiLCJjbGVhbkNvZGUiLCJ0cmltIiwicmVwbGFjZSIsImR1cmF0aW9uQW5hbHlzaXMiLCJjb2RlIiwibmFtZSIsImR1cmF0aW9uIiwiZnJhbWVzIiwicmVhc29uaW5nIiwiZGVidWciLCJtZXRob2QiLCJwcm9tcHRMZW5ndGgiLCJsZW5ndGgiLCJyZXNwb25zZUxlbmd0aCIsImVycm9yIiwiZ2VuZXJhdGVDb2RlV2l0aFJlZmVyZW5jZSIsInByZXZpb3VzU2NlbmVDb2RlIiwiZ2VuZXJhdGVDb2RlIiwicHJvbXB0IiwiYnVpbGRDb2RlUHJvbXB0IiwidXNlciIsInN5c3RlbSIsImluY2x1ZGVzIiwic2NlbmVNYXRjaCIsIm1hdGNoIiwiY29uZmlkZW5jZSIsInNvdXJjZSIsInBhcnNlZCIsInZhbGlkYXRlZCIsImVycm9yQ29kZSIsIm1lc3NhZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwibGF5b3V0SnNvbiIsImZhbGxiYWNrRHVyYXRpb24iLCJnZW5lcmF0ZUNvZGVGcm9tSW1hZ2UiLCJ2aXNpb25BbmFseXNpcyIsInZpc2lvbk1lc3NhZ2VzQ29udGVudCIsInR5cGUiLCJ0ZXh0IiwidXJsIiwiaW1hZ2VVcmxzIiwicHVzaCIsImltYWdlX3VybCIsImltYWdlQ291bnQiLCJVU0VSX1BST01QVCIsIkRFQlVHIiwicHJvY2VzcyIsImNvZGVHZW5lcmF0b3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/add/add_helpers/CodeGeneratorNEW.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/delete/delete.ts":
/*!************************************!*\
  !*** ./src/tools/delete/delete.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DeleteTool: () => (/* binding */ DeleteTool),\n/* harmony export */   deleteTool: () => (/* binding */ deleteTool)\n/* harmony export */ });\n/* harmony import */ var _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/tools/helpers/base */ \"(rsc)/./src/tools/helpers/base.ts\");\n/* harmony import */ var _tools_helpers_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/tools/helpers/types */ \"(rsc)/./src/tools/helpers/types.ts\");\n\n\n/**\n * DELETE Tool - Pure function that validates deletion\n * NO DATABASE ACCESS - only returns deletion confirmation\n * Sprint 42: Refactored to pure function\n */ class DeleteTool extends _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__.BaseMCPTool {\n    async execute(input) {\n        try {\n            // Validate deletion request\n            if (!input.sceneId) {\n                throw new Error(\"No scene ID provided for deletion\");\n            }\n            if (!input.confirmDeletion) {\n                return {\n                    success: false,\n                    reasoning: \"Deletion not confirmed by user\",\n                    chatResponse: \"Please confirm you want to delete this scene\"\n                };\n            }\n            // Return deletion confirmation - NO DATABASE!\n            return {\n                success: true,\n                deletedSceneId: input.sceneId,\n                reasoning: `Scene ${input.sceneId} marked for deletion`,\n                chatResponse: \"I'll remove that scene for you\"\n            };\n        } catch (error) {\n            return {\n                success: false,\n                reasoning: `Delete validation failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                error: error instanceof Error ? error.message : 'Unknown error'\n            };\n        }\n    }\n    constructor(...args){\n        super(...args), this.name = \"DELETE\", this.description = \"Validate scene deletion request\", this.inputSchema = _tools_helpers_types__WEBPACK_IMPORTED_MODULE_1__.deleteToolInputSchema;\n    }\n}\n// Export singleton instance\nconst deleteTool = new DeleteTool();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvdG9vbHMvZGVsZXRlL2RlbGV0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQW1EO0FBRVc7QUFFOUQ7Ozs7Q0FJQyxHQUNNLE1BQU1FLG1CQUFtQkYsNERBQVdBO0lBS3pDLE1BQWdCRyxRQUFRQyxLQUFzQixFQUE2QjtRQUN6RSxJQUFJO1lBQ0YsNEJBQTRCO1lBQzVCLElBQUksQ0FBQ0EsTUFBTUMsT0FBTyxFQUFFO2dCQUNsQixNQUFNLElBQUlDLE1BQU07WUFDbEI7WUFFQSxJQUFJLENBQUNGLE1BQU1HLGVBQWUsRUFBRTtnQkFDMUIsT0FBTztvQkFDTEMsU0FBUztvQkFDVEMsV0FBVztvQkFDWEMsY0FBYztnQkFDaEI7WUFDRjtZQUVBLDhDQUE4QztZQUM5QyxPQUFPO2dCQUNMRixTQUFTO2dCQUNURyxnQkFBZ0JQLE1BQU1DLE9BQU87Z0JBQzdCSSxXQUFXLENBQUMsTUFBTSxFQUFFTCxNQUFNQyxPQUFPLENBQUMsb0JBQW9CLENBQUM7Z0JBQ3ZESyxjQUFjO1lBQ2hCO1FBQ0YsRUFBRSxPQUFPRSxPQUFPO1lBQ2QsT0FBTztnQkFDTEosU0FBUztnQkFDVEMsV0FBVyxDQUFDLDBCQUEwQixFQUFFRyxpQkFBaUJOLFFBQVFNLE1BQU1DLE9BQU8sR0FBRyxpQkFBaUI7Z0JBQ2xHRCxPQUFPQSxpQkFBaUJOLFFBQVFNLE1BQU1DLE9BQU8sR0FBRztZQUNsRDtRQUNGO0lBQ0Y7O1FBbENLLHFCQUNMQyxPQUFPLGVBQ1BDLGNBQWMsd0NBQ2RDLGNBQWNmLHVFQUFxQkE7O0FBZ0NyQztBQUVBLDRCQUE0QjtBQUNyQixNQUFNZ0IsYUFBYSxJQUFJZixhQUFhIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvdG9vbHMvZGVsZXRlL2RlbGV0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlTUNQVG9vbCB9IGZyb20gXCJ+L3Rvb2xzL2hlbHBlcnMvYmFzZVwiO1xuaW1wb3J0IHR5cGUgeyBEZWxldGVUb29sSW5wdXQsIERlbGV0ZVRvb2xPdXRwdXQgfSBmcm9tIFwifi90b29scy9oZWxwZXJzL3R5cGVzXCI7XG5pbXBvcnQgeyBkZWxldGVUb29sSW5wdXRTY2hlbWEgfSBmcm9tIFwifi90b29scy9oZWxwZXJzL3R5cGVzXCI7XG5cbi8qKlxuICogREVMRVRFIFRvb2wgLSBQdXJlIGZ1bmN0aW9uIHRoYXQgdmFsaWRhdGVzIGRlbGV0aW9uXG4gKiBOTyBEQVRBQkFTRSBBQ0NFU1MgLSBvbmx5IHJldHVybnMgZGVsZXRpb24gY29uZmlybWF0aW9uXG4gKiBTcHJpbnQgNDI6IFJlZmFjdG9yZWQgdG8gcHVyZSBmdW5jdGlvblxuICovXG5leHBvcnQgY2xhc3MgRGVsZXRlVG9vbCBleHRlbmRzIEJhc2VNQ1BUb29sPERlbGV0ZVRvb2xJbnB1dCwgRGVsZXRlVG9vbE91dHB1dD4ge1xuICBuYW1lID0gXCJERUxFVEVcIjtcbiAgZGVzY3JpcHRpb24gPSBcIlZhbGlkYXRlIHNjZW5lIGRlbGV0aW9uIHJlcXVlc3RcIjtcbiAgaW5wdXRTY2hlbWEgPSBkZWxldGVUb29sSW5wdXRTY2hlbWE7XG5cbiAgcHJvdGVjdGVkIGFzeW5jIGV4ZWN1dGUoaW5wdXQ6IERlbGV0ZVRvb2xJbnB1dCk6IFByb21pc2U8RGVsZXRlVG9vbE91dHB1dD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBWYWxpZGF0ZSBkZWxldGlvbiByZXF1ZXN0XG4gICAgICBpZiAoIWlucHV0LnNjZW5lSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gc2NlbmUgSUQgcHJvdmlkZWQgZm9yIGRlbGV0aW9uXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlucHV0LmNvbmZpcm1EZWxldGlvbikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIHJlYXNvbmluZzogXCJEZWxldGlvbiBub3QgY29uZmlybWVkIGJ5IHVzZXJcIixcbiAgICAgICAgICBjaGF0UmVzcG9uc2U6IFwiUGxlYXNlIGNvbmZpcm0geW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgc2NlbmVcIixcbiAgICAgICAgfSBhcyBEZWxldGVUb29sT3V0cHV0O1xuICAgICAgfVxuXG4gICAgICAvLyBSZXR1cm4gZGVsZXRpb24gY29uZmlybWF0aW9uIC0gTk8gREFUQUJBU0UhXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkZWxldGVkU2NlbmVJZDogaW5wdXQuc2NlbmVJZCxcbiAgICAgICAgcmVhc29uaW5nOiBgU2NlbmUgJHtpbnB1dC5zY2VuZUlkfSBtYXJrZWQgZm9yIGRlbGV0aW9uYCxcbiAgICAgICAgY2hhdFJlc3BvbnNlOiBcIkknbGwgcmVtb3ZlIHRoYXQgc2NlbmUgZm9yIHlvdVwiLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHJlYXNvbmluZzogYERlbGV0ZSB2YWxpZGF0aW9uIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9IGFzIERlbGV0ZVRvb2xPdXRwdXQ7XG4gICAgfVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBkZWxldGVUb29sID0gbmV3IERlbGV0ZVRvb2woKTtcbiJdLCJuYW1lcyI6WyJCYXNlTUNQVG9vbCIsImRlbGV0ZVRvb2xJbnB1dFNjaGVtYSIsIkRlbGV0ZVRvb2wiLCJleGVjdXRlIiwiaW5wdXQiLCJzY2VuZUlkIiwiRXJyb3IiLCJjb25maXJtRGVsZXRpb24iLCJzdWNjZXNzIiwicmVhc29uaW5nIiwiY2hhdFJlc3BvbnNlIiwiZGVsZXRlZFNjZW5lSWQiLCJlcnJvciIsIm1lc3NhZ2UiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJpbnB1dFNjaGVtYSIsImRlbGV0ZVRvb2wiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/delete/delete.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/edit/edit.ts":
/*!********************************!*\
  !*** ./src/tools/edit/edit.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EditTool: () => (/* binding */ EditTool),\n/* harmony export */   editTool: () => (/* binding */ editTool)\n/* harmony export */ });\n/* harmony import */ var _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/tools/helpers/base */ \"(rsc)/./src/tools/helpers/base.ts\");\n/* harmony import */ var _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/server/services/ai/aiClient.service */ \"(rsc)/./src/server/services/ai/aiClient.service.ts\");\n/* harmony import */ var _config_models_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ~/config/models.config */ \"(rsc)/./src/config/models.config.ts\");\n/* harmony import */ var _config_prompts_config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ~/config/prompts.config */ \"(rsc)/./src/config/prompts.config.ts\");\n/* harmony import */ var _tools_helpers_types__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ~/tools/helpers/types */ \"(rsc)/./src/tools/helpers/types.ts\");\n\n\n\n\n\n/**\n * EDIT Tool - Pure function that transforms scene content\n * NO DATABASE ACCESS - only transformation\n * Sprint 42: Refactored to pure function\n */ class EditTool extends _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__.BaseMCPTool {\n    async execute(input) {\n        try {\n            // Validate input\n            if (!input.tsxCode) {\n                throw new Error(\"No scene code provided\");\n            }\n            console.log(' [EDIT TOOL] Executing edit:', {\n                prompt: input.userPrompt,\n                hasErrorDetails: !!input.errorDetails,\n                codeLength: input.tsxCode.length\n            });\n            // Just edit the code - one unified approach\n            console.log(' [EDIT TOOL] Processing edit request');\n            return await this.performEdit(input);\n        } catch (error) {\n            console.error(' [EDIT TOOL] Error:', error);\n            return {\n                success: false,\n                reasoning: `Edit failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                error: error instanceof Error ? error.message : 'Unknown error'\n            };\n        }\n    }\n    async performEdit(input) {\n        try {\n            const functionName = this.extractFunctionName(input.tsxCode);\n            // Build context for the AI\n            let context = `USER REQUEST: \"${input.userPrompt}\"`;\n            if (input.errorDetails) {\n                context += `\\n\\nERROR TO FIX:\\n${input.errorDetails}`;\n            }\n            if (input.webContext) {\n                context += `\\n\\nWEBSITE BRAND CONTEXT:\n- URL: ${input.webContext.originalUrl}\n- Title: ${input.webContext.pageData.title}\n- Description: ${input.webContext.pageData.description || 'Not available'}\n- Key headings: ${input.webContext.pageData.headings.slice(0, 5).join(', ')}\n\nBRAND MATCHING INSTRUCTIONS:\n- Use the website screenshots to match the brand's visual identity\n- Extract and apply colors, fonts, and design patterns from the screenshots\n- Maintain brand consistency in your edits`;\n            }\n            if (input.imageUrls?.length) {\n                context += `\\n\\nIMAGE CONTEXT: User provided ${input.imageUrls.length} image(s)`;\n            }\n            if (input.visionAnalysis) {\n                context += `\\n\\nVISION ANALYSIS:\\n${JSON.stringify(input.visionAnalysis, null, 2)}`;\n            }\n            // Add reference scenes for style/color matching\n            if (input.referenceScenes?.length) {\n                context += `\\n\\nREFERENCE SCENES FOR STYLE/COLOR MATCHING:`;\n                input.referenceScenes.forEach((scene)=>{\n                    context += `\\n\\n${scene.name} (ID: ${scene.id}):\\n\\`\\`\\`tsx\\n${scene.tsxCode}\\n\\`\\`\\``;\n                });\n                context += `\\n\\nIMPORTANT: Extract the specific colors, styles, animations, or patterns from the reference scenes that the user wants to apply. Be precise in matching the requested elements.`;\n            }\n            // Build message content based on available context\n            let messageContent;\n            // Prepare all available images (web screenshots + user images)\n            const allImageUrls = [];\n            if (input.webContext) {\n                allImageUrls.push(input.webContext.screenshotUrls.desktop);\n                allImageUrls.push(input.webContext.screenshotUrls.mobile);\n            }\n            if (input.imageUrls?.length) {\n                allImageUrls.push(...input.imageUrls);\n            }\n            if (allImageUrls.length > 0) {\n                // Build vision content array for image-based edits\n                const contextInstructions = input.webContext ? 'IMPORTANT: The first two images are website screenshots for brand matching. Use them to understand the brand\\'s visual identity, colors, and design patterns. ' + (input.imageUrls?.length ? `The additional ${input.imageUrls.length} image(s) show specific content requirements. ` : '') + 'Apply the brand style while incorporating any specific visual requirements from additional images.' : 'IMPORTANT: Look at the provided image(s) and recreate the visual elements from the image in the scene code. Match colors, layout, text, and visual hierarchy as closely as possible.';\n                messageContent = [\n                    {\n                        type: 'text',\n                        text: `${context}\n\nEXISTING CODE:\n\\`\\`\\`tsx\n${input.tsxCode}\n\\`\\`\\`\n\n${contextInstructions} Return the complete modified code.`\n                    }\n                ];\n                // Add all images (web screenshots first, then user images)\n                for (const imageUrl of allImageUrls){\n                    messageContent.push({\n                        type: 'image_url',\n                        image_url: {\n                            url: imageUrl\n                        }\n                    });\n                }\n            } else {\n                // Text-only edit\n                messageContent = `${context}\n\nEXISTING CODE:\n\\`\\`\\`tsx\n${input.tsxCode}\n\\`\\`\\`\n\nPlease edit the code according to the user request. Return the complete modified code.`;\n            }\n            console.log(' [EDIT TOOL] Making edit with context:', {\n                userPrompt: input.userPrompt,\n                hasError: !!input.errorDetails,\n                hasImages: !!input.imageUrls?.length,\n                hasWebContext: !!input.webContext,\n                totalImages: allImageUrls.length,\n                codeLength: input.tsxCode.length,\n                codePreview: input.tsxCode.substring(0, 200),\n                websiteUrl: input.webContext?.originalUrl\n            });\n            // Use the AI to edit the code\n            const modelConfig = (0,_config_models_config__WEBPACK_IMPORTED_MODULE_2__.getModel)('editScene');\n            const systemPrompt = (0,_config_prompts_config__WEBPACK_IMPORTED_MODULE_3__.getSystemPrompt)('CODE_EDITOR');\n            const response = await _server_services_ai_aiClient_service__WEBPACK_IMPORTED_MODULE_1__.AIClientService.generateResponse(modelConfig, [\n                {\n                    role: \"user\",\n                    content: messageContent\n                }\n            ], {\n                role: 'system',\n                content: systemPrompt\n            }, {\n                responseFormat: {\n                    type: \"json_object\"\n                }\n            });\n            const content = response?.content;\n            if (!content) {\n                throw new Error(\"No response from AI editor\");\n            }\n            const parsed = this.extractJsonFromResponse(content);\n            // Validate that we got valid code\n            if (!parsed.code || typeof parsed.code !== 'string' || parsed.code.trim().length < 100) {\n                throw new Error(`Invalid code returned`);\n            }\n            console.log(' [EDIT TOOL] Edit completed:', {\n                originalLength: input.tsxCode.length,\n                newLength: parsed.code.length,\n                changed: parsed.code !== input.tsxCode\n            });\n            return {\n                success: true,\n                tsxCode: parsed.code,\n                duration: parsed.newDurationFrames || undefined,\n                reasoning: parsed.reasoning || `Applied edit: ${input.userPrompt}`,\n                chatResponse: parsed.reasoning || `I've updated the scene as requested`,\n                changesApplied: parsed.changes || [\n                    `Applied edit: ${input.userPrompt}`\n                ]\n            };\n        } catch (error) {\n            console.error('[EDIT TOOL] Edit failed:', error);\n            throw error;\n        }\n    }\n    extractFunctionName(tsxCode) {\n        const match = tsxCode.match(/function\\s+(\\w+)|const\\s+(\\w+)\\s*=/);\n        return match?.[1] || match?.[2] || 'Scene';\n    }\n    extractJsonFromResponse(content) {\n        try {\n            // Try direct JSON parse first\n            return JSON.parse(content);\n        } catch  {\n            // Try to extract JSON from markdown code blocks\n            const jsonMatch = content.match(/```(?:json)?\\s*({[\\s\\S]*?})\\s*```/);\n            if (jsonMatch?.[1]) {\n                return JSON.parse(jsonMatch[1]);\n            }\n            // Try to find JSON object in the content\n            const objectMatch = content.match(/{[\\s\\S]*}/);\n            if (objectMatch?.[0]) {\n                return JSON.parse(objectMatch[0]);\n            }\n            throw new Error('Could not extract JSON from response');\n        }\n    }\n    constructor(...args){\n        super(...args), this.name = \"EDIT\", this.description = \"Transform existing scene content based on user prompt\", this.inputSchema = _tools_helpers_types__WEBPACK_IMPORTED_MODULE_4__.editToolInputSchema;\n    }\n}\n// Export singleton instance\nconst editTool = new EditTool();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWMsOERBQ2R3RCxjQUFjbEYscUVBQW1CQTs7QUE4TW5DO0FBRUEsNEJBQTRCO0FBQ3JCLE1BQU1tRixXQUFXLElBQUlsRixXQUFXIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvdG9vbHMvZWRpdC9lZGl0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VNQ1BUb29sIH0gZnJvbSBcIn4vdG9vbHMvaGVscGVycy9iYXNlXCI7XG5pbXBvcnQgeyBBSUNsaWVudFNlcnZpY2UgfSBmcm9tIFwifi9zZXJ2ZXIvc2VydmljZXMvYWkvYWlDbGllbnQuc2VydmljZVwiO1xuaW1wb3J0IHsgZ2V0TW9kZWwgfSBmcm9tIFwifi9jb25maWcvbW9kZWxzLmNvbmZpZ1wiO1xuaW1wb3J0IHsgZ2V0U3lzdGVtUHJvbXB0IH0gZnJvbSBcIn4vY29uZmlnL3Byb21wdHMuY29uZmlnXCI7XG5pbXBvcnQgdHlwZSB7IEVkaXRUb29sSW5wdXQsIEVkaXRUb29sT3V0cHV0IH0gZnJvbSBcIn4vdG9vbHMvaGVscGVycy90eXBlc1wiO1xuaW1wb3J0IHsgZWRpdFRvb2xJbnB1dFNjaGVtYSB9IGZyb20gXCJ+L3Rvb2xzL2hlbHBlcnMvdHlwZXNcIjtcblxuLyoqXG4gKiBFRElUIFRvb2wgLSBQdXJlIGZ1bmN0aW9uIHRoYXQgdHJhbnNmb3JtcyBzY2VuZSBjb250ZW50XG4gKiBOTyBEQVRBQkFTRSBBQ0NFU1MgLSBvbmx5IHRyYW5zZm9ybWF0aW9uXG4gKiBTcHJpbnQgNDI6IFJlZmFjdG9yZWQgdG8gcHVyZSBmdW5jdGlvblxuICovXG5leHBvcnQgY2xhc3MgRWRpdFRvb2wgZXh0ZW5kcyBCYXNlTUNQVG9vbDxFZGl0VG9vbElucHV0LCBFZGl0VG9vbE91dHB1dD4ge1xuICBuYW1lID0gXCJFRElUXCI7XG4gIGRlc2NyaXB0aW9uID0gXCJUcmFuc2Zvcm0gZXhpc3Rpbmcgc2NlbmUgY29udGVudCBiYXNlZCBvbiB1c2VyIHByb21wdFwiO1xuICBpbnB1dFNjaGVtYSA9IGVkaXRUb29sSW5wdXRTY2hlbWE7XG5cbiAgcHJvdGVjdGVkIGFzeW5jIGV4ZWN1dGUoaW5wdXQ6IEVkaXRUb29sSW5wdXQpOiBQcm9taXNlPEVkaXRUb29sT3V0cHV0PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgICBpZiAoIWlucHV0LnRzeENvZGUpIHsgIC8vIOKckyBVc2luZyBjb3JyZWN0IGZpZWxkIG5hbWVcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gc2NlbmUgY29kZSBwcm92aWRlZFwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+Kcj++4jyBbRURJVCBUT09MXSBFeGVjdXRpbmcgZWRpdDonLCB7XG4gICAgICAgIHByb21wdDogaW5wdXQudXNlclByb21wdCxcbiAgICAgICAgaGFzRXJyb3JEZXRhaWxzOiAhIWlucHV0LmVycm9yRGV0YWlscyxcbiAgICAgICAgY29kZUxlbmd0aDogaW5wdXQudHN4Q29kZS5sZW5ndGhcbiAgICAgIH0pO1xuXG4gICAgICAvLyBKdXN0IGVkaXQgdGhlIGNvZGUgLSBvbmUgdW5pZmllZCBhcHByb2FjaFxuICAgICAgY29uc29sZS5sb2coJ+Kcj++4jyBbRURJVCBUT09MXSBQcm9jZXNzaW5nIGVkaXQgcmVxdWVzdCcpO1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucGVyZm9ybUVkaXQoaW5wdXQpO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+Kcj++4jyBbRURJVCBUT09MXSBFcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgcmVhc29uaW5nOiBgRWRpdCBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSBhcyBFZGl0VG9vbE91dHB1dDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBlcmZvcm1FZGl0KGlucHV0OiBFZGl0VG9vbElucHV0KTogUHJvbWlzZTxFZGl0VG9vbE91dHB1dD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSB0aGlzLmV4dHJhY3RGdW5jdGlvbk5hbWUoaW5wdXQudHN4Q29kZSk7XG4gICAgICBcbiAgICAgIC8vIEJ1aWxkIGNvbnRleHQgZm9yIHRoZSBBSVxuICAgICAgbGV0IGNvbnRleHQgPSBgVVNFUiBSRVFVRVNUOiBcIiR7aW5wdXQudXNlclByb21wdH1cImA7XG4gICAgICBcbiAgICAgIGlmIChpbnB1dC5lcnJvckRldGFpbHMpIHtcbiAgICAgICAgY29udGV4dCArPSBgXFxuXFxuRVJST1IgVE8gRklYOlxcbiR7aW5wdXQuZXJyb3JEZXRhaWxzfWA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChpbnB1dC53ZWJDb250ZXh0KSB7XG4gICAgICAgIGNvbnRleHQgKz0gYFxcblxcbldFQlNJVEUgQlJBTkQgQ09OVEVYVDpcbi0gVVJMOiAke2lucHV0LndlYkNvbnRleHQub3JpZ2luYWxVcmx9XG4tIFRpdGxlOiAke2lucHV0LndlYkNvbnRleHQucGFnZURhdGEudGl0bGV9XG4tIERlc2NyaXB0aW9uOiAke2lucHV0LndlYkNvbnRleHQucGFnZURhdGEuZGVzY3JpcHRpb24gfHwgJ05vdCBhdmFpbGFibGUnfVxuLSBLZXkgaGVhZGluZ3M6ICR7aW5wdXQud2ViQ29udGV4dC5wYWdlRGF0YS5oZWFkaW5ncy5zbGljZSgwLCA1KS5qb2luKCcsICcpfVxuXG5CUkFORCBNQVRDSElORyBJTlNUUlVDVElPTlM6XG4tIFVzZSB0aGUgd2Vic2l0ZSBzY3JlZW5zaG90cyB0byBtYXRjaCB0aGUgYnJhbmQncyB2aXN1YWwgaWRlbnRpdHlcbi0gRXh0cmFjdCBhbmQgYXBwbHkgY29sb3JzLCBmb250cywgYW5kIGRlc2lnbiBwYXR0ZXJucyBmcm9tIHRoZSBzY3JlZW5zaG90c1xuLSBNYWludGFpbiBicmFuZCBjb25zaXN0ZW5jeSBpbiB5b3VyIGVkaXRzYDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGlucHV0LmltYWdlVXJscz8ubGVuZ3RoKSB7XG4gICAgICAgIGNvbnRleHQgKz0gYFxcblxcbklNQUdFIENPTlRFWFQ6IFVzZXIgcHJvdmlkZWQgJHtpbnB1dC5pbWFnZVVybHMubGVuZ3RofSBpbWFnZShzKWA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChpbnB1dC52aXNpb25BbmFseXNpcykge1xuICAgICAgICBjb250ZXh0ICs9IGBcXG5cXG5WSVNJT04gQU5BTFlTSVM6XFxuJHtKU09OLnN0cmluZ2lmeShpbnB1dC52aXNpb25BbmFseXNpcywgbnVsbCwgMil9YDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWRkIHJlZmVyZW5jZSBzY2VuZXMgZm9yIHN0eWxlL2NvbG9yIG1hdGNoaW5nXG4gICAgICBpZiAoaW5wdXQucmVmZXJlbmNlU2NlbmVzPy5sZW5ndGgpIHtcbiAgICAgICAgY29udGV4dCArPSBgXFxuXFxuUkVGRVJFTkNFIFNDRU5FUyBGT1IgU1RZTEUvQ09MT1IgTUFUQ0hJTkc6YDtcbiAgICAgICAgaW5wdXQucmVmZXJlbmNlU2NlbmVzLmZvckVhY2goKHNjZW5lKSA9PiB7XG4gICAgICAgICAgY29udGV4dCArPSBgXFxuXFxuJHtzY2VuZS5uYW1lfSAoSUQ6ICR7c2NlbmUuaWR9KTpcXG5cXGBcXGBcXGB0c3hcXG4ke3NjZW5lLnRzeENvZGV9XFxuXFxgXFxgXFxgYDtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnRleHQgKz0gYFxcblxcbklNUE9SVEFOVDogRXh0cmFjdCB0aGUgc3BlY2lmaWMgY29sb3JzLCBzdHlsZXMsIGFuaW1hdGlvbnMsIG9yIHBhdHRlcm5zIGZyb20gdGhlIHJlZmVyZW5jZSBzY2VuZXMgdGhhdCB0aGUgdXNlciB3YW50cyB0byBhcHBseS4gQmUgcHJlY2lzZSBpbiBtYXRjaGluZyB0aGUgcmVxdWVzdGVkIGVsZW1lbnRzLmA7XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1aWxkIG1lc3NhZ2UgY29udGVudCBiYXNlZCBvbiBhdmFpbGFibGUgY29udGV4dFxuICAgICAgbGV0IG1lc3NhZ2VDb250ZW50OiBhbnk7XG4gICAgICBcbiAgICAgIC8vIFByZXBhcmUgYWxsIGF2YWlsYWJsZSBpbWFnZXMgKHdlYiBzY3JlZW5zaG90cyArIHVzZXIgaW1hZ2VzKVxuICAgICAgY29uc3QgYWxsSW1hZ2VVcmxzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgaWYgKGlucHV0LndlYkNvbnRleHQpIHtcbiAgICAgICAgYWxsSW1hZ2VVcmxzLnB1c2goaW5wdXQud2ViQ29udGV4dC5zY3JlZW5zaG90VXJscy5kZXNrdG9wKTtcbiAgICAgICAgYWxsSW1hZ2VVcmxzLnB1c2goaW5wdXQud2ViQ29udGV4dC5zY3JlZW5zaG90VXJscy5tb2JpbGUpO1xuICAgICAgfVxuICAgICAgaWYgKGlucHV0LmltYWdlVXJscz8ubGVuZ3RoKSB7XG4gICAgICAgIGFsbEltYWdlVXJscy5wdXNoKC4uLmlucHV0LmltYWdlVXJscyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChhbGxJbWFnZVVybHMubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBCdWlsZCB2aXNpb24gY29udGVudCBhcnJheSBmb3IgaW1hZ2UtYmFzZWQgZWRpdHNcbiAgICAgICAgY29uc3QgY29udGV4dEluc3RydWN0aW9ucyA9IGlucHV0LndlYkNvbnRleHQgXG4gICAgICAgICAgPyAnSU1QT1JUQU5UOiBUaGUgZmlyc3QgdHdvIGltYWdlcyBhcmUgd2Vic2l0ZSBzY3JlZW5zaG90cyBmb3IgYnJhbmQgbWF0Y2hpbmcuIFVzZSB0aGVtIHRvIHVuZGVyc3RhbmQgdGhlIGJyYW5kXFwncyB2aXN1YWwgaWRlbnRpdHksIGNvbG9ycywgYW5kIGRlc2lnbiBwYXR0ZXJucy4gJyArXG4gICAgICAgICAgICAoaW5wdXQuaW1hZ2VVcmxzPy5sZW5ndGggPyBgVGhlIGFkZGl0aW9uYWwgJHtpbnB1dC5pbWFnZVVybHMubGVuZ3RofSBpbWFnZShzKSBzaG93IHNwZWNpZmljIGNvbnRlbnQgcmVxdWlyZW1lbnRzLiBgIDogJycpICtcbiAgICAgICAgICAgICdBcHBseSB0aGUgYnJhbmQgc3R5bGUgd2hpbGUgaW5jb3Jwb3JhdGluZyBhbnkgc3BlY2lmaWMgdmlzdWFsIHJlcXVpcmVtZW50cyBmcm9tIGFkZGl0aW9uYWwgaW1hZ2VzLidcbiAgICAgICAgICA6ICdJTVBPUlRBTlQ6IExvb2sgYXQgdGhlIHByb3ZpZGVkIGltYWdlKHMpIGFuZCByZWNyZWF0ZSB0aGUgdmlzdWFsIGVsZW1lbnRzIGZyb20gdGhlIGltYWdlIGluIHRoZSBzY2VuZSBjb2RlLiBNYXRjaCBjb2xvcnMsIGxheW91dCwgdGV4dCwgYW5kIHZpc3VhbCBoaWVyYXJjaHkgYXMgY2xvc2VseSBhcyBwb3NzaWJsZS4nO1xuICAgICAgICBcbiAgICAgICAgbWVzc2FnZUNvbnRlbnQgPSBbXG4gICAgICAgICAgeyBcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JywgXG4gICAgICAgICAgICB0ZXh0OiBgJHtjb250ZXh0fVxuXG5FWElTVElORyBDT0RFOlxuXFxgXFxgXFxgdHN4XG4ke2lucHV0LnRzeENvZGV9XG5cXGBcXGBcXGBcblxuJHtjb250ZXh0SW5zdHJ1Y3Rpb25zfSBSZXR1cm4gdGhlIGNvbXBsZXRlIG1vZGlmaWVkIGNvZGUuYFxuICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBhbGwgaW1hZ2VzICh3ZWIgc2NyZWVuc2hvdHMgZmlyc3QsIHRoZW4gdXNlciBpbWFnZXMpXG4gICAgICAgIGZvciAoY29uc3QgaW1hZ2VVcmwgb2YgYWxsSW1hZ2VVcmxzKSB7XG4gICAgICAgICAgbWVzc2FnZUNvbnRlbnQucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAnaW1hZ2VfdXJsJyxcbiAgICAgICAgICAgIGltYWdlX3VybDogeyB1cmw6IGltYWdlVXJsIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVGV4dC1vbmx5IGVkaXRcbiAgICAgICAgbWVzc2FnZUNvbnRlbnQgPSBgJHtjb250ZXh0fVxuXG5FWElTVElORyBDT0RFOlxuXFxgXFxgXFxgdHN4XG4ke2lucHV0LnRzeENvZGV9XG5cXGBcXGBcXGBcblxuUGxlYXNlIGVkaXQgdGhlIGNvZGUgYWNjb3JkaW5nIHRvIHRoZSB1c2VyIHJlcXVlc3QuIFJldHVybiB0aGUgY29tcGxldGUgbW9kaWZpZWQgY29kZS5gO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBbRURJVCBUT09MXSBNYWtpbmcgZWRpdCB3aXRoIGNvbnRleHQ6Jywge1xuICAgICAgICB1c2VyUHJvbXB0OiBpbnB1dC51c2VyUHJvbXB0LFxuICAgICAgICBoYXNFcnJvcjogISFpbnB1dC5lcnJvckRldGFpbHMsXG4gICAgICAgIGhhc0ltYWdlczogISFpbnB1dC5pbWFnZVVybHM/Lmxlbmd0aCxcbiAgICAgICAgaGFzV2ViQ29udGV4dDogISFpbnB1dC53ZWJDb250ZXh0LFxuICAgICAgICB0b3RhbEltYWdlczogYWxsSW1hZ2VVcmxzLmxlbmd0aCxcbiAgICAgICAgY29kZUxlbmd0aDogaW5wdXQudHN4Q29kZS5sZW5ndGgsXG4gICAgICAgIGNvZGVQcmV2aWV3OiBpbnB1dC50c3hDb2RlLnN1YnN0cmluZygwLCAyMDApLFxuICAgICAgICB3ZWJzaXRlVXJsOiBpbnB1dC53ZWJDb250ZXh0Py5vcmlnaW5hbFVybFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVzZSB0aGUgQUkgdG8gZWRpdCB0aGUgY29kZVxuICAgICAgY29uc3QgbW9kZWxDb25maWcgPSBnZXRNb2RlbCgnZWRpdFNjZW5lJyk7XG4gICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBnZXRTeXN0ZW1Qcm9tcHQoJ0NPREVfRURJVE9SJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQUlDbGllbnRTZXJ2aWNlLmdlbmVyYXRlUmVzcG9uc2UoXG4gICAgICAgIG1vZGVsQ29uZmlnLFxuICAgICAgICBbeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogbWVzc2FnZUNvbnRlbnQgfV0sXG4gICAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9LFxuICAgICAgICB7IHJlc3BvbnNlRm9ybWF0OiB7IHR5cGU6IFwianNvbl9vYmplY3RcIiB9IH1cbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSByZXNwb25zZT8uY29udGVudDtcbiAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyByZXNwb25zZSBmcm9tIEFJIGVkaXRvclwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcGFyc2VkID0gdGhpcy5leHRyYWN0SnNvbkZyb21SZXNwb25zZShjb250ZW50KTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgdGhhdCB3ZSBnb3QgdmFsaWQgY29kZVxuICAgICAgaWYgKCFwYXJzZWQuY29kZSB8fCB0eXBlb2YgcGFyc2VkLmNvZGUgIT09ICdzdHJpbmcnIHx8IHBhcnNlZC5jb2RlLnRyaW0oKS5sZW5ndGggPCAxMDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNvZGUgcmV0dXJuZWRgKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+KchSBbRURJVCBUT09MXSBFZGl0IGNvbXBsZXRlZDonLCB7XG4gICAgICAgIG9yaWdpbmFsTGVuZ3RoOiBpbnB1dC50c3hDb2RlLmxlbmd0aCxcbiAgICAgICAgbmV3TGVuZ3RoOiBwYXJzZWQuY29kZS5sZW5ndGgsXG4gICAgICAgIGNoYW5nZWQ6IHBhcnNlZC5jb2RlICE9PSBpbnB1dC50c3hDb2RlXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdHN4Q29kZTogcGFyc2VkLmNvZGUsXG4gICAgICAgIGR1cmF0aW9uOiBwYXJzZWQubmV3RHVyYXRpb25GcmFtZXMgfHwgdW5kZWZpbmVkLFxuICAgICAgICByZWFzb25pbmc6IHBhcnNlZC5yZWFzb25pbmcgfHwgYEFwcGxpZWQgZWRpdDogJHtpbnB1dC51c2VyUHJvbXB0fWAsXG4gICAgICAgIGNoYXRSZXNwb25zZTogcGFyc2VkLnJlYXNvbmluZyB8fCBgSSd2ZSB1cGRhdGVkIHRoZSBzY2VuZSBhcyByZXF1ZXN0ZWRgLFxuICAgICAgICBjaGFuZ2VzQXBwbGllZDogcGFyc2VkLmNoYW5nZXMgfHwgW2BBcHBsaWVkIGVkaXQ6ICR7aW5wdXQudXNlclByb21wdH1gXSxcbiAgICAgIH07XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0VESVQgVE9PTF0gRWRpdCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0RnVuY3Rpb25OYW1lKHRzeENvZGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgbWF0Y2ggPSB0c3hDb2RlLm1hdGNoKC9mdW5jdGlvblxccysoXFx3Kyl8Y29uc3RcXHMrKFxcdyspXFxzKj0vKTtcbiAgICByZXR1cm4gbWF0Y2g/LlsxXSB8fCBtYXRjaD8uWzJdIHx8ICdTY2VuZSc7XG4gIH1cblxuXG4gIHByaXZhdGUgZXh0cmFjdEpzb25Gcm9tUmVzcG9uc2UoY29udGVudDogc3RyaW5nKTogYW55IHtcbiAgICB0cnkge1xuICAgICAgLy8gVHJ5IGRpcmVjdCBKU09OIHBhcnNlIGZpcnN0XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShjb250ZW50KTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIFRyeSB0byBleHRyYWN0IEpTT04gZnJvbSBtYXJrZG93biBjb2RlIGJsb2Nrc1xuICAgICAgY29uc3QganNvbk1hdGNoID0gY29udGVudC5tYXRjaCgvYGBgKD86anNvbik/XFxzKih7W1xcc1xcU10qP30pXFxzKmBgYC8pO1xuICAgICAgaWYgKGpzb25NYXRjaD8uWzFdKSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25NYXRjaFsxXSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFRyeSB0byBmaW5kIEpTT04gb2JqZWN0IGluIHRoZSBjb250ZW50XG4gICAgICBjb25zdCBvYmplY3RNYXRjaCA9IGNvbnRlbnQubWF0Y2goL3tbXFxzXFxTXSp9Lyk7XG4gICAgICBpZiAob2JqZWN0TWF0Y2g/LlswXSkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShvYmplY3RNYXRjaFswXSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGV4dHJhY3QgSlNPTiBmcm9tIHJlc3BvbnNlJyk7XG4gICAgfVxuICB9XG5cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGVkaXRUb29sID0gbmV3IEVkaXRUb29sKCk7XG4iXSwibmFtZXMiOlsiQmFzZU1DUFRvb2wiLCJBSUNsaWVudFNlcnZpY2UiLCJnZXRNb2RlbCIsImdldFN5c3RlbVByb21wdCIsImVkaXRUb29sSW5wdXRTY2hlbWEiLCJFZGl0VG9vbCIsImV4ZWN1dGUiLCJpbnB1dCIsInRzeENvZGUiLCJFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJwcm9tcHQiLCJ1c2VyUHJvbXB0IiwiaGFzRXJyb3JEZXRhaWxzIiwiZXJyb3JEZXRhaWxzIiwiY29kZUxlbmd0aCIsImxlbmd0aCIsInBlcmZvcm1FZGl0IiwiZXJyb3IiLCJzdWNjZXNzIiwicmVhc29uaW5nIiwibWVzc2FnZSIsImZ1bmN0aW9uTmFtZSIsImV4dHJhY3RGdW5jdGlvbk5hbWUiLCJjb250ZXh0Iiwid2ViQ29udGV4dCIsIm9yaWdpbmFsVXJsIiwicGFnZURhdGEiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiaGVhZGluZ3MiLCJzbGljZSIsImpvaW4iLCJpbWFnZVVybHMiLCJ2aXNpb25BbmFseXNpcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZWZlcmVuY2VTY2VuZXMiLCJmb3JFYWNoIiwic2NlbmUiLCJuYW1lIiwiaWQiLCJtZXNzYWdlQ29udGVudCIsImFsbEltYWdlVXJscyIsInB1c2giLCJzY3JlZW5zaG90VXJscyIsImRlc2t0b3AiLCJtb2JpbGUiLCJjb250ZXh0SW5zdHJ1Y3Rpb25zIiwidHlwZSIsInRleHQiLCJpbWFnZVVybCIsImltYWdlX3VybCIsInVybCIsImhhc0Vycm9yIiwiaGFzSW1hZ2VzIiwiaGFzV2ViQ29udGV4dCIsInRvdGFsSW1hZ2VzIiwiY29kZVByZXZpZXciLCJzdWJzdHJpbmciLCJ3ZWJzaXRlVXJsIiwibW9kZWxDb25maWciLCJzeXN0ZW1Qcm9tcHQiLCJyZXNwb25zZSIsImdlbmVyYXRlUmVzcG9uc2UiLCJyb2xlIiwiY29udGVudCIsInJlc3BvbnNlRm9ybWF0IiwicGFyc2VkIiwiZXh0cmFjdEpzb25Gcm9tUmVzcG9uc2UiLCJjb2RlIiwidHJpbSIsIm9yaWdpbmFsTGVuZ3RoIiwibmV3TGVuZ3RoIiwiY2hhbmdlZCIsImR1cmF0aW9uIiwibmV3RHVyYXRpb25GcmFtZXMiLCJ1bmRlZmluZWQiLCJjaGF0UmVzcG9uc2UiLCJjaGFuZ2VzQXBwbGllZCIsImNoYW5nZXMiLCJtYXRjaCIsInBhcnNlIiwianNvbk1hdGNoIiwib2JqZWN0TWF0Y2giLCJpbnB1dFNjaGVtYSIsImVkaXRUb29sIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/edit/edit.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/helpers/base.ts":
/*!***********************************!*\
  !*** ./src/tools/helpers/base.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BaseMCPTool: () => (/* binding */ BaseMCPTool)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n\n/**\n * Base tool implementation with common functionality\n */ class BaseMCPTool {\n    async run(input) {\n        const startTime = Date.now();\n        try {\n            // Validate input\n            const validatedInput = this.inputSchema.parse(input);\n            // Execute tool logic\n            const result = await this.execute(validatedInput);\n            const executionTime = Date.now() - startTime;\n            return {\n                success: true,\n                data: result,\n                metadata: {\n                    executionTime,\n                    toolName: this.name,\n                    timestamp: new Date().toISOString()\n                }\n            };\n        } catch (error) {\n            const executionTime = Date.now() - startTime;\n            return {\n                success: false,\n                error: {\n                    code: error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError ? 'VALIDATION_ERROR' : 'EXECUTION_ERROR',\n                    message: error instanceof Error ? error.message : 'Unknown error',\n                    details: error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError ? {\n                        issues: error.issues\n                    } : undefined\n                },\n                metadata: {\n                    executionTime,\n                    toolName: this.name,\n                    timestamp: new Date().toISOString()\n                }\n            };\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvdG9vbHMvaGVscGVycy9iYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXdCO0FBK0N4Qjs7Q0FFQyxHQUNNLE1BQWVDO0lBS3BCLE1BQU1DLElBQUlDLEtBQWEsRUFBK0I7UUFDcEQsTUFBTUMsWUFBWUMsS0FBS0MsR0FBRztRQUUxQixJQUFJO1lBQ0YsaUJBQWlCO1lBQ2pCLE1BQU1DLGlCQUFpQixJQUFJLENBQUNDLFdBQVcsQ0FBQ0MsS0FBSyxDQUFDTjtZQUU5QyxxQkFBcUI7WUFDckIsTUFBTU8sU0FBUyxNQUFNLElBQUksQ0FBQ0MsT0FBTyxDQUFDSjtZQUVsQyxNQUFNSyxnQkFBZ0JQLEtBQUtDLEdBQUcsS0FBS0Y7WUFFbkMsT0FBTztnQkFDTFMsU0FBUztnQkFDVEMsTUFBTUo7Z0JBQ05LLFVBQVU7b0JBQ1JIO29CQUNBSSxVQUFVLElBQUksQ0FBQ0MsSUFBSTtvQkFDbkJDLFdBQVcsSUFBSWIsT0FBT2MsV0FBVztnQkFDbkM7WUFDRjtRQUNGLEVBQUUsT0FBT0MsT0FBTztZQUNkLE1BQU1SLGdCQUFnQlAsS0FBS0MsR0FBRyxLQUFLRjtZQUVuQyxPQUFPO2dCQUNMUyxTQUFTO2dCQUNUTyxPQUFPO29CQUNMQyxNQUFNRCxpQkFBaUJwQixrQ0FBQ0EsQ0FBQ3NCLFFBQVEsR0FBRyxxQkFBcUI7b0JBQ3pEQyxTQUFTSCxpQkFBaUJJLFFBQVFKLE1BQU1HLE9BQU8sR0FBRztvQkFDbERFLFNBQVNMLGlCQUFpQnBCLGtDQUFDQSxDQUFDc0IsUUFBUSxHQUFHO3dCQUFFSSxRQUFRTixNQUFNTSxNQUFNO29CQUFDLElBQUlDO2dCQUNwRTtnQkFDQVosVUFBVTtvQkFDUkg7b0JBQ0FJLFVBQVUsSUFBSSxDQUFDQyxJQUFJO29CQUNuQkMsV0FBVyxJQUFJYixPQUFPYyxXQUFXO2dCQUNuQztZQUNGO1FBQ0Y7SUFDRjtBQU1GIiwic291cmNlcyI6WyIvVXNlcnMvbWFya3VzaG9nbmUvRG9jdW1lbnRzL0FQUFMvYmF6YWFyLXZpZC9iYXphYXItdmlkL2FwcHMvbWFpbi9zcmMvdG9vbHMvaGVscGVycy9iYXNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5cbi8qKlxuICogQmFzZSBNQ1AgVG9vbCBpbnRlcmZhY2UgZm9sbG93aW5nIE1vZGVsIENvbnRleHQgUHJvdG9jb2wgcGF0dGVybnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBNQ1BUb29sPFRJbnB1dCA9IHVua25vd24sIFRPdXRwdXQgPSB1bmtub3duPiB7XG4gIC8qKiBUb29sIG5hbWUgZm9yIExMTSBmdW5jdGlvbiBjYWxsaW5nICovXG4gIG5hbWU6IHN0cmluZztcbiAgXG4gIC8qKiBUb29sIGRlc2NyaXB0aW9uIGZvciBMTE0gY29udGV4dCAqL1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBcbiAgLyoqIElucHV0IHNjaGVtYSBmb3IgdmFsaWRhdGlvbiAqL1xuICBpbnB1dFNjaGVtYTogei5ab2RTY2hlbWE8VElucHV0PjtcbiAgXG4gIC8qKiBFeGVjdXRlIHRoZSB0b29sIHdpdGggdmFsaWRhdGVkIGlucHV0ICovXG4gIHJ1bihpbnB1dDogVElucHV0KTogUHJvbWlzZTxNQ1BSZXN1bHQ8VE91dHB1dD4+O1xufVxuXG4vKipcbiAqIFN0YW5kYXJkaXplZCByZXN1bHQgZm9ybWF0IGZvciBhbGwgTUNQIHRvb2xzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTUNQUmVzdWx0PFQgPSB1bmtub3duPiB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGRhdGE/OiBUO1xuICBlcnJvcj86IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgfTtcbiAgbWV0YWRhdGE/OiB7XG4gICAgZXhlY3V0aW9uVGltZTogbnVtYmVyO1xuICAgIHRvb2xOYW1lOiBzdHJpbmc7XG4gICAgdGltZXN0YW1wOiBzdHJpbmc7XG4gIH07XG59XG5cbi8qKlxuICogVG9vbCBleGVjdXRpb24gY29udGV4dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIE1DUENvbnRleHQge1xuICB1c2VySWQ6IHN0cmluZztcbiAgcHJvamVjdElkOiBzdHJpbmc7XG4gIHNlc3Npb25JZDogc3RyaW5nO1xuICB1c2VyQ29udGV4dD86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG4vKipcbiAqIEJhc2UgdG9vbCBpbXBsZW1lbnRhdGlvbiB3aXRoIGNvbW1vbiBmdW5jdGlvbmFsaXR5XG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYXNlTUNQVG9vbDxUSW5wdXQsIFRPdXRwdXQ+IGltcGxlbWVudHMgTUNQVG9vbDxUSW5wdXQsIFRPdXRwdXQ+IHtcbiAgYWJzdHJhY3QgbmFtZTogc3RyaW5nO1xuICBhYnN0cmFjdCBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBhYnN0cmFjdCBpbnB1dFNjaGVtYTogei5ab2RTY2hlbWE8VElucHV0PjtcbiAgXG4gIGFzeW5jIHJ1bihpbnB1dDogVElucHV0KTogUHJvbWlzZTxNQ1BSZXN1bHQ8VE91dHB1dD4+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBWYWxpZGF0ZSBpbnB1dFxuICAgICAgY29uc3QgdmFsaWRhdGVkSW5wdXQgPSB0aGlzLmlucHV0U2NoZW1hLnBhcnNlKGlucHV0KTtcbiAgICAgIFxuICAgICAgLy8gRXhlY3V0ZSB0b29sIGxvZ2ljXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGUodmFsaWRhdGVkSW5wdXQpO1xuICAgICAgXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgdG9vbE5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiBlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IgPyAnVkFMSURBVElPTl9FUlJPUicgOiAnRVhFQ1VUSU9OX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IgPyB7IGlzc3VlczogZXJyb3IuaXNzdWVzIH0gOiB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICB0b29sTmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBUb29sLXNwZWNpZmljIGV4ZWN1dGlvbiBsb2dpYyAtIGltcGxlbWVudGVkIGJ5IHN1YmNsYXNzZXNcbiAgICovXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBleGVjdXRlKGlucHV0OiBUSW5wdXQpOiBQcm9taXNlPFRPdXRwdXQ+O1xufSAiXSwibmFtZXMiOlsieiIsIkJhc2VNQ1BUb29sIiwicnVuIiwiaW5wdXQiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwidmFsaWRhdGVkSW5wdXQiLCJpbnB1dFNjaGVtYSIsInBhcnNlIiwicmVzdWx0IiwiZXhlY3V0ZSIsImV4ZWN1dGlvblRpbWUiLCJzdWNjZXNzIiwiZGF0YSIsIm1ldGFkYXRhIiwidG9vbE5hbWUiLCJuYW1lIiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJlcnJvciIsImNvZGUiLCJab2RFcnJvciIsIm1lc3NhZ2UiLCJFcnJvciIsImRldGFpbHMiLCJpc3N1ZXMiLCJ1bmRlZmluZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/helpers/base.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/helpers/types.ts":
/*!************************************!*\
  !*** ./src/tools/helpers/types.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addToolInputSchema: () => (/* binding */ addToolInputSchema),\n/* harmony export */   baseToolInputSchema: () => (/* binding */ baseToolInputSchema),\n/* harmony export */   deleteToolInputSchema: () => (/* binding */ deleteToolInputSchema),\n/* harmony export */   editToolInputSchema: () => (/* binding */ editToolInputSchema),\n/* harmony export */   trimToolInputSchema: () => (/* binding */ trimToolInputSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/lib/index.mjs\");\n\n// ============================================================================\n// ZOD SCHEMAS FOR VALIDATION\n// ============================================================================\nconst baseToolInputSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    userPrompt: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().describe(\"User's description of what they want\"),\n    projectId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().describe(\"Project ID for context only\"),\n    userId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().describe(\"User ID for context only\")\n});\nconst addToolInputSchema = baseToolInputSchema.extend({\n    sceneNumber: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().optional().describe(\"Optional scene number/position\"),\n    previousSceneContext: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        tsxCode: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n        style: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n    }).optional().describe(\"Previous scene for style consistency\"),\n    visionAnalysis: zod__WEBPACK_IMPORTED_MODULE_0__.z.any().optional().describe(\"Vision analysis from image analysis\"),\n    imageUrls: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()).optional().describe(\"Image URLs for reference\"),\n    webContext: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        originalUrl: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n        screenshotUrls: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n            desktop: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n            mobile: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n        }),\n        pageData: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n            title: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n            description: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n            headings: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()),\n            url: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n        }),\n        analyzedAt: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n    }).optional().describe(\"Web analysis context with screenshots for brand matching\")\n});\nconst editToolInputSchema = baseToolInputSchema.extend({\n    sceneId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().describe(\"ID of the scene to edit (reference only)\"),\n    tsxCode: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().describe(\"Current scene TSX code\"),\n    currentDuration: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().optional().describe(\"Current duration in frames\"),\n    imageUrls: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()).optional().describe(\"Image URLs for reference\"),\n    visionAnalysis: zod__WEBPACK_IMPORTED_MODULE_0__.z.any().optional().describe(\"Vision analysis from image analysis\"),\n    errorDetails: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().describe(\"Error details if fixing errors\"),\n    webContext: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        originalUrl: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n        screenshotUrls: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n            desktop: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n            mobile: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n        }),\n        pageData: zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n            title: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n            description: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n            headings: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()),\n            url: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n        }),\n        analyzedAt: zod__WEBPACK_IMPORTED_MODULE_0__.z.string()\n    }).optional().describe(\"Web analysis context with screenshots for brand matching\")\n});\nconst deleteToolInputSchema = baseToolInputSchema.extend({\n    sceneId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().describe(\"ID of the scene to delete\"),\n    confirmDeletion: zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional().describe(\"Confirmation flag for deletion\")\n});\nconst trimToolInputSchema = baseToolInputSchema.extend({\n    sceneId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().describe(\"ID of the scene to trim\"),\n    currentDuration: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().describe(\"Current duration in frames\"),\n    newDuration: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().optional().describe(\"Target duration in frames\"),\n    trimFrames: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().optional().describe(\"Frames to add (positive) or remove (negative)\"),\n    trimType: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        'start',\n        'end'\n    ]).optional().default('end').describe(\"Where to trim from\")\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvdG9vbHMvaGVscGVycy90eXBlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0I7QUFnT3hCLCtFQUErRTtBQUMvRSw2QkFBNkI7QUFDN0IsK0VBQStFO0FBRXhFLE1BQU1DLHNCQUFzQkQsa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUMxQ0MsWUFBWUgsa0NBQUNBLENBQUNJLE1BQU0sR0FBR0MsUUFBUSxDQUFDO0lBQ2hDQyxXQUFXTixrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHQyxRQUFRLENBQUM7SUFDL0JFLFFBQVFQLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdJLFFBQVEsR0FBR0gsUUFBUSxDQUFDO0FBQ3pDLEdBQUc7QUFFSSxNQUFNSSxxQkFBcUJSLG9CQUFvQlMsTUFBTSxDQUFDO0lBQzNEQyxhQUFhWCxrQ0FBQ0EsQ0FBQ1ksTUFBTSxHQUFHSixRQUFRLEdBQUdILFFBQVEsQ0FBQztJQUM1Q1Esc0JBQXNCYixrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO1FBQzdCWSxTQUFTZCxrQ0FBQ0EsQ0FBQ0ksTUFBTTtRQUNqQlcsT0FBT2Ysa0NBQUNBLENBQUNJLE1BQU0sR0FBR0ksUUFBUTtJQUM1QixHQUFHQSxRQUFRLEdBQUdILFFBQVEsQ0FBQztJQUN2QlcsZ0JBQWdCaEIsa0NBQUNBLENBQUNpQixHQUFHLEdBQUdULFFBQVEsR0FBR0gsUUFBUSxDQUFDO0lBQzVDYSxXQUFXbEIsa0NBQUNBLENBQUNtQixLQUFLLENBQUNuQixrQ0FBQ0EsQ0FBQ0ksTUFBTSxJQUFJSSxRQUFRLEdBQUdILFFBQVEsQ0FBQztJQUNuRGUsWUFBWXBCLGtDQUFDQSxDQUFDRSxNQUFNLENBQUM7UUFDbkJtQixhQUFhckIsa0NBQUNBLENBQUNJLE1BQU07UUFDckJrQixnQkFBZ0J0QixrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO1lBQ3ZCcUIsU0FBU3ZCLGtDQUFDQSxDQUFDSSxNQUFNO1lBQ2pCb0IsUUFBUXhCLGtDQUFDQSxDQUFDSSxNQUFNO1FBQ2xCO1FBQ0FxQixVQUFVekIsa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztZQUNqQndCLE9BQU8xQixrQ0FBQ0EsQ0FBQ0ksTUFBTTtZQUNmdUIsYUFBYTNCLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdJLFFBQVE7WUFDaENvQixVQUFVNUIsa0NBQUNBLENBQUNtQixLQUFLLENBQUNuQixrQ0FBQ0EsQ0FBQ0ksTUFBTTtZQUMxQnlCLEtBQUs3QixrQ0FBQ0EsQ0FBQ0ksTUFBTTtRQUNmO1FBQ0EwQixZQUFZOUIsa0NBQUNBLENBQUNJLE1BQU07SUFDdEIsR0FBR0ksUUFBUSxHQUFHSCxRQUFRLENBQUM7QUFDekIsR0FBRztBQUVJLE1BQU0wQixzQkFBc0I5QixvQkFBb0JTLE1BQU0sQ0FBQztJQUM1RHNCLFNBQVNoQyxrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHQyxRQUFRLENBQUM7SUFDN0JTLFNBQVNkLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdDLFFBQVEsQ0FBQztJQUM3QjRCLGlCQUFpQmpDLGtDQUFDQSxDQUFDWSxNQUFNLEdBQUdKLFFBQVEsR0FBR0gsUUFBUSxDQUFDO0lBQ2hEYSxXQUFXbEIsa0NBQUNBLENBQUNtQixLQUFLLENBQUNuQixrQ0FBQ0EsQ0FBQ0ksTUFBTSxJQUFJSSxRQUFRLEdBQUdILFFBQVEsQ0FBQztJQUNuRFcsZ0JBQWdCaEIsa0NBQUNBLENBQUNpQixHQUFHLEdBQUdULFFBQVEsR0FBR0gsUUFBUSxDQUFDO0lBQzVDNkIsY0FBY2xDLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdJLFFBQVEsR0FBR0gsUUFBUSxDQUFDO0lBQzdDZSxZQUFZcEIsa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztRQUNuQm1CLGFBQWFyQixrQ0FBQ0EsQ0FBQ0ksTUFBTTtRQUNyQmtCLGdCQUFnQnRCLGtDQUFDQSxDQUFDRSxNQUFNLENBQUM7WUFDdkJxQixTQUFTdkIsa0NBQUNBLENBQUNJLE1BQU07WUFDakJvQixRQUFReEIsa0NBQUNBLENBQUNJLE1BQU07UUFDbEI7UUFDQXFCLFVBQVV6QixrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO1lBQ2pCd0IsT0FBTzFCLGtDQUFDQSxDQUFDSSxNQUFNO1lBQ2Z1QixhQUFhM0Isa0NBQUNBLENBQUNJLE1BQU0sR0FBR0ksUUFBUTtZQUNoQ29CLFVBQVU1QixrQ0FBQ0EsQ0FBQ21CLEtBQUssQ0FBQ25CLGtDQUFDQSxDQUFDSSxNQUFNO1lBQzFCeUIsS0FBSzdCLGtDQUFDQSxDQUFDSSxNQUFNO1FBQ2Y7UUFDQTBCLFlBQVk5QixrQ0FBQ0EsQ0FBQ0ksTUFBTTtJQUN0QixHQUFHSSxRQUFRLEdBQUdILFFBQVEsQ0FBQztBQUN6QixHQUFHO0FBRUksTUFBTThCLHdCQUF3QmxDLG9CQUFvQlMsTUFBTSxDQUFDO0lBQzlEc0IsU0FBU2hDLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdDLFFBQVEsQ0FBQztJQUM3QitCLGlCQUFpQnBDLGtDQUFDQSxDQUFDcUMsT0FBTyxHQUFHN0IsUUFBUSxHQUFHSCxRQUFRLENBQUM7QUFDbkQsR0FBRztBQUVJLE1BQU1pQyxzQkFBc0JyQyxvQkFBb0JTLE1BQU0sQ0FBQztJQUM1RHNCLFNBQVNoQyxrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHQyxRQUFRLENBQUM7SUFDN0I0QixpQkFBaUJqQyxrQ0FBQ0EsQ0FBQ1ksTUFBTSxHQUFHUCxRQUFRLENBQUM7SUFDckNrQyxhQUFhdkMsa0NBQUNBLENBQUNZLE1BQU0sR0FBR0osUUFBUSxHQUFHSCxRQUFRLENBQUM7SUFDNUNtQyxZQUFZeEMsa0NBQUNBLENBQUNZLE1BQU0sR0FBR0osUUFBUSxHQUFHSCxRQUFRLENBQUM7SUFDM0NvQyxVQUFVekMsa0NBQUNBLENBQUMwQyxJQUFJLENBQUM7UUFBQztRQUFTO0tBQU0sRUFBRWxDLFFBQVEsR0FBR21DLE9BQU8sQ0FBQyxPQUFPdEMsUUFBUSxDQUFDO0FBQ3hFLEdBQUciLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy90b29scy9oZWxwZXJzL3R5cGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRPT0wgSU5URVJGQUNFUyAtIFB1cmUgRnVuY3Rpb25zIE9ubHkgKFNwcmludCA0Milcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBCYXNlIGlucHV0IHRoYXQgYWxsIHRvb2xzIHJlY2VpdmVcbiAqIFRvb2xzIGFyZSBQVVJFIEZVTkNUSU9OUyAtIG5vIHNpZGUgZWZmZWN0cywgbm8gZGF0YWJhc2UgYWNjZXNzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVRvb2xJbnB1dCB7XG4gIHVzZXJQcm9tcHQ6IHN0cmluZztcbiAgcHJvamVjdElkOiBzdHJpbmc7ICAvLyBGb3IgY29udGV4dCBvbmx5LCBub3QgREIgYWNjZXNzXG4gIHVzZXJJZD86IHN0cmluZzsgICAgLy8gRm9yIGNvbnRleHQgb25seSwgbm90IERCIGFjY2Vzc1xufVxuXG4vKipcbiAqIEJhc2Ugb3V0cHV0IHRoYXQgYWxsIHRvb2xzIHJldHVyblxuICogTVVTVCBtYXRjaCBkYXRhYmFzZSBmaWVsZCBuYW1lcyBleGFjdGx5XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVRvb2xPdXRwdXQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICB0c3hDb2RlPzogc3RyaW5nOyAgICAgIC8vIOKckyBDb3JyZWN0IGZpZWxkIG5hbWUgKHdhcyBzY2VuZUNvZGUpXG4gIG5hbWU/OiBzdHJpbmc7ICAgICAgICAgLy8g4pyTIENvcnJlY3QgZmllbGQgbmFtZSAod2FzIHNjZW5lTmFtZSlcbiAgZHVyYXRpb24/OiBudW1iZXI7ICAgICAvLyBBbHdheXMgaW4gZnJhbWVzXG4gIHJlYXNvbmluZzogc3RyaW5nO1xuICBjaGF0UmVzcG9uc2U/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xuICBkZWJ1Zz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBzY2VuZT86IGFueTsgICAgICAgICAgIC8vIFNjZW5lIG9iamVjdCBmb3IgZGF0YWJhc2Ugb3BlcmF0aW9uc1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBREQgVE9PTCBUWVBFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIEFkZFRvb2xJbnB1dCBleHRlbmRzIEJhc2VUb29sSW5wdXQge1xuICBzY2VuZU51bWJlcj86IG51bWJlcjtcbiAgcHJldmlvdXNTY2VuZUNvbnRleHQ/OiB7XG4gICAgdHN4Q29kZTogc3RyaW5nO1xuICAgIHN0eWxlPzogc3RyaW5nO1xuICB9O1xuICBpbWFnZVVybHM/OiBzdHJpbmdbXTtcbiAgdmlzaW9uQW5hbHlzaXM/OiBhbnk7XG4gIHdlYkNvbnRleHQ/OiB7XG4gICAgb3JpZ2luYWxVcmw6IHN0cmluZztcbiAgICBzY3JlZW5zaG90VXJsczoge1xuICAgICAgZGVza3RvcDogc3RyaW5nO1xuICAgICAgbW9iaWxlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBwYWdlRGF0YToge1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgaGVhZGluZ3M6IHN0cmluZ1tdO1xuICAgICAgdXJsOiBzdHJpbmc7XG4gICAgfTtcbiAgICBhbmFseXplZEF0OiBzdHJpbmc7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWRkVG9vbE91dHB1dCBleHRlbmRzIEJhc2VUb29sT3V0cHV0IHtcbiAgdHN4Q29kZTogc3RyaW5nOyAgICAgICAvLyBSZXF1aXJlZCBmb3IgbmV3IHNjZW5lc1xuICBuYW1lOiBzdHJpbmc7ICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBuZXcgc2NlbmVzXG4gIGR1cmF0aW9uOiBudW1iZXI7ICAgICAgLy8gUmVxdWlyZWQgZm9yIG5ldyBzY2VuZXNcbiAgbGF5b3V0SnNvbj86IHN0cmluZztcbiAgcHJvcHM/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFRElUIFRPT0wgVFlQRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBFZGl0VG9vbElucHV0IGV4dGVuZHMgQmFzZVRvb2xJbnB1dCB7XG4gIHNjZW5lSWQ6IHN0cmluZzsgICAgICAgLy8gSnVzdCBmb3IgcmVmZXJlbmNlXG4gIHRzeENvZGU6IHN0cmluZzsgICAgICAgLy8g4pyTIEZJWEVEOiBXYXMgZXhpc3RpbmdDb2RlXG4gIGN1cnJlbnREdXJhdGlvbj86IG51bWJlcjtcbiAgaW1hZ2VVcmxzPzogc3RyaW5nW107XG4gIHZpc2lvbkFuYWx5c2lzPzogYW55O1xuICBlcnJvckRldGFpbHM/OiBzdHJpbmc7XG4gIHJlZmVyZW5jZVNjZW5lcz86IEFycmF5PHsgIC8vIEZvciBjcm9zcy1zY2VuZSBzdHlsZS9jb2xvciBtYXRjaGluZ1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHRzeENvZGU6IHN0cmluZztcbiAgfT47XG4gIHdlYkNvbnRleHQ/OiB7XG4gICAgb3JpZ2luYWxVcmw6IHN0cmluZztcbiAgICBzY3JlZW5zaG90VXJsczoge1xuICAgICAgZGVza3RvcDogc3RyaW5nO1xuICAgICAgbW9iaWxlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBwYWdlRGF0YToge1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgaGVhZGluZ3M6IHN0cmluZ1tdO1xuICAgICAgdXJsOiBzdHJpbmc7XG4gICAgfTtcbiAgICBhbmFseXplZEF0OiBzdHJpbmc7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRWRpdFRvb2xPdXRwdXQgZXh0ZW5kcyBCYXNlVG9vbE91dHB1dCB7XG4gIHRzeENvZGU6IHN0cmluZzsgICAgICAgLy8gVXBkYXRlZCBjb2RlXG4gIGR1cmF0aW9uPzogbnVtYmVyOyAgICAgLy8gT25seSBpZiBjaGFuZ2VkXG4gIHByb3BzPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgY2hhbmdlc0FwcGxpZWQ/OiBzdHJpbmdbXTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREVMRVRFIFRPT0wgVFlQRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBEZWxldGVUb29sSW5wdXQgZXh0ZW5kcyBCYXNlVG9vbElucHV0IHtcbiAgc2NlbmVJZDogc3RyaW5nOyAgICAgICAvLyBXaGljaCBzY2VuZSB0byBkZWxldGVcbiAgY29uZmlybURlbGV0aW9uPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEZWxldGVUb29sT3V0cHV0IGV4dGVuZHMgQmFzZVRvb2xPdXRwdXQge1xuICBkZWxldGVkU2NlbmVJZDogc3RyaW5nO1xuICAvLyBObyBjb250ZW50IGdlbmVyYXRpb24gbmVlZGVkIGZvciBkZWxldGVcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVFJJTSBUT09MIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJpbVRvb2xJbnB1dCBleHRlbmRzIEJhc2VUb29sSW5wdXQge1xuICBzY2VuZUlkOiBzdHJpbmc7ICAgICAgICAgIC8vIFdoaWNoIHNjZW5lIHRvIHRyaW1cbiAgY3VycmVudER1cmF0aW9uOiBudW1iZXI7ICAvLyBDdXJyZW50IGR1cmF0aW9uIGluIGZyYW1lc1xuICBuZXdEdXJhdGlvbj86IG51bWJlcjsgICAgIC8vIE5ldyBkdXJhdGlvbiBpbiBmcmFtZXNcbiAgdHJpbUZyYW1lcz86IG51bWJlcjsgICAgICAvLyBGcmFtZXMgdG8gYWRkIChwb3NpdGl2ZSkgb3IgcmVtb3ZlIChuZWdhdGl2ZSlcbiAgdHJpbVR5cGU/OiAnc3RhcnQnIHwgJ2VuZCc7IC8vIFdoZXJlIHRvIHRyaW0gZnJvbVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyaW1Ub29sT3V0cHV0IGV4dGVuZHMgQmFzZVRvb2xPdXRwdXQge1xuICBkdXJhdGlvbjogbnVtYmVyOyAgICAgICAgIC8vIE5ldyBkdXJhdGlvblxuICB0cmltbWVkRnJhbWVzOiBudW1iZXI7ICAgIC8vIEhvdyBtYW55IGZyYW1lcyB3ZXJlIHRyaW1tZWRcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU0VSVklDRSBIRUxQRVIgVFlQRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBMYXlvdXQgZ2VuZXJhdGlvbiBpbnB1dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIExheW91dEdlbmVyYXRpb25JbnB1dCB7XG4gIHVzZXJQcm9tcHQ6IHN0cmluZztcbiAgcHJvamVjdElkOiBzdHJpbmc7XG4gIHNjZW5lTnVtYmVyPzogbnVtYmVyO1xuICBwcmV2aW91c1NjZW5lSnNvbj86IHN0cmluZztcbiAgdmlzaW9uQW5hbHlzaXM/OiBhbnk7XG59XG5cbi8qKlxuICogTGF5b3V0IGdlbmVyYXRpb24gb3V0cHV0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTGF5b3V0R2VuZXJhdGlvbk91dHB1dCB7XG4gIGxheW91dEpzb246IGFueTtcbiAgcmVhc29uaW5nOiBzdHJpbmc7XG4gIGRlYnVnPzogYW55O1xufVxuXG4vKipcbiAqIENvZGUgZ2VuZXJhdGlvbiBpbnB1dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvZGVHZW5lcmF0aW9uSW5wdXQge1xuICB1c2VyUHJvbXB0OiBzdHJpbmc7XG4gIGxheW91dEpzb246IGFueTtcbiAgZnVuY3Rpb25OYW1lOiBzdHJpbmc7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICB2aXNpb25BbmFseXNpcz86IGFueTtcbn1cblxuLyoqXG4gKiBDb2RlIGdlbmVyYXRpb24gb3V0cHV0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29kZUdlbmVyYXRpb25PdXRwdXQge1xuICBjb2RlOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgZHVyYXRpb246IG51bWJlcjtcbiAgcmVhc29uaW5nOiBzdHJpbmc7XG4gIGRlYnVnPzogYW55O1xufVxuXG4vKipcbiAqIEltYWdlLXRvLWNvZGUgZ2VuZXJhdGlvbiBpbnB1dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEltYWdlVG9Db2RlSW5wdXQge1xuICBpbWFnZVVybHM6IHN0cmluZ1tdO1xuICB1c2VyUHJvbXB0OiBzdHJpbmc7XG4gIGZ1bmN0aW9uTmFtZTogc3RyaW5nO1xuICB2aXNpb25BbmFseXNpcz86IGFueTtcbn1cblxuLyoqXG4gKiBDcmVhdGl2ZSBlZGl0aW5nIGlucHV0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRpdmVFZGl0SW5wdXQge1xuICB1c2VyUHJvbXB0OiBzdHJpbmc7XG4gIHRzeENvZGU6IHN0cmluZzsgICAgICAgIC8vIOKckyBGSVhFRDogV2FzIGV4aXN0aW5nQ29kZVxuICBmdW5jdGlvbk5hbWU6IHN0cmluZztcbiAgaW1hZ2VVcmxzPzogc3RyaW5nW107XG4gIHZpc2lvbkFuYWx5c2lzPzogYW55O1xufVxuXG4vKipcbiAqIFN1cmdpY2FsIGVkaXRpbmcgaW5wdXRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdXJnaWNhbEVkaXRJbnB1dCB7XG4gIHVzZXJQcm9tcHQ6IHN0cmluZztcbiAgdHN4Q29kZTogc3RyaW5nOyAgICAgICAgLy8g4pyTIEZJWEVEOiBXYXMgZXhpc3RpbmdDb2RlXG4gIGZ1bmN0aW9uTmFtZTogc3RyaW5nO1xuICB0YXJnZXRFbGVtZW50Pzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEVycm9yIGZpeGluZyBpbnB1dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVycm9yRml4SW5wdXQge1xuICB0c3hDb2RlOiBzdHJpbmc7ICAgICAgICAvLyDinJMgRklYRUQ6IFdhcyBleGlzdGluZ0NvZGVcbiAgZXJyb3JEZXRhaWxzOiBzdHJpbmc7XG4gIHVzZXJQcm9tcHQ/OiBzdHJpbmc7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFpPRCBTQ0hFTUFTIEZPUiBWQUxJREFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBiYXNlVG9vbElucHV0U2NoZW1hID0gei5vYmplY3Qoe1xuICB1c2VyUHJvbXB0OiB6LnN0cmluZygpLmRlc2NyaWJlKFwiVXNlcidzIGRlc2NyaXB0aW9uIG9mIHdoYXQgdGhleSB3YW50XCIpLFxuICBwcm9qZWN0SWQ6IHouc3RyaW5nKCkuZGVzY3JpYmUoXCJQcm9qZWN0IElEIGZvciBjb250ZXh0IG9ubHlcIiksXG4gIHVzZXJJZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLmRlc2NyaWJlKFwiVXNlciBJRCBmb3IgY29udGV4dCBvbmx5XCIpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBhZGRUb29sSW5wdXRTY2hlbWEgPSBiYXNlVG9vbElucHV0U2NoZW1hLmV4dGVuZCh7XG4gIHNjZW5lTnVtYmVyOiB6Lm51bWJlcigpLm9wdGlvbmFsKCkuZGVzY3JpYmUoXCJPcHRpb25hbCBzY2VuZSBudW1iZXIvcG9zaXRpb25cIiksXG4gIHByZXZpb3VzU2NlbmVDb250ZXh0OiB6Lm9iamVjdCh7XG4gICAgdHN4Q29kZTogei5zdHJpbmcoKSxcbiAgICBzdHlsZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB9KS5vcHRpb25hbCgpLmRlc2NyaWJlKFwiUHJldmlvdXMgc2NlbmUgZm9yIHN0eWxlIGNvbnNpc3RlbmN5XCIpLFxuICB2aXNpb25BbmFseXNpczogei5hbnkoKS5vcHRpb25hbCgpLmRlc2NyaWJlKFwiVmlzaW9uIGFuYWx5c2lzIGZyb20gaW1hZ2UgYW5hbHlzaXNcIiksXG4gIGltYWdlVXJsczogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLmRlc2NyaWJlKFwiSW1hZ2UgVVJMcyBmb3IgcmVmZXJlbmNlXCIpLFxuICB3ZWJDb250ZXh0OiB6Lm9iamVjdCh7XG4gICAgb3JpZ2luYWxVcmw6IHouc3RyaW5nKCksXG4gICAgc2NyZWVuc2hvdFVybHM6IHoub2JqZWN0KHtcbiAgICAgIGRlc2t0b3A6IHouc3RyaW5nKCksXG4gICAgICBtb2JpbGU6IHouc3RyaW5nKCksXG4gICAgfSksXG4gICAgcGFnZURhdGE6IHoub2JqZWN0KHtcbiAgICAgIHRpdGxlOiB6LnN0cmluZygpLFxuICAgICAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgIGhlYWRpbmdzOiB6LmFycmF5KHouc3RyaW5nKCkpLFxuICAgICAgdXJsOiB6LnN0cmluZygpLFxuICAgIH0pLFxuICAgIGFuYWx5emVkQXQ6IHouc3RyaW5nKCksXG4gIH0pLm9wdGlvbmFsKCkuZGVzY3JpYmUoXCJXZWIgYW5hbHlzaXMgY29udGV4dCB3aXRoIHNjcmVlbnNob3RzIGZvciBicmFuZCBtYXRjaGluZ1wiKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgZWRpdFRvb2xJbnB1dFNjaGVtYSA9IGJhc2VUb29sSW5wdXRTY2hlbWEuZXh0ZW5kKHtcbiAgc2NlbmVJZDogei5zdHJpbmcoKS5kZXNjcmliZShcIklEIG9mIHRoZSBzY2VuZSB0byBlZGl0IChyZWZlcmVuY2Ugb25seSlcIiksXG4gIHRzeENvZGU6IHouc3RyaW5nKCkuZGVzY3JpYmUoXCJDdXJyZW50IHNjZW5lIFRTWCBjb2RlXCIpLFxuICBjdXJyZW50RHVyYXRpb246IHoubnVtYmVyKCkub3B0aW9uYWwoKS5kZXNjcmliZShcIkN1cnJlbnQgZHVyYXRpb24gaW4gZnJhbWVzXCIpLFxuICBpbWFnZVVybHM6IHouYXJyYXkoei5zdHJpbmcoKSkub3B0aW9uYWwoKS5kZXNjcmliZShcIkltYWdlIFVSTHMgZm9yIHJlZmVyZW5jZVwiKSxcbiAgdmlzaW9uQW5hbHlzaXM6IHouYW55KCkub3B0aW9uYWwoKS5kZXNjcmliZShcIlZpc2lvbiBhbmFseXNpcyBmcm9tIGltYWdlIGFuYWx5c2lzXCIpLFxuICBlcnJvckRldGFpbHM6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5kZXNjcmliZShcIkVycm9yIGRldGFpbHMgaWYgZml4aW5nIGVycm9yc1wiKSxcbiAgd2ViQ29udGV4dDogei5vYmplY3Qoe1xuICAgIG9yaWdpbmFsVXJsOiB6LnN0cmluZygpLFxuICAgIHNjcmVlbnNob3RVcmxzOiB6Lm9iamVjdCh7XG4gICAgICBkZXNrdG9wOiB6LnN0cmluZygpLFxuICAgICAgbW9iaWxlOiB6LnN0cmluZygpLFxuICAgIH0pLFxuICAgIHBhZ2VEYXRhOiB6Lm9iamVjdCh7XG4gICAgICB0aXRsZTogei5zdHJpbmcoKSxcbiAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICBoZWFkaW5nczogei5hcnJheSh6LnN0cmluZygpKSxcbiAgICAgIHVybDogei5zdHJpbmcoKSxcbiAgICB9KSxcbiAgICBhbmFseXplZEF0OiB6LnN0cmluZygpLFxuICB9KS5vcHRpb25hbCgpLmRlc2NyaWJlKFwiV2ViIGFuYWx5c2lzIGNvbnRleHQgd2l0aCBzY3JlZW5zaG90cyBmb3IgYnJhbmQgbWF0Y2hpbmdcIiksXG59KTtcblxuZXhwb3J0IGNvbnN0IGRlbGV0ZVRvb2xJbnB1dFNjaGVtYSA9IGJhc2VUb29sSW5wdXRTY2hlbWEuZXh0ZW5kKHtcbiAgc2NlbmVJZDogei5zdHJpbmcoKS5kZXNjcmliZShcIklEIG9mIHRoZSBzY2VuZSB0byBkZWxldGVcIiksXG4gIGNvbmZpcm1EZWxldGlvbjogei5ib29sZWFuKCkub3B0aW9uYWwoKS5kZXNjcmliZShcIkNvbmZpcm1hdGlvbiBmbGFnIGZvciBkZWxldGlvblwiKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgdHJpbVRvb2xJbnB1dFNjaGVtYSA9IGJhc2VUb29sSW5wdXRTY2hlbWEuZXh0ZW5kKHtcbiAgc2NlbmVJZDogei5zdHJpbmcoKS5kZXNjcmliZShcIklEIG9mIHRoZSBzY2VuZSB0byB0cmltXCIpLFxuICBjdXJyZW50RHVyYXRpb246IHoubnVtYmVyKCkuZGVzY3JpYmUoXCJDdXJyZW50IGR1cmF0aW9uIGluIGZyYW1lc1wiKSxcbiAgbmV3RHVyYXRpb246IHoubnVtYmVyKCkub3B0aW9uYWwoKS5kZXNjcmliZShcIlRhcmdldCBkdXJhdGlvbiBpbiBmcmFtZXNcIiksXG4gIHRyaW1GcmFtZXM6IHoubnVtYmVyKCkub3B0aW9uYWwoKS5kZXNjcmliZShcIkZyYW1lcyB0byBhZGQgKHBvc2l0aXZlKSBvciByZW1vdmUgKG5lZ2F0aXZlKVwiKSxcbiAgdHJpbVR5cGU6IHouZW51bShbJ3N0YXJ0JywgJ2VuZCddKS5vcHRpb25hbCgpLmRlZmF1bHQoJ2VuZCcpLmRlc2NyaWJlKFwiV2hlcmUgdG8gdHJpbSBmcm9tXCIpLFxufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBST0dSRVNTIENBTExCQUNLIFRZUEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgUHJvZ3Jlc3NDYWxsYmFjayA9IChzdGFnZTogc3RyaW5nLCBzdGF0dXM6IHN0cmluZykgPT4gdm9pZDtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVE9PTCBSRVNVTFQgV1JBUFBFUlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFRvb2xSZXN1bHQ8VCA9IEJhc2VUb29sT3V0cHV0PiB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGRhdGE/OiBUO1xuICBlcnJvcj86IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgfTtcbiAgbWV0YWRhdGE/OiB7XG4gICAgZXhlY3V0aW9uVGltZTogbnVtYmVyO1xuICAgIHRvb2xOYW1lOiBzdHJpbmc7XG4gICAgdGltZXN0YW1wOiBzdHJpbmc7XG4gIH07XG59ICJdLCJuYW1lcyI6WyJ6IiwiYmFzZVRvb2xJbnB1dFNjaGVtYSIsIm9iamVjdCIsInVzZXJQcm9tcHQiLCJzdHJpbmciLCJkZXNjcmliZSIsInByb2plY3RJZCIsInVzZXJJZCIsIm9wdGlvbmFsIiwiYWRkVG9vbElucHV0U2NoZW1hIiwiZXh0ZW5kIiwic2NlbmVOdW1iZXIiLCJudW1iZXIiLCJwcmV2aW91c1NjZW5lQ29udGV4dCIsInRzeENvZGUiLCJzdHlsZSIsInZpc2lvbkFuYWx5c2lzIiwiYW55IiwiaW1hZ2VVcmxzIiwiYXJyYXkiLCJ3ZWJDb250ZXh0Iiwib3JpZ2luYWxVcmwiLCJzY3JlZW5zaG90VXJscyIsImRlc2t0b3AiLCJtb2JpbGUiLCJwYWdlRGF0YSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJoZWFkaW5ncyIsInVybCIsImFuYWx5emVkQXQiLCJlZGl0VG9vbElucHV0U2NoZW1hIiwic2NlbmVJZCIsImN1cnJlbnREdXJhdGlvbiIsImVycm9yRGV0YWlscyIsImRlbGV0ZVRvb2xJbnB1dFNjaGVtYSIsImNvbmZpcm1EZWxldGlvbiIsImJvb2xlYW4iLCJ0cmltVG9vbElucHV0U2NoZW1hIiwibmV3RHVyYXRpb24iLCJ0cmltRnJhbWVzIiwidHJpbVR5cGUiLCJlbnVtIiwiZGVmYXVsdCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/helpers/types.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/trim/trim.ts":
/*!********************************!*\
  !*** ./src/tools/trim/trim.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TrimTool: () => (/* binding */ TrimTool),\n/* harmony export */   trimTool: () => (/* binding */ trimTool)\n/* harmony export */ });\n/* harmony import */ var _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ~/tools/helpers/base */ \"(rsc)/./src/tools/helpers/base.ts\");\n/* harmony import */ var _tools_helpers_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/tools/helpers/types */ \"(rsc)/./src/tools/helpers/types.ts\");\n\n\n/**\n * TRIM Tool - Fast duration adjustment without AI\n * Used for simple cuts, extensions, or duration changes\n * NO AI PROCESSING - just metadata update\n */ class TrimTool extends _tools_helpers_base__WEBPACK_IMPORTED_MODULE_0__.BaseMCPTool {\n    async execute(input) {\n        try {\n            console.log(' [TRIM TOOL] Executing trim:', {\n                prompt: input.userPrompt,\n                sceneId: input.sceneId,\n                newDuration: input.newDuration,\n                trimFrames: input.trimFrames,\n                trimType: input.trimType\n            });\n            // Parse the user prompt to extract duration intent\n            const durationInfo = this.parseDurationFromPrompt(input.userPrompt);\n            // Determine the new duration\n            let newDuration;\n            const currentDuration = input.currentDuration;\n            if (input.newDuration) {\n                newDuration = input.newDuration;\n            } else if (input.trimFrames) {\n                newDuration = Math.max(1, currentDuration + input.trimFrames);\n            } else if (durationInfo) {\n                newDuration = durationInfo.frames;\n            } else {\n                throw new Error(\"Could not determine new duration from input\");\n            }\n            const trimmedFrames = currentDuration - newDuration;\n            console.log(' [TRIM TOOL] Duration change:', {\n                from: currentDuration,\n                to: newDuration,\n                trimmed: trimmedFrames\n            });\n            // Return the trim instruction - NO CODE GENERATION\n            return {\n                success: true,\n                duration: newDuration,\n                trimmedFrames: trimmedFrames,\n                reasoning: `${trimmedFrames > 0 ? 'Trimmed' : 'Extended'} scene by ${Math.abs(trimmedFrames)} frames`,\n                chatResponse: trimmedFrames > 0 ? `I'll cut ${Math.abs(trimmedFrames / 30).toFixed(1)} seconds from the ${input.trimType} of the scene` : `I'll extend the scene by ${Math.abs(trimmedFrames / 30).toFixed(1)} seconds`\n            };\n        } catch (error) {\n            console.error(' [TRIM TOOL] Error:', error);\n            return {\n                success: false,\n                reasoning: `Trim failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                error: error instanceof Error ? error.message : 'Unknown error'\n            };\n        }\n    }\n    parseDurationFromPrompt(prompt) {\n        // Match patterns like \"3 seconds\", \"90 frames\", \"make it 5s\"\n        const secondsMatch = prompt.match(/(\\d+(?:\\.\\d+)?)\\s*(?:seconds?|secs?|s)/i);\n        const framesMatch = prompt.match(/(\\d+)\\s*(?:frames?|f)/i);\n        if (secondsMatch && secondsMatch[1]) {\n            const seconds = parseFloat(secondsMatch[1]);\n            return {\n                seconds,\n                frames: Math.round(seconds * 30)\n            }; // 30fps\n        }\n        if (framesMatch && framesMatch[1]) {\n            const frames = parseInt(framesMatch[1]);\n            return {\n                frames,\n                seconds: frames / 30\n            };\n        }\n        return null;\n    }\n    constructor(...args){\n        super(...args), this.name = \"TRIM\", this.description = \"Fast duration adjustment for scenes without modifying animations\", this.inputSchema = _tools_helpers_types__WEBPACK_IMPORTED_MODULE_1__.trimToolInputSchema;\n    }\n}\n// Export singleton instance\nconst trimTool = new TrimTool();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QztBQUVBLDRCQUE0QjtBQUNyQixNQUFNeUMsV0FBVyxJQUFJeEMsV0FBVyIsInNvdXJjZXMiOlsiL1VzZXJzL21hcmt1c2hvZ25lL0RvY3VtZW50cy9BUFBTL2JhemFhci12aWQvYmF6YWFyLXZpZC9hcHBzL21haW4vc3JjL3Rvb2xzL3RyaW0vdHJpbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlTUNQVG9vbCB9IGZyb20gXCJ+L3Rvb2xzL2hlbHBlcnMvYmFzZVwiO1xuaW1wb3J0IHR5cGUgeyBUcmltVG9vbElucHV0LCBUcmltVG9vbE91dHB1dCB9IGZyb20gXCJ+L3Rvb2xzL2hlbHBlcnMvdHlwZXNcIjtcbmltcG9ydCB7IHRyaW1Ub29sSW5wdXRTY2hlbWEgfSBmcm9tIFwifi90b29scy9oZWxwZXJzL3R5cGVzXCI7XG5cbi8qKlxuICogVFJJTSBUb29sIC0gRmFzdCBkdXJhdGlvbiBhZGp1c3RtZW50IHdpdGhvdXQgQUlcbiAqIFVzZWQgZm9yIHNpbXBsZSBjdXRzLCBleHRlbnNpb25zLCBvciBkdXJhdGlvbiBjaGFuZ2VzXG4gKiBOTyBBSSBQUk9DRVNTSU5HIC0ganVzdCBtZXRhZGF0YSB1cGRhdGVcbiAqL1xuXG5leHBvcnQgY2xhc3MgVHJpbVRvb2wgZXh0ZW5kcyBCYXNlTUNQVG9vbDxUcmltVG9vbElucHV0LCBUcmltVG9vbE91dHB1dD4ge1xuICBuYW1lID0gXCJUUklNXCI7XG4gIGRlc2NyaXB0aW9uID0gXCJGYXN0IGR1cmF0aW9uIGFkanVzdG1lbnQgZm9yIHNjZW5lcyB3aXRob3V0IG1vZGlmeWluZyBhbmltYXRpb25zXCI7XG4gIGlucHV0U2NoZW1hID0gdHJpbVRvb2xJbnB1dFNjaGVtYTtcblxuICBwcm90ZWN0ZWQgYXN5bmMgZXhlY3V0ZShpbnB1dDogVHJpbVRvb2xJbnB1dCk6IFByb21pc2U8VHJpbVRvb2xPdXRwdXQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ+Kcgu+4jyBbVFJJTSBUT09MXSBFeGVjdXRpbmcgdHJpbTonLCB7XG4gICAgICAgIHByb21wdDogaW5wdXQudXNlclByb21wdCxcbiAgICAgICAgc2NlbmVJZDogaW5wdXQuc2NlbmVJZCxcbiAgICAgICAgbmV3RHVyYXRpb246IGlucHV0Lm5ld0R1cmF0aW9uLFxuICAgICAgICB0cmltRnJhbWVzOiBpbnB1dC50cmltRnJhbWVzLFxuICAgICAgICB0cmltVHlwZTogaW5wdXQudHJpbVR5cGVcbiAgICAgIH0pO1xuXG4gICAgICAvLyBQYXJzZSB0aGUgdXNlciBwcm9tcHQgdG8gZXh0cmFjdCBkdXJhdGlvbiBpbnRlbnRcbiAgICAgIGNvbnN0IGR1cmF0aW9uSW5mbyA9IHRoaXMucGFyc2VEdXJhdGlvbkZyb21Qcm9tcHQoaW5wdXQudXNlclByb21wdCk7XG4gICAgICBcbiAgICAgIC8vIERldGVybWluZSB0aGUgbmV3IGR1cmF0aW9uXG4gICAgICBsZXQgbmV3RHVyYXRpb246IG51bWJlcjtcbiAgICAgIGNvbnN0IGN1cnJlbnREdXJhdGlvbiA9IGlucHV0LmN1cnJlbnREdXJhdGlvbjtcbiAgICAgIFxuICAgICAgaWYgKGlucHV0Lm5ld0R1cmF0aW9uKSB7XG4gICAgICAgIG5ld0R1cmF0aW9uID0gaW5wdXQubmV3RHVyYXRpb247XG4gICAgICB9IGVsc2UgaWYgKGlucHV0LnRyaW1GcmFtZXMpIHtcbiAgICAgICAgbmV3RHVyYXRpb24gPSBNYXRoLm1heCgxLCBjdXJyZW50RHVyYXRpb24gKyBpbnB1dC50cmltRnJhbWVzKTtcbiAgICAgIH0gZWxzZSBpZiAoZHVyYXRpb25JbmZvKSB7XG4gICAgICAgIG5ld0R1cmF0aW9uID0gZHVyYXRpb25JbmZvLmZyYW1lcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBkZXRlcm1pbmUgbmV3IGR1cmF0aW9uIGZyb20gaW5wdXRcIik7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRyaW1tZWRGcmFtZXMgPSBjdXJyZW50RHVyYXRpb24gLSBuZXdEdXJhdGlvbjtcblxuICAgICAgY29uc29sZS5sb2coJ+Kcgu+4jyBbVFJJTSBUT09MXSBEdXJhdGlvbiBjaGFuZ2U6Jywge1xuICAgICAgICBmcm9tOiBjdXJyZW50RHVyYXRpb24sXG4gICAgICAgIHRvOiBuZXdEdXJhdGlvbixcbiAgICAgICAgdHJpbW1lZDogdHJpbW1lZEZyYW1lc1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFJldHVybiB0aGUgdHJpbSBpbnN0cnVjdGlvbiAtIE5PIENPREUgR0VORVJBVElPTlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZHVyYXRpb246IG5ld0R1cmF0aW9uLFxuICAgICAgICB0cmltbWVkRnJhbWVzOiB0cmltbWVkRnJhbWVzLFxuICAgICAgICByZWFzb25pbmc6IGAke3RyaW1tZWRGcmFtZXMgPiAwID8gJ1RyaW1tZWQnIDogJ0V4dGVuZGVkJ30gc2NlbmUgYnkgJHtNYXRoLmFicyh0cmltbWVkRnJhbWVzKX0gZnJhbWVzYCxcbiAgICAgICAgY2hhdFJlc3BvbnNlOiB0cmltbWVkRnJhbWVzID4gMCBcbiAgICAgICAgICA/IGBJJ2xsIGN1dCAke01hdGguYWJzKHRyaW1tZWRGcmFtZXMgLyAzMCkudG9GaXhlZCgxKX0gc2Vjb25kcyBmcm9tIHRoZSAke2lucHV0LnRyaW1UeXBlfSBvZiB0aGUgc2NlbmVgXG4gICAgICAgICAgOiBgSSdsbCBleHRlbmQgdGhlIHNjZW5lIGJ5ICR7TWF0aC5hYnModHJpbW1lZEZyYW1lcyAvIDMwKS50b0ZpeGVkKDEpfSBzZWNvbmRzYCxcbiAgICAgIH07XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4pyC77iPIFtUUklNIFRPT0xdIEVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICByZWFzb25pbmc6IGBUcmltIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9IGFzIFRyaW1Ub29sT3V0cHV0O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VEdXJhdGlvbkZyb21Qcm9tcHQocHJvbXB0OiBzdHJpbmcpOiB7IGZyYW1lczogbnVtYmVyOyBzZWNvbmRzOiBudW1iZXIgfSB8IG51bGwge1xuICAgIC8vIE1hdGNoIHBhdHRlcm5zIGxpa2UgXCIzIHNlY29uZHNcIiwgXCI5MCBmcmFtZXNcIiwgXCJtYWtlIGl0IDVzXCJcbiAgICBjb25zdCBzZWNvbmRzTWF0Y2ggPSBwcm9tcHQubWF0Y2goLyhcXGQrKD86XFwuXFxkKyk/KVxccyooPzpzZWNvbmRzP3xzZWNzP3xzKS9pKTtcbiAgICBjb25zdCBmcmFtZXNNYXRjaCA9IHByb21wdC5tYXRjaCgvKFxcZCspXFxzKig/OmZyYW1lcz98ZikvaSk7XG4gICAgXG4gICAgaWYgKHNlY29uZHNNYXRjaCAmJiBzZWNvbmRzTWF0Y2hbMV0pIHtcbiAgICAgIGNvbnN0IHNlY29uZHMgPSBwYXJzZUZsb2F0KHNlY29uZHNNYXRjaFsxXSk7XG4gICAgICByZXR1cm4geyBzZWNvbmRzLCBmcmFtZXM6IE1hdGgucm91bmQoc2Vjb25kcyAqIDMwKSB9OyAvLyAzMGZwc1xuICAgIH1cbiAgICBcbiAgICBpZiAoZnJhbWVzTWF0Y2ggJiYgZnJhbWVzTWF0Y2hbMV0pIHtcbiAgICAgIGNvbnN0IGZyYW1lcyA9IHBhcnNlSW50KGZyYW1lc01hdGNoWzFdKTtcbiAgICAgIHJldHVybiB7IGZyYW1lcywgc2Vjb25kczogZnJhbWVzIC8gMzAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHRyaW1Ub29sID0gbmV3IFRyaW1Ub29sKCk7Il0sIm5hbWVzIjpbIkJhc2VNQ1BUb29sIiwidHJpbVRvb2xJbnB1dFNjaGVtYSIsIlRyaW1Ub29sIiwiZXhlY3V0ZSIsImlucHV0IiwiY29uc29sZSIsImxvZyIsInByb21wdCIsInVzZXJQcm9tcHQiLCJzY2VuZUlkIiwibmV3RHVyYXRpb24iLCJ0cmltRnJhbWVzIiwidHJpbVR5cGUiLCJkdXJhdGlvbkluZm8iLCJwYXJzZUR1cmF0aW9uRnJvbVByb21wdCIsImN1cnJlbnREdXJhdGlvbiIsIk1hdGgiLCJtYXgiLCJmcmFtZXMiLCJFcnJvciIsInRyaW1tZWRGcmFtZXMiLCJmcm9tIiwidG8iLCJ0cmltbWVkIiwic3VjY2VzcyIsImR1cmF0aW9uIiwicmVhc29uaW5nIiwiYWJzIiwiY2hhdFJlc3BvbnNlIiwidG9GaXhlZCIsImVycm9yIiwibWVzc2FnZSIsInNlY29uZHNNYXRjaCIsIm1hdGNoIiwiZnJhbWVzTWF0Y2giLCJzZWNvbmRzIiwicGFyc2VGbG9hdCIsInJvdW5kIiwicGFyc2VJbnQiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJpbnB1dFNjaGVtYSIsInRyaW1Ub29sIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/trim/trim.ts\n");

/***/ }),

/***/ "(rsc)/./src/tools/webAnalysis/WebAnalysisAgent.ts":
/*!***************************************************!*\
  !*** ./src/tools/webAnalysis/WebAnalysisAgent.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WebAnalysisAgent: () => (/* binding */ WebAnalysisAgent)\n/* harmony export */ });\n/* harmony import */ var playwright__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! playwright */ \"playwright\");\n/* harmony import */ var _lib_utils_r2_upload__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ~/lib/utils/r2-upload */ \"(rsc)/./src/lib/utils/r2-upload.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([playwright__WEBPACK_IMPORTED_MODULE_0__]);\nplaywright__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nclass WebAnalysisAgent {\n    async analyzeWebsite(url, projectId, userId) {\n        console.log(` Analyzing: ${url}`);\n        const browser = await playwright__WEBPACK_IMPORTED_MODULE_0__.chromium.launch({\n            headless: true,\n            args: [\n                '--no-sandbox',\n                '--disable-setuid-sandbox'\n            ] // For production deployment\n        });\n        try {\n            const page = await browser.newPage();\n            // Navigate with timeout\n            console.log(' Navigating to website...');\n            await page.goto(url, {\n                waitUntil: 'networkidle',\n                timeout: 10000\n            });\n            // Desktop screenshot\n            console.log(' Taking desktop screenshot...');\n            await page.setViewportSize({\n                width: 1280,\n                height: 800\n            });\n            const desktopScreenshot = await page.screenshot({\n                type: 'png',\n                fullPage: false\n            });\n            // Mobile screenshot  \n            console.log(' Taking mobile screenshot...');\n            await page.setViewportSize({\n                width: 390,\n                height: 844\n            });\n            const mobileScreenshot = await page.screenshot({\n                type: 'png',\n                fullPage: false\n            });\n            // Extract page data\n            console.log(' Extracting page data...');\n            const pageData = await page.evaluate(()=>({\n                    title: document.title,\n                    description: document.querySelector('meta[name=\"description\"]')?.getAttribute('content') || document.querySelector('meta[property=\"og:description\"]')?.getAttribute('content') || undefined,\n                    headings: Array.from(document.querySelectorAll('h1, h2, h3')).map((h)=>h.textContent?.trim()).filter((text)=>Boolean(text)).slice(0, 10),\n                    url: window.location.href\n                }));\n            console.log(` Analysis complete for ${pageData.title}`);\n            // Upload screenshots to R2 if projectId provided\n            let screenshotUrls;\n            if (projectId) {\n                try {\n                    console.log(' Uploading screenshots to R2...');\n                    screenshotUrls = await (0,_lib_utils_r2_upload__WEBPACK_IMPORTED_MODULE_1__.uploadWebAnalysisScreenshots)({\n                        desktop: desktopScreenshot,\n                        mobile: mobileScreenshot\n                    }, projectId, userId);\n                    console.log(' Screenshots uploaded to R2');\n                } catch (uploadError) {\n                    console.error(' Failed to upload screenshots:', uploadError);\n                // Continue without R2 URLs - screenshots still available as buffers\n                }\n            }\n            return {\n                success: true,\n                url,\n                screenshots: {\n                    desktop: desktopScreenshot,\n                    mobile: mobileScreenshot\n                },\n                screenshotUrls,\n                pageData,\n                analyzedAt: new Date().toISOString()\n            };\n        } catch (error) {\n            console.error(' Analysis failed:', error instanceof Error ? error.message : String(error));\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : String(error),\n                url\n            };\n        } finally{\n            await browser.close();\n        }\n    }\n    /**\n   * Validate if a URL is accessible and safe to analyze\n   */ async validateUrl(url) {\n        try {\n            const parsed = new URL(url);\n            // Only allow http/https\n            if (![\n                'http:',\n                'https:'\n            ].includes(parsed.protocol)) {\n                return {\n                    valid: false,\n                    error: 'Only HTTP and HTTPS URLs are supported'\n                };\n            }\n            // Block localhost and private IPs for security\n            const hostname = parsed.hostname.toLowerCase();\n            if (hostname === 'localhost' || hostname.startsWith('127.') || hostname.startsWith('192.168.') || hostname.startsWith('10.') || hostname.includes('internal')) {\n                return {\n                    valid: false,\n                    error: 'Local and private URLs are not allowed'\n                };\n            }\n            return {\n                valid: true\n            };\n        } catch (error) {\n            return {\n                valid: false,\n                error: 'Invalid URL format'\n            };\n        }\n    }\n    /**\n   * Test if the agent can analyze a given URL without actually doing the analysis\n   */ async testConnection(url) {\n        const validation = await this.validateUrl(url);\n        if (!validation.valid) {\n            return {\n                reachable: false,\n                error: validation.error\n            };\n        }\n        const browser = await playwright__WEBPACK_IMPORTED_MODULE_0__.chromium.launch({\n            headless: true\n        });\n        try {\n            const page = await browser.newPage();\n            await page.goto(url, {\n                waitUntil: 'domcontentloaded',\n                timeout: 5000\n            });\n            const title = await page.title();\n            return {\n                reachable: true,\n                error: title ? undefined : 'Page loaded but no title found'\n            };\n        } catch (error) {\n            return {\n                reachable: false,\n                error: `Cannot reach website: ${error instanceof Error ? error.message : String(error)}`\n            };\n        } finally{\n            await browser.close();\n        }\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvdG9vbHMvd2ViQW5hbHlzaXMvV2ViQW5hbHlzaXNBZ2VudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBc0M7QUFDK0I7QUF1QjlELE1BQU1FO0lBQ1gsTUFBTUMsZUFBZUMsR0FBVyxFQUFFQyxTQUFrQixFQUFFQyxNQUFlLEVBQThCO1FBQ2pHQyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxjQUFjLEVBQUVKLEtBQUs7UUFFbEMsTUFBTUssVUFBVSxNQUFNVCxnREFBUUEsQ0FBQ1UsTUFBTSxDQUFDO1lBQ3BDQyxVQUFVO1lBQ1ZDLE1BQU07Z0JBQUM7Z0JBQWdCO2FBQTJCLENBQUMsNEJBQTRCO1FBQ2pGO1FBRUEsSUFBSTtZQUNGLE1BQU1DLE9BQU8sTUFBTUosUUFBUUssT0FBTztZQUVsQyx3QkFBd0I7WUFDeEJQLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU1LLEtBQUtFLElBQUksQ0FBQ1gsS0FBSztnQkFDbkJZLFdBQVc7Z0JBQ1hDLFNBQVM7WUFDWDtZQUVBLHFCQUFxQjtZQUNyQlYsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTUssS0FBS0ssZUFBZSxDQUFDO2dCQUFFQyxPQUFPO2dCQUFNQyxRQUFRO1lBQUk7WUFDdEQsTUFBTUMsb0JBQW9CLE1BQU1SLEtBQUtTLFVBQVUsQ0FBQztnQkFDOUNDLE1BQU07Z0JBQ05DLFVBQVU7WUFDWjtZQUVBLHNCQUFzQjtZQUN0QmpCLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU1LLEtBQUtLLGVBQWUsQ0FBQztnQkFBRUMsT0FBTztnQkFBS0MsUUFBUTtZQUFJO1lBQ3JELE1BQU1LLG1CQUFtQixNQUFNWixLQUFLUyxVQUFVLENBQUM7Z0JBQzdDQyxNQUFNO2dCQUNOQyxVQUFVO1lBQ1o7WUFFQSxvQkFBb0I7WUFDcEJqQixRQUFRQyxHQUFHLENBQUM7WUFDWixNQUFNa0IsV0FBVyxNQUFNYixLQUFLYyxRQUFRLENBQUMsSUFBTztvQkFDMUNDLE9BQU9DLFNBQVNELEtBQUs7b0JBQ3JCRSxhQUFhRCxTQUFTRSxhQUFhLENBQUMsNkJBQTZCQyxhQUFhLGNBQ2xFSCxTQUFTRSxhQUFhLENBQUMsb0NBQW9DQyxhQUFhLGNBQWNDO29CQUNsR0MsVUFBVUMsTUFBTUMsSUFBSSxDQUFDUCxTQUFTUSxnQkFBZ0IsQ0FBQyxlQUM1Q0MsR0FBRyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFQyxXQUFXLEVBQUVDLFFBQ3hCQyxNQUFNLENBQUMsQ0FBQ0MsT0FBeUJDLFFBQVFELE9BQ3pDRSxLQUFLLENBQUMsR0FBRztvQkFDWnpDLEtBQUswQyxPQUFPQyxRQUFRLENBQUNDLElBQUk7Z0JBQzNCO1lBRUF6QyxRQUFRQyxHQUFHLENBQUMsQ0FBQyx3QkFBd0IsRUFBRWtCLFNBQVNFLEtBQUssRUFBRTtZQUV2RCxpREFBaUQ7WUFDakQsSUFBSXFCO1lBQ0osSUFBSTVDLFdBQVc7Z0JBQ2IsSUFBSTtvQkFDRkUsUUFBUUMsR0FBRyxDQUFDO29CQUNaeUMsaUJBQWlCLE1BQU1oRCxrRkFBNEJBLENBQ2pEO3dCQUFFaUQsU0FBUzdCO3dCQUFtQjhCLFFBQVExQjtvQkFBaUIsR0FDdkRwQixXQUNBQztvQkFFRkMsUUFBUUMsR0FBRyxDQUFDO2dCQUNkLEVBQUUsT0FBTzRDLGFBQWE7b0JBQ3BCN0MsUUFBUThDLEtBQUssQ0FBQyxtQ0FBbUNEO2dCQUNqRCxvRUFBb0U7Z0JBQ3RFO1lBQ0Y7WUFFQSxPQUFPO2dCQUNMRSxTQUFTO2dCQUNUbEQ7Z0JBQ0FtRCxhQUFhO29CQUNYTCxTQUFTN0I7b0JBQ1Q4QixRQUFRMUI7Z0JBQ1Y7Z0JBQ0F3QjtnQkFDQXZCO2dCQUNBOEIsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO1lBQ3BDO1FBRUYsRUFBRSxPQUFPTCxPQUFPO1lBQ2Q5QyxRQUFROEMsS0FBSyxDQUFDLHNCQUFzQkEsaUJBQWlCTSxRQUFRTixNQUFNTyxPQUFPLEdBQUdDLE9BQU9SO1lBQ3BGLE9BQU87Z0JBQ0xDLFNBQVM7Z0JBQ1RELE9BQU9BLGlCQUFpQk0sUUFBUU4sTUFBTU8sT0FBTyxHQUFHQyxPQUFPUjtnQkFDdkRqRDtZQUNGO1FBQ0YsU0FBVTtZQUNSLE1BQU1LLFFBQVFxRCxLQUFLO1FBQ3JCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFlBQVkzRCxHQUFXLEVBQStDO1FBQzFFLElBQUk7WUFDRixNQUFNNEQsU0FBUyxJQUFJQyxJQUFJN0Q7WUFFdkIsd0JBQXdCO1lBQ3hCLElBQUksQ0FBQztnQkFBQztnQkFBUzthQUFTLENBQUM4RCxRQUFRLENBQUNGLE9BQU9HLFFBQVEsR0FBRztnQkFDbEQsT0FBTztvQkFBRUMsT0FBTztvQkFBT2YsT0FBTztnQkFBeUM7WUFDekU7WUFFQSwrQ0FBK0M7WUFDL0MsTUFBTWdCLFdBQVdMLE9BQU9LLFFBQVEsQ0FBQ0MsV0FBVztZQUM1QyxJQUFJRCxhQUFhLGVBQ2JBLFNBQVNFLFVBQVUsQ0FBQyxXQUNwQkYsU0FBU0UsVUFBVSxDQUFDLGVBQ3BCRixTQUFTRSxVQUFVLENBQUMsVUFDcEJGLFNBQVNILFFBQVEsQ0FBQyxhQUFhO2dCQUNqQyxPQUFPO29CQUFFRSxPQUFPO29CQUFPZixPQUFPO2dCQUF5QztZQUN6RTtZQUVBLE9BQU87Z0JBQUVlLE9BQU87WUFBSztRQUV2QixFQUFFLE9BQU9mLE9BQU87WUFDZCxPQUFPO2dCQUFFZSxPQUFPO2dCQUFPZixPQUFPO1lBQXFCO1FBQ3JEO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1tQixlQUFlcEUsR0FBVyxFQUFtRDtRQUNqRixNQUFNcUUsYUFBYSxNQUFNLElBQUksQ0FBQ1YsV0FBVyxDQUFDM0Q7UUFDMUMsSUFBSSxDQUFDcUUsV0FBV0wsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQUVNLFdBQVc7Z0JBQU9yQixPQUFPb0IsV0FBV3BCLEtBQUs7WUFBQztRQUNyRDtRQUVBLE1BQU01QyxVQUFVLE1BQU1ULGdEQUFRQSxDQUFDVSxNQUFNLENBQUM7WUFBRUMsVUFBVTtRQUFLO1FBRXZELElBQUk7WUFDRixNQUFNRSxPQUFPLE1BQU1KLFFBQVFLLE9BQU87WUFDbEMsTUFBTUQsS0FBS0UsSUFBSSxDQUFDWCxLQUFLO2dCQUNuQlksV0FBVztnQkFDWEMsU0FBUztZQUNYO1lBRUEsTUFBTVcsUUFBUSxNQUFNZixLQUFLZSxLQUFLO1lBQzlCLE9BQU87Z0JBQ0w4QyxXQUFXO2dCQUNYckIsT0FBT3pCLFFBQVFLLFlBQVk7WUFDN0I7UUFFRixFQUFFLE9BQU9vQixPQUFPO1lBQ2QsT0FBTztnQkFDTHFCLFdBQVc7Z0JBQ1hyQixPQUFPLENBQUMsc0JBQXNCLEVBQUVBLGlCQUFpQk0sUUFBUU4sTUFBTU8sT0FBTyxHQUFHQyxPQUFPUixRQUFRO1lBQzFGO1FBQ0YsU0FBVTtZQUNSLE1BQU01QyxRQUFRcUQsS0FBSztRQUNyQjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXJrdXNob2duZS9Eb2N1bWVudHMvQVBQUy9iYXphYXItdmlkL2JhemFhci12aWQvYXBwcy9tYWluL3NyYy90b29scy93ZWJBbmFseXNpcy9XZWJBbmFseXNpc0FnZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNocm9taXVtIH0gZnJvbSAncGxheXdyaWdodCc7XG5pbXBvcnQgeyB1cGxvYWRXZWJBbmFseXNpc1NjcmVlbnNob3RzIH0gZnJvbSAnfi9saWIvdXRpbHMvcjItdXBsb2FkJztcblxuZXhwb3J0IGludGVyZmFjZSBXZWJBbmFseXNpc1Jlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHVybD86IHN0cmluZztcbiAgc2NyZWVuc2hvdHM/OiB7XG4gICAgZGVza3RvcDogQnVmZmVyO1xuICAgIG1vYmlsZTogQnVmZmVyO1xuICB9O1xuICBzY3JlZW5zaG90VXJscz86IHtcbiAgICBkZXNrdG9wOiBzdHJpbmc7XG4gICAgbW9iaWxlOiBzdHJpbmc7XG4gIH07XG4gIHBhZ2VEYXRhPzoge1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgaGVhZGluZ3M6IHN0cmluZ1tdO1xuICAgIHVybDogc3RyaW5nO1xuICB9O1xuICBlcnJvcj86IHN0cmluZztcbiAgYW5hbHl6ZWRBdD86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFdlYkFuYWx5c2lzQWdlbnQge1xuICBhc3luYyBhbmFseXplV2Vic2l0ZSh1cmw6IHN0cmluZywgcHJvamVjdElkPzogc3RyaW5nLCB1c2VySWQ/OiBzdHJpbmcpOiBQcm9taXNlPFdlYkFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc29sZS5sb2coYPCfjJAgQW5hbHl6aW5nOiAke3VybH1gKTtcbiAgICBcbiAgICBjb25zdCBicm93c2VyID0gYXdhaXQgY2hyb21pdW0ubGF1bmNoKHsgXG4gICAgICBoZWFkbGVzczogdHJ1ZSxcbiAgICAgIGFyZ3M6IFsnLS1uby1zYW5kYm94JywgJy0tZGlzYWJsZS1zZXR1aWQtc2FuZGJveCddIC8vIEZvciBwcm9kdWN0aW9uIGRlcGxveW1lbnRcbiAgICB9KTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IGJyb3dzZXIubmV3UGFnZSgpO1xuICAgICAgXG4gICAgICAvLyBOYXZpZ2F0ZSB3aXRoIHRpbWVvdXRcbiAgICAgIGNvbnNvbGUubG9nKCfwn5ONIE5hdmlnYXRpbmcgdG8gd2Vic2l0ZS4uLicpO1xuICAgICAgYXdhaXQgcGFnZS5nb3RvKHVybCwgeyBcbiAgICAgICAgd2FpdFVudGlsOiAnbmV0d29ya2lkbGUnLFxuICAgICAgICB0aW1lb3V0OiAxMDAwMCBcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBEZXNrdG9wIHNjcmVlbnNob3RcbiAgICAgIGNvbnNvbGUubG9nKCfwn5al77iPIFRha2luZyBkZXNrdG9wIHNjcmVlbnNob3QuLi4nKTtcbiAgICAgIGF3YWl0IHBhZ2Uuc2V0Vmlld3BvcnRTaXplKHsgd2lkdGg6IDEyODAsIGhlaWdodDogODAwIH0pO1xuICAgICAgY29uc3QgZGVza3RvcFNjcmVlbnNob3QgPSBhd2FpdCBwYWdlLnNjcmVlbnNob3QoeyBcbiAgICAgICAgdHlwZTogJ3BuZycsXG4gICAgICAgIGZ1bGxQYWdlOiBmYWxzZSBcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBNb2JpbGUgc2NyZWVuc2hvdCAgXG4gICAgICBjb25zb2xlLmxvZygn8J+TsSBUYWtpbmcgbW9iaWxlIHNjcmVlbnNob3QuLi4nKTtcbiAgICAgIGF3YWl0IHBhZ2Uuc2V0Vmlld3BvcnRTaXplKHsgd2lkdGg6IDM5MCwgaGVpZ2h0OiA4NDQgfSk7XG4gICAgICBjb25zdCBtb2JpbGVTY3JlZW5zaG90ID0gYXdhaXQgcGFnZS5zY3JlZW5zaG90KHsgXG4gICAgICAgIHR5cGU6ICdwbmcnLFxuICAgICAgICBmdWxsUGFnZTogZmFsc2UgXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCBwYWdlIGRhdGFcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OEIEV4dHJhY3RpbmcgcGFnZSBkYXRhLi4uJyk7XG4gICAgICBjb25zdCBwYWdlRGF0YSA9IGF3YWl0IHBhZ2UuZXZhbHVhdGUoKCkgPT4gKHtcbiAgICAgICAgdGl0bGU6IGRvY3VtZW50LnRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPVwiZGVzY3JpcHRpb25cIl0nKT8uZ2V0QXR0cmlidXRlKCdjb250ZW50JykgfHwgXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21ldGFbcHJvcGVydHk9XCJvZzpkZXNjcmlwdGlvblwiXScpPy5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKSB8fCB1bmRlZmluZWQsXG4gICAgICAgIGhlYWRpbmdzOiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2gxLCBoMiwgaDMnKSlcbiAgICAgICAgICAubWFwKGggPT4gaC50ZXh0Q29udGVudD8udHJpbSgpKVxuICAgICAgICAgIC5maWx0ZXIoKHRleHQpOiB0ZXh0IGlzIHN0cmluZyA9PiBCb29sZWFuKHRleHQpKVxuICAgICAgICAgIC5zbGljZSgwLCAxMCksIC8vIExpbWl0IHRvIGZpcnN0IDEwIGhlYWRpbmdzXG4gICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWZcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYOKchSBBbmFseXNpcyBjb21wbGV0ZSBmb3IgJHtwYWdlRGF0YS50aXRsZX1gKTtcbiAgICAgIFxuICAgICAgLy8gVXBsb2FkIHNjcmVlbnNob3RzIHRvIFIyIGlmIHByb2plY3RJZCBwcm92aWRlZFxuICAgICAgbGV0IHNjcmVlbnNob3RVcmxzOiB7IGRlc2t0b3A6IHN0cmluZzsgbW9iaWxlOiBzdHJpbmcgfSB8IHVuZGVmaW5lZDtcbiAgICAgIGlmIChwcm9qZWN0SWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+TpCBVcGxvYWRpbmcgc2NyZWVuc2hvdHMgdG8gUjIuLi4nKTtcbiAgICAgICAgICBzY3JlZW5zaG90VXJscyA9IGF3YWl0IHVwbG9hZFdlYkFuYWx5c2lzU2NyZWVuc2hvdHMoXG4gICAgICAgICAgICB7IGRlc2t0b3A6IGRlc2t0b3BTY3JlZW5zaG90LCBtb2JpbGU6IG1vYmlsZVNjcmVlbnNob3QgfSxcbiAgICAgICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgICAgIHVzZXJJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBTY3JlZW5zaG90cyB1cGxvYWRlZCB0byBSMicpO1xuICAgICAgICB9IGNhdGNoICh1cGxvYWRFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gdXBsb2FkIHNjcmVlbnNob3RzOicsIHVwbG9hZEVycm9yKTtcbiAgICAgICAgICAvLyBDb250aW51ZSB3aXRob3V0IFIyIFVSTHMgLSBzY3JlZW5zaG90cyBzdGlsbCBhdmFpbGFibGUgYXMgYnVmZmVyc1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHVybCxcbiAgICAgICAgc2NyZWVuc2hvdHM6IHtcbiAgICAgICAgICBkZXNrdG9wOiBkZXNrdG9wU2NyZWVuc2hvdCxcbiAgICAgICAgICBtb2JpbGU6IG1vYmlsZVNjcmVlbnNob3RcbiAgICAgICAgfSxcbiAgICAgICAgc2NyZWVuc2hvdFVybHMsXG4gICAgICAgIHBhZ2VEYXRhLFxuICAgICAgICBhbmFseXplZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH07XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEFuYWx5c2lzIGZhaWxlZDonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcikpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgIHVybFxuICAgICAgfTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgYnJvd3Nlci5jbG9zZSgpO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIFZhbGlkYXRlIGlmIGEgVVJMIGlzIGFjY2Vzc2libGUgYW5kIHNhZmUgdG8gYW5hbHl6ZVxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVVcmwodXJsOiBzdHJpbmcpOiBQcm9taXNlPHsgdmFsaWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFyc2VkID0gbmV3IFVSTCh1cmwpO1xuICAgICAgXG4gICAgICAvLyBPbmx5IGFsbG93IGh0dHAvaHR0cHNcbiAgICAgIGlmICghWydodHRwOicsICdodHRwczonXS5pbmNsdWRlcyhwYXJzZWQucHJvdG9jb2wpKSB7XG4gICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdPbmx5IEhUVFAgYW5kIEhUVFBTIFVSTHMgYXJlIHN1cHBvcnRlZCcgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQmxvY2sgbG9jYWxob3N0IGFuZCBwcml2YXRlIElQcyBmb3Igc2VjdXJpdHlcbiAgICAgIGNvbnN0IGhvc3RuYW1lID0gcGFyc2VkLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAoaG9zdG5hbWUgPT09ICdsb2NhbGhvc3QnIHx8IFxuICAgICAgICAgIGhvc3RuYW1lLnN0YXJ0c1dpdGgoJzEyNy4nKSB8fCBcbiAgICAgICAgICBob3N0bmFtZS5zdGFydHNXaXRoKCcxOTIuMTY4LicpIHx8XG4gICAgICAgICAgaG9zdG5hbWUuc3RhcnRzV2l0aCgnMTAuJykgfHxcbiAgICAgICAgICBob3N0bmFtZS5pbmNsdWRlcygnaW50ZXJuYWwnKSkge1xuICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnTG9jYWwgYW5kIHByaXZhdGUgVVJMcyBhcmUgbm90IGFsbG93ZWQnIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7IHZhbGlkOiB0cnVlIH07XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgVVJMIGZvcm1hdCcgfTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBUZXN0IGlmIHRoZSBhZ2VudCBjYW4gYW5hbHl6ZSBhIGdpdmVuIFVSTCB3aXRob3V0IGFjdHVhbGx5IGRvaW5nIHRoZSBhbmFseXNpc1xuICAgKi9cbiAgYXN5bmMgdGVzdENvbm5lY3Rpb24odXJsOiBzdHJpbmcpOiBQcm9taXNlPHsgcmVhY2hhYmxlOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVVcmwodXJsKTtcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7IHJlYWNoYWJsZTogZmFsc2UsIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIH07XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBjaHJvbWl1bS5sYXVuY2goeyBoZWFkbGVzczogdHJ1ZSB9KTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IGJyb3dzZXIubmV3UGFnZSgpO1xuICAgICAgYXdhaXQgcGFnZS5nb3RvKHVybCwgeyBcbiAgICAgICAgd2FpdFVudGlsOiAnZG9tY29udGVudGxvYWRlZCcsXG4gICAgICAgIHRpbWVvdXQ6IDUwMDAgXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgdGl0bGUgPSBhd2FpdCBwYWdlLnRpdGxlKCk7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgcmVhY2hhYmxlOiB0cnVlLCBcbiAgICAgICAgZXJyb3I6IHRpdGxlID8gdW5kZWZpbmVkIDogJ1BhZ2UgbG9hZGVkIGJ1dCBubyB0aXRsZSBmb3VuZCcgXG4gICAgICB9O1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IFxuICAgICAgICByZWFjaGFibGU6IGZhbHNlLCBcbiAgICAgICAgZXJyb3I6IGBDYW5ub3QgcmVhY2ggd2Vic2l0ZTogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCBcbiAgICAgIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGF3YWl0IGJyb3dzZXIuY2xvc2UoKTtcbiAgICB9XG4gIH1cbn0iXSwibmFtZXMiOlsiY2hyb21pdW0iLCJ1cGxvYWRXZWJBbmFseXNpc1NjcmVlbnNob3RzIiwiV2ViQW5hbHlzaXNBZ2VudCIsImFuYWx5emVXZWJzaXRlIiwidXJsIiwicHJvamVjdElkIiwidXNlcklkIiwiY29uc29sZSIsImxvZyIsImJyb3dzZXIiLCJsYXVuY2giLCJoZWFkbGVzcyIsImFyZ3MiLCJwYWdlIiwibmV3UGFnZSIsImdvdG8iLCJ3YWl0VW50aWwiLCJ0aW1lb3V0Iiwic2V0Vmlld3BvcnRTaXplIiwid2lkdGgiLCJoZWlnaHQiLCJkZXNrdG9wU2NyZWVuc2hvdCIsInNjcmVlbnNob3QiLCJ0eXBlIiwiZnVsbFBhZ2UiLCJtb2JpbGVTY3JlZW5zaG90IiwicGFnZURhdGEiLCJldmFsdWF0ZSIsInRpdGxlIiwiZG9jdW1lbnQiLCJkZXNjcmlwdGlvbiIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRBdHRyaWJ1dGUiLCJ1bmRlZmluZWQiLCJoZWFkaW5ncyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtYXAiLCJoIiwidGV4dENvbnRlbnQiLCJ0cmltIiwiZmlsdGVyIiwidGV4dCIsIkJvb2xlYW4iLCJzbGljZSIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsInNjcmVlbnNob3RVcmxzIiwiZGVza3RvcCIsIm1vYmlsZSIsInVwbG9hZEVycm9yIiwiZXJyb3IiLCJzdWNjZXNzIiwic2NyZWVuc2hvdHMiLCJhbmFseXplZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiRXJyb3IiLCJtZXNzYWdlIiwiU3RyaW5nIiwiY2xvc2UiLCJ2YWxpZGF0ZVVybCIsInBhcnNlZCIsIlVSTCIsImluY2x1ZGVzIiwicHJvdG9jb2wiLCJ2YWxpZCIsImhvc3RuYW1lIiwidG9Mb3dlckNhc2UiLCJzdGFydHNXaXRoIiwidGVzdENvbm5lY3Rpb24iLCJ2YWxpZGF0aW9uIiwicmVhY2hhYmxlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/tools/webAnalysis/WebAnalysisAgent.ts\n");

/***/ }),

/***/ "(ssr)/../../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!**********************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \**********************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../../server/app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@aws-sdk/client-s3":
/*!*************************************!*\
  !*** external "@aws-sdk/client-s3" ***!
  \*************************************/
/***/ ((module) => {

"use strict";
module.exports = require("@aws-sdk/client-s3");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "drizzle-orm":
/*!******************************!*\
  !*** external "drizzle-orm" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = import("drizzle-orm");;

/***/ }),

/***/ "drizzle-orm/mysql-core":
/*!*****************************************!*\
  !*** external "drizzle-orm/mysql-core" ***!
  \*****************************************/
/***/ ((module) => {

"use strict";
module.exports = import("drizzle-orm/mysql-core");;

/***/ }),

/***/ "drizzle-orm/neon-http":
/*!****************************************!*\
  !*** external "drizzle-orm/neon-http" ***!
  \****************************************/
/***/ ((module) => {

"use strict";
module.exports = import("drizzle-orm/neon-http");;

/***/ }),

/***/ "drizzle-orm/pg-core":
/*!**************************************!*\
  !*** external "drizzle-orm/pg-core" ***!
  \**************************************/
/***/ ((module) => {

"use strict";
module.exports = import("drizzle-orm/pg-core");;

/***/ }),

/***/ "drizzle-orm/sqlite-core":
/*!******************************************!*\
  !*** external "drizzle-orm/sqlite-core" ***!
  \******************************************/
/***/ ((module) => {

"use strict";
module.exports = import("drizzle-orm/sqlite-core");;

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:buffer":
/*!******************************!*\
  !*** external "node:buffer" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:buffer");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream/web");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "playwright":
/*!*****************************!*\
  !*** external "playwright" ***!
  \*****************************/
/***/ ((module) => {

"use strict";
module.exports = import("playwright");;

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("string_decoder");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@opentelemetry","vendor-chunks/@trpc","vendor-chunks/superjson","vendor-chunks/is-what","vendor-chunks/copy-anything","vendor-chunks/@neondatabase","vendor-chunks/oauth4webapi","vendor-chunks/@auth","vendor-chunks/cookie","vendor-chunks/@panva","vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/@anthropic-ai","vendor-chunks/winston","vendor-chunks/logform","vendor-chunks/async","vendor-chunks/winston-transport","vendor-chunks/form-data-encoder","vendor-chunks/@colors","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/@dabh","vendor-chunks/uuid","vendor-chunks/colorspace","vendor-chunks/call-bind-apply-helpers","vendor-chunks/triple-beam","vendor-chunks/regexp.prototype.flags","vendor-chunks/object-is","vendor-chunks/agentkeepalive","vendor-chunks/object-keys","vendor-chunks/get-proto","vendor-chunks/fast-json-patch","vendor-chunks/@t3-oss","vendor-chunks/winston-daily-rotate-file","vendor-chunks/string_decoder","vendor-chunks/simple-swizzle","vendor-chunks/inherits","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/zod","vendor-chunks/util-deprecate","vendor-chunks/text-hex","vendor-chunks/stack-trace","vendor-chunks/set-function-name","vendor-chunks/set-function-length","vendor-chunks/safe-stable-stringify","vendor-chunks/one-time","vendor-chunks/object-hash","vendor-chunks/ms","vendor-chunks/moment","vendor-chunks/kuler","vendor-chunks/is-stream","vendor-chunks/is-regex","vendor-chunks/is-date-object","vendor-chunks/is-arguments","vendor-chunks/humanize-ms","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/has-property-descriptors","vendor-chunks/get-intrinsic","vendor-chunks/functions-have-names","vendor-chunks/fn.name","vendor-chunks/file-stream-rotator","vendor-chunks/fecha","vendor-chunks/event-target-shim","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/enabled","vendor-chunks/dunder-proto","vendor-chunks/define-properties","vendor-chunks/define-data-property","vendor-chunks/deep-equal","vendor-chunks/color-string","vendor-chunks/color-name","vendor-chunks/call-bound","vendor-chunks/call-bind","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&page=%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftrpc%2F%5Btrpc%5D%2Froute.ts&appDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmarkushogne%2FDocuments%2FAPPS%2Fbazaar-vid%2Fbazaar-vid%2Fapps%2Fmain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();